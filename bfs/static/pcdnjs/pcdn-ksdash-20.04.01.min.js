!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).ksp2ploader=t()}}(function(){var define,module,exports;return function r(e,o,a){function u(i,t){if(!o[i]){if(!e[i]){var s="function"==typeof require&&require;if(!t&&s)return s(i,!0);if(c)return c(i,!0);var n=new Error("Cannot find module '"+i+"'");throw n.code="MODULE_NOT_FOUND",n}var h=o[i]={exports:{}};e[i][0].call(h.exports,function(t){return u(e[i][1][t]||t)},h,h.exports,r,e,o,a)}return o[i].exports}for(var c="function"==typeof require&&require,t=0;t<a.length;t++)u(a[t]);return u}({1:[function(t,i,s){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function a(t){return"function"==typeof t}function u(t){return"object"==typeof t&&null!==t}function c(t){return void 0===t}((i.exports=n).EventEmitter=n).prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},n.prototype.emit=function(t){var i,s,n,h,r,e;if(this._events||(this._events={}),"error"===t&&(!this._events.error||u(this._events.error)&&!this._events.error.length)){if((i=arguments[1])instanceof Error)throw i;var o=new Error('Uncaught, unspecified "error" event. ('+i+")");throw o.context=i,o}if(c(s=this._events[t]))return!1;if(a(s))switch(arguments.length){case 1:s.call(this);break;case 2:s.call(this,arguments[1]);break;case 3:s.call(this,arguments[1],arguments[2]);break;default:h=Array.prototype.slice.call(arguments,1),s.apply(this,h)}else if(u(s))for(h=Array.prototype.slice.call(arguments,1),n=(e=s.slice()).length,r=0;r<n;r++)e[r].apply(this,h);return!0},n.prototype.on=n.prototype.addListener=function(t,i){var s;if(!a(i))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,a(i.listener)?i.listener:i),this._events[t]?u(this._events[t])?this._events[t].push(i):this._events[t]=[this._events[t],i]:this._events[t]=i,u(this._events[t])&&!this._events[t].warned&&(s=c(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&0<s&&this._events[t].length>s&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.once=function(t,i){if(!a(i))throw TypeError("listener must be a function");var s=!1;function n(){this.removeListener(t,n),s||(s=!0,i.apply(this,arguments))}return n.listener=i,this.on(t,n),this},n.prototype.removeListener=function(t,i){var s,n,h,r;if(!a(i))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(h=(s=this._events[t]).length,n=-1,s===i||a(s.listener)&&s.listener===i)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,i);else if(u(s)){for(r=h;0<r--;)if(s[r]===i||s[r].listener&&s[r].listener===i){n=r;break}if(n<0)return this;1===s.length?(s.length=0,delete this._events[t]):s.splice(n,1),this._events.removeListener&&this.emit("removeListener",t,i)}return this},n.prototype.removeAllListeners=function(t){var i,s;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(i in this._events)"removeListener"!==i&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events={},this}if(a(s=this._events[t]))this.removeListener(t,s);else if(s)for(;s.length;)this.removeListener(t,s[s.length-1]);return delete this._events[t],this},n.prototype.listeners=function(t){return this._events&&this._events[t]?a(this._events[t])?[this._events[t]]:this._events[t].slice():[]},n.prototype.listenerCount=function(t){if(this._events){var i=this._events[t];if(a(i))return 1;if(i)return i.length}return 0},n.listenerCount=function(t,i){return t.listenerCount(i)}},{}],2:[function(t,i,s){"use strict";s.__esModule=!0;var o=f(t("../utils/string-utils")),n=f(t("../../p2p/core/loader/ks-httploader")),a=t("../utils/md5"),u=t("../utils/crc"),h=t("../utils/ks-log"),r=f(t("../utils/global")),e=f(t("../utils/ks-object")),c=f(t("./version"));function f(t){return t&&t.__esModule?t:{default:t}}var l=function(){function i(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,i),this.t="DynamicConfig",this.s=!1,this.n=t.n,this.h=t,this.r=this.h.r,this.o=new n.default(this),this.a="kcgc",this.u=0,this.c=5,this.f="",this.l=30*r.default.p*r.default.b}return i.prototype.destroy=function(){this.close(),this.o=null,this.r=null,this.h=null,this.n=null},i.prototype.open=function(){this.s||(this.s=!0,this.setIntervalTimer(this.l),this.load(),this.y())},i.prototype.setIntervalTimer=function(t){this.g&&clearInterval(this.g);var i=this;this.g=setInterval(function(){i.u=0,i.y()},t)},i.prototype.close=function(){this.s&&(this.s=!1,this.o&&this.o.close(),this.o=null,this.g&&clearInterval(this.g))},i.prototype.load=function(){var t=this.n.get(this.a);if(o.default._(t))this.r.warn(this.t,"failed to loaded config from local storage");else{var i=this.S(t),s=i[0],n=i[1];s?(this.h.T=n.kcgId||this.h.T,this.A(n||{})):this.r.warn(this.t,"config check failed")}},i.prototype.S=function(t){var i=[!1,{}],s=t.split("_");if(2!==s.length)return i;var n=s[0],h=o.default.M(s[1]),r=u.CryptoCRC.C(o.default.O(h)),e=a.Md5.R(r).toLowerCase();return i[0]=n===e,i[1]=o.default.P(h),i},i.prototype.U=function(t,i){this.s&&(this.u>=this.c||this.y())},i.prototype.I=function(t){if(this.s&&(this.r.info(this.t,"Http complete for tag("+t.getTag()+"), response code("+t.N+"), details("+t.x+"), size("+t.j+")"),"dynamic-config"===t.getTag())){var i=o.default.L(t.$.array());if(this.r.trace(this.t,i),""!==i){var s=o.default.P(i),n=s.status,h=s.policy;0===n?(this.A(h||{}),this.save(h||{})):this.r.warn(this.t,"query config error, error code("+n+")")}else this.r.warn(this.t,"query config error, response empty")}},i.prototype.A=function(t){if(t.hasOwnProperty("http.secure")&&(this.h.W.D=o.default.parseBool(t["http.secure"],this.h.W.q)),t.hasOwnProperty("slb.domain")&&(this.h.W.B=t["slb.domain"]),t.hasOwnProperty("log.type")&&(this.h.F=new e.default(t["log.type"]).asInt(),h.KsLog.setLogType(this.h.F)),t.hasOwnProperty("log.level")&&(this.h.z=new e.default(t["log.level"]).asInt(),h.KsLog.setLogLevel(this.h.z)),t.hasOwnProperty("dynamic_config.interval")){var i=new e.default(t["dynamic_config.interval"]).asInt();i=i*r.default.p*r.default.b,this.l!==i&&(this.l=i,this.setIntervalTimer(this.l))}},i.prototype.y=function(){if(this.h.V){this.u++;var t="https://slb-p2p.vcloud.ks-live.com/config/v2?customid="+this.h.H+"&mt="+this.h.J+"&tid=4&deviceid="+this.h.T+"&cdid=&hwtype=&module="+this.h.K+"&os="+this.h.G+"&osver="+(this.h.Q?this.h.Q:"")+"&arch=&mac=&appname="+this.h.X+"&appver="+this.h.Y+"&sdkver=&modulever="+c.default.Z()+"&net_type=";this.o.setTimer("config",10*r.default.b,this.o.create()).it("dynamic-config").open(t)}},i.prototype.save=function(t){t.kcgId=this.h.T;var i=JSON.stringify(t),s=u.CryptoCRC.C(o.default.O(i)),n=a.Md5.R(s).toLowerCase();this.f!==n&&(this.n.set(this.a,n+"_"+o.default.st(i)),this.f=n)},i}();s.default=l},{"../../p2p/core/loader/ks-httploader":25,"../utils/crc":6,"../utils/global":9,"../utils/ks-log":12,"../utils/ks-object":13,"../utils/md5":16,"../utils/string-utils":17,"./version":5}],3:[function(t,i,s){"use strict";s.__esModule=!0,s.OSType=s.BrowserType=void 0;var n=a(t("../utils/local-store")),h=a(t("../utils/string-utils")),r=a(t("./version")),e=t("../utils/ks-log"),o=a(t("../utils/global"));function a(t){return t&&t.__esModule?t:{default:t}}function u(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}var f=function t(){u(this,t),this.nt=10,this.ht=10,this.et=1,this.ot=2,this.ut="kingdata.ksyun.com",this.ft="pcth-cdn.ksyun.com:8082",this.lt="/kcg-console-connection",this.vt=60,this.dt=13,this.bt=6e3,this.wt=!1,this.kt=100,this.yt=1e4,this.gt=100,this.q=1e4,this.D=!0,this._t=3e4,this.St=60,this.B="slb-p2p.vcloud.ks-live.com",this.Tt="tracker.vcloud.ks-live.com"},l=s.BrowserType={Et:0,At:1,Mt:2,Ct:4,Ot:8,Rt:16,Pt:32,Ut:64,It:128,Nt:256},v=s.OSType={xt:0,jt:1,Lt:2,$t:4,Dt:8,Wt:16,qt:32},c=function(){function c(){u(this,c),this.t="Environment",this.Bt=null,this.W=new f,this.Ft=!1,this.zt=!1,this.Vt=!1,this.Ht=!1,this.V=!0,this.z=254,this.F=e.LogType.Jt,this.Kt="",this.Gt="120.92.215.15:8085",this.Qt=1,this.Xt=!0,this.Yt=104857600,this.Zt=10,this.ti=!1,this.si=!1,this.ni=!1,this.hi=!1,this.ri=!1,this.ei=!0,this.oi=!1,this.csid="",this.H="test_h5",this.ai(),this.ui(),this.ci(),this.fi(),this.li(),this.J="video",this.r=new e.KsLog,this.n=new n.default,this.vi=!1,this.mi=!1,this.pi=2,this.di=10,this.bi=!0}return c.getInstance=function(){return this.instance||(this.instance=new c),this.instance},c.prototype.init=function(t,i,s){var n=this;this.wi=s,this.ki=this.wi.ki,this.r.init(this),this.yi="",this.gi="",this._i=t,this.J=t.mediaType,this.K="kcg-h5",this.Si=h.default.format("{0}-{1}",this.K,r.default.Ti()),this.Ei=h.default.format("{0}{1}{2}{3}",Math.floor(1001*Math.random()),Math.floor(1001*Math.random()),Math.floor(1001*Math.random()),o.default.Ai()),this.T=this.Ei,this.Mi(),this.Ci(i),this.Oi=setInterval(function(){n.li()},1e4),this.bi=!0},c.prototype.Mi=function(){-1!==this._i.url.indexOf("?")?this._i.url+="&kcgt="+o.default.Ai():this._i.url+="?kcgt="+o.default.Ai()},c.prototype.unInit=function(){this.wi=null,this.r&&this.r.unInit(),this.r=null,this.n=null,this._i=null,this.Oi&&clearInterval(this.Oi),this.Oi=null,c.instance=null,this.vi=!1,this.mi=!1,this.bi=!0},c.prototype.li=function(){try{this.n.get("kcg.usp")&&(this.Xt=this.n.get("kcg.usp")),this.n.get("kcg.ll")&&(this.z=this.n.get("kcg.ll")),this.n.get("kcg.lt")&&(this.F=this.n.get("kcg.lt")),this.n.get("kcg.li")&&(this.Qt=this.n.get("kcg.li")),this.n.get("kcg.la")&&(this.oi=this.n.get("kcg.la")),this.n.get("kcg.ls")&&(this.Kt=this.n.get("kcg.ls")),this.n.get("kcg.udc")&&(this.V=this.n.get("kcg.udc")),this.n.get("kcg.drtc")&&(this.ti=this.n.get("kcg.drtc")),this.n.get("kcg.dwst")&&(this.si=this.n.get("kcg.dwst")),this.n.get("kcg.dspnd")&&(this.ni=this.n.get("kcg.dspnd")),this.z<=0&&(this.z=0),this.oi<=0&&(this.oi=!1),this.F<=0&&(this.F=0),e.KsLog.F=this.F,e.KsLog.Ri=this.z,""===this.Kt&&(this.Kt=this.Gt)}catch(t){this.Oi&&clearInterval(this.Oi)}},c.prototype.Pi=function(){if(this._i.videoTag){var t=this._i.videoTag;1<t.buffered.length&&this.r.info(this.t,"videoTag.length > 1 = "+t.buffered.length);for(var i=0;i<t.buffered.length;i++)if(t.buffered.start(i)-t.currentTime<=.5&&t.currentTime<=t.buffered.end(i))return t.buffered.end(i)-t.currentTime}return 0},c.prototype.Ui=function(){return!(!this._i.videoTag||1!=this._i.videoTag.seeking)},c.prototype.fi=function(){try{var t=window.MediaSource||window.WebKitMediaSource;t&&(this.Ft=!0,this.zt=t.isTypeSupported('video/webm; codecs="vorbis,vp8"'),this.Vt=t.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),this.Ht=t.isTypeSupported('video/mp2t; codecs="avc1.42E01E,mp4a.40.2"'));var i=!!navigator.mozGetUserMedia;this.hi=!(i&&!navigator.mozGetUserMedia||!i&&!navigator.webkitGetUserMedia)}catch(t){this.r.info(this.t,"TestMediaSource error:"+t.toString())}},c.prototype.ai=function(){var t=this.Ii(),i=!1,s=c.Ni,n=Array.isArray(s),h=0;for(s=n?s:s[Symbol.iterator]();;){var r;if(n){if(h>=s.length)break;r=s[h++]}else{if((h=s.next()).done)break;r=h.value}var e=r,o=e[0],a=e[1],u=e[2];if(o===t.browser){this.xi=a,this.X=u,this.Y=t.ver,i=!0;break}}i||(this.xi=l.Nt,this.X="Other",this.Y="0")},c.prototype.ui=function(){this.G=this.ji()},c.prototype.Ci=function(t){t.hasOwnProperty("netCoreUseP2P")&&(this.Xt=t.netCoreUseP2P),t.hasOwnProperty("logLevel")&&(this.z=t.logLevel),t.hasOwnProperty("logType")&&(this.F=t.logType),t.hasOwnProperty("udc")&&(this.V=t.udc),t.hasOwnProperty("disableWebrtc")&&(this.ti=t.disableWebrtc),t.hasOwnProperty("disableWebsocket")&&(this.si=t.disableWebsocket),t.hasOwnProperty("customid")&&(this.H=t.customid),this.li()},c.prototype.Ii=function(){var t={},i=navigator.userAgent.toLowerCase(),s=/(edge)\/([\w.]+)/.exec(i)||/(opr)[\/]([\w.]+)/.exec(i)||/(ubrowser)[\/]([\w.]+)/.exec(i)||/(qqbrowser)[\/]([\w.]+)/.exec(i)||/(chrome)[ \/]([\w.]+)/.exec(i)||/(iemobile)[\/]([\w.]+)/.exec(i)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(i)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(i)||/(webkit)[ \/]([\w.]+)/.exec(i)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(i)||/(msie) ([\w.]+)/.exec(i)||0<=i.indexOf("trident")&&/(rv)(?::| )([\w.]+)/.exec(i)||i.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(i)||[];return t.browser=s[5]||s[3]||s[1]||"",t.ver=s[4]||s[2]||"0",t},c.prototype.ci=function(){var t=navigator.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|IEMobile/i);this.Li=!!t,this.$i=this.Li&&0<t.length?t[0]:this.Di},c.prototype.ji=function(){var t=navigator.userAgent,i="Win32"===navigator.platform||"Windows"===navigator.platform||"Win64"===navigator.platform,s="Mac68K"===navigator.platform||"MacPPC"===navigator.platform||"Macintosh"===navigator.platform||"MacIntel"===navigator.platform;if(this.Wi=v.xt,this.Di="Unkonwn",s)return this.Wi=v.jt,this.Di="Mac",this.Di;if(t.toLowerCase().match(/iphone|ipad|ipod/i)||navigator.platform.toLowerCase().match(/iphone|ipad|ipod/i))return this.Wi=v.qt,this.Di="IOS",this.Di;if(t.toLowerCase().match(/android/i)||navigator.platform.toLowerCase().match(/android/i))return this.Wi=v.Wt,this.Di="Android",this.Di;if("X11"===navigator.platform&&!i&&!s)return this.Wi=v.Dt,this.Di="Unix",this.Di;if(-1<String(navigator.platform).indexOf("Linux"))return this.Wi=v.$t,this.Di="Linux",this.Di;if(i){this.Wi=v.Lt,this.Di="Windows";var n=c.SubOSTypeTable,h=Array.isArray(n),r=0;for(n=h?n:n[Symbol.iterator]();;){var e;if(h){if(r>=n.length)break;e=n[r++]}else{if((r=n.next()).done)break;e=r.value}var o=e,a=o[0],u=o[1];if(-1<t.indexOf(a))return u}return"Windows"}return"other"},c.prototype.detectOSVersion=function(){this.Q=this.getOSVersion()},c.prototype.getOSVersion=function(){var t=navigator.userAgent,i="";if(-1<t.indexOf("Mac OS X")){i=(t.match(/OS [\d._]*/gi)+"").replace(/[^0-9|_.]/gi,"").replace(/_/gi,".")}else-1<t.indexOf("Android")||-1<t.indexOf("Linux")?i=t.substr(t.indexOf("Android")+8,t.indexOf(";",t.indexOf("Android"))-t.indexOf("Android")-8):-1<t.indexOf("BB10")?i=t.substr(t.indexOf("BB10")+5,t.indexOf(";",t.indexOf("BB10"))-t.indexOf("BB10")-5):t.indexOf("IEMobile")&&(i=t.substr(t.indexOf("IEMobile")+9,t.indexOf(";",t.indexOf("IEMobile"))-t.indexOf("IEMobile")-9));return i},c.prototype.qi=function(t){t.p2pEnabled=this.ei,t.p2pUploadEnabled=1,t.liveStorageMemoryOnly=0,t.vodStorageMemoryOnly=0,t.cdnKeepAlive=0,t.networkType="WIFI",t.externalAppPackageName="",t.moduleVersion=this.Si,t.moduleId=this.T,t.listenAddress=0,t.clientGeo=this.yi,t.clientGeoName=this.yi,t.clientIp=this.gi,t.deviceType=this.$i,t.osType=this.Wi,t.globalProxyUrl="",t.hlsServerPort=0,t.livePlayOffset=this.W.vt,t.keyDataCacheCount=0,t.browserName=this.X},c}();(s.default=c).SubOSTypeTable=[["Windows NT 5.0","Win2000"],["Windows 2000","Win2000"],["Windows NT 5.1","WinXP"],["Windows XP","WinXP"],["Windows NT 5.2","Win2003"],["Windows 2003","Win2003"],["Windows NT 6.0","WinVista"],["Windows Vista","WinVista"],["Windows NT 6.1","Win7"],["Windows 7","Win7"],["Windows NT 6.2","Win8"],["Windows 8","Win8"],["Windows NT 6.4","Win10"],["Windows NT 10","Win10"],["Windows 10","Win10"]],c.Ni=[["msie",l.Ot,"IE"],["rv",l.Ot,"IE"],["firefox",l.Mt,"FireFox"],["chrome",l.At,"Chrome"],["opera",l.Ct,"Opera"],["opr",l.Ct,"Opera"],["safari",l.Pt,"Safari"],["edge",l.Rt,"Edge"],["ubrowser",l.Ut,"UC"],["qqbrowser",l.It,"QQ"],["lbbrowser",l.kBrowserTypeLieBao,"LieBao"]]},{"../utils/global":9,"../utils/ks-log":12,"../utils/local-store":14,"../utils/string-utils":17,"./version":5}],4:[function(t,i,s){"use strict";s.__esModule=!0;var n=function(){function i(){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,i)}return i.getConstantErrors=function(t){switch(t){case i.Bi:return"Success";case i.Fi:return"Timeout";default:return"Unknown"}},i}();(s.default=n).Bi=0,n.Fi=1,n.zi=2,n.Vi=3},{}],5:[function(t,i,s){"use strict";s.__esModule=!0;var n=function(){function t(){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t)}return t.Ti=function(){return t.Hi+"."+t.Ji+"."+t.Ki+"."+t.kDebugNumber},t.Z=function(){return 1e6*t.Hi+1e4*t.Ji+100*t.Ki+t.kDebugNumber},t}();(s.default=n).Gi="v2",n.Hi=1,n.Ji=0,n.Ki=6,n.kDebugNumber=8},{}],6:[function(t,i,s){"use strict";s.__esModule=!0,(s.CryptoCRC=function(){function e(){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,e)}return e.Xi=function(t){var i=0,s=t,n=Array.isArray(s),h=0;for(s=n?s:s[Symbol.iterator]();;){var r;if(n){if(h>=s.length)break;r=s[h++]}else{if((h=s.next()).done)break;r=h.value}i=e.Qi[255&(r^i>>8)]^i<<8}return 65535&(0^i)},e.C=function(t){return e.Xi(t).toString(16)},e}()).Qi=new Uint16Array([0,4129,8258,12387,16516,20645,24774,28903,33032,37161,41290,45419,49548,53677,57806,61935,4657,528,12915,8786,21173,17044,29431,25302,37689,33560,45947,41818,54205,50076,62463,58334,9314,13379,1056,5121,25830,29895,17572,21637,42346,46411,34088,38153,58862,62927,50604,54669,13907,9842,5649,1584,30423,26358,22165,18100,46939,42874,38681,34616,63455,59390,55197,51132,18628,22757,26758,30887,2112,6241,10242,14371,51660,55789,59790,63919,35144,39273,43274,47403,23285,19156,31415,27286,6769,2640,14899,10770,56317,52188,64447,60318,39801,35672,47931,43802,27814,31879,19684,23749,11298,15363,3168,7233,60846,64911,52716,56781,44330,48395,36200,40265,32407,28342,24277,20212,15891,11826,7761,3696,65439,61374,57309,53244,48923,44858,40793,36728,37256,33193,45514,41451,53516,49453,61774,57711,4224,161,12482,8419,20484,16421,28742,24679,33721,37784,41979,46042,49981,54044,58239,62302,689,4752,8947,13010,16949,21012,25207,29270,46570,42443,38312,34185,62830,58703,54572,50445,13538,9411,5280,1153,29798,25671,21540,17413,42971,47098,34713,38840,59231,63358,50973,55100,9939,14066,1681,5808,26199,30326,17941,22068,55628,51565,63758,59695,39368,35305,47498,43435,22596,18533,30726,26663,6336,2273,14466,10403,52093,56156,60223,64286,35833,39896,43963,48026,19061,23124,27191,31254,2801,6864,10931,14994,64814,60687,56684,52557,48554,44427,40424,36297,31782,27655,23652,19525,15522,11395,7392,3265,61215,65342,53085,57212,44955,49082,36825,40952,28183,32310,20053,24180,11923,16050,3793,7920])},{}],7:[function(t,i,s){"use strict";s.__esModule=!0;var n=function(){function o(){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,o)}return o.Yi=function(t,i){for(var s=-1^i,n=t.length-1,h=0;h<n;)s=(s=s>>>8^o.Zi[255&(s^t.charCodeAt(h++))])>>>8^o.Zi[255&(s^t.charCodeAt(h++))];return h===n&&(s=s>>>8^o.Zi[255&(s^t.charCodeAt(h))]),(-1^s)>>>0},o.ts=function(t,i){if(1e4<t.length)return o.ss(t,i);for(var s=-1^i,n=t.length-3,h=0;h<n;)s=(s=(s=(s=s>>>8^o.Zi[255&(s^t[h++])])>>>8^o.Zi[255&(s^t[h++])])>>>8^o.Zi[255&(s^t[h++])])>>>8^o.Zi[255&(s^t[h++])];for(;h<n+3;)s=s>>>8^o.Zi[255&(s^t[h++])];return(-1^s)>>>0},o.ss=function(t,i){for(var s=-1^i,n=t.length-7,h=0;h<n;)s=(s=(s=(s=(s=(s=(s=(s=s>>>8^o.Zi[255&(s^t[h++])])>>>8^o.Zi[255&(s^t[h++])])>>>8^o.Zi[255&(s^t[h++])])>>>8^o.Zi[255&(s^t[h++])])>>>8^o.Zi[255&(s^t[h++])])>>>8^o.Zi[255&(s^t[h++])])>>>8^o.Zi[255&(s^t[h++])])>>>8^o.Zi[255&(s^t[h++])];for(;h<n+7;)s=s>>>8^o.Zi[255&(s^t[h++])];return(-1^s)>>>0},o.ns=function(t,i){var s,n=-1^i,h=0,r=void 0,e=void 0;for(h=0,s=t.length;h<s;)n=(r=t.charCodeAt(h++))<128?n>>>8^o.Zi[255&(n^r)]:r<2048?(n=n>>>8^o.Zi[255&(n^(192|r>>6&31))])>>>8^o.Zi[255&(n^(128|63&r))]:55296<=r&&r<57344?(r=64+(1023&r),e=1023&t.charCodeAt(h++),(n=(n=(n=n>>>8^o.Zi[255&(n^(240|r>>8&7))])>>>8^o.Zi[255&(n^(128|r>>2&63))])>>>8^o.Zi[255&(n^(128|e>>6&15|(3&r)<<4))])>>>8^o.Zi[255&(n^(128|63&e))]):(n=(n=n>>>8^o.Zi[255&(n^(224|r>>12&15))])>>>8^o.Zi[255&(n^(128|r>>6&63))])>>>8^o.Zi[255&(n^(128|63&r))];return(-1^n)>>>0},o}();(s.default=n).Zi=[0,1996959894,-301047508,-1727442502,124634137,1886057615,-379345611,-1637575261,249268274,2044508324,-522852066,-1747789432,162941995,2125561021,-407360249,-1866523247,498536548,1789927666,-205950648,-2067906082,450548861,1843258603,-187386543,-2083289657,325883990,1684777152,-43845254,-1973040660,335633487,1661365465,-99664541,-1928851979,997073096,1281953886,-715111964,-1570279054,1006888145,1258607687,-770865667,-1526024853,901097722,1119000684,-608450090,-1396901568,853044451,1172266101,-589951537,-1412350631,651767980,1373503546,-925412992,-1076862698,565507253,1454621731,-809855591,-1195530993,671266974,1594198024,-972236366,-1324619484,795835527,1483230225,-1050600021,-1234817731,1994146192,31158534,-1731059524,-271249366,1907459465,112637215,-1614814043,-390540237,2013776290,251722036,-1777751922,-519137256,2137656763,141376813,-1855689577,-429695999,1802195444,476864866,-2056965928,-228458418,1812370925,453092731,-2113342271,-183516073,1706088902,314042704,-1950435094,-54949764,1658658271,366619977,-1932296973,-69972891,1303535960,984961486,-1547960204,-725929758,1256170817,1037604311,-1529756563,-740887301,1131014506,879679996,-1385723834,-631195440,1141124467,855842277,-1442165665,-586318647,1342533948,654459306,-1106571248,-921952122,1466479909,544179635,-1184443383,-832445281,1591671054,702138776,-1328506846,-942167884,1504918807,783551873,-1212326853,-1061524307,-306674912,-1698712650,62317068,1957810842,-355121351,-1647151185,81470997,1943803523,-480048366,-1805370492,225274430,2053790376,-468791541,-1828061283,167816743,2097651377,-267414716,-2029476910,503444072,1762050814,-144550051,-2140837941,426522225,1852507879,-19653770,-1982649376,282753626,1742555852,-105259153,-1900089351,397917763,1622183637,-690576408,-1580100738,953729732,1340076626,-776247311,-1497606297,1068828381,1219638859,-670225446,-1358292148,906185462,1090812512,-547295293,-1469587627,829329135,1181335161,-882789492,-1134132454,628085408,1382605366,-871598187,-1156888829,570562233,1426400815,-977650754,-1296233688,733239954,1555261956,-1026031705,-1244606671,752459403,1541320221,-1687895376,-328994266,1969922972,40735498,-1677130071,-351390145,1913087877,83908371,-1782625662,-491226604,2075208622,213261112,-1831694693,-438977011,2094854071,198958881,-2032938284,-237706686,1759359992,534414190,-2118248755,-155638181,1873836001,414664567,-2012718362,-15766928,1711684554,285281116,-1889165569,-127750551,1634467795,376229701,-1609899400,-686959890,1308918612,956543938,-1486412191,-799009033,1231636301,1047427035,-1362007478,-640263460,1088359270,936918e3,-1447252397,-558129467,1202900863,817233897,-1111625188,-893730166,1404277552,615818150,-1160759803,-841546093,1423857449,601450431,-1285129682,-1000256840,1567103746,711928724,-1274298825,-1022587231,1510334235,755167117]},{}],8:[function(t,i,s){"use strict";s.__esModule=!0,s.hs=n,s.rs=function(t){return l(a(u(t),t.length*o))},s.es=function(t){return c(a(u(t),t.length*o))},s.as=function(t,i){return f(e(t,i))},s.us=function(t,i){return l(e(t,i))},s.cs=function(t,i){return c(e(t,i))},s.fs=e;var h=0,r="=",o=8;function n(t){return f(a(u(t),t.length*o))}function a(t,i){t[i>>5]|=128<<24-i%32,t[15+(i+64>>9<<4)]=i;for(var s,n=Array(80),h=1732584193,r=-271733879,e=-1732584194,o=271733878,a=-1009589776,u=0;u<t.length;u+=16){for(var c=h,f=r,l=e,v=o,m=a,p=0;p<80;p++){n[p]=p<16?t[u+p]:k(n[p-3]^n[p-8]^n[p-14]^n[p-16],1);var d=w(w(k(h,5),b(p,r,e,o)),w(w(a,n[p]),(s=p)<20?1518500249:s<40?1859775393:s<60?-1894007588:-899497514));a=o,o=e,e=k(r,30),r=h,h=d}h=w(h,c),r=w(r,f),e=w(e,l),o=w(o,v),a=w(a,m)}return Array(h,r,e,o,a)}function b(t,i,s,n){return t<20?i&s|~i&n:t<40?i^s^n:t<60?i&s|i&n|s&n:i^s^n}function e(t,i){var s=u(t);16<s.length&&(s=a(s,t.length*o));for(var n=Array(16),h=Array(16),r=0;r<16;r++)n[r]=909522486^s[r],h[r]=1549556828^s[r];var e=a(n.concat(u(i)),512+i.length*o);return a(h.concat(e),672)}function w(t,i){var s=(65535&t)+(65535&i);return(t>>16)+(i>>16)+(s>>16)<<16|65535&s}function k(t,i){return t<<i|t>>>32-i}function u(t){for(var i=Array(),s=(1<<o)-1,n=0;n<t.length*o;n+=o)i[n>>5]|=(t.charCodeAt(n/o)&s)<<32-o-n%32;return i}function c(t){for(var i="",s=(1<<o)-1,n=0;n<32*t.length;n+=o)i+=String.fromCharCode(t[n>>5]>>>32-o-n%32&s);return i}function f(t){for(var i=h?"0123456789ABCDEF":"0123456789abcdef",s="",n=0;n<4*t.length;n++)s+=i.charAt(t[n>>2]>>8*(3-n%4)+4&15)+i.charAt(t[n>>2]>>8*(3-n%4)&15);return s}function l(t){for(var i="",s=0;s<4*t.length;s+=3)for(var n=(t[s>>2]>>8*(3-s%4)&255)<<16|(t[s+1>>2]>>8*(3-(s+1)%4)&255)<<8|t[s+2>>2]>>8*(3-(s+2)%4)&255,h=0;h<4;h++)8*s+6*h>32*t.length?i+=r:i+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(n>>6*(3-h)&63);return i}},{}],9:[function(t,i,s){"use strict";s.__esModule=!0;var n=function(){function i(){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,i)}return i.ls=function(){return Math.floor((new Date).getTime()/1e3)},i.Ai=function(){return(new Date).getTime()},i.vs=function(t){var i=1<arguments.length&&void 0!==arguments[1]&&arguments[1],s=new Date;void 0!==t&&s.setTime(1e3*t);var n=s.getFullYear(),h=s.getMonth()+1,r=s.getDate(),e=s.getHours(),o=s.getMinutes(),a=s.getSeconds(),u=s.getMilliseconds(),c=n+(i?"-":"");return h<10&&(c+="0"),c+=h+(i?"-":""),r<10&&(c+="0"),c+=r+(i?" ":""),e<10&&(c+="0"),c+=e+(i?":":""),o<10&&(c+="0"),c+=o+(i?":":""),a<10&&(c+="0"),c+=a+(i?".":""),u<100&&(c+="0"),u<10&&(c+="0"),c+=u},i.ms=function(t){return i.vs(t,!0)},i.speed=function(t,i){t=t||0;var s=1024,n="B/s";return i&&(t*=8,s=1e3,n="bps"),t<1024?t.toFixed(0)+" "+n:t<s*s?(t/s).toFixed(1)+" K"+n:t<s*s*s?(t/s/s).toFixed(1)+" M"+n:t<s*s*s*s?(t/s/s/s).toFixed(1)+" G"+n:void 0},i}();(s.default=n).ps=1024,n.ds=1024,n.bs=1024,n.ws=1048576,n.ks=1073741824,n.ys=0x4000000000000,n.b=1e3,n.gs=1e3,n._s=1e3,n.Ss=1e3,n.Ts=1e6,n.p=60,n.Es=60,n.As=24,n.Ms=3600,n.Cs=86400},{}],10:[function(t,i,s){"use strict";s.__esModule=!0;var n=function(){function t(){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.t="KsArray",this.Os=[]}return t.prototype.empty=function(){return 0===this.size()},t.prototype.clear=function(){this.Os=[]},t.prototype.push=function(t){this.Os.push(t)},t.prototype.push_back=function(t){this.push(t)},t.prototype.size=function(){return this.Os.length},t.prototype.back=function(){if(this.empty())throw new Error("array index out of bounds");return this.Os[this.size()-1]},t.prototype.front=function(){if(this.empty())throw new Error("array index out of bounds");return this.Os[0]},t.prototype.at=function(t){if(t<0||t>=this.Os.length)throw new Error("array index out of bounds");return this.Os[t]},t.prototype.lastButOne=function(){if(this.size()<=1)throw new Error("array index out of bounds");return this.Os[this.size()-2]},t.prototype.erase=function(t){if(!(t<0||t>=this.Os.length))return this.Os.splice(t,1)},t.prototype.sort=function(t){return this.Os.sort(t)},t.prototype.filter=function(t){return this.Os.filter(t)},t.prototype.reduce=function(t,i){return this.Os.reduce(t,i)},t.prototype.find=function(t){return this.Os.find(t)},t.prototype.findIndex=function(t){return this.Os.findIndex(t)},t.prototype[Symbol.iterator]=function(){var t=this,i=0;return{next:function(){return i<t.Os.length?{value:t.Os[i++],done:!1}:{value:void 0,done:!0}}}},t}();s.default=n},{}],11:[function(t,i,s){"use strict";s.__esModule=!0;var n,h=t("./global"),r=(n=h)&&n.__esModule?n:{default:n};var e=function(){function s(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,s),this.t="KsBuffer",this.Rs=r.default.ps;var i=0<t?t:this.Rs;this.Ps=new ArrayBuffer(i),this.Us=i,this.Is=0}return s.prototype.begin=function(){return 0},s.prototype.resize=function(t){this.Ps=new ArrayBuffer(t),this.Us=t,this.Is=0},s.prototype.empty=function(){return this.size()<=0},s.prototype.append=function(t){t instanceof Uint8Array||(t=new Uint8Array(t));var i=new Uint8Array(this.Ps,0,this.Us);this.Is+t.byteLength>this.Us&&(this.expand(this.Is+t.byteLength),i=new Uint8Array(this.Ps,0,this.Us)),i.set(t,this.Is),this.Is+=t.byteLength},s.prototype.size=function(){return this.Is},s.prototype.array=function(){return new Uint8Array(this.Ps,0,this.Is)},s.prototype.arrayBuffer=function(){return this.Ps},s.prototype.subarray=function(t,i){if(t<0||t>=this.Is||i<0||t+i>this.Is)throw new Error("array index out of bounds");return new Uint8Array(this.Ps,t,i)},s.prototype.erase=function(t){return t>this.Us?-1:t>=this.Is?(t=this.Is,this.clear()):(this.Ps=this.Ps.slice(t,this.Us),this.Is-=t,this.Us-=t,t)},s.prototype.expand=function(t){for(var i=2*this.Us;i<t;)i*=2;var s=new ArrayBuffer(i);if(0<this.Is){var n=new Uint8Array(this.Ps,0,this.Is);new Uint8Array(s,0,i).set(n,0)}this.Ps=s,this.Us=i},s.prototype.clear=function(){var t=this.Is;return this.Is=0,t},s}();s.default=e},{"./global":9}],12:[function(t,i,s){"use strict";s.__esModule=!0,s.KsLog=s.LogType=s.LogLevel=void 0;var n,h=t("./log-pool"),r=t("./global"),e=(n=r)&&n.__esModule?n:{default:n};var o=s.LogLevel={Ns:0,xs:1,js:2,Ls:4,$s:8,Ds:16,Ws:255},a=s.LogType={Jt:0,qs:1,Bs:2,Fs:4},u=s.KsLog=function(){function n(){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,n)}return n.getInstance=function(){return this.instance||(this.instance=new n),this.instance},n.prototype.init=function(t){this.initLogPool(t).open()},n.prototype.unInit=function(){this.zs&&this.zs.close(),this.zs=null,n.instance=null},n.prototype.trace=function(t,i){if((n.Ri&o.xs)!==o.Ns){var s="KsLoader: ["+e.default.ms()+" - TRC] "+(t||"")+": "+i;this.uploadLog(s),(n.F&a.qs)!==a.Jt&&(console.debug?console.debug(s):console.log(s))}},n.prototype.info=function(t,i){if((n.Ri&o.js)!==o.Ns){var s="KsLoader: ["+e.default.ms()+" - INF] "+(t||"")+": "+i;this.uploadLog(s),(n.F&a.qs)!==a.Jt&&(console.info?console.info(s):console.log(s))}},n.prototype.warn=function(t,i){if((n.Ri&o.Ls)!==o.Ns){var s="KsLoader: ["+e.default.ms()+" - WRN] "+(t||"")+": "+i;this.uploadLog(s),(n.F&a.qs)!==a.Jt&&(console.warn?console.warn(s):console.log(s))}},n.prototype.error=function(t,i){if((n.Ri&o.$s)!==o.Ns){var s="KsLoader: ["+e.default.ms()+" - ERR] "+(t||"")+": "+i;this.uploadLog(s),(n.F&a.qs)!==a.Jt&&(console.error?console.error(s):console.warn?console.warn(s):console.log(s))}},n.prototype.uploadLog=function(t){(n.F&a.Fs)===a.Jt&&(n.F&a.Bs)===a.Jt||this.zs&&this.zs.push(t)},n.prototype.initLogPool=function(t){return this.zs=new h.LogPool(t),this.zs},n.d=function(t,i){n.getInstance().trace(t,i)},n.i=function(t,i){n.getInstance().info(t,i)},n.w=function(t,i){n.getInstance().warn(t,i)},n.e=function(t,i){n.getInstance().error(t,i)},n.setLogLevel=function(t){n.Ri=t},n.setLogType=function(t){n.F=t},n}();u.F=a.Fs,u.Ri=o.Ns},{"./global":9,"./log-pool":15}],13:[function(t,i,s){"use strict";s.__esModule=!0;var n,h=t("./string-utils"),r=(n=h)&&n.__esModule?n:{default:n};var e=function(){function i(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,i),this.t="KsObject",this.Vs=t}return i.prototype.asBool=function(){return r.default.parseBool(this.Vs)},i.prototype.asInt=function(){return r.default.Hs(this.Vs)},i.prototype.asDouble=function(){return r.default.Js(this.Vs)},i.prototype.asString=function(){return this.Vs+""},i}();s.default=e},{"./string-utils":17}],14:[function(t,i,s){"use strict";s.__esModule=!0;var n=function(){function s(){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,s),this.BaseTag="LocalStore"}return s.isSupported=function(){if(this.Ks)return this.Gs;if(this.Ks=!0,this.Gs=!1,-1<navigator.userAgent.indexOf("UCBrowser"))return!1;for(var t=0,i=new Array("Chrome","MQQBrowser","QQ","TBS","wxwork","MicroMessenger","T7","baiduboxapp","baidubrowser","MiuiBrowser","NetType","OPR"),s=0;s<i.length;s++)-1<navigator.userAgent.indexOf(i[s])&&(t=1);if(1!==t&&(-1<navigator.userAgent.indexOf("HUAWEIEVA")||-1<navigator.userAgent.indexOf("HUAWEIVTR")))return!1;try{return window.localStorage.setItem("test","testValue"),window.localStorage.removeItem("test"),this.Gs=!0,this.Gs}catch(t){return!1}},s.getInstance=function(){return this.instance||(this.instance=new s),this.instance},s.prototype.set=function(t,i){s.isSupported()&&window.localStorage.setItem(t,i)},s.prototype.get=function(t){if(s.isSupported())return window.localStorage.getItem(t)},s.prototype.remove=function(t){if(s.isSupported())return window.localStorage.removeItem(t)},s.prototype.clear=function(){s.isSupported()&&window.localStorage.clear()},s.prototype.each=function(t){s.isSupported()&&Object.keys(window.localStorage).forEach(t)},s}();s.default=n},{}],15:[function(t,i,s){"use strict";s.__esModule=!0,s.LogPool=void 0;h(t("../basic/env"));var n=h(t("../../p2p/core/loader/ks-httploader")),r=t("./ks-log"),e=h(t("./global"));function h(t){return t&&t.__esModule?t:{default:t}}s.LogPool=function(){function i(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,i),this.Qs=[],this.h=t,this.o=new n.default(this),this.o.setLogNone(),this.s=!1,this.Xs=e.default.vs(),this.Ys=1e3,this.Oi=null}return i.prototype.open=function(){var t=this;this.s||(this.s=!0,this.Oi=setInterval(function(){t.post()},1e3*this.h.Qt))},i.prototype.close=function(){this.h=null,this.s=!1,this.o&&this.o.close(),this.o=null,this.Oi&&clearInterval(this.Oi),this.Oi=null},i.prototype.push=function(t){this.Qs.push(t),this.Qs.length>=this.Ys&&this.Qs.shift()},i.prototype.post=function(){if(this.s&&(r.KsLog.F&r.LogType.Fs)!==r.LogType.Jt&&!(this.Qs.length<=0)&&this.o.isIdle()){var t=this.Xs+"_"+this.h.T+"_"+this.h.Ei;this.h.csid=t;var i="http://"+this.h.Kt+"/h5-log?sessionId="+t+"&browser="+this.h.X+"&isMoble="+this.h.Li,s=this.o.create();s.Zs="POST";var n={};this.getStatus(n);var h={sessionId:t,log:this.Qs.join("\r\n"),status:n};this.Qs=[],s.tn=JSON.stringify(h),s.in.set("Content-Type","application/json"),this.o.setTimer("report",5*e.default.b,s).it("reporter").open(i)}},i.prototype.getStatus=function(t){var i={segmentStartWithPlayer:this.h.oi?0:1};this.h&&this.h.wi&&this.h.wi.qi(t,i)},i}()},{"../../p2p/core/loader/ks-httploader":25,"../basic/env":3,"./global":9,"./ks-log":12}],16:[function(t,i,s){"use strict";s.__esModule=!0;s.Md5={hexcase:0,chrsz:8,R:function(t){return this.sn(this.nn(this.hn(t),t.length*this.chrsz))},nn:function(t,i){t[i>>5]|=128<<i%32,t[14+(i+64>>>9<<4)]=i;for(var s=1732584193,n=-271733879,h=-1732584194,r=271733878,e=0;e<t.length;e+=16){var o=s,a=n,u=h,c=r;s=this.ff(s,n,h,r,t[e+0],7,-680876936),r=this.ff(r,s,n,h,t[e+1],12,-389564586),h=this.ff(h,r,s,n,t[e+2],17,606105819),n=this.ff(n,h,r,s,t[e+3],22,-1044525330),s=this.ff(s,n,h,r,t[e+4],7,-176418897),r=this.ff(r,s,n,h,t[e+5],12,1200080426),h=this.ff(h,r,s,n,t[e+6],17,-1473231341),n=this.ff(n,h,r,s,t[e+7],22,-45705983),s=this.ff(s,n,h,r,t[e+8],7,1770035416),r=this.ff(r,s,n,h,t[e+9],12,-1958414417),h=this.ff(h,r,s,n,t[e+10],17,-42063),n=this.ff(n,h,r,s,t[e+11],22,-1990404162),s=this.ff(s,n,h,r,t[e+12],7,1804603682),r=this.ff(r,s,n,h,t[e+13],12,-40341101),h=this.ff(h,r,s,n,t[e+14],17,-1502002290),n=this.ff(n,h,r,s,t[e+15],22,1236535329),s=this.gg(s,n,h,r,t[e+1],5,-165796510),r=this.gg(r,s,n,h,t[e+6],9,-1069501632),h=this.gg(h,r,s,n,t[e+11],14,643717713),n=this.gg(n,h,r,s,t[e+0],20,-373897302),s=this.gg(s,n,h,r,t[e+5],5,-701558691),r=this.gg(r,s,n,h,t[e+10],9,38016083),h=this.gg(h,r,s,n,t[e+15],14,-660478335),n=this.gg(n,h,r,s,t[e+4],20,-405537848),s=this.gg(s,n,h,r,t[e+9],5,568446438),r=this.gg(r,s,n,h,t[e+14],9,-1019803690),h=this.gg(h,r,s,n,t[e+3],14,-187363961),n=this.gg(n,h,r,s,t[e+8],20,1163531501),s=this.gg(s,n,h,r,t[e+13],5,-1444681467),r=this.gg(r,s,n,h,t[e+2],9,-51403784),h=this.gg(h,r,s,n,t[e+7],14,1735328473),n=this.gg(n,h,r,s,t[e+12],20,-1926607734),s=this.hh(s,n,h,r,t[e+5],4,-378558),r=this.hh(r,s,n,h,t[e+8],11,-2022574463),h=this.hh(h,r,s,n,t[e+11],16,1839030562),n=this.hh(n,h,r,s,t[e+14],23,-35309556),s=this.hh(s,n,h,r,t[e+1],4,-1530992060),r=this.hh(r,s,n,h,t[e+4],11,1272893353),h=this.hh(h,r,s,n,t[e+7],16,-155497632),n=this.hh(n,h,r,s,t[e+10],23,-1094730640),s=this.hh(s,n,h,r,t[e+13],4,681279174),r=this.hh(r,s,n,h,t[e+0],11,-358537222),h=this.hh(h,r,s,n,t[e+3],16,-722521979),n=this.hh(n,h,r,s,t[e+6],23,76029189),s=this.hh(s,n,h,r,t[e+9],4,-640364487),r=this.hh(r,s,n,h,t[e+12],11,-421815835),h=this.hh(h,r,s,n,t[e+15],16,530742520),n=this.hh(n,h,r,s,t[e+2],23,-995338651),s=this.ii(s,n,h,r,t[e+0],6,-198630844),r=this.ii(r,s,n,h,t[e+7],10,1126891415),h=this.ii(h,r,s,n,t[e+14],15,-1416354905),n=this.ii(n,h,r,s,t[e+5],21,-57434055),s=this.ii(s,n,h,r,t[e+12],6,1700485571),r=this.ii(r,s,n,h,t[e+3],10,-1894986606),h=this.ii(h,r,s,n,t[e+10],15,-1051523),n=this.ii(n,h,r,s,t[e+1],21,-2054922799),s=this.ii(s,n,h,r,t[e+8],6,1873313359),r=this.ii(r,s,n,h,t[e+15],10,-30611744),h=this.ii(h,r,s,n,t[e+6],15,-1560198380),n=this.ii(n,h,r,s,t[e+13],21,1309151649),s=this.ii(s,n,h,r,t[e+4],6,-145523070),r=this.ii(r,s,n,h,t[e+11],10,-1120210379),h=this.ii(h,r,s,n,t[e+2],15,718787259),n=this.ii(n,h,r,s,t[e+9],21,-343485551),s=this.add(s,o),n=this.add(n,a),h=this.add(h,u),r=this.add(r,c)}return Array(s,n,h,r)},cmn:function(t,i,s,n,h,r){return this.add(this.br(this.add(this.add(i,t),this.add(n,r)),h),s)},ff:function(t,i,s,n,h,r,e){return this.cmn(i&s|~i&n,t,i,h,r,e)},gg:function(t,i,s,n,h,r,e){return this.cmn(i&n|s&~n,t,i,h,r,e)},hh:function(t,i,s,n,h,r,e){return this.cmn(i^s^n,t,i,h,r,e)},ii:function(t,i,s,n,h,r,e){return this.cmn(s^(i|~n),t,i,h,r,e)},add:function(t,i){var s=(65535&t)+(65535&i);return(t>>16)+(i>>16)+(s>>16)<<16|65535&s},br:function(t,i){return t<<i|t>>>32-i},hn:function(t){for(var i=Array(),s=(1<<this.chrsz)-1,n=0;n<t.length*this.chrsz;n+=this.chrsz)i[n>>5]|=(t.charCodeAt(n/this.chrsz)&s)<<n%32;return i},rn:function(t){for(var i="",s=(1<<this.chrsz)-1,n=0;n<32*t.length;n+=this.chrsz)i+=String.fromCharCode(t[n>>5]>>>n%32&s);return i},sn:function(t){for(var i=this.hexcase?"0123456789ABCDEF":"0123456789abcdef",s="",n=0;n<4*t.length;n++)s+=i.charAt(t[n>>2]>>n%4*8+4&15)+i.charAt(t[n>>2]>>n%4*8&15);return s}}},{}],17:[function(_dereq_,module,exports){"use strict";function _classCallCheck(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}exports.__esModule=!0;var StringUtils=function(){function StringUtils(){_classCallCheck(this,StringUtils)}return StringUtils.format=function(t){for(var s=[],i=1;i<arguments.length;i++)s.push(arguments[i]);return(t||"").replace(/\{(\d+)\}/g,function(t,i){return s[i]})},StringUtils.isEmpty=function(t){return void 0===t||null==t||""===t},StringUtils.L=function(t){return t&&0!==t.length?String.fromCharCode.apply(null,t):""},StringUtils.O=function(t){if(!t)return null;for(var i=[],s=0,n=t.length;s<n;++s)i.push(t.charCodeAt(s));return new Uint8Array(i)},StringUtils.P=function parseJson_(str){return eval("("+str+")")},StringUtils.str2asc=function(t){return("0"+t.charCodeAt(0).toString(16)).slice(-2)},StringUtils.en=function(t){return String.fromCharCode(t)},StringUtils.isalnum=function(t){return/^[a-zA-Z0-9]+$/g.test(t)},StringUtils.Hs=function(t){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return isNaN(parseInt(t))?i:parseInt(t)},StringUtils.Js=function(t){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return isNaN(parseFloat(t))?i:parseFloat(t)},StringUtils.parseBool=function(t){return!!t},StringUtils.isUndefined=function(t){return void 0===t},StringUtils._=function(t){return null==t},StringUtils.an=function(t){var i=t.split(":");return 1===i.length?[i[0],0]:2<=i.length?[i[0],StringUtils.Hs(i[1])]:void 0},StringUtils.un=function(t){if(!t)return"";for(var i="",s=0;s<t.length;s++){var n=t.charAt(s);if("+"===n)i+=" ";else if("%"===n){var h=t.substring(s+1,s+3);127<parseInt("0x"+h)?(i+=StringUtils.en(parseInt("0x"+h+t.substring(s+4,s+6))),s+=5):(i+=StringUtils.en(parseInt("0x"+h)),s+=2)}else i+=n}return i},StringUtils.cn=function(t){if(!t)return"";for(var i="",s=0;s<t.length;s++){var n=t.charAt(s),h=StringUtils.str2asc(n);n+":"+h+"n",127<parseInt("0x"+h)?i+="%"+h.slice(0,2)+"%"+h.slice(-2):" "===n?i+="+":-1!=="!'#$%&()*+,/:;<=>?[]^`{|}~%".indexOf(n)?i+="%"+h.toString(16):i+=n}return i},StringUtils.fn=function(t){return t},StringUtils.M=function(t){var i,s=void 0,n=void 0,h=void 0,r=void 0,e=void 0,o=void 0;for(i=t.length,e=0,o="";e<i;){for(;s=StringUtils.ln[255&t.charCodeAt(e++)],e<i&&-1===s;);if(-1===s)break;for(;n=StringUtils.ln[255&t.charCodeAt(e++)],e<i&&-1===n;);if(-1===n)break;o+=String.fromCharCode(s<<2|(48&n)>>4);do{if(61===(h=255&t.charCodeAt(e++)))return o;h=StringUtils.ln[h]}while(e<i&&-1===h);if(-1===h)break;o+=String.fromCharCode((15&n)<<4|(60&h)>>2);do{if(61===(r=255&t.charCodeAt(e++)))return o;r=StringUtils.ln[r]}while(e<i&&-1===r);if(-1===r)break;o+=String.fromCharCode((3&h)<<6|r)}return o},StringUtils.st=function(t){var i,s=void 0,n=void 0,h=void 0,r=void 0,e=void 0;for(i=t.length,n=0,s="";n<i;){if(h=255&t.charCodeAt(n++),n===i){s+=StringUtils.vn.charAt(h>>2),s+=StringUtils.vn.charAt((3&h)<<4),s+="==";break}if(r=t.charCodeAt(n++),n===i){s+=StringUtils.vn.charAt(h>>2),s+=StringUtils.vn.charAt((3&h)<<4|(240&r)>>4),s+=StringUtils.vn.charAt((15&r)<<2),s+="=";break}e=t.charCodeAt(n++),s+=StringUtils.vn.charAt(h>>2),s+=StringUtils.vn.charAt((3&h)<<4|(240&r)>>4),s+=StringUtils.vn.charAt((15&r)<<2|(192&e)>>6),s+=StringUtils.vn.charAt(63&e)}return s},StringUtils.mn=function(t,i,s){var n=t;if(i+s<n.length){for(;s--;)if(128!=(192&n[++i]))return!1;return!0}return!1},StringUtils.bn=function(t){if(!t)return"";for(var i=[],s=t,n=0,h=t.length;n<h;)if(s[n]<128)i.push(String.fromCharCode(s[n])),++n;else{if(s[n]<192);else if(s[n]<224){if(StringUtils.mn(s,n,1)){var r=(31&s[n])<<6|63&s[n+1];if(128<=r){i.push(String.fromCharCode(65535&r)),n+=2;continue}}}else if(s[n]<240){if(StringUtils.mn(s,n,2)){var e=(15&s[n])<<12|(63&s[n+1])<<6|63&s[n+2];if(2048<=e&&55296!=(63488&e)){i.push(String.fromCharCode(65535&e)),n+=3;continue}}}else if(s[n]<248&&StringUtils.mn(s,n,3)){var o=(7&s[n])<<18|(63&s[n+1])<<12|(63&s[n+2])<<6|63&s[n+3];if(65536<o&&o<1114112){o-=65536,i.push(String.fromCharCode(o>>>10|55296)),i.push(String.fromCharCode(1023&o|56320)),n+=4;continue}}i.push(String.fromCharCode(65533)),++n}return i.join("")},StringUtils.wn=function(t){if(!t)return"";t=decodeURIComponent(t);for(var i=String.fromCharCode(t.charCodeAt(0)-t.length),s=1;s<t.length;s++)i+=String.fromCharCode(t.charCodeAt(s)-i.charCodeAt(s-1));return i},StringUtils.kn=function(t){if(!t)return"";for(var i=String.fromCharCode(t.charCodeAt(0)+t.length),s=1;s<t.length;s++)i+=String.fromCharCode(t.charCodeAt(s)+t.charCodeAt(s-1));return encodeURIComponent(i)},StringUtils}();exports.default=StringUtils,StringUtils.vn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",StringUtils.ln=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1],window.StringUtils=StringUtils},{}],18:[function(t,i,s){"use strict";s.__esModule=!0;var n,h=t("./string-utils"),_=(n=h)&&n.__esModule?n:{default:n};var r=function(){function i(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,i),this.yn=t||"",this.gn="http",this._n="",this.Sn=0,this.Tn="",this.En="",this.An="",this.Mn=new Map,""!==this.yn&&this.fromString(this.yn)}return i.prototype.split=function(t,i,s,n,h,r){var e=0,o=0,a=0,u=s.length,c=-1>>>0===r?t.length:r;if(0===s.length)return 0;for((c<=0||c>=t.length)&&(c=t.length);e<c&&(((o=t.indexOf(s,e))<0||c<=o||0<n&&a===n-1)&&(o=c),!(o<e));){if(e<o||!h){var f=e<o?t.substr(e,o-e):"";i.push(f),a++}e=o+u}return a},i.prototype.parseAttributes=function(t,i,s,n,h){var r=0,e=[];this.split(t,e,s,-1,!1,-1>>>0);for(var o=0;o<e.length;o++){var a=e[o],u=[];0!==this.split(a,u,n,2,!1,-1>>>0)&&(h&&(u[0]=u[0].toLowerCase()),u.length<2?1<=u.length&&i.set(u[0],""):i.set(u[0],u[u.length-1]),r++)}return r},i.prototype.parseUrl=function(t,i,s){var n=-1;if(t){var h=0;if(-1!==(n=t.indexOf(":"))){for(var r=!0,e=0;e<n;e++)if(!_.default.isalnum(t[e])){r=!1;break}if(r)for(i.gn=t.substr(0,n).toLowerCase(),h=n+1;h<t.length&&"/"===t[h];)h++}var o=t.indexOf(":",h)>>>0,a=t.indexOf("/",h)>>>0;a<o&&(o=-1),-1!==(o<<=0)&&(i._n=t.substr(h,o-h),i.Sn=_.default.Hs(t.substr(o+1),0));var u=void 0;-1===a?(u="/",0===i._n.length&&(i._n=t.substr(h))):(u=t.substr(a),0===i._n.length&&(i._n=t.substr(h,a-h)));var c=u.indexOf("?")>>>0,f=u.indexOf("#")>>>0;if(i.En=u.substr(0,f<c?f:c),c+1<u.length&&-1!==c&&c<f){var l=u.substr(c+1,-1==f<<0?-1>>>0:f-c-1),v=new Map;this.parseAttributes(l,v,"&","=",!1);var m=v,p=Array.isArray(m),d=0;for(m=p?m:m[Symbol.iterator]();;){var b;if(p){if(d>=m.length)break;b=m[d++]}else{if((d=m.next()).done)break;b=d.value}var w=b,k=w[0],y=w[1];i.Mn.set(_.default.un(k),_.default.un(y))}}-1!==f&&(i.Cn=u.substr(f+1));var g=i.En.lastIndexOf("/")>>>0;i.An=-1===g||0===g?(i.Tn="/",i.En):(i.Tn=i.En.substr(0,g),i.En.substr(g+1)),0!==i.Tn.length&&"/"===i.Tn[i.Tn.length-1]||(i.Tn+="/"),s&&(i.En=u),"http"===this.gn&&0===this.Sn&&(this.Sn=80),"https"===this.gn&&0===this.Sn&&(this.Sn=443)}},i.prototype.fromString=function(t){this.parseUrl(t,this,!1)},i.prototype.toString=function(){var t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],i=0===this.Sn||80===this.Sn||443===this.Sn,s=""===this.gn?"http":this.gn,n=void 0;return n=i?s+"://"+this._n+this.En:s+"://"+this._n+":"+this.Sn+this.En,t?n+this.toQueryString():n},i.prototype.toQueryString=function(){var t="",i=!0,s=this.Mn,n=Array.isArray(s),h=0;for(s=n?s:s[Symbol.iterator]();;){var r;if(n){if(h>=s.length)break;r=s[h++]}else{if((h=s.next()).done)break;r=h.value}var e=r,o=e[0],a=e[1];a+="",t+=i?"?":"&",t+=_.default.fn(o)+"="+_.default.cn(a),i=!1}return t},i.prototype.set=function(t,i){return this.Mn.set(t,i),this},i.prototype.has=function(t){return this.Mn.has(t)},i.prototype.get=function(t){return this.Mn.get(t)},i}();s.default=r,window.KsUrlParser=r},{"./string-utils":17}],19:[function(t,i,s){"use strict";i.exports=t("./ks-loader.js").default},{"./ks-loader.js":20}],20:[function(t,i,s){"use strict";s.__esModule=!0;var r=n(t("events")),e=n(t("./ks-p2ploader")),o=t("./p2p/core/loader/base-loader");function n(t){return t&&t.__esModule?t:{default:t}}var h=function(){function h(t,i,s){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,h),this.t="ks-loader",this.s=!1;var n={customid:"2000020107"};this.ki=n.ki=Math.ceil(1e6*Math.random()),this.On=(new Date).getTime(),this.Rn=new e.default(this.checkMediaInfo(t,i,s),n),this.r=this.Rn.r,this.Pn=null,this.Un=0,this.In=0,this.Nn=null,this.xn=new r.default,this.onDataArrival=null,this.onComplete=null,this.onError=null,this.jn=0}return h.prototype.checkMediaInfo=function(t,i,s){var n={isVod:!0,url:t,type:"mp4",mediaType:s};return i&&(i instanceof HTMLVideoElement||i instanceof HTMLAudioElement?n.videoTag=i:i.length&&((i[0]instanceof HTMLVideoElement||i[0]instanceof HTMLAudioElement)&&(n.videoTag=i[0]),i.length)),n},h.prototype.destroy=function(){this.r&&(this.r.info(this.t,"des <<<<<<<<<<<=========================== $$$$$, id = "+this.ki+", dur = "+((new Date).getTime()-this.On)),this.r=null),this.Rn&&(this.Rn.destroy(),this.Rn=null),this.xn&&(this.xn.removeAllListeners(),this.xn=null),this.Nn=null,this.s=!1,this.Ln=null,this.Pn=null,this.onDataArrival=null,this.onComplete=null,this.onError=null},h.prototype.load=function(t){var i=1<arguments.length&&void 0!==arguments[1]&&arguments[1];2<arguments.length&&void 0!==arguments[2]&&arguments[2];if(this.Rn&&t.hasOwnProperty("from")&&t.hasOwnProperty("to")){this.s=!0;var s=[t.from,t.to];this.checkRange(s)&&(s.length&&"number"==typeof s[0]&&0<=s[0]&&(this.In=s[0]),this.r.info(">>>>>>> $$$ open "+this.t+" range = "+s+", totalOffset = "+this.In+" id = "+this.ki),this.Rn.h.vi=i,this.Rn.open(this.Pn,s,this.receiveDataHandler.bind(this)))}},h.prototype.checkRange=function(t){if(t&&t.length){var i=String(t[0]+"_"+t[1]);return this.Pn!=i?(this.r.info(this.t,this.ki+" ============= checkRange "+this.t+" new range = "+i+", old range = "+this.Pn+" "),null!==this.Pn&&this.abort(this.Pn),this.Pn=i,!0):(this.r.info(this.t,this.ki+" ============= checkRange "+this.t+" same range = "+t+", return false!!!! "),!1)}return!1},h.prototype.receiveDataHandler=function(t){if(this.Rn){var i=this.Rn.getData(this.Pn),s=i.data,n=i.id;this.Un+=s.byteLength;var h=this.Rn.$n();this.Nn?this.Nn(s,this.In,t.totalBytes,h):this.onDataArrival&&(this.r.info(this.t,this.ki+" <<<<<<< range = "+this.Pn+", qid = "+n+", range === qid is "+(this.Pn===n)+", totalOffset_ = "+this.In+", loadedSize_ = "+this.Un+", totalBytes = "+t.totalBytes+", totalFileSize = "+h),this.onDataArrival(s,this.In,t.totalBytes,h)),this.In+=s.byteLength,this.Un==t.totalBytes&&this.onComplete&&(this.abort(this.Pn),this.onComplete())}},h.prototype.Dn=function(t,i,s,n){this.s&&this.xn.emit(o.KsloaderEvents.ON_DOWNLOAD_DATA,t,i,s,n)},h.prototype.Wn=function(){this.xn.emit(o.KsloaderEvents.ON_DOWNLOAD_COMPLETED)},h.prototype.abort=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;this.r&&this.r.info(this.t,"id = "+this.ki+" ============= , abort by "+(null===t?"player":"open")+", old range = "+this.Pn+", dur = "+((new Date).getTime()-this.ki)),this.Rn&&null!=this.Pn&&this.Rn.remove(this.Pn),this.Un=0,this.Pn=null,this.In=0},h.prototype.getVersion=function(){return this.Rn?this.Rn.getVersion():""},h.prototype.loadInfo=function(){return this.Rn?this.Rn.getDownLoadInfo():null},h.prototype.qi=function(t,i){return this.Rn?this.Rn.qi(t,i):null},h.isSupported=function(){return e.default.isSupported()},h}();window.KSLoader=h,s.default=h},{"./ks-p2ploader":22,"./p2p/core/loader/base-loader":23,events:1}],21:[function(t,i,s){"use strict";s.__esModule=!0;s.KsP2PloaderEvents={ERROR:"ks_p2p_loader_error",RAW_DATA_ARRIVED:"raw_data_arrived",MP4_RAW_DATA_ARRIVED:"mp4_raw_data_arrived",LOG:"log"},s.KsP2PloaderErrors={CREATE_CHANNEL_ERROR:"create channel error",OPEN_CHANNEL_ERROR:"open channel error"},s.SystemNetCoreEvents={ERROR:"system_net_core_error",RAW_DATA_ARRIVED:"raw_data_arrived"},s.P2PNetCoreEvents={ERROR:"p2p_net_core_error",RAW_DATA_ARRIVED:"raw_data_arrived"},s.ChannelEvents={ERROR:"channel_error",RAW_DATA_ARRIVED:"raw_data_arrived"},s.qn={ERROR:"protocol_error",Bn:"range_complete",Fn:"httpToken_open",zn:"selector_open",Vn:"manager_open",Hn:"manager_close",Jn:"peer_open",Kn:"peer_close",Gn:"peer_message"},s.HttpDnsEvents={ERROR:"httpdns_error",DNS_FINISH:"dns_finish"},s.Qn={ERROR:"metadata_error",Xn:"meta_finish",Yn:"meta_complete",Zn:"meta_change",th:"metadata_arrived"}},{}],22:[function(t,i,s){"use strict";s.__esModule=!0;var n=l(t("events")),h=(t("./common/utils/ks-log"),t("./ks-p2ploader-events")),r=l(t("./p2p/p2p-net-core")),e=l(t("./system/fetch-net-core")),o=l(t("./common/basic/version")),a=t("./common/basic/env"),u=l(a),c=l(t("./common/basic/dynamic-config")),f=l(t("./common/utils/global"));function l(t){return t&&t.__esModule?t:{default:t}}var v=function(){function s(t,i){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,s),this.t="ks-p2ploader",this.ki=i.ki,this.ih=null,this.s=!1,this.h=new u.default,this.h.init(t,i,this),this.r=this.h.r,this.sh=new c.default(this.h),this.xn=new n.default,this.Events=h.KsP2PloaderEvents}return s.getInstance=function(t,i){return this.instance||(this.instance=new s(t,i)),this.instance},s.prototype.$n=function(){return this.h.Xt&&this.ih?this.ih.$n():0},s.prototype.destroy=function(){this.close(),this.player=null,this.ih=null,this.xn&&(this.xn.removeAllListeners(),this.xn=null),this.sh&&(this.sh.destroy(),this.sh=null),this.r.info(this.t,"des <<<<<<<<<<<========== $$$$$, id = "+this.ki),this.r=null,this.h&&(this.h.unInit(),this.h=null),s.instance&&(s.instance=null)},s.prototype.open=function(t,i,s){if(this.s||(this.s=!0,this.sh.open(),this.nh()),(this.h.bi=!0)===this.h._i.isVod&&"mp4"===this.h._i.type)return this.ih.rh(t,i,s)},s.prototype.getData=function(t){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:-1;if(!0===this.h._i.isVod&&"mp4"===this.h._i.type&&this.ih)return this.ih.eh(t,i)},s.prototype.remove=function(t){return!(!this.s||!this.ih||"mp4"!=this.h._i.type)&&this.ih.oh(t)},s.prototype.ah=function(t){if(!this.s||!this.ih||"mp4"!=this.h._i.type)return!1;this.ih.ah(t)},s.prototype.close=function(){this.s&&(this.s=!1,this.ih&&(this.ih.destroy(),this.ih=null),this.sh&&this.sh.close())},s.prototype.nh=function(){var i=this;this.s&&(this.h.Xt?(this.ih=new r.default(this.h),this.ih.on(h.P2PNetCoreEvents.RAW_DATA_ARRIVED,this.onRawDataArrival.bind(this))):(this.ih=new e.default,this.ih.on(h.SystemNetCoreEvents.RAW_DATA_ARRIVED,this.onRawDataArrival.bind(this))),this.ih.on(h.P2PNetCoreEvents.ERROR,function(t){i.xn.emit(h.KsP2PloaderEvents.ERROR,t)}),this.ih.open())},s.prototype.on=function(t,i){this.xn.addListener(t,i)},s.prototype.off=function(t,i){this.xn.removeListener(t,i)},s.prototype.getVersion=function(){return o.default.Ti()},s.prototype.getDownLoadInfo=function(){var t={cdn:0,p2p:0};return this.h.Xt&&this.ih&&this.ih.uh&&this.ih.uh.ch&&(t.cdn=this.ih.uh.ch.fh,t.p2p=this.ih.uh.ch.lh,t.url=this.ih.uh.ch.vh,this.r&&this.r.info(this.t,"<<< id = "+this.ki+", cdn = "+t.cdn+", p2p = "+t.p2p+", "+t.p2p/(t.cdn+t.p2p)+"%")),t},s.prototype.qi=function(t,i){if(this.s){var s=t.module={};s.version=this.getVersion(),s.buildTime="2018-07-12 10:54:42";var n=t.system={},h=t.enviroment={};n.currentTime=f.default.Ai()/1e3,this.h.qi(h),this.h.Xt&&this.ih&&this.ih.qi(t,i)}},s.prototype.getStatistics=function(){return this.h.Xt&&this.ih?this.ih.getStatistics():null},s.prototype.onRawDataArrival=function(t,i){this.s&&this.xn.emit(h.KsP2PloaderEvents.RAW_DATA_ARRIVED,t,i)},s.isSupported=function(){var i=!1;try{var t=u.default.getInstance(),s=a.BrowserType.Pt|a.BrowserType.At|a.BrowserType.Mt|a.BrowserType.Ct|a.BrowserType.Rt|a.BrowserType.Ut,n=a.OSType.jt|a.OSType.Lt;return i=(i=(t.xi&s)!==a.BrowserType.Et)&&(t.Wi&n)!==a.OSType.xt}catch(t){return i}},s}();s.default=v},{"./common/basic/dynamic-config":2,"./common/basic/env":3,"./common/basic/version":5,"./common/utils/global":9,"./common/utils/ks-log":12,"./ks-p2ploader-events":21,"./p2p/p2p-net-core":47,"./system/fetch-net-core":66,events:1}],23:[function(t,i,s){"use strict";s.__esModule=!0,s.KsloaderEvents=void 0;var h=n(t("events")),r=n(t("../../../common/utils/ks-buffer")),e=n(t("../../../common/utils/url-parser"));function n(t){return t&&t.__esModule?t:{default:t}}var o=s.KsloaderEvents={ERROR:"onError",ON_DOWNLOAD_COMPLETED:"onComplete",ON_DOWNLOAD_DATA:"onDataArrival"},a=function(){function n(t){var i=1<arguments.length&&void 0!==arguments[1]&&arguments[1],s=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,n),this.BaseTag="BaseLoader",this.xn=new h.default,this.mh=0,this.ph=0,this.dh=0,this.bh=0,this.s=!1,this.wh=!1,this.kh="",this.yh="",this.gh=0,this._h="",this.Sh="",this.j=0,this.Th="",this.Zs="GET",this.Eh="HTTP/1.1",this.Ah=!1,this.Mh=!1,this.N=-1,this.Ch=0,this.Oh=0,this.x="",this.in=new Map,this.Rh=new Map,this.$=new r.default,this.tn="",this.Ph=-1,this.Uh=-1,this.Ih=0,this.Nh=-1,this.xh=-1,this.jh=-1,this.Lh=-1,this.$h="",this.Dh="",this.Wh=!1,this.r=t,this.vi=i,this.ki=s}return n.prototype.destroy=function(){this.close(),this.in=null,this.xn&&this.xn.removeAllListeners(),this.xn=null,this.r=null,this.vi=!1},n.prototype.getTag=function(){return this.Th},n.prototype.it=function(t){return this.Th=t,this},n.prototype.qh=function(t){return this.Dh="["+t+"]",this},n.prototype.open=function(t){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";2<arguments.length&&void 0!==arguments[2]&&arguments[2];if(!this.s){this.s=!0,this.Sh=t,this.Wh=""!==i;var s=new e.default;s.fromString(this.Sh),this.yh=s._n,this.gh=s.Sn,this.kh=s.gn,this._h=s.Tn,this.Ah||this.r.info(this.BaseTag,"id = "+this.ki+", ["+this.Th+"]"+this.Dh+"Start download "+this.Sh+"...")}},n.prototype.onDownloadData=function(t){this.xn.emit(o.ON_DOWNLOAD_DATA,t)},n.prototype.onDownloadCompleted=function(t){this.xn.emit(o.ON_DOWNLOAD_COMPLETED,t)},n.prototype.close=function(){this.s&&(this.s=!1)},n.prototype.on=function(t,i){this.xn.addListener(t,i)},n.prototype.off=function(t,i){this.xn.removeListener(t,i)},n}();s.default=a,window.KsloaderEvents=o},{"../../../common/utils/ks-buffer":11,"../../../common/utils/url-parser":18,events:1}],24:[function(t,i,s){"use strict";s.__esModule=!0;var o=h(t("../../../common/utils/global")),r=t("./base-loader"),n=h(r),a=h(t("../../../common/utils/string-utils"));function h(t){return t&&t.__esModule?t:{default:t}}var e=function(e){function h(t){var i=1<arguments.length&&void 0!==arguments[1]&&arguments[1],s=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,h);var n=function(t,i){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!i||"object"!=typeof i&&"function"!=typeof i?t:i}(this,e.call(this,t,i,s));n.t="FetchLoader",n.wh=!1,n.Bh=null;try{n.Bh=new self.AbortController}catch(t){n.r.warn(n.t,"id = "+n.ki+", no AbortController")}return n.Fh=n.Bh?n.Bh.signal:null,n}return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(t,i):t.__proto__=i)}(h,e),h.isSupported=function(){try{return self.fetch&&self.ReadableStream}catch(t){return!1}},h.prototype.destroy=function(){this.close(),this.Bh=null,this.Fh=null},h.prototype.open=function(t){var r=this,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";e.prototype.open.call(this,t,i),i&&this.in.set("Range",i);var s=this.getParams();this.Ih=this.ph=this.dh=o.default.Ai();var n=new Request(t,s),h=this.Fh;self.fetch(n,{signal:h}).then(function(t){if(r.s){r.Mh=!0,r.dh=o.default.Ai(),r.Nh<0&&(r.Nh=Math.max(r.dh-r.ph,0)),r.N=t.status,r.x=t.statusText;var s=r;if(t.headers.forEach(function(t,i){s.Rh.set(i,t)}),"cdn-range-data"==r.Th&&r.r.info(r.t,"id = "+r.ki+", then. [ "+r.Th+" ]"),t.ok){if(t.url!==r.Sh&&(r.Ah||r.r.info(r.t,"id = "+r.ki+", ["+r.Th+"]"+r.Dh+"Download auto redirect to "+t.url)),200<=t.status&&t.status<300){var i=t.headers.get("Content-Length");i&&(r.Ph=a.default.Hs(i));var n=t.headers.get("Content-Range");if(n){var h=n.split("/");2===h.length?(r.r.warn(r.t,"parse rangeValue = "+n),r.Uh=a.default.Hs(h[1])):r.r.warn(r.t,"id = "+r.ki+", ["+r.Th+"]"+r.Dh+" parse content-range("+n+") error: "+t.url)}return r.onFetchData.call(r,t.body.getReader())}}else r.Ah||r.r.info(r.t,"id = "+r.ki+", "+r.Th+", res.ok = "+t.ok),r.onComplete()}}).catch(function(t){r.Ah||r.r.info(r.t,"id = "+r.ki+", error:"+t),r.$h=t.toString(),r.onComplete()})},h.prototype.onComplete=function(){"cdn-range-data"==this.Th&&(this.Ah||this.r.info(this.t,"id = "+this.ki+", onComplete, "+this.Th+", this.isOpen_ = "+this.s)),this.s&&!this.wh&&(this.wh=!0,this.xh=Math.max(o.default.Ai()-this.Ih,0),this.zh(),this.xn.emit(r.KsloaderEvents.ON_DOWNLOAD_COMPLETED,this))},h.prototype.zh=function(){0<arguments.length&&void 0!==arguments[0]&&arguments[0];this.xh<0&&(this.jh=Math.max(this.dh-this.Ih,0),0<this.jh&&(this.Lh=this.j*o.default.Ss/this.jh))},h.prototype.onFetchData=function(s){var n=this;s.read().then(function(t){if(!1===n.s)return n.Ah||n.r.trace(n.t,"cancel..."),s.cancel();if(n.dh=o.default.Ai(),n.jh=Math.max(n.dh-n.Ih,0),t.value){var i=t.value.buffer;n.j+=i.byteLength,0<n.jh&&(n.Lh=n.j*o.default.Ss/n.jh),n.$.append(i),n.xn.emit(r.KsloaderEvents.ON_DOWNLOAD_DATA,n)}t.done?n.onComplete():n.onFetchData(s)}).catch(function(t){n.Ah||n.r.trace(n.t,"error:"+t),n.$h=t.toString(),n.onComplete()})},h.prototype.getParams=function(){this.Th;var t=new Headers,i=this.in,s=Array.isArray(i),n=0;for(i=s?i:i[Symbol.iterator]();;){var h;if(s){if(n>=i.length)break;h=i[n++]}else{if((n=i.next()).done)break;h=n.value}var r=h,e=r[0],o=r[1];t.append(e,o)}var a={method:this.Zs,headers:t,mode:"cors",cache:"no-cache",redirect:"follow",credentials:this.vi?"include":"same-origin"};return""!==this.tn&&(a.body=this.tn),a},h.prototype.close=function(){if(this.s=!1,!this.wh&&this.Bh)try{this.Bh.abort()}catch(t){this.r&&this.r.info(this.t,"this.controller_.abort() = "+t)}},h}(n.default);s.default=e},{"../../../common/utils/global":9,"../../../common/utils/string-utils":17,"./base-loader":23}],25:[function(t,i,s){"use strict";s.__esModule=!0;t("../../../common/utils/ks-log");var n,h=t("./ks-loader"),r=(n=h)&&n.__esModule?n:{default:n},e=t("./base-loader");var o=function(){function i(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,i),this.BaseTag="KsHttploader",this.Vh=null,this.Hh=null,this.Jh=t,this.s=!1,this.Ah=!1}return i.prototype.wait=function(s){return new Promise(function(t,i){setTimeout(t,s)})},i.prototype.close=function(){this.clearTimer(),this.cancel(),this.Jh=null,this.s=!1},i.prototype.cancel=function(){this.Hh&&(this.Hh.zh("cancel"),this.Hh.destroy()),this.Hh=null},i.prototype.isIdle=function(){return null==this.Hh},i.prototype.create=function(){var i=this;return this.cancel(),this.s=!0,this.Hh=r.default.Kh(this.Jh.h.r),this.Ah&&(this.Hh.Ah=!0),this.Hh.on(e.KsloaderEvents.ON_DOWNLOAD_DATA,function(t){i.s&&i.Hh===t?i.Jh&&i.Jh.Gh&&i.Jh.Gh(t):i.Ah||i.Jh.h.r.info(i.BaseTag,"Expired http download data for tag, ignore")}),this.Hh.on(e.KsloaderEvents.ON_DOWNLOAD_COMPLETED,function(t){i.s&&i.Hh===t?(i.Hh=null,i.clearTimer(),i.Jh&&i.Jh.I&&i.Jh.I(t)):i.Ah||i.Jh.h.r.info(i.BaseTag,"Expired http complete for tag, ignore")}),this.Hh},i.prototype.setLogNone=function(){this.Ah=!0},i.prototype.setTimer=function(t,i,s){var n=this;return this.clearTimer(),this.Vh=setTimeout(function(){n.s&&n.Hh===s?n.Jh&&n.Jh.U&&n.Jh.U(t,n.Hh):n.Ah||n.Jh.h.r.info(n.BaseTag,"Expired http timeout for tag, ignore")},i),s},i.prototype.clearTimer=function(){this.Vh&&(clearTimeout(this.Vh),this.Vh=null)},i}();s.default=o},{"../../../common/utils/ks-log":12,"./base-loader":23,"./ks-loader":26}],26:[function(t,i,s){"use strict";s.__esModule=!0;var n=r(t("./fetch-loader")),h=r(t("./xhr-range-loader"));function r(t){return t&&t.__esModule?t:{default:t}}var e=function(){function t(){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t)}return t.Kh=function(t){var i=1<arguments.length&&void 0!==arguments[1]&&arguments[1],s=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;if(n.default.isSupported())return new n.default(t,i,s);if(h.default.isSupported())return new h.default(t,i);throw new Error("Your browser doesn't support xhr with arraybuffer responseType!")},t}();s.default=e,window.KsLoader=e},{"./fetch-loader":24,"./xhr-range-loader":27}],27:[function(t,i,s){"use strict";s.__esModule=!0;t("../../../common/utils/ks-log");var l=t("./base-loader"),n=h(l),v=h(t("../../../common/utils/global")),m=h(t("../../../common/utils/string-utils"));function h(t){return t&&t.__esModule?t:{default:t}}var r=function(f){function n(t,i){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,n);var s=function(t,i){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!i||"object"!=typeof i&&"function"!=typeof i?t:i}(this,f.call(this,t,i));return s.t="XhrRangeLoader",s.wh=!1,s.Qh=null,s}return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(t,i):t.__proto__=i)}(n,f),n.isSupported=function(){if(!this.Ks)try{this.Ks=!0;var t=new XMLHttpRequest;return t.open("GET","https://example.com",!0),t.responseType="arraybuffer",this.Gs="arraybuffer"===t.responseType,this.Gs}catch(t){return this.Gs=!1,this.r.warn("RangeLoader",t.message),!1}return this.Gs},n.prototype.destroy=function(){this.close()},n.prototype.open=function(t){var h=this,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";f.prototype.open.call(this,t,i),this.Ih=this.ph=this.dh=v.default.Ai();var r=this.Qh=new XMLHttpRequest;r.open(this.Zs,t,!0),r.responseType="arraybuffer",this.vi&&(r.withCredentials=!0),r.onreadystatechange=function(t){if(h.s&&2===r.readyState){h.Mh=!0,h.dh=v.default.Ai(),h.Nh<0&&(h.Nh=Math.max(h.dh-h.ph,0)),h.N=r.status,h.x=r.statusText,""!==r.responseURL&&r.responseURL!==h.Sh&&(h.Ah||h.r.info(h.t,"["+h.Th+"]"+h.Dh+"Download auto redirect to "+r.responseURL));var i=r.getResponseHeader("Content-Length");i&&(h.Ph=m.default.Hs(i));var s=h.Wh?r.getResponseHeader("Content-Range"):null;if(s){var n=s.split("/");2===n.length?h.Uh=m.default.Hs(n[1]):h.r.error(h.t,"["+h.Th+"]"+h.Dh+" parse content-range("+s+") error: "+r.responseURL)}0!==r.status&&(r.status<200||299<r.status)&&h.onComplete()}},r.onprogress=function(t){h.s&&(h.dh=v.default.Ai())},r.onload=function(t){if(h.s){h.dh=v.default.Ai(),h.jh=Math.max(h.dh-h.Ih,0);var i=t.target.response;h.j+=i.byteLength,0<h.jh&&(h.Lh=h.j*v.default.Ss/h.jh),h.$.append(i),h.xn.emit(l.KsloaderEvents.ON_DOWNLOAD_DATA,h)}},r.onloadend=function(t){h.s&&(h.Ah||h.r.trace(h.t,"done..."),h.onComplete())},r.onerror=function(t){h.s&&(h.Ah||h.r.trace(h.t,"error:"+t.constructor.name+","+t.type),h.$h=t.constructor.name,h.onComplete())},i&&r.setRequestHeader("Range",i);var s=this.in,n=Array.isArray(s),e=0;for(s=n?s:s[Symbol.iterator]();;){var o;if(n){if(e>=s.length)break;o=s[e++]}else{if((e=s.next()).done)break;o=e.value}var a=o,u=a[0],c=a[1];r.setRequestHeader(u,c)}try{""!==this.tn?r.send(this.tn):r.send(null)}catch(t){this.r.error(t)}},n.prototype.onComplete=function(){this.s&&!this.wh&&(this.wh=!0,this.xh=Math.max(v.default.Ai()-this.Ih,0),this.zh(),this.xn.emit(l.KsloaderEvents.ON_DOWNLOAD_COMPLETED,this))},n.prototype.zh=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";this.xh<0&&(this.jh=Math.max(this.dh-this.Ih,0),0<this.jh&&(this.Lh=this.j*v.default.Ss/this.jh)),this.Ah||this.r.info(this.t,"["+this.Th+"]"+this.Dh+"Download "+(""===t?this.Mh?"OK":"FAILED":t)+": "+(this.Mh?"":this.$h)+", url("+this.Sh+")"),this.Ah||this.r.info(this.t,"["+this.Th+"]"+this.Dh+"Response code("+this.N+"), details("+this.x+"), data("+this.j+"/"+this.Ch+" Bytes), responsed time("+this.Nh+" ms), total used time("+this.xh+" ms), speed("+this.Lh+" Byte/s), alive times("+this.Oh+")")},n.prototype.close=function(){this.s&&(this.s=!1,this.Qh&&this.Qh.abort())},n}(n.default);s.default=r},{"../../../common/utils/global":9,"../../../common/utils/ks-log":12,"../../../common/utils/string-utils":17,"./base-loader":23}],28:[function(t,i,s){"use strict";s.__esModule=!0,s.Xh=void 0;var r=h(t("../../../common/utils/url-parser")),e=h(t("../../../common/utils/string-utils")),g=h(t("../../../common/utils/ks-buffer")),o=h(t("../../../common/utils/ks-array")),a=t("./meta-data"),n=h(a),_=h(t("./segment")),S=t("./piece"),T=h(S),u=t("../../../common/utils/crypto"),c=h(t("../../../common/basic/version")),E=h(t("../../../common/utils/global")),A=t("../../protocol/base/manager");function h(t){return t&&t.__esModule?t:{default:t}}var M=s.Xh={Yh:131072,Zh:1,tr:4,ir:131072,sr:0,nr:Math.pow(25,4)},f=function(n){function h(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,h);var i=function(t,i){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!i||"object"!=typeof i&&"function"!=typeof i?t:i}(this,n.call(this,t));i.t="MetaDataMP4",i.hr=a.er.rr,i.or=a.ur.ar,i.cr=e.default.st(t._i.url);var s=new r.default;return s.fromString(t._i.url),s.Mn.set("kcgm",t.h.K),s.Mn.set("kcg",c.default.Z()),s.Mn.set("kcgid",t.h.T),s.Mn.set("kcguid",i.ch.fr),s.Mn.set("stream",i.cr),i.lr=i.vr=t._i.url,i.mr=s.toString(),i.pr=s._n,i.dr=s.Tn,i.wr=s.An,i.kr=s.En,i.yr=!1,i.gr="",i._r=0,i.Sr=0,i.Tr=0,i.Er=new o.default,i.Ar=null,i.Mr=null,i.Cr=null,i.timeRage=[],i.ki=t.h.ki,i.r.info(i.t,"con $$$$  ===========>>>>>>>>>>>, id = "+i.ki),i}return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(t,i):t.__proto__=i)}(h,n),h.prototype.destroy=function(){this.r.info(this.t,"des <<<<<<<<<<<========== $$$$, id = "+this.ki),n.prototype.destroy.call(this),this._r=0,this.Tr=0,this.Sr=0,this.Er=null,this.Ar=null,this.Mr=null,this.Cr=null,this.timeRage=[],this.r=null},h.prototype.Or=function(){return M.Yh/M.tr},h.prototype.Rr=function(){return M.tr},h.prototype.Pr=function(){return 524288e3<this._r?M.ir:104857600<this._r?32768:10485760<this._r?16384:8192},h.prototype.Ur=function(){return 104857600<this._r?16:10485760<this._r?8:4},h.prototype.Ir=function(){return this.Nr&&0<this.Nr.size()},h.prototype.xr=function(){return 0<this.Er.size()},h.prototype.jr=function(t){return this.Lr.isOutOfDate(t)},h.prototype.$r=function(t){if(!this.Ir()||t<0||t>=this._r)return null;var i=-1,s=M.Yh*M.Zh,n=this.Pr();if(0<this.Sr)if(t<s)i=Math.floor(t/this.Or());else{var h=t-s,r=Math.floor(h/n);i=this.Sr+r}else i=Math.floor(t/n);return i>=this.Dr.size?null:this.Dr.get(String(i))},h.prototype.Wr=function(t,i){var s=this.qr(t);return s?s.Br:""},h.prototype.Fr=function(t){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;if(0<this._r||t<=0)return!1;this._r=t,this.Vr.zr=0;var s=null,n=null,h=null,r=this.Vr.Hr=0,e=0,o=M.Yh*M.Zh;this.Sr=Math.ceil(o/this.Or());var a=null;i&&0<i.byteLength&&(a=new Uint8Array(i));for(var u=E.default.Ai(),c=this.Pr(),f=Math.ceil((this._r-o)/c)+this.Sr,l=0,v=0;v<f;v++){var m=0<this.Sr&&v<this.Sr?this.Rr():this.Ur();if((0<this.Sr&&v>=this.Rr()?v-this.Rr():v)%m==0){var p=new _.default;this.Nr.push_back(p),p.Br=r.toString(),p.Jr=r,p.Kr=this,p.Gr=u+v,p.Qr=!0,p.url=p.Xr=this.vr,s&&(s.Yr=p),(s=p).Zr=h,h=p,r++,e=0}var d=this.Nr.back(),b=new T.default;if(b.Br=this.Vr.zr.toString(),b.Jr=e,b.hr=S.ie.te,v<this.Sr){b.se=this.Or(),b.ne=e*this.Or();var w=l*this.Or(),k=(l+1)*this.Or();if(a){var y=new g.default;y.append(a.subarray(w,k)),this.he(b,y,y.size()),b.data=y,b.re=u,b.ee=A.ae.oe,d.ue(),this.Tr+=b.se}l++}else b.se=v<f-1?c:this._r%c,b.ne=e*c;b.ce=n?n.ce+n.se:0,b.segment=d,n&&(n.Yr=b),n=b,d.se+=b.se,d.fe.push_back(b),this.Dr.set(b.Br,b),e++,this.Vr.zr++}this.r.info(this.t,"getData $$$ ++++++++++++++, pConut = "+this.Vr.zr+", sCount = "+r+", pSize = "+this.Pr()+", id = "+this.ki)},h.prototype.le=function(){},h.prototype.ve=function(t){},h.prototype.me=function(){if(""===this.pe){var t=new r.default;t.fromString(this.lr),t.gn="http",this.pe=(0,u.hs)(t.toString(!1))+"_"+c.default.Gi}},h.prototype.de=function(t){},h.prototype.be=function(){},h}(n.default);s.default=f},{"../../../common/basic/version":5,"../../../common/utils/crypto":8,"../../../common/utils/global":9,"../../../common/utils/ks-array":10,"../../../common/utils/ks-buffer":11,"../../../common/utils/string-utils":17,"../../../common/utils/url-parser":18,"../../protocol/base/manager":48,"./meta-data":29,"./piece":30,"./segment":31}],29:[function(t,i,s){"use strict";s.__esModule=!0,s.MetaInfo=s.ur=s.er=void 0;t("../../../common/utils/ks-log");var n=e(t("../../../common/utils/ks-array")),h=e(t("../../../common/utils/string-utils")),r=e(t("../../../common/utils/ks-buffer"));function e(t){return t&&t.__esModule?t:{default:t}}function o(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}var a=s.er={we:0,ke:1,rr:2,ye:3,ge:4,_e:5,Se:6},u=s.ur={Te:0,Ee:1,ar:2,Ae:3},c=s.MetaInfo=function(){function t(){o(this,t),this.reset()}return t.prototype.reset=function(){this.Hr=0,this.Me="",this.Ce=0,this.zr=0,this.Oe=0,this.etag="",this.lastModified="",this.Re=0},t}(),f=function(){function i(t){o(this,i),this.t="MetaData",this.vr="",this.ch=t,this.Vr=new c,this.hr=a.we,this.or=u.Ae,this.Pe=!1,this.Ue=new r.default,this.pe="",this.lr="",this.vr="",this.Nr=new n.default,this.Dr=new Map,this.r=t.h.r}return i.prototype.destroy=function(){this.Nr=null,this.ch=null,this.r=null},i.prototype.parse=function(t){},i.prototype.save=function(t){},i.prototype.read=function(t){},i.prototype.Ie=function(){return this.hr===a.ye||this.hr===a.ke?"m3u8-p2p":this.hr===a.ge?"flv-p2p":this.hr===a.rr?"mp4-p2p":this.hr===a.Se?"download-p2p":"unknown"},i.prototype.Ne=function(){return this.xe(this.hr)?"live":this.je(this.hr)?"vod":"download"},i.prototype.xe=function(){return this.hr===a.ge||this.hr===a.ye},i.prototype.je=function(){return this.hr===a.rr||this.hr===a.ke},i.prototype.Le=function(){return this.hr===a.ge},i.prototype.$e=function(i){var t=this.Nr.find(function(t){return t.Br===i});return"undefined"!==t?t:null},i.prototype.De=function(t){var i=this.Nr,s=Array.isArray(i),n=0;for(i=s?i:i[Symbol.iterator]();;){var h;if(s){if(n>=i.length)break;h=i[n++]}else{if((n=i.next()).done)break;h=n.value}var r=h;if(!(0<r.re)){var e=r.fe,o=Array.isArray(e),a=0;for(e=o?e:e[Symbol.iterator]();;){var u;if(o){if(a>=e.length)break;u=e[a++]}else{if((a=e.next()).done)break;u=a.value}var c=u;c.We===t&&(this.r.info(this.t,"resetPieceReceivingBySession , StartTime = "+c.qe+", SessionId = "+c.We+", id_ = "+c.Br+", Protocol_ = "+c.ee),c.Be=!1,c.qe=0,c.We=0)}}}},i.prototype.Fe=function(){switch(this.hr){case a.ke:return"m3u8-vod";case a.rr:return"mp4-vod";case a.ye:return"m3u8-live";case a.ge:return"flv-live";case a.Se:return"download";default:return"unknown"}},i.prototype.ze=function(t){var i=this.Dr.get(t);return h.default._(i)?"-1":i.segment.Jr},i.prototype.qr=function(t){var i=this.Dr.get(t);return h.default._(i)?null:i.segment},i.prototype.Ve=function(t){return this.Dr.get(t)},i.prototype.he=function(t,i,s){switch(this.or){case u.ar:return t.He(i,s);case u.Ae:return t.Je(i,s);case u.Ee:return!0;case u.Te:return!1;default:return t.Je(i,s)}},i.prototype.Ke=function(t){for(var i=0;i<=t&&!this.Nr.empty();i++){this.Nr.front().earse(),this.Nr.erase(0)}},i.prototype.qi=function(t,i,s,n){var h=s.incompleteOnly;n.segmentCount=this.Nr.size(),n.pieceCount=this.Dr.size,n.p2pGroupId=this.pe,n.segmentFirstId=0<this.Nr.size()?this.Nr.front().Br:"0",n.segmentLastId=0<this.Nr.size()?this.Nr.back().Br:"0",n.verifyMethod=this.or;var r=0,e=0,o=0,a=0,u=n.segments=[],c=!1,f=s.segmentStartWithPlayer,l=s.maxCount;l<=0&&(l=6);for(var v=0;v<this.Nr.size();v++){var m=this.Nr.at(v);if(""!==t&&m.Br!==t||(c=!0),c){if(h&&0<m.re)continue;if(0<i&&i<=e)break;if(f&&l<r)break;var p=u[u.length]={};m.qi(p),r++,e+=m.Ge,0<m.re?o++:0<m.Qe&&a++}}n.segmentDisplayCount=r,n.segmentDisplayDuration=e,n.segmentCompletedCount=o,n.segmentCompletingCount=a},i}();s.default=f},{"../../../common/utils/ks-array":10,"../../../common/utils/ks-buffer":11,"../../../common/utils/ks-log":12,"../../../common/utils/string-utils":17}],30:[function(t,i,s){"use strict";s.__esModule=!0,s.ie=void 0;var n,h=t("../../../common/utils/crc"),r=t("../../../common/utils/crc32"),e=(n=r)&&n.__esModule?n:{default:n};s.ie={Xe:-1,Ye:0,Ze:1,io:2,te:3,so:4};var o=function(){function t(){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.t="Piece",this.Br="",this.hr=0,this.ne=0,this.se=0,this.no=!1,this.ho=0,this.ro=0,this.eo=0,this.Jr=0,this.oo=0,this.ao=Math.floor(101*Math.random()),this.uo=0,this.ee=0,this.co=0,this.Be=!1,this.We=0,this.qe=0,this.fo=0,this.re=0,this.Ge=0,this.data=null,this.segment=null,this.Yr=null,this.lo="",this.ce=0}return t.prototype.earse=function(){0<arguments.length&&void 0!==arguments[0]&&arguments[0]||(this.Yr=null),this.data=null,this.lo=""},t.prototype.qi=function(t){t.id=this.Br,t.index=this.Jr,t.type=this.hr,t.offset=this.ne,t.size=this.se,t.wild=this.no,t.checksum=this.eo,t.transferDepth=this.uo,t.shareInRanges=this.co,t.receiveProtocol=this.ee,t.receiveByStable=this.Be,t.receiveStartTime=this.qe,t.playedTime=this.fo,t.completedTime=this.re},t.prototype.vo=function(t){},t.prototype.mo=function(t){},t.prototype.He=function(t,i){var s=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;if(this.no)return!0;if(t.size()!==i)return!1;var n;return n=e.default.ts(t.array()),0!=this.eo?this.eo===n:0!=s?(this.eo=s===n?s:0,s===n):(this.eo=n,!0)},t.prototype.Je=function(t,i){if(this.no)return!0;var s=h.CryptoCRC.Xi(t.array());return this.eo===s},t}();s.default=o},{"../../../common/utils/crc":6,"../../../common/utils/crc32":7}],31:[function(t,i,s){"use strict";s.__esModule=!0;var n=h(t("../../../common/utils/ks-array")),e=h(t("../../../common/utils/global"));function h(t){return t&&t.__esModule?t:{default:t}}var r=function(){function t(){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.t="Segment",this.Br="",this.Ih=0,this.Gr=0,this.po=0,this.do=0,this.Ge=0,this.ho=0,this.Jr=0,this.bo=0,this.wo=0,this.se=0,this.ne=0,this.ko=!1,this.yo=!1,this.Qr=!1,this.go=!1,this.url="",this.Xr="",this._o="",this.fe=new n.default,this.Qe=0,this.re=0,this.So=0,this.To=0,this.Eo=0,this.Ao=0,this.Mo=!0,this.Kr=null,this.Yr=null,this.Zr=null}return t.prototype.earse=function(){var t=0<arguments.length&&void 0!==arguments[0]&&arguments[0];t||(this.Mo=!1,this.Kr=null,this.Yr=null,this.Zr=null);var i=this.fe,s=Array.isArray(i),n=0;for(i=s?i:i[Symbol.iterator]();;){var h;if(s){if(n>=i.length)break;h=i[n++]}else{if((n=i.next()).done)break;h=n.value}h.earse(t)}},t.prototype.qi=function(t){t.id=this.Br,t.index=this.Jr,t.duration=this.Ge,t.url=this.url,t.pieceCount=this.fe.size(),t.pieceTnCount=this.bo,t.piecePnCount=this.wo,t.size=this.se,t.startTime=this.Ih,t.startTimeActual=this.Gr,t.completedTime=this.re,t.completedPieceCount=this.Qe,t.completedSize=this.So,t.startReceiveTime=this.To,t.lastReceiveTime=this.Eo,t.receiveSpeed=this.Ao,t.beginOfMeta=this.ko,t.discontinuity=this.Qr,t.updateSuccess=this.yo;for(var i=0,s=t.pieces=[],n=0;n<this.fe.size();n++){var h=this.fe.at(n);h.re<=0&&0<h.qe&&i++;var r=s[s.length]={};h.qi(r)}t.pendingPieceCount=i},t.prototype.vo=function(t){},t.prototype.mo=function(t){},t.prototype.ue=function(){var t=e.default.Ai();this.Eo=t,this.Qe=0,this.So=0;var i=this.fe,s=Array.isArray(i),n=0;for(i=s?i:i[Symbol.iterator]();;){var h;if(s){if(n>=i.length)break;h=i[n++]}else{if((n=i.next()).done)break;h=n.value}var r=h;0<r.re&&(this.Qe++,0<r.se&&(this.So+=r.se))}this.Qe===this.fe.size()&&(this.Kr.Le()?0<this.Kr.Nr.size()&&this.Br!==this.Kr.Nr.back().Br&&(this.re=t,this.So<=0&&(this.So=this.se)):(this.re=t,this.So<=0&&(this.So=this.se))),0<this.To&&t>this.To&&(this.Ao=this.So*e.default.Ss/(t-this.To))},t.prototype.Co=function(){var t=0<arguments.length&&void 0!==arguments[0]&&arguments[0];this.re=0,this.Qe=0,this.To=0,this.Eo=0,this.Ao=0;var i=this.fe,s=Array.isArray(i),n=0;for(i=s?i:i[Symbol.iterator]();;){var h;if(s){if(n>=i.length)break;h=i[n++]}else{if((n=i.next()).done)break;h=n.value}var r=h;r.re=0,r.ee=0,r.qe=0,r.fo=0}this.earse(t);var e=this.So;return this.So=0,e},t}();s.default=r},{"../../../common/utils/global":9,"../../../common/utils/ks-array":10}],32:[function(t,i,s){"use strict";s.__esModule=!0;var n,h=t("events"),r=(n=h)&&n.__esModule?n:{default:n};var e=function(){function i(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,i),this.BaseTag="Append",this.s=!1,this.uh=t,this.ch=t.ch,this.Kr=t.ch.Kr,this.xn=new r.default,this.Oo=null}return i.prototype.destroy=function(){this.close(),this.xn&&this.xn.removeAllListeners(),this.Ro(),this.uh=null,this.xn=null,this.ch=null,this.Kr=null},i.prototype.setTimeout=function(i){function t(t){return i.apply(this,arguments)}return t.toString=function(){return i.toString()},t}(function(t){var i=this;this.Ro(),this.uh&&(i.Oo=setTimeout(function(){i.onTimeout()},t))}),i.prototype.onTimeout=function(){},i.prototype.Ro=function(){this.Oo&&(clearTimeout(this.Oo),this.Oo=null)},i.prototype.open=function(){this.s||(this.s=!0)},i.prototype.close=function(){this.s&&(this.s=!1)},i.prototype.on=function(t,i){this.xn.addListener(t,i)},i.prototype.off=function(t,i){this.xn.removeListener(t,i)},i.prototype.Po=function(){},i}();s.default=e},{events:1}],33:[function(t,i,s){"use strict";function n(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}s.__esModule=!0;var h=s.ChannelStatus={Unknown:-1,Opened:0,Paused:1,Stoped:2},r=(s.PlayerStatus=function(){function t(){n(this,t),this.Uo=0,this.Io=0,this.No=0,this.xo=0,this.jo=0,this.Lo=0,this.$o=0,this.Do="",this.Wo="",this.qo="",this.Bo="",this.Fo=0,this.zo=0,this.Vo=0,this.Ho=0,this.Jo="",this.Ko=0,this.Go="",this.Qo=0,this.Xo=""}return t.prototype.destroy=function(){},t.prototype.qi=function(t,i){t.playerFlushTime=this.Io,t.playerFlushInterval=this.No,t.playerFlushMaxInterval=this.xo,t.playerInitialPosition=this.jo,t.playerSkipPosition=this.Lo,t.playerSkipDuration=this.$o,t.playerSkipBeginSegmentId=this.Do,t.playerSkipEndSegmentId=this.Wo,t.playerSkipInitSegmentId=this.qo,t.playerSegmentId=this.Bo},t}(),function t(){n(this,t),this.Yo=!1,this.Zo=-1,this.ta="",this.ia="",this.sa="",this.na=0,this.ha=0,this.ra=0,this.ea=0,this.oa="",this.aa=0}),e=function t(){n(this,t),this.ua="",this.ca=0,this.fa=0,this.la=-1,this.va=0,this.ma=0},o=function(){function t(){n(this,t),this.pa=h.Unknown,this.da=new r,this.ba=new e,this.Xs=0,this.wa=0,this.dh=0,this.ka=0,this.ya=0,this.ga=0}return t.prototype.destroy=function(){this.da=null,this.ba=null},t.prototype.qi=function(t,i){t.createTime=this.Xs,t.openTime=this.wa,t.activeTime=this.dh,t.gslbServerIp=this.ba.ua,t.gslbTryTimes=this.ba.ca,t.channelOpenedTime=this.ya,t.maxSleepTime=this.ka,t.mediaStartTime=this.ga,t.metaTryTimes=this.da.ea,t.metaServerResponseCode=this.da.aa,t.metaResponseCode=this.da.Zo,t.metaResponseDetails=this.da.ta,t.metaResponseType=this.da.ia,t.metaLoadTime=this.da.na,t.metaLastLoadTime=this.da.ha,t.metaServerIp=this.da.oa},t}();s.default=o},{}],34:[function(t,i,s){"use strict";s.__esModule=!0;var n=p(t("events")),h=(t("../../../common/utils/ks-log"),p(t("../../tools/collector/report-client"))),r=t("./channel-info"),e=p(r),o=p(t("./protocol-observer")),a=p(t("./stat-data")),u=t("../../../ks-p2ploader-events"),c=t("../../../common/utils/md5"),f=p(t("./context")),l=t("../../tools/collector/stage"),v=p(t("../../../common/basic/error")),m=p(t("../../../common/utils/global"));function p(t){return t&&t.__esModule?t:{default:t}}var d=function(){function i(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,i),this.BaseTag="BaseChannel",this.h=t,this.r=t.r,this.ch=new f.default(this.h),this._a=null,this.Sa=null,this.Ta=null,this.Ea=null,this.Aa=new h.default(this.ch),this.xn=new n.default,this.s=!1,this.ch.Ma=this.Ma=new e.default,this.ch.Ca=this.Ca=new a.default,this.Br=c.Md5.R(this.ch._i.url).toLowerCase(),this.ch.Oa=this.Br,this.Ma.Xs=this.pStartTime=m.default.Ai(),this.Ra=new r.PlayerStatus}return i.prototype.destroy=function(){this.close(),this.r.info(this.BaseTag,"destroy()"),this.xn&&this.xn.removeAllListeners(),this.Aa&&this.Aa.destroy(),this._a&&this._a.destroy(),this.Sa&&this.Sa.destroy(),this.Ea&&this.Ea.destroy(),this.Ta&&this.Ta.destroy(),this.ch&&this.ch.destroy(),this.Ra&&this.Ra.destroy(),this.xn=null,this.Ea=null,this._a=null,this.Aa=null,this.ch=null,this.Sa=null,this.Ta=null,this.r=null,this.h=null,this.Ca=null,this.Ma=null,this.Ra=null},i.prototype.open=function(){var t=this;return this.s=!0,this.r.info(this.BaseTag,"base channel open..."),this.Ea=new o.default(this),this.Aa.open().Pa(l.StageAction.Ua,v.default.Bi),this.Ta.on(u.Qn.Yn,function(){Promise.resolve().then(function(){t.Ea.open()})}),!0},i.prototype.ah=function(t){if(!this.s)return!1},i.prototype.close=function(){this.s&&(this.s=!1,this.Aa&&this.Aa.close(),this.Ea&&this.Ea.close(),this.Ta&&this.Ta.close())},i.prototype.on=function(t,i){this.xn.addListener(t,i)},i.prototype.off=function(t,i){this.xn.removeListener(t,i)},i.prototype.Ia=function(){},i.prototype.qi=function(t,i){this.Ma.qi(t,i);var s=i.simple,n=i.segmentStartWithPlayer,h=i.maxDuration||0;if(n&&h<=0&&(h=300*m.default.b),t.id=this.Br,t.type="flv-live",t.opened=!0,t.paused=!1,t.groupType=0,t.directMetaMode=this.ch.Kr.Pe,t.channelUrl=this.ch.Kr.lr,t.channelPlayUrl="",t.gslbServerResponseCode=0,t.gslbServerErrorCode=0,t.gslbLoadTime=0,t.gslbConsumedTime=0,t.totalDuration=0,!s){var r=t.context={};this.ch.qi(r),this.Ca.qi(t,i);var e=t.metaData={};this.ch.Kr.qi(n?this._a.Vr.Me:"",h,i,e),this._a.qi(t)}},i.prototype.getStatistics=function(){var t=m.default.Ai(),i=Math.floor((t-this.pStartTime)/1e3);this.pStartTime=t;var s=0,n=0;0<i&&(s=Math.round(this.ch.Na/i),n=Math.round(this.ch.xa/i)),this.ch.Na=0,this.ch.xa=0;var h=new Object;return h.p2purl=this.ch.Kr.lr,h.p2p_d=String(s+" B/S"),h.cdn_d=String(n+" B/S"),h},i}();s.default=d},{"../../../common/basic/error":4,"../../../common/utils/global":9,"../../../common/utils/ks-log":12,"../../../common/utils/md5":16,"../../../ks-p2ploader-events":21,"../../tools/collector/report-client":61,"../../tools/collector/stage":64,"./channel-info":33,"./context":35,"./protocol-observer":38,"./stat-data":40,events:1}],35:[function(t,i,s){"use strict";s.__esModule=!0;var n=a(t("../../../common/utils/url-parser")),h=t("../../protocol/base/manager"),r=a(t("../../../common/utils/string-utils")),e=a(t("../../../common/utils/ks-array")),o=(a(t("../../../common/basic/env")),a(t("../../../common/utils/global")));function a(t){return t&&t.__esModule?t:{default:t}}var u=function(){function i(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,i),this.ja=new e.default,this.h=t,this.La="",this.$a="",this.Da="m3u8",this.fr=r.default.format("{0}{1}{2}{3}",Math.floor(1001*Math.random()),Math.floor(1001*Math.random()),Math.floor(1001*Math.random()),o.default.Ai()),this.Wa="",this.qa="",this.Ba=h.za.Fa,this.Va=1e3,this.Ha=60,this.Ja=!1,this.Ka=!0,this.Oa="",this.Ga=.1,this.Qa=5,this.Xa=6,this.Ya=5,this.Za=2,this.tu=2,this.iu=1048576,this.su=5,this.nu=3,this.hu=!1,this.ru=!0,this.eu=!0,this.ou=!0,this.au=2,this.uu=128,this.cu=4,this.fu=!1,this.lu=5e4,this.vu=12e4,this.mu=3e4,this.pu=!0,this.du="",this.bu="",this.wu="",this.ku="",this.yu=-1,this.gu=30,this._u=5,this.Su=20,this.Tu=1,this.Eu=1,this.Au=!1,this.Mu=!0,this.Cu=15,this.Ou=0,this.Ru=0,this.Pu=!1,this.Uu=!1,this.Iu=!1,this.Nu=!1,this.xu=!1,this.ju="",this.Lu="",this.$u="",this.Du="",this.Wu="",this.qu="",this.Bu="",this.Fu="",this.vt=-1,this.zu=0,this.Vu=0,this.Hu=0,this.Ju=0,this.Ku=0,this.Gu=0,this.Qu=0,this.Xu=-1,this.Yu=0,this.Zu=0,this.tc=0,this.ic=0,this.sc=0,this.nc=0,this.hc=0,this.rc=0,this.ec=0,this.oc=0,this.ac=0,this.uc=0,this.cc=0,this.fc=0,this.lc=new Set,this.vc=new Set,this.mc=new Set,this.pc=0,this.dc=0,this.bc=!1,this.wc=0,this.kc=0,this.yc="",this.gc=0,this._c=0,this.Sc=0,this.Tc="",this.Ec="",this._i=this.Ac(t._i),this.Ci(),this.Mc="{}",this.xa=0,this.Na=0,this.lh=0,this.fh=0,this.Cc=2000087882,this.Oc="",this.Rc=3,this.Pc=3,this.Kr=null,this.Ca=null,this.Ma=null,this.vh=""}return i.prototype.Ac=function(t){var i={};for(var s in t)"videoTag"!=s&&(i[s]=t[s]);return i},i.prototype.Ci=function(){var t=new n.default;t.fromString(this._i.url),this.Wa=t._n,this.h.Wa=this.Wa},i.prototype.destroy=function(){this._i=null,this.h=null,this.Kr&&(this.Kr.destroy(),this.Kr=null),this.Ca&&(this.Ca.destroy(),this.Ca=null),this.Ma&&(this.Ma.destroy(),this.Ma=null),this.vh=""},i.prototype.qi=function(t){t.geo=this.qa,t.statReportInterval=this.Ha,t.liveStorageMemoryOnly=this.Ja,t.cdnKeepAlive=this.Ka,t.p2pPeerId=this.du,t.p2pRtmfpPeerId=this.bu,t.p2pWebsocketPeerId=this.wu,t.p2pWebrtcPeerId=this.ku,t.p2pFetchRate=this.Ga,t.p2pMaxPeers=this.Qa,t.p2pUrgentSize=this.Ya,t.p2pLedbatEnabled=this.ou,t.p2pUploadEnabled=this.ru,t.p2pUploadLimit=this.fu,t.p2pUploadThrottleInit=this.lu,t.p2pUploadThrottleAverage=this.vu,t.p2pUploadMaxReserved=this.mu,t.p2pUrgentUploadEnabled=this.pu,t.p2pShareRangeInterval=this._u,t.p2pMaxParallelRequestPieces=this.Su,t.p2pMaxUrgentRequestPieces=this.Tu,t.cdnSlowThresholdRate=this.Eu,t.cdnDisabled=this.Au,t.cdnMultiRequest=this.Mu,t.cdnMultiMaxHost=this.Cu,t.cdnStartTime=this.Ou,t.playingPosition=this.Ru,t.selectorServerHost=this.ju,t.gatherServerHost=this.Lu,t.rtmfpServerHost=this.$u,t.trackerServerHost=this.Du,t.webrtcServerHost=this.qu,t.superNodeServerHost=this.Fu,t.protocolCdnDisabled=this.Pu,t.protocolRtmfpDisabled=this.Uu,t.protocolWebsocketDisabled=this.Iu,t.protocolWebrtcDisabled=this.xu,t.protocolSuperNodeDisabled=this.Nu,t.selectorConnectedTime=this.Vu,t.rtmfpServerConnectedTime=this.Hu,t.gatherServerConnectedTime=this.Ju,t.trackerServerConnectedTime=this.Ku,t.webrtcServerConnectedTime=this.Gu,t.superNodeServerConnectedTime=this.Qu,t.cdnTotalNodeCount=this.Yu,t.rtmfpTotalNodeCount=this.Zu,t.webrtcTotalNodeCount=this.sc,t.websocketTotalNodeCount=this.tc,t.superNodeTotalNodeCount=this.ic,t.upnpMapCompleteTime=this.pc,t.upnpMapSuccess=this.bc,t.upnpMappedInPort=this.wc,t.upnpMappedOutPort=this.kc,t.upnpMappedAddress=this.yc,t.videoFormat=this.Da,t.videoType=this.$a,t.appUuid=this.fr,t.playType=this.La,t.custid=this.Wa},i}();s.default=u},{"../../../common/basic/env":3,"../../../common/utils/global":9,"../../../common/utils/ks-array":10,"../../../common/utils/string-utils":17,"../../../common/utils/url-parser":18,"../../protocol/base/manager":48}],36:[function(t,i,s){"use strict";s.__esModule=!0;var n=r(t("events")),h=(r(t("../../../common/basic/env")),t("../../../ks-p2ploader-events"));function r(t){return t&&t.__esModule?t:{default:t}}var e=function(){function i(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,i),this.BaseTag="Meta",this.s=!1,this.ch=t.ch,this.da=this.ch.Ma.da,this.Uc=null,this.Ic=null,this.Aa=t.Aa,this.h=t.h,this.r=this.h.r,this.xn=new n.default}return i.prototype.destroy=function(){this.close(),this.ch=null,this.xn&&this.xn.removeAllListeners(),this.xn=null,this.Uc&&(this.Uc.zh("cancel"),this.Uc.destroy()),this.Uc=null,this.r=null,this.h=null},i.prototype.open=function(){this.s||(this.s=!0)},i.prototype.close=function(){this.s&&(this.s=!1,this.Nc())},i.prototype.on=function(t,i){this.xn.addListener(t,i)},i.prototype.off=function(t,i){this.xn.removeListener(t,i)},i.prototype.xc=function(t){var i=this;i.Ic=setTimeout(function(){i.jc()},t)},i.prototype.jc=function(){},i.prototype.Nc=function(){this.Ic&&(clearTimeout(this.Ic),this.Ic=null)},i.prototype.wait=function(s){return new Promise(function(t,i){setTimeout(t,s)})},i.prototype.Lc=function(t,i){this.xn.emit(h.Qn.Xn)},i}();s.default=e},{"../../../common/basic/env":3,"../../../ks-p2ploader-events":21,events:1}],37:[function(t,i,s){"use strict";s.__esModule=!0;t("../../../common/utils/ks-log");var e=o(t("../../../common/utils/string-utils")),r=t("../../core/meta/piece"),n=o(t("../../protocol/base/message")),h=o(t("../../../common/utils/global"));function o(t){return t&&t.__esModule?t:{default:t}}var a=function(){function t(){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.t="Peer",this.dh=0,this.$c=0,this.Dc=0,this.Wc=0,this.qc=0,this.Bc=0,this.Fc=0,this.zc=0,this.Vc=0,this.Eo=0,this.Oe=-1,this.Hc=0,this.Jc=0,this.Kc=0,this.Gc=0,this.Qc=0,this.Xc=0,this.Yc=0,this.Zc=0,this.tf=0,this.if=0,this.sf=t.nf++,this.hf=0,this.rf=0,this.ef=null,this.af=new n.default,this.uf="",this.cf=0,this.lf=0,this.qe=0,this.downloadForConnection="",this.Me="",this.tagPieceMark=new Map,this.mf=""}return t.prototype.destroy=function(){this.ef&&(this.ef.close(),this.ef=null),this.pf(),this.tagPieceMark=null,this.af=null},t.prototype.df=function(){return!(!this.ef||!this.ef.df())},t.prototype.isBusy=function(){return!(!this.ef||!this.ef.isBusy())},t.prototype.bf=function(t,i){if(this.ef&&this.ef.df())return!0;if(t>=r.ie.so)return!1;if(t===r.ie.io||t===r.ie.te){var s=this.tagPieceMark.get(i);if(!e.default.isUndefined(s))return s}return!1},t.prototype.wf=function(t,i,s){if(t>=r.ie.so)return!1;if(t!==r.ie.io&&t!==r.ie.te)return!1;var n=this.tagPieceMark.get(i),h=!1;return e.default.isUndefined(n)||(h=n),this.tagPieceMark.set(i,s),h},t.prototype.pf=function(){this.tagPieceMark&&this.tagPieceMark.clear()},t.prototype.kf=function(t,i,s){if(t>=r.ie.so)return!1;if(t===r.ie.io||t===r.ie.te){var n=this.tagPieceMark.get(i);e.default.isUndefined(n)||this.tagPieceMark.set(i,!1)}},t.prototype.yf=function(t){if(!(0<this.rf)){var i=this.ef.gf(t,0<this.lf);0<=i&&(this.Oe=i)}},t.prototype.send=function(t){var i=t._f,s=Array.isArray(i),n=0;for(i=s?i:i[Symbol.iterator]();;){var h;if(s){if(n>=i.length)break;h=i[n++]}else{if((n=i.next()).done)break;h=n.value}var r=h;r.Sf.hr,r.Sf.segment.Br,r.Sf.segment.Jr,r.Sf.segment.do,e.default.format("{0}/{1},",r.Sf.Br,r.Sf.Jr)}this.ef.send(t)},t.prototype.Tf=function(t){this.Hc+=0===t.Lr.size()?0:1,this.Jc+=t._f.size(),this.Kc+=t.Ef.size()},t.prototype.Af=function(t,i){this.Yc=this.Dc,this.Dc+=i,this.Wc+=t,this.Vc=h.default.Ai()},t.prototype.Mf=function(){this.Zc=this.qc,this.tf=h.default.Ai()},t.prototype.Cf=function(){this.tf=0},t.prototype.Of=function(t){this.Gc+=t.Lr.size(),this.Qc+=t._f.size(),this.Xc+=t.Ef.size()},t.prototype.Rf=function(t,i){this.Bc+=t,this.Pf(i)},t.prototype.Pf=function(t){var i=h.default.Ai();if(this.qc+=t,this.Eo=i,0<this.tf&&i>this.tf){var s=this.qc-this.Zc;this.Oe=1e3*s/(i-this.tf)}},t.prototype.Uf=function(i,s){this.af._f.erase(this.af._f.findIndex(function(t){return t.hr===i&&t.piece_Id===s}))},t.prototype.qi=function(t){t.name=this.ef.If(),t.type=this.ef.Nf(),t.remoteId=this.ef.xf(),t.remoteAddress=this.ef.jf(),t.remoteType=this.ef.Lf(),t.lastReceiveSpeed=this.Oe,t.lastReceiveTime=this.Eo,t.lastSendTime=this.Vc,t.lf=this.lf,t.totalReceiveBytes=this.qc,t.totalReceivePieces=this.Bc,t.totalSendBytes=this.Dc,t.totalSendPieces=this.Wc,t.totalChecksumErrors=this.Fc,t.totalInvalidErrors=this.zc,t.totalSendRanges=this.Hc,t.totalSendRequests=this.Jc,t.totalSendResponses=this.Kc,t.totalReceiveRanges=this.Gc,t.totalReceiveRequests=this.Qc,t.totalReceiveResponses=this.Xc},t}();(s.default=a).nf=0},{"../../../common/utils/global":9,"../../../common/utils/ks-log":12,"../../../common/utils/string-utils":17,"../../core/meta/piece":30,"../../protocol/base/message":49}],38:[function(t,i,s){"use strict";s.__esModule=!0;t("../../../common/utils/ks-log");var h=t("../../../ks-p2ploader-events"),n=u(t("../../protocol/base/protocol")),p=u(t("../../../common/utils/string-utils")),m=(u(t("../../../common/basic/env")),t("../../protocol/base/message")),d=u(m),r=u(t("../../../common/basic/error")),e=t("../../tools/collector/stage"),o=t("../../tools/collector/stage-error"),a=(u(o),t("../../protocol/base/manager")),b=u(t("../../../common/utils/global"));function u(t){return t&&t.__esModule?t:{default:t}}var c=function(){function i(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,i),this.t="ProtocolObserver",this.s=!1,this.uh=t,this.h=t.h,this.r=this.h.r,this.ch=t.ch,this._a=t._a,this.Kr=t.ch.Kr,this.Ca=t.Ca,this.gn=new n.default(this),this.$f=0,this.Aa=t.Aa,this.Df=new Map}return i.prototype.destroy=function(){this.close(),this.gn&&this.gn.destroy(),this.gn=null,this.Aa=null,this.uh=null,this.ch=null,this._a=null,this.Kr=null,this.Ca=null,this.Df.clear(),this.Df=null,this.h=null},i.prototype.open=function(){var n=this;this.s||(this.s=!0,this.gn.on(h.qn.Gn,function(t){n.Wf(t)}),this.gn.on(h.qn.Bn,function(t,i){n.qf(t,i)}),this.gn.on(h.qn.ERROR,function(t){n.uh.xn.emit(h.ChannelEvents.ERROR,t)}),this.gn.on(h.qn.zn,function(t,i){n.Bf(t,i)}),this.gn.on(h.qn.Vn,function(t,i,s){n.Ff(t,i,s)}),this.gn.on(h.qn.Hn,function(t){n.zf(t)}),this.gn.on(h.qn.Jn,function(t){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;n.Vf(t,i)}),this.gn.on(h.qn.Kn,function(t){n.Hf(t)}),this.gn.open(),this.uh.Sa.open())},i.prototype.close=function(){this.s&&(this.s=!1)},i.prototype.ah=function(){if(!this.s)return!1},i.prototype.Jf=function(t){return!1},i.prototype.qf=function(t,i){this.firstPieceReceived||(this.firstPieceReceived=!0,200<=t.N&&t.N<300&&this.Aa.Pa(e.StageAction.Kf,r.default.Bi,t)),i&&(200<=t.N&&t.N<300?this.Aa.Gf(t):this.Aa.Pa(o.StageErrorAction.Qf,r.default.Fi,t))},i.prototype.Wf=function(t){if(this.s){var i=b.default.Ai();t.Lr.empty()||this.Xf(t,i),t._f.empty()||this.Yf(t,i),t.Ef.empty()||this.Zf(t,i)}},i.prototype.Xf=function(t,i){var s=0,n=this._a.tl(t.ef);if(n){n.pf();var h=t.Lr,r=Array.isArray(h),e=0;for(h=r?h:h[Symbol.iterator]();;){var o;if(r){if(e>=h.length)break;o=h[e++]}else{if((e=h.next()).done)break;o=e.value}var a=o;if(""!==a.il)for(var u=this.Kr.Ve(a.il),c=0;c<a.sl&&u;c++){n.wf(a.hr,u.Br,!0)||s++,u=u.Yr}}return 0<s&&this.$f+3*b.default.Ss<i&&(this.$f=i,this._a.nl(!0)),s}},i.prototype.Yf=function(t,i){var s=0,n=new d.default,h=this._a.tl(t.ef),r=t.ef,e=t.ef.hl()?null:t.ef.rl;if(h){var o=t._f,a=Array.isArray(o),u=0;for(o=a?o:o[Symbol.iterator]();;){var c;if(a){if(u>=o.length)break;c=o[u++]}else{if((u=o.next()).done)break;c=u.value}var f=c,l=new m.ResponseDataItem;n.Ef.push(l),l.el=f.el,l.hr=f.hr;var v=this.Kr.Ve(f.el);p.default._(v)||v.re<=0||p.default._(v.data)||(l.data=v.data,s+=l.data.size())}this.Aa.ol(r.al(),r.ul(),s,e),this.uh.Ca.cl(r.al(),n.Ef.size(),s),h.Af(n.Ef.size(),s),h.Tf(n),h.send(n)}},i.prototype.Zf=function(t,i){var s=0,n=this._a.tl(t.ef);if(n){var h=t.ef.hl()?null:t.ef.rl,r=t.ef.qe,e=t.Ef,o=Array.isArray(e),a=0;for(e=o?e:e[Symbol.iterator]();;){var u;if(o){if(a>=e.length)break;u=e[a++]}else{if((a=e.next()).done)break;u=a.value}var c=u,f=this.Kr.Ve(c.el);if(p.default._(f))this.r.error(this.t,"Response piece from session("+n.ef.jf()+"), piece("+c.el+") not found !!!");else{var l=f.segment;if(l.Mo)if(0<f.qe&&(r=f.qe),null==c.data||c.data.empty())n.rf++,n.zc++,n.wf(f.hr,f.Br,!1),n.ef.hl()&&(n.Oe=0),400<=c.ho&&c.ho<500&&(f.ho=c.ho,l.ho=c.ho),this.r.trace(this.t,"Received piece data = "+c.data+", empty = "+c.data.empty()+", isHttp = "+n.ef.hl()+", code = "+c.ho+", from("+n.ef.jf()+"), segment("+l.Br+"/"+l.Jr+"), piece("+f.Br+"/"+f.Jr+")");else if(0<f.re)this.r.info(this.t,"discarded download , piece.id_ = "+f.Br+", piece.receiveProtocol_ = "+f.ee),this.Aa.fl(n.ef.al(),n.ef.ul(),c.data.size(),h,i-r),this.Ca.ll(n.ef.al(),1,c.data.size());else{var v=0<f.se&&c.data.size()!==f.se,m=this.Kr.he(f,c.data,c.data.size());f.Be=!1,f.qe=0,f.We=0,!v&&m?(this.Aa.vl(n.ef.al(),1,0),this.r.trace(this.t,"Received piece from("+n.ef.jf()+"), segment("+l.Br+"/"+l.Jr+"), piece("+f.Br+"/"+f.Jr+")"),n.rf=0,f.data=c.data,f.re=i,s++,f.ee=t.ef.al(),n.Rf(1,f.data.size()),this.Ca.ml(!1,t.ef.al(),1,f.data.size()),this.Aa.pl(t.ef,f.data.size(),h,f.re-r,f.Ge),this.dl(h,f),n.uf=l.Br,this.uh.Ma.ga<=0&&(this.uh.Ma.ga=b.default.Ai()),l.ue(),this.bl(t.ef),!0===this.h._i.isLive&&"flv"===this.h._i.type&&this.uh.Sa.Po(f),!0===this.h._i.isVod&&"mp4"===this.h._i.type&&(this.uh.Sa.Po(f),this.ch.Kr.Tr+=f.se,this.uh.wl())):(n.Oe=0,n.rf++,n.zc++,n.kf(f.hr,f.Br,!0),v||n.Fc++,this.Aa.vl(n.ef.al(),0,1,h,c.data.size()))}else this.r.error(this.t,"Response piece from session("+n.ef.jf()+"), segment("+l.Br+"/"+l.Jr+"), piece("+f.Br+"/"+f.Jr+") is invalid")}}return 0<t.Ef.size()&&(n.hf=0,n.lf=Math.max(0,n.lf-t.Ef.size()),0===n.lf&&this._a.kl(),n.qe=0,n.yf(i)),s}},i.prototype.bl=function(t){t.hl()||this.firstP2PPieceReceived||(this.firstP2PPieceReceived=!0,this.Aa.Pa(e.StageAction.yl,r.default.Bi))},i.prototype.Bf=function(t,i){this.s&&(this.r.info(this.t,"Protocol selector("+this.ch.ju+") open, code("+t+"), "+(r.default.Bi!==t?"FAILED":"OK")),this.Aa.Pa(e.StageAction.gl,t,i))},i.prototype.Ff=function(t,i,s){this.s&&(this.r.info(this.t,"Protocol manager("+t.Nf()+"/"+t._l()+") open, code("+i+"), "+(r.default.Bi!==i?"FAILED":"OK")),this.Aa.Pa(t.al()===a.ae.Sl?e.StageAction.Tl:e.StageAction.El,i,s))},i.prototype.zf=function(t){if(this.s){var i=this._a.Al(t.hl(),t.al());0<i&&(this._a.nl(!0),t.hl()||this.Aa.Ml(t.al(),i)),this.r.info(this.t,"["+this.ch.Kr.Fe()+"]Protocol manager("+t.Nf()+"://"+t._l()+") close, remove "+i+" session(s)")}},i.prototype.Vf=function(t){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;if(this.s){var s=this._a.Cl(t);if(!t.hl()){var n=this._a.Ol(t.hl(),t.al());this.Aa.Ml(t.al(),n),0!=i&&this.Aa.Rl(t.rl,i)}var h=b.default.Ai();this._a.Pl(s,h),this._a.kl(!t.hl())}},i.prototype.Hf=function(t){if(this.s&&(this._a.Ul(t)&&(this._a.nl(!0),!t.hl()))){var i=this._a.Ol(t.hl(),t.al());this.Aa.Ml(t.al(),i)}},i.prototype.dl=function(t,i){if(t&&t.peerId&&(i.lo=t.peerId,!1===this.Df.has(t.peerId))){var s={};for(var n in t)s[n]=t[n];this.Df.set(t.peerId,s)}},i}();s.default=c},{"../../../common/basic/env":3,"../../../common/basic/error":4,"../../../common/utils/global":9,"../../../common/utils/ks-log":12,"../../../common/utils/string-utils":17,"../../../ks-p2ploader-events":21,"../../protocol/base/manager":48,"../../protocol/base/message":49,"../../protocol/base/protocol":50,"../../tools/collector/stage":64,"../../tools/collector/stage-error":63}],39:[function(t,i,s){"use strict";s.__esModule=!0;t("../../../common/utils/ks-log");var n=u(t("../../../common/utils/ks-array")),h=u(t("../../../common/utils/string-utils")),r=u(t("./peer")),e=t("../../protocol/base/message"),o=u(e),l=t("../../core/meta/meta-data"),a=(u(t("../../../common/basic/env")),u(t("../../../common/utils/global")));function u(t){return t&&t.__esModule?t:{default:t}}function c(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}var f=function t(){c(this,t),this.Il=0,this.Me="",this.Nl=-1,this.xl="",this.jl=0,this.Ll=0,this.$l=0,this.Dl=15*a.default.Ss,this.Wl=0},v=function(){function s(t,i){c(this,s),this.BaseTag="Scheduler",this.s=!1,this.ch=t,this.Vr=new f,this.uh=i,this.ql=new n.default,this.Bl=new n.default,this.Fl=new o.default,this.h=i.h,this.r=this.h.r,this.zl=0}return s.prototype.destroy=function(){this.close(),this.ch=null,this.uh=null,this.Vr=null,this.r=null,this.h=null,this.ql=null,this.Bl=null,this.Fl=null},s.prototype.open=function(){this.s||(this.s=!0,this.Vl(),this.Hl(1e3))},s.prototype.Jl=function(t){},s.prototype.close=function(){if(this.s){this.s=!1;var t=this.ql,i=Array.isArray(t),s=0;for(t=i?t:t[Symbol.iterator]();;){var n;if(i){if(s>=t.length)break;n=t[s++]}else{if((s=t.next()).done)break;n=s.value}n.ef.destroy()}var h=this.Bl,r=Array.isArray(h),e=0;for(h=r?h:h[Symbol.iterator]();;){var o;if(r){if(e>=h.length)break;o=h[e++]}else{if((e=h.next()).done)break;o=e.value}o.ef.destroy()}this.ql.clear(),this.Bl.clear(),this.Vl()}},s.prototype.Kl=function(t){},s.prototype.Cl=function(i){var t=null,s=i.hl()?this.ql:this.Bl;i.Gl();var n=s.find(function(t){return t.ef===i});return h.default.isUndefined(n)?((t=new r.default).ef=i,s.push_back(t)):(t=n).hf=0,t.dh=a.default.Ai(),t},s.prototype.Ol=function(t,s){return(t?this.ql:this.Bl).reduce(function(t,i){if(null!=i.ef&&i.ef.al()===s)return++t},0)},s.prototype.Pl=function(t,i){t.df()||t&&t.ef&&!this.Fl.empty()&&this.h.ei&&(t.if=i,t.Tf(this.Fl),t.send(this.Fl))},s.prototype.Ql=function(){return this.Fl},s.prototype.Xl=function(t,i){var s=this.ch._u*a.default.Ss;return i-t.if>=s},s.prototype.Yl=function(t){return!1},s.prototype.Zl=function(t){(1<arguments.length&&void 0!==arguments[1]&&arguments[1]||this.zl+a.default.Ss<=t)&&(this.tv(this.Fl),this.zl=t)},s.prototype.iv=function(t,i){var s=i?this.ql:this.Bl,n=Array.isArray(s),h=0;for(s=n?s:s[Symbol.iterator]();;){var r;if(n){if(h>=s.length)break;r=s[h++]}else{if((h=s.next()).done)break;r=h.value}r.yf(t)}},s.prototype.kl=function(){var t=this,i=0<arguments.length&&void 0!==arguments[0]&&arguments[0];Promise.resolve().then(function(){t.Jl(i)})},s.prototype.Hl=function(t){var i=this;this.scheduleTimer=setInterval(function(){i.Jl(!1),i.sv(a.default.Ai(),!0)},t)},s.prototype.Vl=function(){this.scheduleTimer&&(clearInterval(this.scheduleTimer),this.scheduleTimer=null)},s.prototype.tv=function(t){},s.prototype.nv=function(){var t=null,i=this.ql,s=Array.isArray(i),n=0;for(i=s?i:i[Symbol.iterator]();;){var h;if(s){if(n>=i.length)break;h=i[n++]}else{if((n=i.next()).done)break;h=n.value}var r=h;if(r.lf<=0){r.mf="",t=r;break}}return t},s.prototype.hv=function(t,i){var s=null,n=this.Bl,h=Array.isArray(n),r=0;for(n=h?n:n[Symbol.iterator]();;){var e;if(h){if(r>=n.length)break;e=n[r++]}else{if((r=n.next()).done)break;e=r.value}var o=e;if(!(5<o.hf)&&(!o.isBusy()&&(o.df()||o.bf(t,i)))){s=o;break}}return s},s.prototype.sv=function(t,i){this.Zl(t,i);var s=this.Bl,n=Array.isArray(s),h=0;for(s=n?s:s[Symbol.iterator]();;){var r;if(n){if(h>=s.length)break;r=s[h++]}else{if((h=s.next()).done)break;r=h.value}var e=r;(i||this.Xl(e,t))&&this.Pl(e,t)}},s.prototype.rv=function(){this.ev(!0),this.ev(!1)},s.prototype.ev=function(t){var i=t?this.ql:this.Bl,s=a.default.Ai(),n=i,h=Array.isArray(n),r=0;for(n=h?n:n[Symbol.iterator]();;){var e;if(h){if(r>=n.length)break;e=n[r++]}else{if((r=n.next()).done)break;e=r.value}var o=e;o.lf<=0||(this.r.info(this.BaseTag,"["+this.ch.Kr.Fe()+"]Peer paused, peer id("+o.ef.xf()+"), address("+o.ef.jf()+") for channel("+this.uh.Br+")"),this.ch.Kr.De(o.sf),t&&this.ov(s,!1,o))}},s.prototype.ov=function(t,i,s){var n=new o.default,h=new e.RequestDataItem;n.av=!0,n._f.push_back(h),s.uf="",s.lf=0,i&&(s.Oe=0),s.Jc=s.Xc,s.$c=s.dh=t,s.ef.send(n)},s.prototype.uv=function(t){var i=t?this.ql:this.Bl,s=i,n=Array.isArray(s),h=0;for(s=n?s:s[Symbol.iterator]();;){var r;if(n){if(h>=s.length)break;r=s[h++]}else{if((h=s.next()).done)break;r=h.value}r.ef.close()}i.clear()},s.prototype.Al=function(t,i){var s=0,n=(t?this.ql:this.Bl).filter(function(t){return!(!t.ef||t.ef.al()===i)||(s++,!1)});return t?this.ql=n:this.Bl=n,s},s.prototype.Ul=function(i){var s=this,t=i.hl()?this.ql:this.Bl;return t.erase(t.findIndex(function(t){if(t.ef===i)return s.ch.Kr.De(t.sf),!0}))},s.prototype.tl=function(i){return(i.hl()?this.ql:this.Bl).find(function(t){return t.ef===i})},s.prototype.nl=function(t){var i=0;t&&(i=this.Vr.jl);for(var s=i;s<this.ch.Kr.Nr.size();s++){var n=this.ch.Kr.Nr.at(s);if(!n.go){var h=n.fe,r=Array.isArray(h),e=0;for(h=r?h:h[Symbol.iterator]();;){var o;if(r){if(e>=h.length)break;o=h[e++]}else{if((e=h.next()).done)break;o=e.value}var a=o;a.co=0;var u=this.Bl,c=Array.isArray(u),f=0;for(u=c?u:u[Symbol.iterator]();;){var l;if(c){if(f>=u.length)break;l=u[f++]}else{if((f=u.next()).done)break;l=f.value}if(l.bf(a.hr,a.Br)){a.co++;break}}}}}},s.prototype.cv=function(t){},s.prototype.fv=function(){if(this.Vr.jl>=this.ch.Kr.Nr.size())return!1;var t=!1,i=this.ch.Kr.Nr.at(this.Vr.jl);if(0<i.se&&0<i.Ge){var s=1e3*i.se/i.Ge*this.ch.Eu,n=0,h=this.ql,r=Array.isArray(h),e=0;for(h=r?h:h[Symbol.iterator]();;){var o;if(r){if(e>=h.length)break;o=h[e++]}else{if((e=h.next()).done)break;o=e.value}var a=o;if(0<a.lf){n=a.Oe;break}}0<=n&&n<s&&(t=!0)}return t},s.prototype.lv=function(){return this.ql.reduce(function(t,i){return t+Math.max(0,i.lf)},0)},s.prototype.vv=function(){return this.Bl.reduce(function(t,i){return t+Math.max(0,i.lf)},0)},s.prototype.pv=function(t){var i=t-this.Vr.Dl;""===this.ch.Kr.pe&&(i+=this.Vr.Dl/2);var s=this.ql,n=Array.isArray(s),h=0;for(s=n?s:s[Symbol.iterator]();;){var r;if(n){if(h>=s.length)break;r=s[h++]}else{if((h=s.next()).done)break;r=h.value}var e=r;e.lf<=0||(e.dh>=i&&(this.ch.Kr.hr===l.er.ge||""===e.uf||e.cf>=this.Vr.Nl)||(e.hf++,this.r.info(this.BaseTag,"["+this.ch.Kr.Fe()+"]Peer stable blocked "+e.hf+" times, peer id("+e.ef.xf()+"), pending("+e.lf+", address("+e.ef.jf()+") for channel("+this.uh.Br+"))"),this.ch.Kr.De(e.sf),this.ov(t,!1,e)))}var o=this.Bl,a=Array.isArray(o),u=0;for(o=a?o:o[Symbol.iterator]();;){var c;if(a){if(u>=o.length)break;c=o[u++]}else{if((u=o.next()).done)break;c=u.value}var f=c;f.qe<=0||(f.qe+this.Vr.Dl>t||(this.r.info(this.BaseTag,"["+this.ch.Kr.Fe()+"]Peer timeout "+f.hf+" times, peer("+f.ef.Nf()+"://"+f.ef.xf()+") address("+f.ef.jf()+"), pending("+f.lf+" for channel("+this.uh.Br+"))"),f.Oe=0,f.hf++,f.$c=t,f.qe=0,f.lf=0))}},s.prototype.qi=function(t){t.urgentIncompleteCount=this.Vr.Il,t.urgentSegmentId=this.Vr.Me,t.urgentSegmentEndId=this.Vr.xl,t.otherPeerRequestCount=this.Vr.Wl,t.peerReceiveTimeout=this.Vr.Dl;var i=t.stablePeers=[],s=this.ql,n=Array.isArray(s),h=0;for(s=n?s:s[Symbol.iterator]();;){var r;if(n){if(h>=s.length)break;r=s[h++]}else{if((h=s.next()).done)break;r=h.value}var e=r,o=i[i.length]={};e.qi(o)}var a=t.otherPeers=[],u=this.Bl,c=Array.isArray(u),f=0;for(u=c?u:u[Symbol.iterator]();;){var l;if(c){if(f>=u.length)break;l=u[f++]}else{if((f=u.next()).done)break;l=f.value}var v=l;o=a[a.length]={};v.qi(o)}},s}();s.default=v},{"../../../common/basic/env":3,"../../../common/utils/global":9,"../../../common/utils/ks-array":10,"../../../common/utils/ks-log":12,"../../../common/utils/string-utils":17,"../../core/meta/meta-data":29,"../../protocol/base/message":49,"./peer":37}],40:[function(t,i,s){"use strict";s.__esModule=!0;var n,e=t("../../protocol/base/manager"),h=t("../../../common/utils/global"),r=(n=h)&&n.__esModule?n:{default:n};var o=function(){function i(){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,i),this.BaseTag="StatData",this.Wc=0,this.Dc=0,this.Bc=0,this.qc=0,this.dv=0,this.bv=0,this.wv=0,this.kv=0,this.yv=0,this.gv=0,this._v=0,this.Sv=0,this.Tv=0,this.Ev=0,this.Av=0,this.Mv=0,this.Cv=0,this.Oe=0,this.Ov=0,this.Rv=[],this.Pv=[],this.Uv=[],this.Iv=[],this.Nv=[],this.xv=[],this.jv=[];for(var t=0;t<e.ae.Lv;t++)this.Rv[t]=0,this.Pv[t]=0,this.Uv[t]=0,this.Iv[t]=0,this.Nv[t]=0,this.xv[t]=0,this.jv[t]=0;this.$v=0,this.Dv=0,this.Wv=0,this.qv=0,this.Bv=0,this.Fv=0,this.zv=0,this.Vv=0}return i.prototype.destroy=function(){this.Rv=[],this.Pv=[],this.Uv=[],this.Iv=[],this.Nv=[],this.xv=[],this.jv=[]},i.prototype.qi=function(t,i){t.downloadedRate=this.Cv,t.lastDownloadedRate=this.Oe,t.downloadedDuration=this.qv,t.downloadedPercent=this.Wv;var s=t.statData={};s.totalSendPieces=this.Wc,s.totalSendBytes=this.Dc,s.actualSendPieces=this.dv,s.actualSendBytes=this.bv,s.totalReceivePieces=this.Bc,s.totalReceiveBytes=this.qc,s.actualReceivePieces=this.wv,s.actualReceiveBytes=this.kv,s.urgentReceiveBytes=this.yv,s.lastReceiveBytes=this.gv,s.shareSendRatio=this.$v,s.shareReceiveRatio=this.Dv,s.avgSendSpeed=this.Av,s.avgReceiveSpeed=this.Mv,s.urgentReceiveSpeed=this.Cv,s.lastReceiveSpeed=this.Oe,s.restrictedSendSpeed=this.Ov,s.downloadedDuration=this.qv,s.totalPlayedBytes=this.Fv,s.totalPlayedPieces=this.zv,s.totalPlayedDuration=this.Vv;for(var n=s.protocols=[],h=e.ae.Hv+1;h<e.ae.Lv;h++){var r=n[h]={};r.totalSendPieces=this.Iv[h],r.totalSendBytes=this.Pv[h],r.totalReceivePieces=this.Iv[h],r.totalReceiveBytes=this.Nv[h],r.shareSendRatio=0<this.Nv[h]?this.Pv[h]/this.Nv[h]:0,r.shareReceiveRatio=0<this.qc?this.Nv[h]/this.qc:0}},i.prototype.Jv=function(t,i,s){t<0||t>=e.ae.Lv||(this.Wc+=s,this.Dc+=i,this.dv+=s,this.bv+=i,this.Rv[t]+=s,this.Pv[t]+=i)},i.prototype.Af=function(){0<this.qc&&(this.$v=this.Dc/this.qc);var t=r.default.Ai();if(0<this._v&&t>this._v){var i=t-this._v;this.Av=this.dv*r.default.Ss/i}else this._v=t},i.prototype.cl=function(t,i,s){this.Jv(t,s,i),this.Af()},i.prototype.Kv=function(t,i,s){t<0||t>=e.ae.Lv||(this.Bc+=s,this.qc+=i,this.wv+=i,this.kv+=i,this.Iv[t]+=s,this.Nv[t]+=i,this.gv+=i)},i.prototype.Gv=function(){return this.qc-this.Qv()},i.prototype.Qv=function(){return this.Nv[e.ae.oe]},i.prototype.Xv=function(){return this.jv[e.ae.oe]},i.prototype.Yv=function(){return this.jv[e.ae.Zv]+this.jv[e.ae.Sl]+this.jv[e.ae.tm]},i.prototype.Rf=function(t){0<this.qc&&(this.$v=this.Dc/this.qc,this.Dv=this.Gv()/this.qc);var i=r.default.Ai();if(0<this.Sv&&i>this.Sv){var s=i-this.Sv;this.Mv=this.kv*r.default.Ss/s}else this.Sv=i;if(0<this.Ev&&i>this.Ev){var n=i-this.Ev;this.Oe=this.gv*r.default.Ss/n,n>5*r.default.Ss&&(this.Ev=i,this.gv=0)}else this.Ev=i;if(t)if(0<this.Tv&&i>this.Tv){var h=i-this.Tv;this.Cv=this.yv*r.default.Ss/h,h>5*r.default.Ss&&(this.Tv=i,this.yv=0)}else this.Tv=i},i.prototype.ll=function(t,i,s){this.jv[t]+=s},i.prototype.ml=function(t,i,s,n){this.Kv(i,n,s),t&&(this.yv+=n),this.Rf(t)},i}();s.default=o},{"../../../common/utils/global":9,"../../protocol/base/manager":48}],41:[function(t,i,s){"use strict";s.__esModule=!0;var n=h(t("../../base/append")),l=(h(t("../../../../common/basic/env")),h(t("../../../../common/utils/global"))),e=h(t("../../../../common/utils/ks-buffer")),v=(t("../../../../common/utils/ks-log"),t("./request"));function h(t){return t&&t.__esModule?t:{default:t}}var r=function(s){function n(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,n);var i=function(t,i){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!i||"object"!=typeof i&&"function"!=typeof i?t:i}(this,s.call(this,t));return i.t="MP4Append",i.im=0,i.Ra=i.uh.Ra,i.Ca=i.uh.Ca,i.sm=i.uh.nm.sm,i.hm=i.uh.nm.hm,i.Ko=0,i.rm=0,i.em=0,i.om=!1,i.h=t.h,i.r=t.h.r,i.Df=i.uh.Df,i.Aa=i.uh.Aa,i.am="empty",i.um="full",i.cm=0,i.ki=t.h.ki,i.r.info(i.t,"con $$$$ ===========>>>>>>>>>>>, id = "+i.ki+", "+i.s),i}return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(t,i):t.__proto__=i)}(n,s),n.prototype.destroy=function(){s.prototype.destroy.call(this),this.Ra=null,this.Ca=null,this.sm=null,this.hm=null,this.Df=null,this.Aa=null,this.h=null,this.r.info(this.t,"des <<<<<<<<<<<========== $$$$, id = "+this.ki+", "+this.s),this.r=null,this.cm=0},n.prototype.close=function(){s.prototype.close.call(this),this.cm=0,this.em=0},n.prototype.open=function(){s.prototype.open.call(this),this.cm=0,this.setTimeout(100)},n.prototype.onTimeout=function(){this.Po(),this.setTimeout(200)},n.prototype.fm=function(){0<arguments.length&&void 0!==arguments[0]&&arguments[0];this.Ro(),this.onTimeout()},n.prototype.lm=function(t){this.fm(t)},n.prototype.Po=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;!this.s||this.ch.Kr.Nr.size()<=0||(this.uh.nm.vm(),this.h._i.videoTag&&(this.ch.Ru=this.h._i.videoTag.currentTime),!this.Kr.xr()&&this.hm&&0<this.hm.size&&this.mm(this.hm),this.sm&&0<this.sm.size&&this.mm(this.sm,t))},n.prototype.mm=function(t){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,s=l.default.Ai();this.pm(t,s);var n=t.values(),h=Array.isArray(n),r=0;for(n=h?n:n[Symbol.iterator]();;){var e;if(h){if(r>=n.length)break;e=n[r++]}else{if((r=n.next()).done)break;e=r.value}for(var o=e;this.dm(o);){if(""===o.bm){this.uh._a.wm();break}if(i&&i.Br===o.km||(i=this.ch.Kr.Ve(o.km)),!i||null===i.data||i.data.empty()){i.re=0;break}this.Ra.Uo<=0&&(this.Ra.Uo=s);var a=o.il+o.ym,u=o.gm;if(!(0<i.re))break;var c=0,f=i.se-1;a>=i.ce&&a<=i.ce+f?(c=a-i.ce,u<i.ce+f&&(f=u-i.ce),o._m===v.Tm.Sm&&this.Kr.xr()&&(this.Ra.Fo<=0&&(this.Ra.Fo=i.oo),this.Ra.Uo<=0&&(this.Ra.Uo=s)),i.fo=s,o._m===v.Tm.Sm&&this.uh.Aa.Em(i.ee,f-c+1,this.Am(i.lo)),this.send(o,i,c,f),this.Mm+=i.Ge,this.em=(new Date).getTime()):this.r.error(this.t,"toPlayer error !!! requestOffsetStart = "+a+", piece("+i.Br+").OSFile_ = "+i.ce)}}},n.prototype.dm=function(t){if(t.Cm())return!1;var i=(new Date).getTime();if(0==this.em&&(this.em=i),1500<=i-this.em)return this.r&&this.r.warn(this.t,this.s+",  >= 1.5 * 1000 "),!0;if(t._m===v.Tm.Sm){if(!this.h||!this.h._i)return this.r&&this.r.error(this.t,this.s+", mp4-append !this.env_ || !this.env_.mediaInfo_ ____________ return false"),!1;if(t.Mm=this.h.Pi(),t.Mm>=v.Rm.Om)return!1;if(t.Pm>=v.Rm.Um)return!1}return!0},n.prototype.pm=function(t,i){if(this.hm!==t&&!this.h._i.videoTag){var s=t.values(),n=Array.isArray(s),h=0;for(s=n?s:s[Symbol.iterator]();;){var r;if(n){if(h>=s.length)break;r=s[h++]}else{if((h=s.next()).done)break;r=h.value}var e=r;e.Im<0?e.Mm=0:(e.Mm-=Math.round((i-e.Im)/1e3),e.Mm=e.Mm<0?0:e.Mm)}}},n.prototype.send=function(t,i,s,n){if(this.s){var h=n-s+1,r=new e.default(i.data.size());r.append(i.data.array()),this.Nm(this.um),this.xm(l.default.Ai()-this.ch.dc,i.Ge),this.uh.nm.jm(t,r.subarray(s,h),h,i.Br,i.Ge,s)}},n.prototype.Am=function(t){return t&&this.Df&&this.Df.has(t)?this.Df.get(t):null},n.prototype.Nm=function(t){t===this.am?this.uh.Aa.Lm():this.uh.Aa.$m()},n.prototype.xm=function(t,i){this.Aa.xm(t,i)},n}(n.default);s.default=r},{"../../../../common/basic/env":3,"../../../../common/utils/global":9,"../../../../common/utils/ks-buffer":11,"../../../../common/utils/ks-log":12,"../../base/append":32,"./request":46}],42:[function(t,i,s){"use strict";s.__esModule=!0;var h=m(t("./mp4-requestManager")),r=t("./request"),e=m(t("./mp4-append")),o=m(t("./mp4-meta")),a=m(t("./mp4-scheduler")),n=m(t("../../base/channel")),u=(t("../../../../common/utils/ks-log"),m(t("../../../../common/utils/global"))),c=m(t("../../base/protocol-observer")),f=t("../../../../ks-p2ploader-events"),l=t("../../../tools/collector/stage"),v=m(t("../../../../common/basic/error"));function m(t){return t&&t.__esModule?t:{default:t}}var p=function(s){function n(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,n);var i=function(t,i){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!i||"object"!=typeof i&&"function"!=typeof i?t:i}(this,s.call(this,t));return i.t="MP4Channel",i.nm=new h.default(i),i.Ta=new o.default(i),i.Sa=new e.default(i),i._a=new a.default(i.ch,i),i.Df=null,i.ki=t.ki,i.r.info(i.t,"con $$$$ ===========>>>>>>>>>>>, id = "+i.ki),i}return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(t,i):t.__proto__=i)}(n,s),n.prototype.destroy=function(){this.nm&&(this.nm.destroy(),this.nm=null),this.r.info(this.t,"des <<<<<<<<<<<========== $$$$, id = "+this.ki),s.prototype.destroy.call(this),this.Df=null},n.prototype.open=function(){var t=this;return this.s=!0,this.Ea=new c.default(this),this.Aa.open().Pa(l.StageAction.Ua,v.default.Bi),this.Ta.on(f.Qn.th,function(){Promise.resolve().then(function(){t.Ea.open()})}),this.ch.dc=u.default.Ai(),this.Sa.Df=this.Ea.Df,this.Ta.open(),this._a.open(),!0},n.prototype.eh=function(t){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:-1;if(!0===this.h._i.isVod&&"mp4"===this.h._i.type&&this.nm)return this.nm.eh(t,r.Tm.Sm,i)},n.prototype.rh=function(t,i,s){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;if(this.s)return!0===this.h._i.isVod&&"mp4"===this.h._i.type?this.nm.rh(t,i,s,n):void 0},n.prototype.oh=function(t){this.nm.oh(t)},n.prototype.ah=function(t){s.prototype.ah.call(this,t),this.Ea.ah(t)},n.prototype.wl=function(){if(!(this.ch.Kr.Nr.empty()||this.ch.Kr.Tr<this.h.Yt)){for(var t=null,i=(t=this.nm.Dm())?t.jl-1:this.ch.Kr.Nr.size,s=0;s<i;s++){var n=this.ch.Kr.Nr.at(s);if(n&&(this.ch.Kr.Tr-=n.Co(this.h._i.isVod),this.ch.Kr.Tr<this.h.Yt))return}if(!(this.ch.Kr.Tr<this.h.Yt))for(var h=(t=this.nm.Wm())?t.qm+1:0,r=this.ch.Kr.Nr.size()-1;h<=r;r--){var e=this.ch.Kr.Nr.at(r);if(e&&(this.ch.Kr.Tr-=e.Co(this.h._i.isVod),this.ch.Kr.Tr<this.h.Yt))return}}},n.prototype.Bm=function(t){return t&&null!==t.km&&this.ch.Kr.Wr(t.km),null},n}(n.default);s.default=p},{"../../../../common/basic/error":4,"../../../../common/utils/global":9,"../../../../common/utils/ks-log":12,"../../../../ks-p2ploader-events":21,"../../../tools/collector/stage":64,"../../base/channel":34,"../../base/protocol-observer":38,"./mp4-append":41,"./mp4-meta":43,"./mp4-requestManager":44,"./mp4-scheduler":45,"./request":46}],43:[function(t,i,s){"use strict";s.__esModule=!0;var n=v(t("../../base/meta")),h=t("../../../core/meta/meta-data-mp4"),r=v(h),e=v(t("../../../../common/utils/url-parser")),o=v(t("../../../../common/basic/error")),a=t("../../../tools/collector/stage-error"),u=(t("../../../../common/utils/ks-log"),v(t("../../../../common/utils/global"))),c=t("../../../../ks-p2ploader-events"),f=(t("./request"),v(t("../../../../common/utils/string-utils")),v(t("../../../core/loader/ks-loader"))),l=t("../../../core/loader/base-loader");function v(t){return t&&t.__esModule?t:{default:t}}var m=function(s){function n(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,n);var i=function(t,i){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!i||"object"!=typeof i&&"function"!=typeof i?t:i}(this,s.call(this,t));return i.t="MP4Meta",i.uh=t,i.ch.Kr=i.Kr=new r.default(i.ch),i.ch.La=i.Kr.Ne(),i.ch.$a=i.Kr.Fe(),i.ch.Da=i.Kr.Ie(),i.Fm=i.h.mi?"bytes=0-"+(h.Xh.Zh*h.Xh.Yh-1):"bytes=0-1",i.zm=null,i.Zt=i.h.Zt,i.ki=t.h.ki,i.r.info(i.t,"con $$$$  ===========>>>>>>>>>>>, id = "+i.ki),i.Vm=!1,i}return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(t,i):t.__proto__=i)}(n,s),n.prototype.destroy=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";this.r&&this.r.info(this.t,"des "+t+" <<<<<<<<<<<========== $$$$, id = "+this.ki),s.prototype.destroy.call(this),this.Fm="",this.uh=null},n.prototype.open=function(){s.prototype.open.call(this),this.Hm()},n.prototype.close=function(){s.prototype.close.call(this),null!=this.zm&&(this.zm.zh("cancel"),this.zm.destroy(),this.zm=null)},n.prototype.jc=function(){if(this.s){var t=this.zm;null!=t&&this.Aa.Jm(a.StageErrorAction.Km,o.default.Fi,t),this.Gm()}},n.prototype.Hm=function(){if(this.s&&!this.Kr.Ir()){var t=this.Qm(this.Xm(this.h._i.url));if(0<t)return this.r.info(this.t,"$$$ findLocalFileLength_ success: length = "+t),this.Kr.Fr(t,null),this.Lc(290,{}),this.uh.nm.Ym(),void this.destroy("success");this.xc(4e3),this.Zm()}},n.prototype.Zm=function(){var i=this,s=this.ch.Kr.vr;null!=this.zm&&(this.zm.zh("cancel"),this.zm.destroy("timeOut"),this.zm=null),this.zm=f.default.Kh(this.r,this.h.vi,this.ki),this.qe=u.default.Ai(),this.zm.it("mp4Meta-range-data").open(s,this.Fm),this.zm.on(l.KsloaderEvents.ON_DOWNLOAD_COMPLETED,function(t){i.s&&i.zm===t&&(i.dh=u.default.Ai(),!t.Mh||t.N<200||300<=t.N?i.Aa.Jm(a.StageErrorAction.Km,o.default.Vi,t):0<t.Uh?(i.r.info(i.t,"$$$ downloadContentLength_ success: length = "+t.Uh),i.Kr.Fr(t.Uh,i.h.mi?t.$.Ps:null),i.tp(i.Xm(s),t.Uh),i.Lc(290,{}),i.uh.nm.Ym(),i.destroy("success")):i.r.error(i.t,"$$$ downloadContentLength_ error: length = "+t.Uh+", "+t.Ph))})},n.prototype.Gm=function(){var i=this;this.wait(1e3).then(function(){i.s&&i.Hm()}).catch(function(t){i.r.info(i.t,"error:"+t)})},n.prototype.Lc=function(t,i){this.da.ra=this.ch.Ma.dh=u.default.Ai(),this.da.Yo=!0,this.da.Zo=t,this.da.ta=i,this.da.ia="video/x-mp4",this.da.sa=i,290===t?this.xn.emit(c.Qn.th):200===t?this.xn.emit(c.Qn.Yn):this.xn.emit(c.Qn.ERROR,{})},n.prototype.np=function(){var t=this.h.n;JSON.parse(t.get("b_gidInfo"))&&t.set("b_gidInfo",JSON.stringify([]))},n.prototype.Qm=function(t){var i=this.hp(t);return i&&i.length?i.length:0},n.prototype.Xm=function(t){var i=new e.default;return i.fromString(t),String(i.En)},n.prototype.hp=function(t){var i=this.h.n,s=JSON.parse(i.get("b_gidInfo"));if(!s||!s.length)return null;for(var n=0;n<s.length;n++)if(s[n].hasOwnProperty("gid")&&s[n].gid==t)return s[n];return null},n.prototype.tp=function(t,i){var s=this.h.n,n=JSON.parse(s.get("b_gidInfo")),h={gid:t,length:i};n?this.hp(t)||(n.push(h),n.length>this.Zt&&n.splice(0,2),s.set("b_gidInfo",JSON.stringify(n))):s.set("b_gidInfo",JSON.stringify([h]))},n}(n.default);s.default=m},{"../../../../common/basic/error":4,"../../../../common/utils/global":9,"../../../../common/utils/ks-log":12,"../../../../common/utils/string-utils":17,"../../../../common/utils/url-parser":18,"../../../../ks-p2ploader-events":21,"../../../core/loader/base-loader":23,"../../../core/loader/ks-loader":26,"../../../core/meta/meta-data-mp4":28,"../../../tools/collector/stage-error":63,"../../base/meta":36,"./request":46}],44:[function(t,i,s){"use strict";s.__esModule=!0;var n,a=t("./request"),e=(n=a)&&n.__esModule?n:{default:n},o=t("../../../../ks-p2ploader-events");var h=function(){function i(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,i),this.t="RequestManager",this.sm=new Map,this.hm=new Map,this.uh=t,this.ch=t.ch,this.rp=null,this.h=t.h,this.r=t.h.r,this.ep(500),this.ki=t.h.ki,this.r.info(this.t,"con $$$$ ===========>>>>>>>>>>>, id = "+this.ki)}return i.prototype.destroy=function(){if(this.r.info(this.t,"des <<<<<<<<<<<========== $$$$, id = "+this.ki),this.sm){var t=this.sm.values(),i=Array.isArray(t),s=0;for(t=i?t:t[Symbol.iterator]();;){var n;if(i){if(s>=t.length)break;n=t[s++]}else{if((s=t.next()).done)break;n=s.value}var h=n;h.op()&&h.destroy()}}this.ap(),this.r=null,this.h=null,this.sm=null,this.hm=null,this.ch=null,this.uh=null},i.prototype.ap=function(){this.rp&&(clearTimeout(this.rp),this.rp=null)},i.prototype.ep=function(t){var i=this;i.rp=setTimeout(function(){i.onTimeout()},t)},i.prototype.onTimeout=function(){if(this.sm){var t=this.sm.values(),i=Array.isArray(t),s=0;for(t=i?t:t[Symbol.iterator]();;){var n;if(i){if(s>=t.length)break;n=t[s++]}else{if((s=t.next()).done)break;n=s.value}var h=n;h.op()&&this.up(h)}}this.cp(),this.ep(200)},i.prototype.fp=function(t,i){var s=t.join("-");if(!this.hm.has(s)){var n=new e.default(s,t,this.r,i,a.Tm.lp);this.hm.set(s,n),this.Ym(n),this.cp()}},i.prototype.rh=function(t,i,s){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:a.Tm.Sm;if(null==t)return console.error(this.t,"addRequest error id = "+t),!1;var h=n===a.Tm.Sm?this.sm:this.hm;if(h.has(t))return!1;if(!i||i.length<2)return!1;if("number"!=typeof i[0]||i[0]<0)return!1;if("number"!=typeof i[1]&&""!=i[1]||"number"==typeof i[1]&&0<i[1]&&i[1]<i[0])return this.r.info(this.t,"addRequest error range[1], range = "+i+", error id = "+t),!1;if(0<this.ch.Kr._r&&(i[0]>this.ch.Kr._r||""!=i[1]&&i[1]>this.ch.Kr._r))return this.r.info(this.t,"addRequest error range[1] fileSize_ = "+this.ch.Kr._r+", range = "+i+", error id = "+t),!1;0<this.ch.Kr._r&&(""===i[1]||i[1]<0)&&(i[1]=this.ch.Kr._r-1);var r=new e.default(t,i,this.r,s,n);return this.r.info(this.t,">>>>>>> addRequest id_ = "+r.Br+" ridTest_ = "+this.ki),h.set(t,r),this.Ym(r),this.cp(),!0},i.prototype.Ym=function(t){if(0<this.ch.Kr.Nr.size())if(t)this.vp(t);else{var i=this.sm.values(),s=Array.isArray(i),n=0;for(i=s?i:i[Symbol.iterator]();;){var h;if(s){if(n>=i.length)break;h=i[n++]}else{if((n=i.next()).done)break;h=n.value}var r=h;this.vp(r)}}},i.prototype.cp=function(){!this.uh&&this.r&&this.r.info(this.t,"!!!!!! notifyNewRequest_, "+this.uh),this.uh&&this.uh.Sa&&this.uh.Sa.fm(),this.uh&&this.uh._a&&this.uh._a.fm()},i.prototype.vp=function(t){if(t.il>this.ch.Kr._r||t.gm>this.ch.Kr._r)t.mp=!0;else{var i,s=null;0<this.ch.Kr._r&&(""===t.gm||t.gm<0)&&(t.gm=this.ch.Kr._r-1,t.se=t.gm-t.il+1);var n=t.il+t.pp;if((i=this.ch.Kr.$r(n))&&(t.bm=i.Br,t.dp=i.Jr,t.Me=i.segment.Br,t.jl=i.segment.Jr),!t.bp){var h=t.gm;if(s=this.ch.Kr.$r(h)){t.bp=s.Br,t.wp=s.Jr,t.kp=s.segment.Br,t.qm=s.segment.Jr;var r=this.ch.Kr.qr(s.Br);r&&(t.yp=r.fe.back().Br)}}if(""===t.km&&(t.km=t.bm),t._m!==a.Tm.lp)if(this.ch.Kr.xr())i&&(t.Nl=i.segment.Ih,t.gp=i.oo),-1===t._p&&s&&(t._p=s.segment.Ih,t.Sp=s.oo);else if(i){t.xl=Number(i.segment.Jr+this.Tp()-1),t.Ep=i.segment.Jr+this.Tp()-1,t.kp&&Number(t.xl)>Number(t.kp)&&(t.xl=t.kp,t.Ep=t.qm);var e=t.Ep+1;if(e<this.ch.Kr.Nr.size()){t.Ap=String(e),t.Mp=e;var o=t.Ep+this.Cp()-1;t.Op=o>=this.ch.Kr.Nr.size()?this.ch.Kr.Nr.size()-1:o,t.Rp=String(t.Op)}else t.Ap="",t.Pp=-1,t.Mp=0,t.Op=0,t.Rp="",t.Up=-1}}},i.prototype.Tp=function(){if(this.h.bi&&self.AbortController||this.h.Ui()){if(this.h.Pi()>a.Rm.Om-10)return this.h.pi;if(524288e3<this.ch.Kr._r)return 4;if(104857600<this.ch.Kr._r)return 5;if(62914560<this.ch.Kr._r)return 12;if(52428800<this.ch.Kr._r)return 10;if(41943040<this.ch.Kr._r)return 8;if(20971520<this.ch.Kr._r)return 6}return this.h.pi},i.prototype.Cp=function(){return 524288e3<this.ch.Kr._r?4:209715200<this.ch.Kr._r?10:104857600<this.ch.Kr._r?15:(this.ch.Kr._r,20)},i.prototype.eh=function(t,i){var s=2<arguments.length&&void 0!==arguments[2]?arguments[2]:-1,n=i===a.Tm.Sm?this.sm:this.hm;if(!n)return null;if(n.has(t)){var h=n.get(t).Ip(s);return i===a.Tm.Sm&&this.Ym(n.get(t)),h}return null},i.prototype.jm=function(t,i,s,n,h,r){t&&(this.uh.xn.emit(o.ChannelEvents.RAW_DATA_ARRIVED,i,s),t.jm(i,n,h,this.ch._r))},i.prototype.vm=function(){if(this.hm){var t=this.hm.values(),i=Array.isArray(t),s=0;for(t=i?t:t[Symbol.iterator]();;){var n;if(i){if(s>=t.length)break;n=t[s++]}else{if((s=t.next()).done)break;n=s.value}var h=n;(h.Cm()||!0===h.mp)&&(!0===h.mp&&h.Np(),this.up(h))}this.ch.Kr.xr()&&(this.hm=null)}var r=this.sm.values(),e=Array.isArray(r),o=0;for(r=e?r:r[Symbol.iterator]();;){var a;if(e){if(o>=r.length)break;a=r[o++]}else{if((o=r.next()).done)break;a=o.value}var u=a;(u.op()||!0===u.mp)&&(!0===u.mp&&u.Np(),this.up(u))}},i.prototype.oh=function(t){var i=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:a.Tm.Sm)===a.Tm.Sm?this.sm:this.hm;return!(!i||!i.has(t))&&this.up(i.get(t))},i.prototype.up=function(t){if(t){var i=t._m===a.Tm.Sm?this.sm:this.hm,s=t.Br;t._m;return t.destroy(),i.delete(s),!0}return!1},i.prototype.Dm=function(){if(this.ch.Kr.Nr.size()<=0||!this.sm||0===this.sm.size)return null;var t=this.sm.values(),i=Array.isArray(t),s=0;for(t=i?t:t[Symbol.iterator]();;){var n;if(i){if(s>=t.length)break;n=t[s++]}else{if((s=t.next()).done)break;n=s.value}return n}},i.prototype.Wm=function(){if(this.ch.Kr.Nr.size()<=0||!this.sm||0===this.sm.size)return null;var t=0,i=this.sm.values(),s=Array.isArray(i),n=0;for(i=s?i:i[Symbol.iterator]();;){var h;if(s){if(n>=i.length)break;h=i[n++]}else{if((n=i.next()).done)break;h=n.value}var r=h;if(++t==this.sm.size)return r}},i}();s.default=h},{"../../../../ks-p2ploader-events":21,"./request":46}],45:[function(t,i,s){"use strict";s.__esModule=!0;var n=h(t("../../base/scheduler")),c=t("../../../core/meta/piece"),_=t("../../../protocol/base/message"),w=h(_),S=h(t("../../../../common/utils/global")),k=t("./request"),T=h(t("../../../../common/utils/string-utils"));function h(t){return t&&t.__esModule?t:{default:t}}var r=function(n){function h(t,i){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,h);var s=function(t,i){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!i||"object"!=typeof i&&"function"!=typeof i?t:i}(this,n.call(this,t,i));return s.t="MP4Scheduler",s.ki=(new Date).getTime(),s.s=!1,s.ch.p2pShareRangeleterval=.7,s.ch.dnKeepAlive=!0,s.Hr=0,s.xp=0,s.jp=0,s.Lp=0,s.$p="",s.sm=s.uh.nm.sm,s.hm=s.uh.nm.hm,s.Dp=0,s.ki=i.h.ki,s.r.info(s.t,"con $$$$ ===========>>>>>>>>>>>, id = "+s.ki+", "+s.s),s}return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(t,i):t.__proto__=i)}(h,n),h.prototype.destroy=function(){this.r.info(this.t,"des <<<<<<<<<<<========== $$$$, id = "+this.ki+", "+this.s),n.prototype.destroy.call(this),this.sm=null,this.hm=null},h.prototype.open=function(){n.prototype.open.call(this)},h.prototype.close=function(){n.prototype.close.call(this)},h.prototype.Wp=function(){var t=new _.PieceRangeItem;return t.hr=c.ie.te,t.sl=0,t.il="-1",t},h.prototype.tv=function(t){if(t.Lr.clear(),!this.ch.ru||!this.h.ei){var i=new _.PieceRangeItem;return i.hr=c.ie.te,i.il="0",i.sl=1,void t.Lr.push_back(i)}var s=this.ch.Kr.Nr,n=Array.isArray(s),h=0;for(s=n?s:s[Symbol.iterator]();;){var r;if(n){if(h>=s.length)break;r=s[h++]}else{if((h=s.next()).done)break;r=h.value}var e=r;if(!e.go)for(var o=this.Wp(),a=0;a<e.fe.size();a++){var u=e.fe.at(a);if(0===a&&0<e.re){o.il=u.Br,o.sl=e.fe.size(),t.Lr.push_back(o);break}u.re<=0?"-1"!==o.il&&(t.Lr.push_back(o),o=this.Wp()):("-1"===o.il&&(o.il=u.Br),o.hr=u.hr,o.sl++,a===e.fe.size()-1&&"-1"!==o.il&&t.Lr.push_back(o))}}},h.prototype.fm=function(){this.Vl(),this.Hl(200),this.Jl(!0)},h.prototype.Jl=function(t){if(this.s&&!(this.ch.Kr.Nr.size()<=0)){var i=S.default.Ai();if(this.iv(i,!t),t||(this.Vr.Ll=i)-this.Vr.$l>=2*S.default.Ss&&(this.pv(i),this.Vr.$l=i,this.ql.sort(function(t,i){return i.Oe-t.Oe}),this.Bl.sort(function(t,i){return i.Oe-t.Oe})),this.uh.nm.vm(),this.hm&&0<this.hm.size){var s=this.hm.values(),n=Array.isArray(s),h=0;for(s=n?s:s[Symbol.iterator]();;){var r;if(n){if(h>=s.length)break;r=s[h++]}else{if((h=s.next()).done)break;r=h.value}var e=r;0<this.ql.size()&&this.qp(e)}}if(this.sm&&0!==this.sm.size){var o=this.sm.values(),a=Array.isArray(o),u=0;for(o=a?o:o[Symbol.iterator]();;){var c;if(a){if(u>=o.length)break;c=o[u++]}else{if((u=o.next()).done)break;c=u.value}var f=c;if(!f.Cm()){f.Il=this.lv();!t&&0<this.ql.size()&&(this.h._i.videoTag?(this.h.Pi()<k.Rm.Om-10||this.ch.lh<1024||1==this.h.Ui())&&this.qp(f):this.qp(f)),this.ch.eu&&0==this.h.Ui()&&12<this.h.Pi()&&(this.Vr.Wl=this.Bp(f)),f.Il=this.lv()}}this.Dp++}}},h.prototype.qp=function(t){if(this.ql.empty()||this.ch.Kr.Nr.empty())return 0;var i=t.jl,s=t._m===k.Tm.Sm?t.Ep:t.qm,n=S.default.Ai(),h=this.cv(),r=this.nv();if(t.Fp=!1,!r)return 0;var e=0,o=0,a=0,u=!(t.Fp=!0),c=!1;t.Hr=0,t.xp=0,this.jp=0,this.Lp=0;var f=new w.default;if(i<0)return this.r.error(this.t+"startSegmentIndex < 0 Error !!! startSegmentIndex = "+i),0;for(a=i;a<=s;a++){var l=this.ch.Kr.Nr.at(a);400<=l.ho&&l.ho<500&&this.r.info(this.t,"skip segment schedule, S("+l.Br+"), S error code("+l.ho+")");for(var v=a===i?t.dp:0;v<l.fe.size()&&o<=0;v++){if(u){this.r.info(this.t,"full 0 === true, pieceId = "+p+", endPieceId = "+d);break}var m=l.fe.at(v),p=Number(m.Br),d=Number(t.yp);if(t._m===k.Tm.Sm&&this.ch.Kr.xr()&&(t.Hr+=m.Ge,t.Hr>h&&(this.r.info(this.t,"full 3 === true, PId = "+p+", totalDuration = "+t.Hr),u=!0)),d<=p&&(u=!0,this.r.info(this.t,"full 1 === true, PId = "+p+", endPieceId = "+d),d<p)){this.r.info(this.t,"full 2 === true, PId > endPId , PId = "+p+", endPId = "+d);break}if(0<m.re){if(t.xp+=m.Ge,0<e){c=!0;break}}else{if(0<m.qe){if(!m.Be&&n<m.qe+this.ch.nu*S.default.Ss/2){o++;continue}if(m.Be&&n<5e3+m.qe){o++;continue}m.Be&&this.r.info(this.t,"重新 分配的piece ,p.id = "+m.Br+" , p.index_ = "+m.Jr)}"0"===m.Br&&this.r.info(this.t,"piece.id_ = "+m.Br);var b=new _.RequestDataItem;if(b.zp=!0,b.Sf=m,b.eo=m.eo,f._f.push_back(b),m.Be=!0,m.qe=n,m.We=r.sf,l.To<=0&&(l.To=n),e++,this.jp+=m.Ge,m.Jr,u)break}}if(0<o||0<c){l.Jr;break}}return 0<f._f.size()&&(this.$p=f._f.back().Sf.Br,r.lf<=0&&(r.uf=f._f.back().Sf.segment.Br),r.dh=n,r.mf=t.Br,r.lf+=f._f.size(),r.Tf(f),0===t.Vp&&(t.Vp=n),r.send(f)),e},h.prototype.wm=function(){},h.prototype.Bp=function(t){if(this.Bl.empty()||this.ch.Kr.Nr.empty())return 0;this.fv();var i=this.vv(),s=this.Hp(t);if(-1===s)return 0;var n=t.Op,h=2*this.ch.Su,r=0,e=S.default.Ai(),o=-1,a=-1;for(r=s;r<n;r++){var u=this.ch.Kr.Nr.at(r);if(u&&!u.go){var c=u.fe,f=Array.isArray(c),l=0;for(c=f?c:c[Symbol.iterator]();;){var v;if(f){if(l>=c.length)break;v=c[l++]}else{if((l=c.next()).done)break;v=l.value}var m=v,p=this.hv(m.hr,m.Br);if(!T.default._(p)){if(p.df()){if(p.dh!=e&&p.af._f.size())continue;if(p.dh==e&&p.af._f.size()&&Number(p.af._f.back().el)+1!=Number(m.Br))continue}if(!(0<m.re||m.Be&&0<m.qe)){if(0<m.qe&&!m.Be)if(this.ch.Za*S.default.Ss+m.qe>e)continue;var d=new _.RequestDataItem;if(p.af._f.push_back(d),d.zp=!1,d.hr=m.hr,d.el=m.Br,d.eo=m.eo,(d.Sf=m).Be=!1,m.qe=e,m.We=p.sf,u.To<=0&&(u.To=e),p.dh=e,p.uf=u.Br,-1==o&&(o=m.Jr),a=m.Jr,++i>=h){this.r.info(this.t,"P2P ++requestCount = "+i);break}p.af._f.size()>=h/2&&(this.r.info(this.t," ###### ===> dispatch P2P seg.index = "+r+", startSeg = "+s+", endSeg = "+n+", startPie = "+o+", endPie = "+a),this.Jp(p,e))}}}if(h<=i)break}}var b=this.Bl,w=Array.isArray(b),k=0;for(b=w?b:b[Symbol.iterator]();;){var y;if(w){if(k>=b.length)break;y=b[k++]}else{if((k=b.next()).done)break;y=k.value}var g=y;g.af._f.size()<=0||(this.r.info(this.t,"######===>, peer.message_.requests_.size() = "+g.af._f.size()),this.Jp(g,e))}return i},h.prototype.Hp=function(t){var i=t.Mp;if(1048576<this.ch.fh+this.ch.lh&&this.h.Pi()>k.Rm.Om-10)return t.jl;return i},h.prototype.Jp=function(t,i){var s=t.af._f.size();return t.Tf(t.af),t.Mf(),t.qe=i,t.lf=t.af._f.size(),t.send(t.af),t.af._f.clear(),s},h.prototype.Kp=function(){return 0<this.uh.Ra.Uo},h.prototype.cv=function(){return 1e3*this.h.su},h}(n.default);(s.default=r).MIN_SCHEDULE_DURATION=400},{"../../../../common/utils/global":9,"../../../../common/utils/string-utils":17,"../../../core/meta/piece":30,"../../../protocol/base/message":49,"../../base/scheduler":39,"./request":46}],46:[function(t,i,s){"use strict";s.__esModule=!0,s.Rm=s.Tm=void 0;var e=n(t("../../../../common/utils/global")),o=(t("../../../../common/utils/ks-log"),n(t("../../../../common/utils/ks-buffer")));function n(t){return t&&t.__esModule?t:{default:t}}var h=s.Tm={Sm:0,lp:1},r=(s.Rm={Um:5242880,Gp:60,Om:25},function(){function r(t,i,s,n){var h=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0;!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,r),this.t="Request",this.Br=t,this.il=i[0],this.gm=i[1],this.Nn=n,this.se=""===i[1]||i[1]<0?0:i[1]-i[0]+1,this.Pm=0,this._m=h,this.Qp=new o.default,this.ym=0,this.pp=0,this.Xp=e.default.Ai(),this.Im=-1,this.Yp=null,this.Il=0,this.Me="",this.jl=-1,this.Nl=-1,this.bm="",this.dp=-1,this.gp=-1,this.xl="",this.Ep=0,this.kp="",this._p=-1,this.qm=0,this.bp="",this.wp=-1,this.Sp=-1,this.yp="",this.Ap="",this.Pp=-1,this.Mp=0,this.Rp="",this.Up=-1,this.Op=0,this.Mm=0,this.Zp=0,this.km="",this.Fp=!1,this.Hr=0,this.xp=0,this.Ll=0,this.$l=0,this.Dl=30*e.default.Ss,this.Wl=0,this.mp=!1,this.Vp=0,this.r=s,this.r.info(this.t,">>>>> ##### new Request id = "+this.Br+", [ "+this.il+", "+this.gm+" ], size = "+this.se+", creatTime = "+this.Xp),this.pieceIdTest=0}return r.prototype.Cm=function(){return 0<this.ym&&this.ym===this.se},r.prototype.op=function(){return 0<this.pp&&this.pp===this.se},r.prototype.Np=function(){this.Nn&&this.Nn({requestError:!0})},r.prototype.jm=function(t,i,s){if(!t||0===t.byteLength)return!1;this.pieceIdTest=i,this.ym+=t.byteLength,this.km=Number(i)+1<Number(this.bp)?String(Number(i)+1):this.bp,this.Im=e.default.Ai(),this.Mm+=s;var n=this.Pm+t.byteLength;if(this.Qp.append(t),this.Pm=this.Qp.size(),this._m===h.Sm)this.Nn&&this.Nn({loadedBytes:this.Pm,totalBytes:this.se});else{if(n>this.Pm)throw new Error(this.t+"Moov writeData error!!! tempTotalSize = "+n+", data_.byteLength = "+this.Qp.byteLength+", start = "+this.il+", end = "+this.gm);this.Cm&&this.Nn(this.Qp.array())}return!0},r.prototype.Ip=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:-1;if(0===this.Pm||0===t)return null;var i=t;(i<0||i>this.Pm)&&(i=this.Pm);var s=this.Qp.subarray(0,i);return i<=this.Qp.size()?this.Qp.resize(e.default.ps):this.Qp.erase(this.Pm),this.Pm=this.Qp.size(),this.pp+=i,{data:s,id:this.Br}},r.prototype.td=function(){var t=0===this.Vp?this.Xp:this.Vp;if(0<t&&0<this.pp){var i=e.default.Ai()-t,s=Math.round(this.pp/1024/(i/1e3));this.r.info(this.t,"<==== ##### id = "+this.Br+", [ "+this.il+", "+this.gm+" ], readSize = "+this.pp+", size = "+this.se+", startTime - creatTime = "+(t-this.Xp)+", dur = "+i+", speed = "+s)}},r.prototype.destroy=function(){this.r.info(this.t,"======== destroy id= "+this.Br+", "),this.td(),this.t="Request",this.Br="",this.il=-1,this.gm=-1,this.se=0,this.Pm=0,this.Nn=null,this.Qp=null,this.ym=0,this.pp=0,this.Xp=-1,this.Im=-1,this._m=h.Sm,this.Yp=null,this.Il=0,this.Me="",this.jl=-1,this.Nl=-1,this.bm="",this.dp=-1,this.gp=-1,this.xl="",this.Ep=0,this.kp="",this._p=-1,this.qm=0,this.bp="",this.wp=-1,this.Sp=-1,this.yp="",this.Ap="",this.Pp=-1,this.Mp=0,this.Rp="",this.Up=-1,this.Op=0,this.km="",this.Mm=0,this.Zp=0,this.Hr=0,this.xp=0,this.Fp=!1,this.Ll=0,this.$l=0,this.Dl=30*e.default.Ss,this.Wl=0,this.mp=!1,this.r=null},r}());s.default=r},{"../../../../common/utils/global":9,"../../../../common/utils/ks-buffer":11,"../../../../common/utils/ks-log":12}],47:[function(t,i,s){"use strict";s.__esModule=!0;var n=e(t("events")),h=e(t("./logic/vod/mp4/mp4-channel")),r=t("../ks-p2ploader-events");function e(t){return t&&t.__esModule?t:{default:t}}var o=function(){function i(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,i),this.s=!1,this.t="P2PNetCore",this.h=t,this.xn=new n.default,this.uh=null}return i.prototype.destroy=function(){this.close(),this.h=null,this.xn&&(this.xn.removeAllListeners(),this.xn=null)},i.prototype.on=function(t,i){this.xn.addListener(t,i)},i.prototype.off=function(t,i){this.xn.removeListener(t,i)},i.prototype.open=function(){var s=this;this.s=!0,this.sd(),this.uh?(this.uh.on(r.ChannelEvents.RAW_DATA_ARRIVED,function(t,i){s.xn.emit(r.P2PNetCoreEvents.RAW_DATA_ARRIVED,t,i)}),this.uh.on(r.ChannelEvents.ERROR,function(t){s.xn.emit(r.P2PNetCoreEvents.ERROR,t)}),this.uh.open()||this.xn.emit(r.P2PNetCoreEvents.ERROR,r.KsP2PloaderErrors.OPEN_CHANNEL_ERROR)):this.xn.emit(r.P2PNetCoreEvents.ERROR,r.KsP2PloaderErrors.CREATE_CHANNEL_ERROR)},i.prototype.$n=function(){return this.uh?this.uh.ch.Kr._r:0},i.prototype.eh=function(t){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:-1;if(!0===this.h._i.isVod&&"mp4"===this.h._i.type&&this.uh)return this.uh.eh(t,i)},i.prototype.close=function(){this.s=!1,this.uh&&(this.uh.destroy(),this.uh=null)},i.prototype.oh=function(t){return!!this.s&&this.uh.oh(t)},i.prototype.ah=function(t){return!!this.s&&this.uh.ah(t)},i.prototype.rh=function(t,i,s){if(this.s)return!0===this.h._i.isVod&&"mp4"===this.h._i.type?this.uh.rh(t,i,s):void 0},i.prototype.sd=function(){this.h._i.isLive&&"flv"===this.h._i.type||(this.uh=new h.default(this.h))},i.prototype.qi=function(t,i){if(this.uh){var s=(t.channels=[])[0]={};this.uh.qi(s,i)}},i.prototype.getStatistics=function(){return this.uh?this.uh.getStatistics():null},i}();s.default=o},{"../ks-p2ploader-events":21,"./logic/vod/mp4/mp4-channel":42,events:1}],48:[function(t,i,s){"use strict";s.__esModule=!0,s.za=s.nd=s.ae=s.hd=void 0;var n=r(t("../../../common/utils/ks-array")),h=(r(t("../../../common/basic/env")),r(t("../../../common/utils/global")));function r(t){return t&&t.__esModule?t:{default:t}}var e=s.hd={rd:0,ed:1,od:2,ad:3,ud:4},o=s.ae={Hv:0,oe:1,Zv:2,tm:3,Sl:4,cd:5,fd:6,Lv:100},a=(s.nd={ld:1,vd:2,md:4,pd:8,dd:16,bd:32},s.za={wd:0,kd:1,yd:2,gd:3,Fa:4,_d:5,Sd:6,Td:7,Ed:8,Ad:9},function(){function s(t,i){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,s),this.t="Manager",this.s=!1,this.gn=t,this.ch=t.ch,this.xn=i,this.Md=new n.default,this.hr=o.Hv,this.Cd=e.rd,this.Od=20,this.dh=0,this.Br="",this.h=t.h,this.Rd=new Set,this.Pd=new Set,this.Ud=new Set,this.Id=new Map}return s.prototype.destroy=function(){this.close(),this.ch=null,this.gn=null,this.Md=null,this.xn=null,this.Rd&&this.Rd.clear(),this.Pd&&this.Pd.clear(),this.Ud&&this.Ud.clear(),this.Rd=null,this.Pd=null,this.Ud=null,this.h&&(this.h=null),this.Id=null},s.prototype.open=function(){this.s||(this.s=!0,this.dh=h.default.Ai())},s.prototype.close=function(){if(this.s){this.s=!1;var t=this.Md,i=Array.isArray(t),s=0;for(t=i?t:t[Symbol.iterator]();;){var n;if(i){if(s>=t.length)break;n=t[s++]}else{if((s=t.next()).done)break;n=s.value}n.destroy()}this.Md.clear()}},s.prototype._l=function(){return this.Br},s.prototype.al=function(){return this.hr},s.prototype.Nf=function(){switch(this.hr){case o.Hv:return"reserved";case o.oe:return"cdn";case o.Zv:return"rtmfp";case o.tm:return"websocket";case o.Sl:return"webrtc";case o.cd:return"superNode";case o.fd:return"localcache";default:return"unknown"}},s.prototype.Nd=function(){},s.prototype.Am=function(){var t={},i={};this.ch.qi(t),this.h.qi(i);var s={customid:t.custid,geo:t.geo,groupid:this.ch.Kr.pe,device_name:"",mac:"",net_type:"wifi",module:"h5",module_ver:i.moduleVersion,os:i.osType,play_type:t.playType,tid:1};return JSON.stringify(s)},s.prototype.xd=function(){var t={customid:"",geo:"",groupid:this.ch.Kr.pe,device_name:"",mac:"",net_type:"",module:"",module_ver:"",os:"",play_type:"",tid:1};return JSON.stringify(t)},s.prototype.df=function(){return o.cd===this.hr},s.prototype.hl=function(){return o.oe===this.hr},s.prototype.jd=function(){return this.Id.size},s.prototype.Ld=function(t){this.Od=t},s.prototype.setTimeout=function(n){function t(t,i,s){return n.apply(this,arguments)}return t.toString=function(){return n.toString()},t}(function(t,i,s){var n=this;return i=setTimeout(function(){n.onTimeout(t,i)},s)}),s.prototype.onTimeout=function(t,i,s){},s}());s.default=a},{"../../../common/basic/env":3,"../../../common/utils/global":9,"../../../common/utils/ks-array":10}],49:[function(t,i,s){"use strict";s.__esModule=!0,s.ResponseDataItem=s.RequestDataItem=s.PieceRangeItem=void 0;var n=r(t("../../../common/utils/ks-array")),h=r(t("../../../common/utils/ks-buffer"));function r(t){return t&&t.__esModule?t:{default:t}}function e(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}s.PieceRangeItem=function t(){e(this,t),this.hr=0,this.sl=0,this.il="-1"},s.RequestDataItem=function t(){e(this,t),this.zp=!1,this.Sf=null,this.hr=0,this.el="",this.eo=0},s.ResponseDataItem=function t(){e(this,t),this.ho=0,this.data=new h.default(1),this.hr=0,this.el=""};var o=function(){function t(){e(this,t),this.Br=t.$d++,this.ef=null,this.av=!1,this.Lr=new n.default,this._f=new n.default,this.Ef=new n.default}return t.prototype.empty=function(){return this.Lr.empty()&&this._f.empty()&&this.Ef.empty()},t}();(s.default=o).$d=0},{"../../../common/utils/ks-array":10,"../../../common/utils/ks-buffer":11}],50:[function(t,i,s){"use strict";s.__esModule=!0,s.P2PServerTypes=void 0;var n=c(t("events")),m=(t("../../../common/utils/ks-log"),t("../../../ks-p2ploader-events")),h=c(t("../cdn/cdn-manager")),r=c(t("../../core/loader/ks-httploader")),p=(c(t("../../../common/basic/env")),c(t("../../../common/utils/string-utils"))),d=c(t("../../../common/utils/ks-object")),e=c(t("../super-node/supernode-manager")),b=c(t("../../../common/basic/error")),o=c(t("../../../common/utils/global")),w=c(t("../../../common/basic/version")),a=t("./manager"),u=c(t("../../../common/utils/ks-array"));c(t("../../logic/base/protocol-observer"));function c(t){return t&&t.__esModule?t:{default:t}}var k=s.P2PServerTypes={Dd:0,Wd:1,qd:2,Bd:4,Fd:8,zd:16,Vd:32,Hd:64,Jd:128,Kd:256,Gd:512,Qd:1024,Xd:2048,Yd:4096,Zd:8192,ib:16384,sb:32768},f=function(){function i(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,i),this.t="Protocol",this.s=!1,this.ch=t.ch,this.nb=new u.default,this.xn=new n.default,this.h=t.h,this.r=this.h.r,this.hb=0,this.rb=!1,this.o=new r.default(this),this.eb=null,this.ob=""}return i.prototype.destroy=function(){this.close(),this.xn&&this.xn.removeAllListeners(),this.xn=null,this.ch=null,this.nb=null,this.r=null,this.h=null},i.prototype.close=function(){if(this.s){this.s=!1;var t=this.nb,i=Array.isArray(t),s=0;for(t=i?t:t[Symbol.iterator]();;){var n;if(i){if(s>=t.length)break;n=t[s++]}else{if((s=t.next()).done)break;n=s.value}n.destroy()}this.nb.clear(),this.o.close(),this.o=null,this.eb&&clearInterval(this.eb)}},i.prototype.open=function(){if(!this.s){this.s=!0,this.ab(),this.ub();var t=this;this.eb=setInterval(function(){t.hb&&t.cb()},3e4)}},i.prototype.ub=function(){var t=(this.h.W.D?"https":"http")+"://"+this.h.W.B+"/query/v3?customid="+this.h.H+"&mt="+this.h.J+"&type="+(k.sb+k.zd)+"&hwtype=pc&multiquery=1&os="+this.h.G+"&osver=&arch=&url="+p.default.cn(this.ch.Kr.vr)+"&playtype=vod&vf=mp4&appname="+this.h.X+"&appver="+w.default.Z()+"&sdkver="+w.default.Z()+"&module="+this.h.K+"&modulever="+w.default.Z()+"&playurl_host="+this.ch.Kr.pr+"&net_type=wifi&deviceid="+this.h.T+"&clength="+this.ch.Kr._r+"&sessionkey="+encodeURIComponent(this.ch.Oc)+"&mac=";this.ch._c++,this.o.setTimer("selector",this.h.W.q,this.o.create()).it("base-selector").open(t)},i.prototype.cb=function(){var t=""!==this.ob?this.ob:this.h.W.Tt,i=(this.h.W.D?"https":"http")+"://"+t+"/trace/v3?customid="+this.h.H+"&mt="+this.h.J+"&hwtype=pc&multiquery=1&&os="+this.h.G+"&osver=&arch=&geo="+this.ch.qa+"&playtype=vod&groupid="+this.ch.Kr.pe+"&vf=mp4&appname="+this.h.X+"&appver="+w.default.Z()+"&sdkver="+w.default.Z()+"&module="+this.h.K+"&modulever="+w.default.Z()+"&playurl_host="+this.ch.Kr.pr+"&net_type=wifi&deviceid="+this.h.T+"&clength="+this.ch.Kr._r+"&sessionkey="+encodeURIComponent(this.ch.Oc)+"&mac=",s=[],n={},h=this.fb(a.ae.cd);if(h){var r=s[s.length]={};r.type=a.nd.bd,r.neighbors=0,r.act=3,r.schedule=3,r.expect=Math.max(3-h.jd(),0)}n.protocol=s;var e=this.o.create();e.Zs="POST",e.tn=JSON.stringify(n),this.r.info(this.t,"body:("+e.tn+")"),e.in.set("Content-Type","application/json"),this.o.setTimer("tracker",this.h.W._t,e).it("trace::v3").open(i)},i.prototype.I=function(t){if(this.r.info(this.t,"Http complete for tag("+t.getTag()+"), response code("+t.N+"), details("+t.x+"), size("+t.j+")"),"base-selector"===t.getTag()){if(!t.Mh||t.N<200||300<=t.N)return void this.xn.emit(m.qn.zn,b.default.Vi,t);if(!this.lb(t))return void this.xn.emit(m.qn.zn,b.default.zi,t);var i=p.default.format("Query from selector successfully, gather({0}), webrtc({1}), tracker({2}), stun({3}), max peers({4}), urgent size({5}), cdn({6}), rtmfp({7}), websocket({8}), webrtc({9}), upload({10}), urgent upload({11}), range interval({12} s), upload limit({13}), init throttle({14} B/s), avg throttle({15} B/s), max reserved({16} B/s), force({17}), http info numbers((18))",this.ch.Lu,this.ch.qu,this.ch.Du,this.ch.Wu,this.ch.Qa,this.ch.Ya,this.ch.Pu?"no":"yes",this.ch.Uu?"no":"yes",this.ch.Iu?"no":"yes",this.ch.xu?"no":"yes",this.ch.ru?"yes":"no",this.ch.pu?"yes":"no",this.ch._u,this.ch.fu?"yes":"no",this.ch.lu,this.ch.vu,this.ch.mu,this.ch.hu,this.ch.Va);this.r.info(this.t,i),this.hb=o.default.Ai(),this.ch.Vu=t.xh,this.o.clearTimer(),this.xn.emit(m.qn.zn,b.default.Bi,t),this.vb()}else if("trace::v3"===t.getTag()){if(this.o.clearTimer(),!t.Mh||t.N<200||300<=t.N)return;var s=this.nb,n=Array.isArray(s),h=0;for(s=n?s:s[Symbol.iterator]();;){var r;if(n){if(h>=s.length)break;r=s[h++]}else{if((h=s.next()).done)break;r=h.value}var e=r;e.hl()||e.Nd(t)}}},i.prototype.lb=function(t){var i=p.default.P(p.default.L(t.$.array())),s=i.geo,n=i.status,h=i.items,r=i.groupId;if(0!==(this.mb=n)||p.default._(h))return this.xn.emit(m.qn.zn,b.default.zi,t),this.r.info(this.t,"Selector response error:{"+this.mb),!1;var e=h,o=Array.isArray(e),a=0;for(e=o?e:e[Symbol.iterator]();;){var u;if(o){if(a>=e.length)break;u=e[a++]}else{if((a=e.next()).done)break;u=a.value}var c=u,f=c.serviceUrls,l=c.type;l===k.Fd&&(this.ch.qu=new d.default(f).asString()),l===k.Hd&&(this.ch.Wu=new d.default(f).asString()),l===k.zd&&(this.ch.Lu=this.ch.Du=new d.default(f).asString())}if(p.default._(i["p2p.force_tracker"])||(this.ob=new d.default(i["p2p.force_tracker"]).asString()),p.default._(r)||(this.ch.Kr.pe=new d.default(r).asString()+w.default.Gi),p.default._(s)||(this.ch.qa=new d.default(s).asString()),p.default._(i["p2p.max_peers"])||(this.ch.Qa=Math.max(new d.default(i["p2p.max_peers"]).asInt(),3)),p.default._(i["p2p.act_type"])||(this.ch.Rc=Math.max(new d.default(i["p2p.act_type"]).asInt(),3)),p.default._(i["p2p.schedule_type"])||(this.ch.Pc=Math.max(new d.default(i["p2p.schedule_type"]).asInt(),3)),p.default._(i["p2p.urgent.size"])||(this.ch.Ya=Math.max(new d.default(i["p2p.urgent"]).asInt(),3)),i.hasOwnProperty("p2p.upload.enable")&&(this.ch.ru=new d.default(i["p2p.upload.enable"]).asBool()),i.hasOwnProperty("p2p.download.enable")&&(this.ch.eu=new d.default(i["p2p.download.enable"]).asBool()),i.hasOwnProperty("p2p.range.share_interval")&&(this.ch._u=Math.max(new d.default(i._u).asDouble(),1)),i.hasOwnProperty("p2p.pieces.max_parallel_request")&&(this.ch.Su=new d.default(i["p2p.pieces.max_parallel_request"]).asInt()),i.hasOwnProperty("p2p.pieces.max_urgent_request")&&(this.ch.Tu=new d.default(i["p2p.pieces.max_urgent_request"]).asInt()),i.hasOwnProperty("p2p.fetch_rate")&&(this.ch.Ga=new d.default(i["p2p.fetch_rate"]).asDouble()),i.hasOwnProperty("p2p.pieces.timeout_value")&&(this.ch.Xa=new d.default(i["p2p.pieces.timeout_value"]).asInt()),0<new d.default(i["p2p.live.play_offset"]).asInt()&&(this.ch.vt=new d.default(i["p2p.live.play_offset"]).asInt()),i.hasOwnProperty("p2p.support.enable")&&(this.h.ri=new d.default(i["p2p.support.enable"]).asBool()),i.hasOwnProperty("p2p.storage.memory_capacity")){var v=this.h.Yt;this.h.Yt=new d.default(i["p2p.storage.memory_capacity"]).asInt(),this.r.info(this.t,"set memory storage bucket data capacity("+v+"/"+this.h.Yt+")")}return i.hasOwnProperty("p2p.llls.urgent_size")&&(this.ch.Za=Math.max(1,new d.default(i["p2p.llls.urgent_size"]).asDouble())),i.hasOwnProperty("p2p.protocol.supernode.disable")&&(this.ch.Nu=i["p2p.protocol.supernode.disable"].asBool()),this.h.yi=this.ch.qa,!0},i.prototype.U=function(t,i){if("base-selector"===i.getTag()){if(this.ch._c>this.h.W.gt)return;this.xn.emit(m.qn.zn,b.default.Fi,i),this.r.info(this.t,"selector timeout, "+this.ch._c+" try times..."),this.ub()}else i.getTag()},i.prototype.on=function(t,i){this.xn.addListener(t,i)},i.prototype.off=function(t,i){this.xn.removeListener(t,i)},i.prototype.ab=function(){this.pb()},i.prototype.pb=function(){var t=new h.default(this,this.xn);t.open(),this.nb.push_back(t)},i.prototype.fb=function(i){return this.nb.find(function(t){return t.hr===i})},i.prototype.vb=function(){if(""===this.ch.Kr.pe||this.rb||this.hb<=0)return!0;if(!this.ch.Nu&&!this.h.ni){var t=new e.default(this,this.xn);t.open(),t.Ld(this.ch.Qa),this.nb.push_back(t)}this.cb(),this.rb=!0},i}();s.default=f},{"../../../common/basic/env":3,"../../../common/basic/error":4,"../../../common/basic/version":5,"../../../common/utils/global":9,"../../../common/utils/ks-array":10,"../../../common/utils/ks-log":12,"../../../common/utils/ks-object":13,"../../../common/utils/string-utils":17,"../../../ks-p2ploader-events":21,"../../core/loader/ks-httploader":25,"../../logic/base/protocol-observer":38,"../cdn/cdn-manager":52,"../super-node/supernode-manager":56,"./manager":48,events:1}],51:[function(t,i,s){"use strict";s.__esModule=!0;var h=t("./manager"),a=(n(t("../../../common/utils/global")),t("../../tools/collector/report-base")),u=n(a);function n(t){return t&&t.__esModule?t:{default:t}}var r=function(){function n(t,i,s){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,n),this.t="ProtocolSession",this.s=!1,this.db=t,this.ch=t.ch,this.xn=i,this.primary=s,this.Ba=h.za.wd,this.bb=!1,this.An="",this.wb="",this.kb="",this.yb="",this.gb="un",this.qe=0,this.gn="http",this.rl={},this._b=null}return n.prototype.destroy=function(){this.close(),this.db=null,this.ch=null,this.xn=null,this.primary=null,this.rl=null,this._b&&(this._b.clear(),this._b=null)},n.prototype.open=function(){this.s||(this.s=!0)},n.prototype.close=function(){this.s&&(this.s=!1,this.qe=0)},n.prototype.df=function(){return this.db.df()},n.prototype.hl=function(){return this.db.hl()},n.prototype.al=function(){return this.db.al()},n.prototype.Nf=function(){return this.db.Nf()},n.prototype.ul=function(){var t=this.gb.toLowerCase();return-1!==t.indexOf("un")?h.za.kd:-1!==t.indexOf("flash")?h.za.kd:-1!==t.indexOf("android")?h.za.yd:-1!==t.indexOf("ios")?h.za.gd:-1!==t.indexOf("h5")?h.za.Fa:h.za.wd},n.prototype.Gl=function(){this.db.hl()||h.za.wd!==this.Ba||(this.Ba=this.ul())},n.prototype.gf=function(){},n.prototype.send=function(t){},n.prototype.Sb=function(t){this.An=t},n.prototype.If=function(){return this.An},n.prototype.xf=function(){return this.wb},n.prototype.jf=function(){return this.kb},n.prototype.Lf=function(){return this.yb},n.prototype.Tb=function(){return this.bb},n.prototype.Eb=function(){return this.s},n.prototype.Ab=function(){var t=["cid","m","mv","os","tid","geo","mac","net","nat","pt"],i=u.default.Mb,s=Array.isArray(i),n=0;for(i=s?i:i[Symbol.iterator]();;){var h;if(s){if(n>=i.length)break;h=i[n++]}else{if((n=i.next()).done)break;h=n.value}var r=h,e=r[0],o=r[1];-1!=t.indexOf(e)&&(this.rl[e]=o===a.VType.Cb?0:"")}},n.prototype.Ob=function(){this.rl=JSON.parse(this.db.xd())},n}();s.default=r},{"../../../common/utils/global":9,"../../tools/collector/report-base":60,"./manager":48}],52:[function(t,i,s){"use strict";s.__esModule=!0,s.CdnManagerConfig=void 0;var h=t("../base/manager"),n=r(h),a=r(t("./cdn-session"));function r(t){return t&&t.__esModule?t:{default:t}}var u=s.CdnManagerConfig={Rb:2,Pb:3},e=function(o){function n(t,i){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,n);var s=function(t,i){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!i||"object"!=typeof i&&"function"!=typeof i?t:i}(this,o.call(this,t,i));return s.t="CdnManager",s.hr=h.ae.oe,s}return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(t,i):t.__proto__=i)}(n,o),n.prototype.destroy=function(){o.prototype.destroy.call(this)},n.prototype.isBusy=function(){},n.prototype.open=function(){o.prototype.open.call(this);for(var t=!0===this.ch.isVod&&"mp4"===this.ch.type?u.Rb:u.Pb,i=0;i<t;i++){var s=new a.default(this,this.xn,i);this.Md.push(s)}var n=this.Md,h=Array.isArray(n),r=0;for(n=h?n:n[Symbol.iterator]();;){var e;if(h){if(r>=n.length)break;e=n[r++]}else{if((r=n.next()).done)break;e=r.value}e.open()}},n.prototype.close=function(){o.prototype.close.call(this)},n}(n.default);s.default=e},{"../base/manager":48,"./cdn-session":53}],53:[function(t,i,s){"use strict";s.__esModule=!0;t("../../../common/utils/ks-log");var n=r(t("../base/session")),o=t("../../../ks-p2ploader-events"),h=r(t("../../core/loader/ks-loader")),a=t("../../core/loader/base-loader"),u=r(t("../../../common/utils/url-parser")),c=t("../../core/meta/piece"),f=r(t("./request-range")),l=t("../base/message"),v=r(l),m=r(t("../../../common/utils/ks-buffer")),p=(r(t("../../../common/basic/env")),r(t("../../../common/basic/version"))),d=r(t("../../../common/utils/global"));function r(t){return t&&t.__esModule?t:{default:t}}var e=function(r){function e(t,i,s){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,e);var n=function(t,i){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!i||"object"!=typeof i&&"function"!=typeof i?t:i}(this,r.call(this,t,i,0===s));n.t="CdnSession",n.db=t,n.zm=null,n.Ub=null,n.Jr=s,n.dh=0,n.Oe=0,n.Ib=0,n.Nb=0;var h=new u.default;return h.fromString(n.ch._i.url),n.kb=h._n,n._b=new f.default,n.h=t.h,n.r=n.h.r,n.Fm="",n}return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(t,i):t.__proto__=i)}(e,r),e.prototype.destroy=function(){r.prototype.destroy.call(this),this.zm&&(this.zm.zh("cancel"),this.zm.destroy()),this.zm=null,this.Fm="",this.r=null,this.h=null,this.xb()},e.prototype.jb=function(t){var i=this;i.Ub=setTimeout(function(){i.Lb()},t)},e.prototype.xb=function(){this.Ub&&(clearTimeout(this.Ub),this.Ub=null)},e.prototype.open=function(){r.prototype.open.call(this),this.xn.emit(o.qn.Jn,this)},e.prototype.close=function(){r.prototype.close.call(this),this.h&&this.r&&this.r.info(this.t,"close this.range_ = "+this.Fm)},e.prototype.gf=function(t,i){var s=0<this.Ib?t-this.Ib:0;return s>d.default.gs&&(this.Oe=this.Nb*d.default.Ss/s),this.Oe},e.prototype.send=function(t){if(t.av)this.$b();else if(this._b.Db)this.r.info(this.t,"cdn session is still downloading");else if(t._f.empty())this.r.info(this.t,"request is null");else{this._b.clear();var i=(this._b.Wb=t)._f.front().Sf;if(this._b.Sf=i,this._b.qb=i.hr,this._b.qb===c.ie.io){var s=new u.default;s.fromString(i.segment.url),s.Mn.set("kcg",p.default.Z()),s.Mn.set("kcgm",this.h.K),s.Mn.set("kcgid",this.h.T),s.Mn.set("kcguid",this.ch.fr),s.Mn.set("index",i.segment.do),s.Mn.set("begin",t._f.front().Sf.Jr),s.Mn.set("end",t._f.back().Sf.Jr),s._n=this.ch.Kr.gslbHost,this._b.Bb=s.toString()}else if(this._b.qb===c.ie.te){this._b.Bb=i.segment.url;var n=t._f.front().Sf.ce,h=t._f.back().Sf.ce+t._f.back().Sf.se-1;this.Fm="bytes="+n+"-"+h}this.h&&(this.h.bi=!1),this.Fb()}},e.prototype.Fb=function(){var i=this;this.s&&(this._b.Db=!0,this.xb(),this.jb(4e3),null!=this.zm&&(this.zm.zh("cancel"),this.zm.destroy(),this.zm=null),this.ch.vh=this._b.Bb,this.zm=h.default.Kh(this.r,this.h.vi),this.zm.it("cdn-range-data").qh(this.Jr).open(this._b.Bb,this.Fm,this.db.ch.Kr._r),this.qe=d.default.Ai(),this.zm.on(a.KsloaderEvents.ON_DOWNLOAD_DATA,function(t){i.s&&i.zm===t?(i.dh=d.default.Ai(),i.zb(t,!0)):i.r.info(i.t,"["+i.ch.Kr.hr+"]Expired http complete for tag, ignore")}),this.zm.on(a.KsloaderEvents.ON_DOWNLOAD_COMPLETED,function(t){if(i.s&&i.zm===t)if(i.ch.vh=i._b.Bb,i.dh=d.default.Ai(),i.xb(),!t.Mh||t.N<200||300<=t.N){if(400<=t.N&&t.N<500)return;i.Vb()}else i.zb(t),i.zm.destroy(),i.zm=null;else i.r.info(i.t,"["+i.ch.Kr.hr+"]Expired http complete for tag, ignore")}))},e.prototype.Vb=function(){var i=this;this.wait(1e3).then(function(){i.s&&i.Lb()}).catch(function(t){i.r.info(i.t,"error:"+t)})},e.prototype.wait=function(s){return new Promise(function(t,i){setTimeout(t,s)})},e.prototype.Lb=function(){this.s&&(this.r.info(this.t,"cdn("+this.Jr+") range request is timeout..., receive piece("+this._b.Hb+"/"+this._b.Wb._f.size()+"), url("+this._b.Bb+")"),this.zm&&(this.zb(this.zm),this.zm.destroy()),this.zm=null)},e.prototype.zb=function(t){var i=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(this._b.Hb<this._b.Wb._f.size()){this.Oe=t.Lh,this.Nb=t.j;for(var s=new v.default,n=(s.ef=this)._b.Hb;n<this._b.Wb._f.size();n++){var h=new l.ResponseDataItem,r=this._b.Wb._f.at(n).Sf;if(h.ho=t.Mh?t.N:-1,h.hr=r.hr,h.el=r.Br,this._b.Jb+r.se>t.$.size()){if(i)break;this._b.Jb+=r.se}else h.data=new m.default(r.se),h.data.append(t.$.subarray(this._b.Jb,r.se)),this._b.Jb+=r.se;this._b.Hb++,this.ch.vh=this._b.Bb,this.xn.emit(o.qn.Bn,t,!1),s.Ef.push_back(h)}s.empty()||this.xn.emit(o.qn.Gn,s)}this._b.Db&&this._b.Hb>=this._b.Wb._f.size()&&(this.zm&&this.xn.emit(o.qn.Bn,this.zm,!0),this._b.Db=!1)},e.prototype.Kb=function(t){return 0},e.prototype.$b=function(){this.xb(),this.zm&&(this.zm.zh("cancel"),this.zm.destroy()),this.zm=null,this._b.Db=!1},e}(n.default);s.default=e},{"../../../common/basic/env":3,"../../../common/basic/version":5,"../../../common/utils/global":9,"../../../common/utils/ks-buffer":11,"../../../common/utils/ks-log":12,"../../../common/utils/url-parser":18,"../../../ks-p2ploader-events":21,"../../core/loader/base-loader":23,"../../core/loader/ks-loader":26,"../../core/meta/piece":30,"../base/message":49,"../base/session":51,"./request-range":54}],54:[function(t,i,s){"use strict";s.__esModule=!0;var n=t("../../core/meta/meta-data");var h=function(){function t(){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.t="RequestRange",this.clear()}return t.prototype.clear=function(){this.Db=!1,this.zp=!1,this.ne=0,this.Jb=0,this.Hb=0,this.Bb="",this.qb=n.er.we,this.Wb=null,this.Sf=null},t}();s.default=h},{"../../core/meta/meta-data":29}],55:[function(t,i,s){arguments[4][54][0].apply(s,arguments)},{"../../core/meta/meta-data":29,dup:54}],56:[function(t,i,s){"use strict";s.__esModule=!0;var r=t("../base/manager"),n=h(r),v=h(t("../../../common/utils/string-utils")),m=t("../../../ks-p2ploader-events"),p=(t("../../../common/utils/ks-log"),h(t("../../../common/utils/global"))),d=h(t("../../../common/basic/error")),b=h(t("./supernode-peer")),e=h(t("../../../common/basic/version"));function h(t){return t&&t.__esModule?t:{default:t}}var o=function(h){function n(t,i){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,n);var s=function(t,i){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!i||"object"!=typeof i&&"function"!=typeof i?t:i}(this,h.call(this,t,i));return s.t="SuperNodeManager",s.hr=r.ae.cd,s.Br=v.default.format("{0}{1}{2}{3}",Math.floor(1001*Math.random()),Math.floor(1001*Math.random()),Math.floor(1001*Math.random()),p.default.Ai()),s}return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(t,i):t.__proto__=i)}(n,h),n.prototype.destroy=function(){h.prototype.destroy.call(this)},n.prototype.Gb=function(){var t={customid:this.h.H,mt:this.h.J,device_id:this.h.T,device_name:"",geo:this.ch.qa,module:this.h.K,module_ver:e.default.Z(),os:this.h.osType,play_type:this.ch.La,peerid:this.Br};return JSON.stringify(t)},n.prototype.Nd=function(t){var i=0,s=v.default.P(v.default.L(t.$.array())),n=s.status,h=s.peers;if(0!==(this.Qb=n)||v.default._(h))return this.h.r.info(this.t,"Supernode tracker response error, status{"+n),!1;var r=h,e=Array.isArray(r),o=0;for(r=e?r:r[Symbol.iterator]();;){var a;if(e){if(o>=r.length)break;a=r[o++]}else{if((o=r.next()).done)break;a=o.value}var u=a,c=u.peerid,f=u.pip;u.pport;if("127.0.0.1"!==f&&"0.0.0.0"!==f&&"255.255.255.255"!==f){c=c.toLowerCase();var l=void 0;if(this.Id.has(c))l=this.Id.get(c);else{if(this.Id.size>=2*this.Od)break;l=new b.default(this),this.Id.set(c,l),i++}v.default._(l)||l.load(u)}}h.length;this.ch.ic=this.Id.size;this.Xb||(!0,this.Xb=!0,this.Yb=p.default.Ai(),this.xn.emit(m.qn.Vn,this,d.default.Bi,t)),0<i&&this.Zb()},n.prototype.tw=function(t){if(this.s){var i=[],s=this.Id,n=Array.isArray(s),h=0;for(s=n?s:s[Symbol.iterator]();;){var r;if(n){if(h>=s.length)break;r=s[h++]}else{if((h=s.next()).done)break;r=h.value}var e=r[1];if(t===e.ef){this.h.r.info(this.t,"super node session("+e.Br+", "+e.internetIp+":"+e.iw+") closed"),this.ch.ic=this.Id.size,i.push(e.Br),e.destroy();break}}var o=i,a=Array.isArray(o),u=0;for(o=a?o:o[Symbol.iterator]();;){var c;if(a){if(u>=o.length)break;c=o[u++]}else{if((u=o.next()).done)break;c=u.value}var f=c;this.h.r.info(this.t,"will delete super node session("+f+")"),this.Id.delete(f)}return!0}},n.prototype.Zb=function(){this.sw=0;var t=this.Id,i=Array.isArray(t),s=0;for(t=i?t:t[Symbol.iterator]();;){var n;if(i){if(s>=t.length)break;n=t[s++]}else{if((s=t.next()).done)break;n=s.value}n[1].Tb()&&this.sw++}if(this.ch.ic=this.Id.size,!(this.sw>=this.Od)){var h=[],r=this.Id,e=Array.isArray(r),o=0;for(r=e?r:r[Symbol.iterator]();;){var a;if(e){if(o>=r.length)break;a=r[o++]}else{if((o=r.next()).done)break;a=o.value}var u=a[1];u.Tb()||h.push(u)}var c=h,f=Array.isArray(c),l=0;for(c=f?c:c[Symbol.iterator]();;){var v;if(f){if(l>=c.length)break;v=c[l++]}else{if((l=c.next()).done)break;v=l.value}if(v.connect(this)&&(this.sw++,this.sw>=this.Od))break}this.ch.fc=this.sw}},n.prototype.open=function(){h.prototype.open.call(this)},n.prototype.close=function(){if(this.Id){var t=this.Id,i=Array.isArray(t),s=0;for(t=i?t:t[Symbol.iterator]();;){var n;if(i){if(s>=t.length)break;n=t[s++]}else{if((s=t.next()).done)break;n=s.value}n[1].destroy()}this.Id.clear()}h.prototype.close.call(this)},n}(n.default);s.default=o},{"../../../common/basic/error":4,"../../../common/basic/version":5,"../../../common/utils/global":9,"../../../common/utils/ks-log":12,"../../../common/utils/string-utils":17,"../../../ks-p2ploader-events":21,"../base/manager":48,"./supernode-peer":57}],57:[function(t,i,s){"use strict";s.__esModule=!0;t("../../../common/utils/ks-log"),a(t("../../../common/basic/env"));var n=a(t("../../../common/utils/string-utils")),h=a(t("./supernode-session")),r=a(t("../../../common/utils/global")),e=a(t("../../../common/utils/url-parser")),o=t("../base/manager");function a(t){return t&&t.__esModule?t:{default:t}}var u=function(){function i(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,i),this.t="SuperNodePeer",this.db=t,this.h=t.h,this.r=this.h.r,this.ch=t.ch,this.gn=0,this.nw=0,this.dh=0,this.rw=0,this.ew=0,this.ow=0,this.aw=!1,this.ef=null,this.uw="",this.iw=0}return i.prototype.destroy=function(){this.disconnect(),this.db=null,this.r=null,this.h=null,this.ch=null},i.prototype.Tb=function(){return null!=this.ef},i.prototype.disconnect=function(){return this.aw=!1,null!=this.ef&&(this.r.trace(this.t,"will disconnect a super node("+this.Br+"), "+this.uw+":"+this.iw),this.ow++,this.ef.close(),this.ef.destroy()),!(this.ef=null)},i.prototype.connect=function(){return this.disconnect(),this.r.trace(this.t,"Try to connect to a super node("+this.Br+"), "+this.uw+":"+this.iw),this.aw=!0,this.ew++,this.rw=this.dh=r.default.Ai(),this.ef=new h.default(this.db,this.db.xn,this),this.ef.open()},i.prototype.cw=function(){return this.gn===o.nd.bd?"https":"http"},i.prototype.fw=function(){var t=new e.default;t.fromString(this.ch._i.url),t.gn=this.cw();var i=t._n;return t._n=this.uw,t.En="/"+i+t.En,t.Sn=this.iw,t.Mn.set("ksurl",n.default.cn(this.ch._i.url)),t.Mn.set("ksgid",this.ch.Kr.pe),t.Mn.set("ksdev",this.lw),t.Mn.set("ksts",this.vw),t.Mn.set("ctype",1),t.Mn.set("kslen",this.ch.Kr._r),t.toString(!0)},i.prototype.load=function(t){if(0!==this.nw){var i=t.pip,s=t.pport;this.uw===i&&this.iw===s||(this.r.info(this.t,"peer("+this.Br+")has changed, ori:"+this.uw+":"+this.iw+", now:"+i+":"+s),this.disconnect())}this.nw=r.default.Ai(),this.mw=t.deviceid,this.lw=t.ksdev,this.vw=t.ksts,this.Br=t.peerid,this.pw=t.peertype,this.uw=t.pip,this.iw=t.pport,this.gn=t.protocol,this.dw=t.tid},i.prototype.bw=function(){return n.default.format("ws://%s:%u/mtep-exchange-connection?inIp=%s&inPort=%u&peerId=%s",this.uw,this.iw,this.innerIp,this.ww,this.Br)},i}();s.default=u},{"../../../common/basic/env":3,"../../../common/utils/global":9,"../../../common/utils/ks-log":12,"../../../common/utils/string-utils":17,"../../../common/utils/url-parser":18,"../base/manager":48,"./supernode-session":58}],58:[function(t,i,s){"use strict";s.__esModule=!0;t("../../../common/utils/ks-log");var n=h(t("../base/session")),a=t("../../../ks-p2ploader-events"),e=h(t("../../core/loader/ks-loader")),o=t("../../core/loader/base-loader"),u=(h(t("../../../common/utils/url-parser")),t("../../core/meta/piece"),h(t("./request-range"))),c=t("../base/message"),f=h(c),l=h(t("../../../common/utils/ks-buffer")),v=(h(t("../../../common/basic/env")),h(t("../../../common/basic/version")),h(t("../../../common/utils/global"))),m=h(t("../../../common/utils/string-utils"));h(t("../base/manager")),t("../../tools/collector/traffic");function h(t){return t&&t.__esModule?t:{default:t}}var r=function(h){function r(t,i,s){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,r);var n=function(t,i){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!i||"object"!=typeof i&&"function"!=typeof i?t:i}(this,h.call(this,t,i,!1));return n.t="SuperNodeSession",n.db=t,n.zm=null,n.Ub=null,n.dh=0,n.Oe=0,n.Ib=0,n.Nb=0,n.kw="",n._b=new u.default,n.h=t.h,n.r=n.h.r,n.gn="supernode",n.Fm="",n.yw=s,n.gw=0,n._w=0,n.Sw="",n.Tw={},n}return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(t,i):t.__proto__=i)}(r,h),r.prototype.destroy=function(){h.prototype.destroy.call(this),this.zm&&(this.zm.zh("cancel"),this.zm.destroy(),this.zm=null),this.yw=null,this.Fm="",this.r=null,this.h=null,this.gw=0,this._w=0,this.Tw=null,this.xb()},r.prototype.jb=function(t){var i=this;i.Ub=setTimeout(function(){i.Lb()},t)},r.prototype.xb=function(){this.Ub&&(clearTimeout(this.Ub),this.Ub=null)},r.prototype.open=function(){return this.s||(h.prototype.open.call(this),this.kb=this.yw.uw+this.yw.iw,this.xn.emit(a.qn.Jn,this),this.Ab()),!0},r.prototype.close=function(){this.s&&(this.xn.emit(a.qn.Kn,this),h.prototype.close.call(this))},r.prototype.gf=function(t,i){var s=0<this.Ib?t-this.Ib:0;return s>v.default.gs&&(this.Oe=this.Nb*v.default.Ss/s),this.Oe},r.prototype.send=function(t){if(t.av)this.$b();else if(this._b.Db)this.r.info(this.t,"super node is still downloading");else if(t._f.empty())this.r.info(this.t,"request is null");else{this.kw=this.yw.fw(),this._b.clear(),this._b.Wb=new f.default;var i=t._f,s=Array.isArray(i),n=0;for(i=s?i:i[Symbol.iterator]();;){var h;if(s){if(n>=i.length)break;h=i[n++]}else{if((n=i.next()).done)break;h=n.value}var r=h;this._b.Wb._f.push_back(r)}var e=t._f.front().Sf;this._b.Sf=e,this._b.qb=e.hr,this._b.Bb=this.kw;var o=t._f.front().Sf.ce,a=t._f.back().Sf.ce+t._f.back().Sf.se-1;this.Fm="bytes="+o+"-"+a,this.Fb()}},r.prototype.Ab=function(){h.prototype.Ab.call(this),this.rl.pn=this.yw.cw(),this.rl.dn="",this.rl.pid=this.yw.Br,this.rl.tid=this.yw.dw,this.rl.ip=String(this.yw.uw+":"+this.yw.iw),this.Tw&&(this.Tw.hasOwnProperty("customid")&&(this.rl.cid=this.Tw.customid),this.Tw.hasOwnProperty("device_name")&&(this.rl.dn=this.Tw.device_name),this.Tw.hasOwnProperty("module")&&(this.rl.m=this.Tw.module),this.Tw.hasOwnProperty("module_ver")&&(this.rl.mv=this.Tw.module_ver),this.Tw.hasOwnProperty("os")&&(this.rl.os=this.Tw.os),this.Tw.hasOwnProperty("geo")&&(this.rl.geo=this.Tw.geo),this.Tw.hasOwnProperty("mac")&&(this.rl.mac=this.Tw.mac),this.Tw.hasOwnProperty("net_type")&&(this.rl.net=this.Tw.net_type),this.Tw.hasOwnProperty("nat_type")&&(this.rl.nat=this.Tw.nat_type),this.Tw.hasOwnProperty("tid")&&(this.rl.tid=this.Tw.tid),this.Tw.hasOwnProperty("play_type")&&(this.rl.pt=this.Tw.play_type))},r.prototype.Ew=function(t){var i=t,s=Array.isArray(i),n=0;for(i=s?i:i[Symbol.iterator]();;){var h;if(s){if(n>=i.length)break;h=i[n++]}else{if((n=i.next()).done)break;h=n.value}var r=h,e=r[0],o=r[1];if(this.r.trace(this.t,"key("+e+"), value("+o+")"),"server-info"===e.toLowerCase()){this.Sw=o;break}}m.default.isEmpty(this.Sw)||(this.Tw=JSON.parse(m.default.M(this.Sw)),this.Ab(),0==this._w&&(this._w=this.dh-this.qe,this.xn.emit(a.qn.Jn,this,this._w)))},r.prototype.Fb=function(){var i=this;this.s&&(this._b.Db=!0,this.xb(),this.jb(4e3),null!=this.zm&&(this.zm.zh("cancel"),this.zm.destroy(),this.zm=null),this.ch.vh=this._b.Bb,this.zm=e.default.Kh(this.r),this.zm.in.set("Client-Info",m.default.st(this.db.Gb())),this.zm.it("supernode-range-data").open(this._b.Bb,this.Fm,this.db.ch.Kr._r),this.qe=v.default.Ai(),this.zm.on(o.KsloaderEvents.ON_DOWNLOAD_DATA,function(t){i.s&&i.zm===t?(i.dh=v.default.Ai(),m.default.isEmpty(i.Sw)&&i.Ew(i.zm.Rh),i.zb(t,!0)):i.r.info(i.t,"["+i.ch.Kr.hr+"]Expired http complete for tag, ignore")}),this.zm.on(o.KsloaderEvents.ON_DOWNLOAD_COMPLETED,function(t){i.s&&i.zm===t?(i.ch.vh=i._b.Bb,i.dh=v.default.Ai(),m.default.isEmpty(i.Sw)&&i.Ew(i.zm.Rh),i.xb(),!t.Mh||t.N<200||300<=t.N?i.Aw():(i.zb(t),i.zm.destroy(),i.zm=null,i._b.Db=!1)):i.r.info(i.t,"["+i.ch.Kr.hr+"]Expired http complete for tag, ignore")}))},r.prototype.Aw=function(){var i=this;this.wait(100).then(function(){i.s&&i.db.tw(i)}).catch(function(t){i.r.info(i.t,"error:"+t)})},r.prototype.Vb=function(){var i=this;this.wait(1e3).then(function(){i.s&&i.Lb()}).catch(function(t){i.r.info(i.t,"error:"+t)})},r.prototype.wait=function(s){return new Promise(function(t,i){setTimeout(t,s)})},r.prototype.isBusy=function(){return this._b.Db},r.prototype.Lb=function(){this.s&&(this.r.info(this.t,"super node("+this.kb+") range request is timeout..., receive piece("+this._b.Hb+"/"+this._b.Wb._f.size()+"), url("+this._b.Bb+")"),this.ch.vh=this._b.Bb,this.zm&&(this.zb(this.zm),this.zm.destroy()),this.zm=null,this._b.Db=!1)},r.prototype.zb=function(t){var i=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(this._b.Hb<this._b.Wb._f.size()){this.Oe=t.Lh,this.Nb=t.j;for(var s=new f.default,n=(s.ef=this)._b.Hb;n<this._b.Wb._f.size();n++){var h=new c.ResponseDataItem,r=this._b.Wb._f.at(n).Sf;if(h.ho=t.Mh?t.N:-1,h.hr=r.hr,h.el=r.Br,this._b.Jb+r.se>t.$.size()){if(i)break;this.r.trace(this.t,"["+this.ch.Kr.Fe()+"]Truncated response data from("+this.kb+"), size("+t.$.size()+"), offset("+this._b.Jb+"), piece size("+r.se+"), response size("+s.Ef.size()+")"),this._b.Jb+=r.se}else h.data=new l.default(r.se),h.data.append(t.$.subarray(this._b.Jb,r.se)),this._b.Jb+=r.se;this._b.Hb++,s.Ef.push_back(h)}s.empty()||(this.ch.vh=this._b.Bb,this.xn.emit(a.qn.Gn,s))}},r.prototype.Kb=function(t){return 0},r.prototype.$b=function(){this.xb(),this.zm&&(this.zm.zh("cancel"),this.zm.destroy()),this.zm=null,this._b.Db=!1},r}(n.default);s.default=r},{"../../../common/basic/env":3,"../../../common/basic/version":5,"../../../common/utils/global":9,"../../../common/utils/ks-buffer":11,"../../../common/utils/ks-log":12,"../../../common/utils/string-utils":17,"../../../common/utils/url-parser":18,"../../../ks-p2ploader-events":21,"../../core/loader/base-loader":23,"../../core/loader/ks-loader":26,"../../core/meta/piece":30,"../../tools/collector/traffic":65,"../base/manager":48,"../base/message":49,"../base/session":51,"./request-range":55}],59:[function(t,i,s){"use strict";s.__esModule=!0;var n,h=t("./report-base");var r=function(s){function n(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,n);var i=function(t,i){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!i||"object"!=typeof i&&"function"!=typeof i?t:i}(this,s.call(this,t));return i.Mw=0,i.Cw=1,i.Ow=new Map,i.Rw=n.cloadArray,i.Pw="err-cload",i}return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(t,i):t.__proto__=i)}(n,s),n.prototype.destroy=function(){s.prototype.destroy.call(this),this.Mw=0,this.Cw=1,this.Ow.clear(),this.Ow=null},n.prototype.Uw=function(t){if(t){var i=t.N.toString(),s=t.yh+","+t.gh,n=t._h;if(!1===this.Ow.has(i)){var h=new Map;h.set(s,new Map([["path",n],["count",1]])),this.Ow.set(i,h)}else if(!1===this.Ow.get(i).has(s))this.Ow.get(i).set(s,new Map([["path",n],["count",1]]));else{var r=this.Ow.get(i).get(s).get("count")+1;this.Ow.get(i).get(s).set("count",r)}this.Mw++}},n.prototype.Iw=function(){if(0===this.Ow.size)return"{501,()}";this.Nw="{501";var t=this.Ow,i=Array.isArray(t),s=0;for(t=i?t:t[Symbol.iterator]();;){var n;if(i){if(s>=t.length)break;n=t[s++]}else{if((s=t.next()).done)break;n=s.value}var h=n,r=h[0],e=h[1],o=Array.isArray(e),a=0;for(e=o?e:e[Symbol.iterator]();;){var u;if(o){if(a>=e.length)break;u=e[a++]}else{if((a=e.next()).done)break;u=a.value}var c=u,f=c[0],l=c[1],v=f,m=l.get("count"),p=l.get("path");this.Nw+=",("+m+","+r+","+v+","+p+")"}}this.Nw+="}"},n.prototype.xw=function(){return this.Mw===this.Cw&&(this.Cw*=2,!0)},n}(((n=h)&&n.__esModule?n:{default:n}).default);(s.default=r).cloadArray=[["err_info",2]]},{"./report-base":60}],60:[function(t,i,s){"use strict";s.__esModule=!0,s.ErrorInfo=s.HttpP2PInfo=s.HttpInfo_v1=s.VType=void 0;t("../../../common/utils/ks-log"),a(t("../../../common/basic/env"));var h=a(t("../../../common/utils/url-parser")),n=a(t("../../../common/basic/version")),r=t("../../../common/utils/md5"),u=a(t("../../../common/utils/string-utils")),e=a(t("../../../common/utils/ks-array")),o=a(t("../../../common/utils/global"));function a(t){return t&&t.__esModule?t:{default:t}}function c(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}var f=function(){function n(t,i,s){c(this,n),this.Zs=n.kReportMethodPost,this.Bb=t,this.jw=i,this.Lw=s,this.$w=o.default.Ai()}return n.prototype.Dw=function(){return 0<=o.default.Ai()-this.$w},n}();f.kReportMethodGet=1,f.kReportMethodPost=2;var l=s.VType={Cb:1,Ww:2,qw:3},v=(s.HttpInfo_v1=function(){function h(t,i,s,n){c(this,h),this.Bw=s,this.Fw=t,this.zw=n,this.Vw=i}return h.prototype.toString=function(){return"("+this.Fw+","+this.Vw+","+this.Bw+","+this.zw+")"},h}(),s.HttpP2PInfo=function(){function i(t){c(this,i),this.Hw=t}return i.prototype.toJSONString=function(){return JSON.stringify(this.Hw)},i.prototype.toJSON=function(){return JSON.parse(this.toJSONString())},i}(),s.ErrorInfo=function(){function h(t,i,s,n){c(this,h),this.sl=t,this.Fw=i,this.Jw=s,this.Tn=n}return h.prototype.toString=function(){return"("+this.sl+","+this.Fw+","+this.Jw+","+this.Tn+")"},h}()),m=function(){function i(t){c(this,i),this.t="ReportBase",this.ch=t,this.h=t.h,this.r=this.h.r,this.Kr=this.ch.Kr,this.Kw="",this.Pw="",this.Rw=null,this.Gw={},this.Qw={},this.Xw=new e.default,this.Yw="",this.Zw=[],this.Qw.log_ver="20151222_01",this.Qw.ak="",this.Qw.dev_model="",this.Qw.platform=this.h.Di,this.Qw.sdk_type=this.h.K,this.Qw.os_ver="",this.Qw.dev_id="",this.Qw.pkg="com.ksp2ploader",this.Qw.sdk_ver=n.default.Z(),this.tk=new e.default,this.Nw="",this.ik=[["act",2],["body_type",2],["module",2],["module_ver",2],["tid",1],["customid",2],["device_name",2],["app_name",2],["app_ver",2],["sdk_ver",2],["os",2],["os_ver",2],["arch",2],["deviceid",2],["mac",2],["net_type",2],["uuid",2],["groupid",2],["starttime",1],["time",1],["play_type",2],["vf",2],["mt",2],["dur",1],["geo",2],["local_time",1],["playurl",2]],this.sk=[["ct",1],["frt",1],["ip",2],["pt",1],["ret",1],["rt",1],["tb",1],["tt",1]]}return i.prototype.destroy=function(){this.Kr=null,this.Gw=null,this.Xw=null,this.tk=null,this.Yw="",this.Zw=[],this.nk="",this.Nw="",this.ch=null,this.r=null,this.h=null},i.prototype.hk=function(t,i){var s=i,n=Array.isArray(s),h=0;for(s=n?s:s[Symbol.iterator]();;){var r;if(n){if(h>=s.length)break;r=s[h++]}else{if((h=s.next()).done)break;r=h.value}var e=r,o=e[0],a=e[1];t.hasOwnProperty(o)&&!u.default._(t[o])?this.Gw[o]=t[o]:this.Gw[o]=l.Cb===a?0:""}},i.prototype.tidy=function(){this.Gw={}},i.prototype.toValue=function(t){var i=new h.default;i.fromString(this.ch._i.url),t.playurl_host=i._n,t.playurl_path=i.Tn,t.playurl_stream=i.An,t.playurl=this.ch._i.url,t.kcgport=0,t.kcgid=this.h.T,t.termid=this.ch.Ba,t.p2p=this.h.ei?1:0,t["p-wsoc"]=this.ch.Iu?0:1,t["p-rtc"]=this.ch.xu?0:1,t["p-rtmfp"]=this.ch.Uu?0:1,t.playingPos=this.ch.Ru,t.maxTs=this.Kr.Vr.Re,t.userdata="",t.http_info_J=this.Zw,t.act=this.Pw,t.body_type="kcgv2-"+this.Pw,t.module=this.h.K,t.module_ver=n.default.Z(),t.tid=1,t.customid=this.h.H,t.mt=this.h.J,t.device_name="",t.app_name=this.h.X,t.app_ver=this.h.Y,t.sdk_ver="",t.os=this.h.G,t.os_ver=this.h.Q?this.h.Q:"",t.arch="",t.deviceid=this.h.T,t.mac="",t.net_type="wifi",t.uuid=this.ch.fr,t.groupid=this.Kr.pe,t.starttime=this.ch.dc,t.time=Math.floor(o.default.Ai()/1e3),t.play_type=this.ch.La,t.vf=this.ch.Da,t.dur=0,t.geo=this.ch.qa,t.local_time=o.default.Ai(),t.playurl=this.ch._i.url,t.err_info=this.Nw;try{var s=window.player.getSession();t.b_session=s}catch(t){}},i.prototype.rk=function(){var t={};t.batch_id=this.h.T+(o.default.Ai()+""),t.log_total=1;var i=o.default.vs(Math.floor(o.default.Ai()/1e3),!0).toString();i=i.slice(0,i.length-4),t.batch_date=i;var s=[];s.push(this.Gw),t.log_array=s,this.Gw=t},i.prototype.ek=function(){return JSON.stringify(this.Gw)},i.prototype.uk=function(t){var i=Math.floor(o.default.Ai()/1e3).toString(),s=r.Md5.R("p2p-kcgcdd0b4ce59200266ee700c856d6033m5"+i).toLowerCase(),n=new h.default;return n._n=this.h.W.ut,n.gn="https",n.En="/v2/log/p2p-kcg/upload",n.set("s",s).set("t",i),n.toString()},i.prototype.ck=function(){var t={};return this.fk(),this.Iw(),this.lk(),this.toValue(t),this.hk(t,this.ik),this.hk(t,this.Rw),this.rk(),this.uk(this.ek())},i.prototype.vk=function(){return new f(this.ck(),this.ek(),this.Pw)},i.prototype.mk=function(t){return new f(this.uk(t),t,this.Pw)},i.prototype.Gf=function(t){if(null!==t){for(var i=new Object,s=0;s<this.sk.length;s++){var n=this.sk[s],h=n[0];switch(h){case"ct":case"frt":case"rt":i[h]=1===n[1]?0:"";break;case"ip":i[h]=t.yh;break;case"pt":i[h]=t.gh;break;case"ret":i[h]=t.N;break;case"tb":i[h]=t.j;break;case"tt":i[h]=Math.max(t.xh,t.jh)}}this.Xw.push(i)}},i.prototype.fk=function(){if(this.Xw.empty())return this.Zw=[];var t=new Array,i=this.Xw,s=Array.isArray(i),n=0;for(i=s?i:i[Symbol.iterator]();;){var h;if(s){if(n>=i.length)break;h=i[n++]}else{if((n=i.next()).done)break;h=n.value}var r=h;t.push(r)}this.Zw=t},i.prototype.Uw=function(t){null!=t&&this.tk.push(new v(1,t.N,t.yh+":"+t.gh,t._h))},i.prototype.Iw=function(){if(this.tk.empty())return this.Nw="{501,()}";this.Nw="{501";var t=this.tk,i=Array.isArray(t),s=0;for(t=i?t:t[Symbol.iterator]();;){var n;if(i){if(s>=t.length)break;n=t[s++]}else{if((s=t.next()).done)break;n=s.value}var h=n;this.Nw+=","+h.toString()}this.Nw+="}"},i.prototype.lk=function(){},i}();(s.default=m).Mb=[["cid",2],["ct",1],["dn",2],["drs",1],["ds",1],["geo",2],["ip",2],["m",2],["mac",2],["mv",1],["nat",1],["net",2],["os",2],["pid",2],["pn",2],["pt",2],["sp",1],["tid",1],["tps",1],["us",1],["ut",1]]},{"../../../common/basic/env":3,"../../../common/basic/version":5,"../../../common/utils/global":9,"../../../common/utils/ks-array":10,"../../../common/utils/ks-log":12,"../../../common/utils/md5":16,"../../../common/utils/string-utils":17,"../../../common/utils/url-parser":18}],61:[function(t,i,s){"use strict";s.__esModule=!0;l(t("../../../common/basic/env"));var n=l(t("./traffic")),v=t("./stage"),r=l(v),h=l(t("./reporter")),e=(t("../../../common/utils/ks-log"),l(t("../../../common/basic/error"))),o=t("./stage-error"),a=l(o),u=t("../../protocol/base/manager"),c=l(t("./cload-error")),f=l(t("../../../common/utils/global"));function l(t){return t&&t.__esModule?t:{default:t}}var m=function(){function i(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,i),this.t="ReportClient",this.s=!1,this.ch=t,this.h=t.h,this.r=this.h.r,this.pk=null,this.dk=null,this.bk=new h.default(t.h),this.wk=null,this.kk=null,this.yk=null,this.gk=0,this._k=null,this.Sk=3e3}return i.prototype.destroy=function(){this.close(),this.r&&this.r.info(this.t,"destroy()"),this.r=null,this.h=null,this.ch=null,this.pk=null,this.bk=null,this.wk=null,this.kk=null,this.Tk=null,this.gk=0,this._k=null},i.prototype.open=function(){var t=this;return this.s||(this.pk=new n.default(this.ch),this.s=!0,this.bk.open(),this.kk=new Map,this.Tk=new Map,this.Ek(this.kk,r.default.Ak),this.Ek(this.Tk,a.default.Ak),this.Mk(),this.Ck(),this.Ok(1e3*this.ch.Ha),this.Oi=setInterval(function(){t.s&&t.pk.tp()},3e3)),this},i.prototype.close=function(){this.s&&(this.s=!1,this.bk.close(),this.Rk(),this.Oi&&clearInterval(this.Oi),this.Oi=null,this.kk=null,this.Tk=null)},i.prototype.Rk=function(){this.dk&&(clearTimeout(this.dk),this.dk=null)},i.prototype.Ok=function(t){var i=this;this.dk=setTimeout(function(){i.Pk()},t)},i.prototype.Pk=function(){this.s&&(this.Uk(),this.Ok(1e3*this.ch.Ha))},i.prototype.Ck=function(){var t=this.pk.Ik();if(0!==t.length){var i=t,s=Array.isArray(i),n=0;for(i=s?i:i[Symbol.iterator]();;){var h;if(s){if(n>=i.length)break;h=i[n++]}else{if((n=i.next()).done)break;h=n.value}var r=h,e=r.k,o=r.v,a=this.pk.mk(o);a.$w=f.default.Ai()+this.Sk,this.bk.Nk(a),this.pk.xk(e)}}},i.prototype.Uk=function(){var t=this.pk.vk();this.pk.tidy(),this.pk.xk(),this.bk.Nk(t)},i.prototype.Pa=function(t,i){var s=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(i!==e.default.Bi)return this.Jm(t,i,s);if(!0!==this.jk(t,this.kk)){var n=new r.default(this.ch,t);n.Gf(s);var h=n.vk();h.$w=f.default.Ai()+this.Sk,this.bk.Nk(h),this.Lk(t,!0,this.kk)}},i.prototype.$k=function(){},i.prototype.Ek=function(t,i){var s=i,n=Array.isArray(s),h=0;for(s=n?s:s[Symbol.iterator]();;){var r;if(n){if(h>=s.length)break;r=s[h++]}else{if((h=s.next()).done)break;r=h.value}var e=r,o=e[0];e[1],e[2];t.set(o,!1)}},i.prototype.Mk=function(){if(!(this._k&&0<this._k.length)){this._k=[];var t=r.default.fstimeSub,i=Array.isArray(t),s=0;for(t=i?t:t[Symbol.iterator]();;){var n;if(i){if(s>=t.length)break;n=t[s++]}else{if((s=t.next()).done)break;n=s.value}var h=n;this._k.push([h,0])}}},i.prototype.jk=function(t,i){return!i||!i.has(t)||i.get(t)},i.prototype.Lk=function(t,i,s){s&&s.has(t)&&s.set(t,i)},i.prototype.Jm=function(t,i){var s=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(i!==e.default.Bi){if(t===o.StageErrorAction.Qf)return this.Dk(t,i,s);if(!0!==this.jk(t,this.Tk)){var n=new a.default(this.ch,t);this.Wk(t,i,s),n.Uw(s);var h=n.vk();this.bk.Nk(h),this.Lk(t,!0,this.Tk)}}},i.prototype.Wk=function(t,i){var s=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(t!==o.StageErrorAction.Ua&&i!==e.default.Bi){var n=i===e.default.Fi?20:29;t!==o.StageErrorAction.Tl?s&&-1===s.N&&(s.N=n):-1===this.ch.Xu&&(this.ch.Xu=n)}},i.prototype.Dk=function(t,i,s){if(this.wk||(this.wk=new c.default(this.ch)),this.Wk(t,i,s),this.wk.Uw(s),!0===this.wk.xw()){var n=this.wk.vk();this.wk.tidy(),this.bk.Nk(n)}},i.prototype.qk=function(t){this.pk.qk(t)},i.prototype.Lm=function(){this.pk.Lm()},i.prototype.$m=function(){this.pk.$m()},i.prototype.Rl=function(t,i){this.pk.Rl(t,i)},i.prototype.Bk=function(){},i.prototype.pl=function(t,i){var s=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;4<arguments.length&&void 0!==arguments[4]&&arguments[4];this.pk.pl(t.al(),t.ul(),i,s,n)},i.prototype.xm=function(t,i){if(!0!==this.jk(v.StageAction.Fk,this.kk)){this.gk+=i;var s=this._k,n=Array.isArray(s),h=0;for(s=n?s:s[Symbol.iterator]();;){var r;if(n){if(h>=s.length)break;r=s[h++]}else{if((h=s.next()).done)break;r=h.value}var e=r;this.gk>=e[0]&&0===e[1]&&(e[1]=t)}if(0<this._k[this._k.length-1][1]){var o=[],a=this._k,u=Array.isArray(a),c=0;for(a=u?a:a[Symbol.iterator]();;){var f;if(u){if(c>=a.length)break;f=a[c++]}else{if((c=a.next()).done)break;f=c.value}var l=f;o.push(l[0]+":"+l[1])}this.ch.Mc="{"+o.toString()+"}",this.Pa(v.StageAction.Fk,0)}}},i.prototype.Gf=function(t){this.pk.Gf(t)},i.prototype.fl=function(t,i,s){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,h=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0;this.pk.fl(t,i,s,n,h)},i.prototype.ol=function(t,i,s){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;this.pk.ol(t,i,s,n)},i.prototype.Em=function(t,i){var s=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;this.pk.Em(t,i,s)},i.prototype.vl=function(t,i,s){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,h=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0;t!=u.ae.oe&&1===s&&this.Jm(o.StageErrorAction.yl,20),this.pk.vl(t,i,s,n,h)},i.prototype.Ml=function(t,i){this.pk.Ml(t,i)},i}();s.default=m},{"../../../common/basic/env":3,"../../../common/basic/error":4,"../../../common/utils/global":9,"../../../common/utils/ks-log":12,"../../protocol/base/manager":48,"./cload-error":59,"./reporter":62,"./stage":64,"./stage-error":63,"./traffic":65}],62:[function(t,i,s){"use strict";s.__esModule=!0;var n=e(t("../../core/loader/ks-httploader")),h=e(t("../../../common/utils/ks-array")),r=e(t("../../../common/utils/global"));function e(t){return t&&t.__esModule?t:{default:t}}var o=function(){function i(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,i),this.t="Reporter",this.s=!1,this.h=t,this.r=this.h.r,this.o=new n.default(this),this.zk=new h.default}return i.prototype.destroy=function(){this.close(),this.o=null,this.r=null,this.h=null},i.prototype.open=function(){this.s||(this.s=!0)},i.prototype.close=function(){this.s=!1,this.o&&this.o.close()},i.prototype.Vk=function(t){this.Nk(t)},i.prototype.Nk=function(t){this.zk.push(t),this.Hk()},i.prototype.Jk=function(){return this.zk.erase(this.zk.findIndex(function(t){if(t.Dw())return!0}))},i.prototype.Kk=function(){if(this.r&&this.r.info(this.t,"reportNext_, isOpen_ = "+this.s+", loader_.isIdle() = "+this.o.isIdle()+", this.waitReport_.empty() = "+this.zk.empty()),this.s&&this.o.isIdle()&&!this.zk.empty()){var t=this.Jk();if(t){var i=t[0],s=this.o.create();s.Zs="POST",s.tn=i.jw,s.in.set("Content-Type","application/json"),s.in.set("charset","UTF-8"),this.o.setTimer("report",10*r.default.b,s).it("reporter").open(i.Bb)}else this.Hk(1e3)}},i.prototype.Hk=function(){var t=this,i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;setTimeout(function(){t.Kk()},i)},i.prototype.U=function(t,i){this.s&&this.Hk()},i.prototype.I=function(t){this.s&&"reporter"===t.getTag()&&(this.o.clearTimer(),this.Hk())},i}();s.default=o},{"../../../common/utils/global":9,"../../../common/utils/ks-array":10,"../../core/loader/ks-httploader":25}],63:[function(t,i,s){"use strict";s.__esModule=!0,s.StageErrorAction=void 0;var h=t("./report-base"),n=e(h),r=e(t("../../../common/utils/url-parser"));function e(t){return t&&t.__esModule?t:{default:t}}var o=s.StageErrorAction={Ua:0,Gk:1,Km:2,Kf:3,gl:4,Qk:5,El:6,Tl:7,yl:8,Xk:9,Qf:10,Fk:11},a=function(n){function a(t,i){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,a);var s=function(t,i){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!i||"object"!=typeof i&&"function"!=typeof i?t:i}(this,n.call(this,t));return s.t="StageError",s.Kw=i,s.ho=0,s.Yk="",s.Zk=0,s.ty=0,s.iy="",s.initParam(),s}return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(t,i):t.__proto__=i)}(a,n),a.prototype.initParam=function(){var t=a.Ak,i=Array.isArray(t),s=0;for(t=i?t:t[Symbol.iterator]();;){var n;if(i){if(s>=t.length)break;n=t[s++]}else{if((s=t.next()).done)break;n=s.value}var h=n,r=h[0],e=h[1],o=h[2];if(this.Kw===r){this.Rw=e,this.Pw=o;break}}},a.prototype.toValue=function(t){if(n.prototype.toValue.call(this,t),o.Tl===this.Kw){this.iy=this.ch.Ec,this.ty=this.ch.Gu;var i=new r.default(this.ch.qu);this.Yk=i._n,this.Zk=i.Sn}if(o.El===this.Kw){this.iy=this.ch.Tc,this.ty=this.ch.Ku;var s=new r.default(this.ch.Du);this.Yk=s._n,this.Zk=s.Sn}t.server_ip=this.Yk,t.server_port=this.Zk,t.avgu_time=this.ty},a.prototype.Uw=function(t){if(this.Kw!==o.Tl)return n.prototype.Uw.call(this,t);var i=new r.default(this.ch.qu);this.tk.push(new h.ErrorInfo(1,Math.max(0,this.ch.Xu),i._n+":"+i.Sn,i.Tn))},a}(n.default);(s.default=a).initArray=[],a.gslbArray=[["avgu_time",1],["err_info",2]],a.chkArray=[["avgu_time",1],["err_info",2]],a.cloadArray=[["avgu_time",1],["err_info",2]],a.selArray=[["avgu_time",1],["err_info",2]],a.rtmArray=[["avgu_time",1],["err_info",2],["server_ip",2],["server_port",1]],a.httpArray=[["avgu_time",1],["err_info",2],["server_ip",2],["server_port",1]],a.rtcArray=[["avgu_time",1],["err_info",2],["server_ip",2],["server_port",1]],a.pieArray=[["geo",2]],a.Ak=[[o.Ua,a.initArray,"err-init"],[o.Gk,a.gslbArray,"err-gslb"],[o.Km,a.chkArray,"err-chk"],[o.Kf,a.cloadArray,"err-cload"],[o.gl,a.selArray,"err-pslb"],[o.Qk,a.rtmArray,"err-rtm"],[o.El,a.httpArray,"err-http"],[o.Tl,a.rtcArray,"err-rtc"],[o.yl,a.pieArray,"err-pie"],[o.Xk,a.upnpArray,"err-upnp"],[o.Fk,a.fstimeArray,"err-fstime"]]},{"../../../common/utils/url-parser":18,"./report-base":60}],64:[function(t,i,s){"use strict";s.__esModule=!0,s.StageAction=void 0;var n=r(t("./report-base")),h=r(t("../../../common/utils/url-parser"));function r(t){return t&&t.__esModule?t:{default:t}}var e=s.StageAction={Ua:0,Gk:1,Km:2,Kf:3,gl:4,Qk:5,El:6,Tl:7,yl:8,Xk:9,Qf:10,Fk:11},o=function(n){function a(t,i){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,a);var s=function(t,i){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!i||"object"!=typeof i&&"function"!=typeof i?t:i}(this,n.call(this,t));return s.t="Stage",s.Kw=i,s.ho=0,s.Yk="",s.Zk=0,s.ty=0,s.iy="",s.initParam(),s}return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(t,i):t.__proto__=i)}(a,n),a.prototype.initParam=function(){var t=a.Ak,i=Array.isArray(t),s=0;for(t=i?t:t[Symbol.iterator]();;){var n;if(i){if(s>=t.length)break;n=t[s++]}else{if((s=t.next()).done)break;n=s.value}var h=n,r=h[0],e=h[1],o=h[2];if(this.Kw===r){this.Rw=e,this.Pw=o;break}}},a.prototype.toValue=function(t){if(n.prototype.toValue.call(this,t),e.Tl===this.Kw){this.iy=this.ch.Ec,this.ty=this.ch.Gu;var i=new h.default(this.ch.qu);this.Yk=i._n,this.Zk=i.Sn}if(e.El===this.Kw){this.iy=this.ch.Tc,this.ty=this.ch.Ku;var s=new h.default(this.ch.Du);this.Yk=s._n,this.Zk=s.Sn}t.server_ip=this.Yk,t.server_port=this.Zk,t.avgu_time=this.ty,t.fstime=this.ch.Mc},a.prototype.Gf=function(t){if(this.Kw!==e.Tl)return n.prototype.Gf.call(this,t);var i=new h.default(this.ch.qu);this.Xw.push({ct:0,frt:0,ip:i._n,pt:i.Sn,ret:Math.max(0,this.ch.Xu),rt:0,tb:0,tt:this.ch.Gu})},a}(n.default);(s.default=o).initArray=[],o.gslbArray=[["avgu_time",1],["http_info",2]],o.chkArray=[["avgu_time",1],["http_info",2]],o.cloadArray=[["avgu_time",1],["http_info",2]],o.selArray=[["avgu_time",1],["http_info",2]],o.rtmArray=[["avgu_time",1],["http_info",2],["server_ip",2],["server_port",1]],o.httpArray=[["avgu_time",1],["http_info",2],["server_ip",2],["server_port",1]],o.rtcArray=[["avgu_time",1],["http_info",2],["server_ip",2],["server_port",1]],o.pieArray=[],o.fstimeArray=[["fstime",2]],o.fstimeSub=[500,1e3,1500],o.Ak=[[e.Ua,o.initArray,"init"],[e.Gk,o.gslbArray,"gslb"],[e.Km,o.chkArray,"chk"],[e.Kf,o.cloadArray,"cload"],[e.gl,o.selArray,"pslb"],[e.Qk,o.rtmArray,"rtm"],[e.El,o.httpArray,"http"],[e.Tl,o.rtcArray,"rtc"],[e.yl,o.pieArray,"pie"],[e.Xk,o.upnpArray,"upnp"],[e.Fk,o.fstimeArray,"fstime"]]},{"../../../common/utils/url-parser":18,"./report-base":60}],65:[function(t,i,s){"use strict";s.__esModule=!0,s.P2PInfo=void 0;var e=t("../../protocol/base/manager"),u=t("./report-base"),c=n(u),a=(n(t("../../../common/utils/local-store")),n(t("../../../common/utils/string-utils"))),f=n(t("../../../common/utils/global"));function n(t){return t&&t.__esModule?t:{default:t}}var p=s.P2PInfo={sy:"pn",ny:"us",hy:"ds",ry:"tps",ey:"ut",oy:"drs",ay:"speed",uy:"ct",cy:"pid",fy:"cid",ly:"tid",vy:"dn",my:"m",py:"mv",dy:"os",by:"address",wy:"geo",ky:"mac",yy:"net",gy:"nat",_y:"pt",Sy:"ip"},h=function(s){function r(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,r);var i=function(t,i){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!i||"object"!=typeof i&&"function"!=typeof i?t:i}(this,s.call(this,t));return i.t="Traffic",i.ch=t,i.Ty=0,i.Ey=0,i.Ay=0,i.My=0,i.Cy=0,i.Oy=0,i.Ry=0,i.Py=0,i.Uy=0,i.Iy=0,i.Ny=0,i.xy=0,i.jy=0,i.Ly=0,i.$y=0,i.Dy=0,i.Wy=0,i.qy=0,i.By=0,i.Fy=0,i.zy=0,i.Vy=0,i.Hy=0,i.Jy=0,i.Ky=0,i.Gy=0,i.Qy=0,i.Xy=0,i.Yy=0,i.Zy=0,i.tg=0,i.ig=0,i.sg=0,i.ng=0,i.hg=0,i.rg=0,i.eg=0,i.og=0,i.ag=0,i.ug=0,i.cg=0,i.fg=0,i.lg=0,i.vg=0,i.mg=0,i.pg=0,i.dg=0,i.bg=0,i.wg=0,i.kg=0,i.yg=0,i._g=0,i.Sg=0,i.Tg=0,i.Eg=!1,i.Ag=0,i.h=t.h,i.Rw=r.trafficArray,i.Pw="hb",i.Mg="kcg.tfc_",i.Df=new Map,i.nk="",i.Cg=[],i.Og=new Set,i.Rg=new Set,i.Pg=new Set,i.empty_count=0,i.empty_time=0,i.Ug=[],i.Ig=!1,i}return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(t,i):t.__proto__=i)}(r,s),r.prototype.destroy=function(){this.Ng(),this.Ug=null,this.h=null},r.prototype.Ik=function(){var r=this,e=this.h.n,o=[];return e.each(function(t){var i=e.get(t);if(-1!==t.indexOf(r.Mg)){var s=i.split("_");if(2===s.length){var n=a.default.Hs(s[0]);if(6e4<f.default.Ai()-n){var h=a.default.M(s[1]);o.push({k:t,v:h})}}}}),o},r.prototype.xk=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",i=this.h.n,s=""===t?this.Mg+this.ch.Oa:t;i.remove(s)},r.prototype.tp=function(){var t=this.h.n,i={};this.fk(),this.Iw(),this.lk(),this.toValue(i),this.hk(i,this.ik),this.hk(i,r.trafficArray),this.Gw.report_old=1,this.rk();var s=f.default.Ai(),n=this.Mg+this.ch.Oa,h=s+"_"+a.default.st(this.ek());t.set(n,h),this.Gw={}},r.prototype.toValue=function(t){s.prototype.toValue.call(this,t),t.hw=this.h.$i,t.fsize=this.Uy+this.Ay,t.asize=this.Iy+this.My,t.isize=this.Ny+this.Cy,t.hsize=this.xy+this.Oy,t["fsize-rtc"]=this.Uy,t["isize-rtc"]=this.Ny,t["asize-rtc"]=this.Iy,t["hsize-rtc"]=this.xy,t["fsize-wsoc"]=this.Ay,t["isize-wsoc"]=this.Cy,t["asize-wsoc"]=this.My,t["hsize-wsoc"]=this.Oy,t["player-rtmfp"]=this.$y,t["player-wsoc"]=this.Dy,t["player-rtc"]=this.Wy,t["player-supernode"]=this.qy,t["up-rtmfp"]=0,t["up-rtc"]=this.dg,t["up-wsoc"]=this.pg,t.csize=this.Ty,t.psize_download=this.Ey+this.Py+this.jy,t.psize_upload=this.dg+this.pg,t.player_cdn=this.Ly,t.player_p2p=this.$y+this.Dy+this.Wy+this.qy,t.lcsize=this.By,t.lpsize=this.Fy,t.tnode=this.ch.hc+this.ch.ec+this.ch.ic,t.anode=this.Og.size+this.Rg.size+this.Pg.size,t.anode_https=this.Pg.size,t.anode_http=0,t.anode_rtmfp=0,t.anode_rtc=0,t.anode_wsoc=0,t.dnode_rtmfp=0,t.lnode_rtmfp=0,t.dnode_rtc=this.ch.nc,t.lnode_rtc=this.ch.hc,t.dnode_wsoc=this.ch.rc,t.lnode_wsoc=this.ch.ec,t.dnode_https=this.ch.fc,t.lnode_https=this.ch.ic,t.dnode_http=0,t.lnode_http=0,t.chk0=this.bg,t.chk1=this.Sg,t.chk2=this.wg,t.chk3=this.kg,t.chk4=this._g,t.chk5=this.yg,t.p2p_info_J=this.Cg,t.pcont=0,t.is_loading=0<this.Ug.length?this.Ug.length:0,t.loading_duration=0},r.prototype.tidy=function(){s.prototype.tidy.call(this),this.Eg=!0,this.Ty=0,this.Ey=0,this.Ay=0,this.My=0,this.Cy=0,this.Oy=0,this.Ry=0,this.jy=0,this.mg=0,this.pg=0,this.dg=0,this.bg=0,this.wg=0,this.kg=0,this.yg=0,this._g=0,this.Sg=0,this.Tg=0,this.Ly=0,this.$y=0,this.Dy=0,this.Wy=0,this.qy=0,this.By=0,this.Fy=0,this.Py=0,this.Uy=0,this.Iy=0,this.Ny=0,this.xy=0,this.Ag=0,this.Xw.clear(),this.Zw=[],this.Yw="",this.nk="",this.Cg=[],this.Df.clear(),this.Og.clear(),this.Rg.clear(),this.Pg.clear(),this.Ug=[]},r.prototype.xg=function(){this.zy=0,this.Vy=0,this.Ky=0,this.Gy=0,this.Hy=0,this.Jy=0,this.Yy=0,this.Zy=0,this.tg=0,this.ig=0,this.sg=0,this.ng=0,this.eg=0,this.og=0,this.ag=0,this.ug=0,this.cg=0,this.fg=0},r.prototype.Ml=function(t,i){var s=this.ch;switch(this.Eg&&(this.xg(),this.Eg=!1),t){case e.ae.Zv:this.og++,this.Zy+=i,this.Vy=""===s.bu?-1:Math.floor(this.Zy/this.og);break;case e.ae.tm:this.ug++,this.ig+=i,this.Jy=s.Ku<=0?-1:Math.floor(this.ig/this.ug);break;case e.ae.Sl:this.fg++,this.ng+=i,this.Gy=s.Gu<=0?-1:Math.floor(this.ng/this.fg);break;case e.ae.cd:this.vg++,this.rg+=i,this.Xy=s.Qu<=0?-1:Math.floor(this.rg/this.vg)}var n=0;switch(t){case e.ae.Zv:n=s.Zu;break;case e.ae.tm:n=s.tc;break;case e.ae.Sl:n=s.sc;break;case e.ae.cd:n=s.ic}this.jg(t,n)},r.prototype.jg=function(t,i){switch(t){case e.ae.Zv:this.eg++,this.Yy+=i,this.zy=Math.floor(this.Yy/this.eg);break;case e.ae.tm:this.ag++,this.tg+=i,this.Hy=Math.floor(this.tg/this.ag);break;case e.ae.Sl:this.cg++,this.sg+=i,this.Ky=Math.floor(this.sg/this.cg);break;case e.ae.cd:this.lg++,this.hg+=i,this.Qy=Math.floor(this.hg/this.lg)}},r.prototype.fl=function(t,i,s){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,h=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0;if(!(s<=0)){switch(t){case e.ae.oe:this.By+=s;break;case e.ae.Zv:case e.ae.tm:case e.ae.Sl:case e.ae.cd:this.Fy+=s}n&&t!==e.ae.oe&&(this.qk(n,p.oy,s,h),this.Lg(n))}},r.prototype.Lg=function(t){"webrtc"===t[p.sy]?this.Og.add(t[p.cy]):"websocket"===t[p.sy]?this.Rg.add(t[p.cy]):"https"!==t[p.sy]&&"http"!==t[p.sy]||this.Pg.add(t[p.cy])},r.prototype.pl=function(t,i,s){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,h=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0;if(!(s<=0)){switch(t){case e.ae.oe:this.Ty+=s;break;case e.ae.cd:this.jy+=s;break;case e.ae.Sl:switch(this.Py+=s,i){case e.za.kd:this.Uy+=s;break;case e.za.yd:this.Iy+=s;break;case e.za.gd:this.Ny+=s;break;case e.za.Fa:this.xy+=s;break;default:this.Uy+=s}break;case e.ae.tm:switch(this.Ey+=s,i){case e.za.kd:this.Ay+=s;break;case e.za.yd:this.My+=s;break;case e.za.gd:this.Cy+=s;break;case e.za.Fa:this.Oy+=s;break;default:this.Ay+=s}break;case e.ae.fd:this.Ry+=s}n&&t!==e.ae.oe&&(this.qk(n,p.hy,s,h),this.Lg(n)),this.$g(t,s)}},r.prototype.$g=function(t,i){t===e.ae.oe?this.ch.xa+=i:this.ch.Na+=i},r.prototype.ol=function(t,i,s){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;if(!(s<=0)){switch(t){case e.ae.Zv:this.mg+=s;break;case e.ae.tm:this.pg+=s;break;case e.ae.Sl:this.dg+=s}n&&this.qk(n,p.ny,s)}},r.prototype.Em=function(t,i){var s=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!(i<=0)){switch(t){case e.ae.oe:this.Ly+=i;break;case e.ae.Zv:this.$y+=i;break;case e.ae.tm:this.Dy+=i;break;case e.ae.Sl:this.Wy+=i;break;case e.ae.cd:this.qy+=i}s&&t!==e.ae.oe&&this.qk(s,p.ry,i),t!==e.ae.oe?this.ch.lh+=i:this.ch.fh+=i}},r.prototype.vl=function(t,i,s){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,h=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0;switch(this.bg+=i,t){case e.ae.oe:this.wg+=s;break;case e.ae.Zv:this.kg+=s;break;case e.ae.tm:this.yg+=s;break;case e.ae.Sl:this._g+=s;break;case e.ae.cd:this.Tg+=s;break;default:this.Sg+=s}n&&1===s&&t!==e.ae.oe&&(this.qk(n,p.oy,h),this.Lg(n))},r.prototype.Rl=function(t,i){this.qk(t,p.uy,0,i)},r.prototype.qk=function(t,i,s){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;t.hasOwnProperty(p.cy)&&t[p.cy]&&(!1===this.Df.has(t[p.cy])&&this.Dg(t),this.Wg(t[p.cy],i,s,n))},r.prototype.Dg=function(t){var i=new Map,s=c.default.Mb,n=Array.isArray(s),h=0;for(s=n?s:s[Symbol.iterator]();;){var r;if(n){if(h>=s.length)break;r=s[h++]}else{if((h=s.next()).done)break;r=h.value}var e=r,o=e[0],a=e[1];t.hasOwnProperty(o)?i.set(o,t[o]):i.set(o,u.VType.Cb===a?0:"")}return this.Df.set(t[p.cy],i),!0},r.prototype.Ng=function(){this.Df&&(this.Df.clear(),this.Df=null)},r.prototype.Wg=function(t,i,s){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;if(this.Df.has(t)&&this.Df.get(t).has(i)){var h=this.Df.get(t);if(i!=p.uy){var r=h.get(i)+s;if(h.set(i,r),i===p.oy||i===p.hy){var e=h.get(p.ey)+n;h.set(p.ey,e)}}else h.set("ct",n)}},r.prototype.lk=function(){if(0===this.Df.size)return this.Cg=[];var t=[],i=this.Df.values(),s=Array.isArray(i),n=0;for(i=s?i:i[Symbol.iterator]();;){var h;if(s){if(n>=i.length)break;h=i[n++]}else{if((n=i.next()).done)break;h=n.value}var r=h,e={},o=r,a=Array.isArray(o),u=0;for(o=a?o:o[Symbol.iterator]();;){var c;if(a){if(u>=o.length)break;c=o[u++]}else{if((u=o.next()).done)break;c=u.value}var f=c,l=f[0],v=f[1];e[l]=v}var m=0;0<r.get(p.ey)&&(m=Math.round((r.get(p.hy)+r.get(p.oy))/(r.get(p.ey)/1e3))),e.sp=m,t.push(e)}this.Cg=t},r.prototype.Lm=function(){(0===this.Ug.length||0<this.Ug[this.Ug.length-1][1])&&(this.Ug.push([f.default.Ai(),0]),1<this.Ug.length&&this.h.r.info(this.t,"this.con Empty this.emptyArr_.length= "+this.Ug.length+", arr["+(this.Ug.length-2)+"][0] = "+this.Ug[this.Ug.length-2][0]+", arr["+(this.Ug.length-2)+"][1] = "+this.Ug[this.Ug.length-2][1]),this.h.r.info(this.t,"this.con Empty this.emptyArr_.length= "+this.Ug.length+", arr["+(this.Ug.length-1)+"][0] = "+this.Ug[this.Ug.length-1][0]+", arr["+(this.Ug.length-1)+"][1] = "+this.Ug[this.Ug.length-1][1]))},r.prototype.$m=function(){0<this.Ug.length&&0===this.Ug[this.Ug.length-1][1]&&(this.Ug[this.Ug.length-1][1]=f.default.Ai(),this.h.r.info(this.t,"this.con Full this.emptyArr_.length= "+this.Ug.length+", arr["+(this.Ug.length-1)+"][0] = "+this.Ug[this.Ug.length-1][0]+", arr["+(this.Ug.length-1)+"][1] = "+this.Ug[this.Ug.length-1][1]))},r.prototype.qg=function(){var t=0<arguments.length&&void 0!==arguments[0]&&arguments[0],i=0;0<this.Ug.length&&0===this.Ug[this.Ug.length-1][1]&&(this.Ug[this.Ug.length-1][1]=f.default.Ai());var s=this.Ug,n=Array.isArray(s),h=0;for(s=n?s:s[Symbol.iterator]();;){var r;if(n){if(h>=s.length)break;r=s[h++]}else{if((h=s.next()).done)break;r=h.value}var e=r,o=e[0];i+=e[1]-o}return!0===t&&(this.Ug[this.Ug.length-1][1]=0),i},r}(c.default);(s.default=h).trafficArray=[["csize",1],["psize_download",1],["psize_upload",1],["player_cdn",1],["player_p2p",1],["lcsize",1],["lpsize",1],["tnode",1],["anode",1],["anode_http",1],["anode_https",1],["anode_rtmfp",1],["anode_rtc",1],["anode_wsoc",1],["dnode_rtmfp",1],["lnode_rtmfp",1],["dnode_rtc",1],["lnode_rtc",1],["dnode_wsoc",1],["lnode_wsoc",1],["dnode_https",1],["lnode_https",2],["dnode_http",1],["lnode_http",2],["playingPos",1],["playurl",2],["playurl_host",2],["playurl_path",2],["playurl_stream",2],["http_info_J",3],["p2p_info_J",3],["chk0",1],["chk1",1],["chk2",1],["chk3",1],["chk4",1],["is_loading",1],["loading_duration",1]],h.p2pInfo=[[p.sy,1],[p.ny,1],[p.hy,1],[p.ry,1],[p.oy,1],[p.ey,1],[p.ay,1],[p.uy,1],[p.cy,2],[p.fy,2],[p.ly,1],[p.vy,2],[p.my,2],[p.py,1],[p.dy,2],[p.by,2],[p.wy,2],[p.ky,2],[p.yy,2],[p.gy,1],[p._y,2],[p.Sy,2]]},{"../../../common/utils/global":9,"../../../common/utils/local-store":14,"../../../common/utils/string-utils":17,"../../protocol/base/manager":48,"./report-base":60}],66:[function(t,i,s){"use strict";s.__esModule=!0;var n,h=t("./system-net-core");var r=function(s){function n(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,n);var i=function(t,i){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!i||"object"!=typeof i&&"function"!=typeof i?t:i}(this,s.call(this,t));return i.t="FetchNetCore",i}return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(t,i):t.__proto__=i)}(n,s),n.prototype.destroy=function(){s.prototype.destroy.call(this)},n.prototype.close=function(){s.prototype.close.call(this)},n.prototype.open=function(){},n}(((n=h)&&n.__esModule?n:{default:n}).default);s.default=r},{"./system-net-core":67}],67:[function(t,i,s){"use strict";s.__esModule=!0;var n,h=t("events"),r=(n=h)&&n.__esModule?n:{default:n};var e=function(){function i(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,i),this.t="SystemNetCore",this.s=!1,this.ch=t,this.xn=new r.default}return i.prototype.destroy=function(){this.close(),this.ch=null,this.xn&&(this.xn.removeAllListeners(),this.xn=null)},i.prototype.on=function(t,i){this.xn.addListener(t,i)},i.prototype.off=function(t,i){this.xn.removeListener(t,i)},i.prototype.open=function(){},i.prototype.close=function(){this.s&&(this.s=!1)},i}();s.default=e},{events:1}]},{},[19])(19)});
//# sourceMappingURL=ksp2ploader.min.js.map

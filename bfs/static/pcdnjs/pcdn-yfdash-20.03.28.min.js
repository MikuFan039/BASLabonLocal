(function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var o;o="undefined"==typeof window?"undefined"==typeof global?"undefined"==typeof self?this:self:global:window,o.YFDashIO=e()}})(function(){var e,o=Math.ceil,t=Math.floor,n=Math.pow,r=String.fromCharCode;return function(){function d(s,e,n){function t(g,i){if(!e[g]){if(!s[g]){var r="function"==typeof require&&require;if(!i&&r)return r(g,!0);if(o)return o(g,!0);var c=new Error("Cannot find module '"+g+"'");throw c.code="MODULE_NOT_FOUND",c}var a=e[g]={exports:{}};s[g][0].call(a.exports,function(e){var o=s[g][1][e];return t(o||e)},a,a.exports,d,s,e,n)}return e[g].exports}for(var o="function"==typeof require&&require,r=0;r<n.length;r++)t(n[r]);return t}return d}()({1:[function(e,o,t){"use strict";function n(e){var o=e.length;if(0<o%4)throw new Error("Invalid string. Length must be a multiple of 4");var t=e.indexOf("=");-1===t&&(t=o);var n=t===o?0:4-t%4;return[t,n]}function r(e,o,t){return 3*(o+t)/4-t}function d(e){return s[63&e>>18]+s[63&e>>12]+s[63&e>>6]+s[63&e]}function a(e,o,t){for(var n,r=[],a=o;a<t;a+=3)n=(16711680&e[a]<<16)+(65280&e[a+1]<<8)+(255&e[a+2]),r.push(d(n));return r.join("")}t.byteLength=function(e){var o=n(e),t=o[0],i=o[1];return 3*(t+i)/4-i},t.toByteArray=function(e){for(var o,t=n(e),d=t[0],a=t[1],s=new g(r(e,d,a)),f=0,u=0<a?d-4:d,l=0;l<u;l+=4)o=c[e.charCodeAt(l)]<<18|c[e.charCodeAt(l+1)]<<12|c[e.charCodeAt(l+2)]<<6|c[e.charCodeAt(l+3)],s[f++]=255&o>>16,s[f++]=255&o>>8,s[f++]=255&o;return 2===a&&(o=c[e.charCodeAt(l)]<<2|c[e.charCodeAt(l+1)]>>4,s[f++]=255&o),1===a&&(o=c[e.charCodeAt(l)]<<10|c[e.charCodeAt(l+1)]<<4|c[e.charCodeAt(l+2)]>>2,s[f++]=255&o>>8,s[f++]=255&o),s},t.fromByteArray=function(e){for(var o,t=e.length,n=t%3,r=[],d=16383,c=0,i=t-n;c<i;c+=d)r.push(a(e,c,c+d>i?i:c+d));return 1==n?(o=e[t-1],r.push(s[o>>2]+s[63&o<<4]+"==")):2==n&&(o=(e[t-2]<<8)+e[t-1],r.push(s[o>>10]+s[63&o>>4]+s[63&o<<2]+"=")),r.join("")};for(var s=[],c=[],g="undefined"==typeof Uint8Array?Array:Uint8Array,f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",u=0,i=f.length;u<i;++u)s[u]=f[u],c[f.charCodeAt(u)]=u;c[45]=62,c[95]=63},{}],2:[function(e,o,t){(function(o){"use strict";function d(e){if(e>J)throw new RangeError("The value \""+e+"\" is invalid for option \"size\"");var t=new Uint8Array(e);return t.__proto__=o.prototype,t}function o(e,o,t){if("number"==typeof e){if("string"==typeof o)throw new TypeError("The \"string\" argument must be of type string. Received type number");return c(e)}return i(e,o,t)}function i(e,t,n){if("string"==typeof e)return g(e,t);if(ArrayBuffer.isView(e))return f(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(Y(e,ArrayBuffer)||e&&Y(e.buffer,ArrayBuffer))return u(e,t,n);if("number"==typeof e)throw new TypeError("The \"value\" argument must not be of type number. Received type number");var i=e.valueOf&&e.valueOf();if(null!=i&&i!==e)return o.from(i,t,n);var r=l(e);if(r)return r;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return o.from(e[Symbol.toPrimitive]("string"),t,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function a(e){if("number"!=typeof e)throw new TypeError("\"size\" argument must be of type number");else if(0>e)throw new RangeError("The value \""+e+"\" is invalid for option \"size\"")}function s(e,o,t){return a(e),0>=e?d(e):void 0===o?d(e):"string"==typeof t?d(e).fill(o,t):d(e).fill(o)}function c(e){return a(e),d(0>e?0:0|p(e))}function g(e,t){if(("string"!=typeof t||""===t)&&(t="utf8"),!o.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var n=0|m(e,t),i=d(n),r=i.write(e,t);return r!==n&&(i=i.slice(0,r)),i}function f(e){for(var o=0>e.length?0:0|p(e.length),t=d(o),n=0;n<o;n+=1)t[n]=255&e[n];return t}function u(e,t,n){if(0>t||e.byteLength<t)throw new RangeError("\"offset\" is outside of buffer bounds");if(e.byteLength<t+(n||0))throw new RangeError("\"length\" is outside of buffer bounds");var i;return i=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n),i.__proto__=o.prototype,i}function l(e){if(o.isBuffer(e)){var t=0|p(e.length),n=d(t);return 0===n.length?n:(e.copy(n,0,0,t),n)}return void 0===e.length?"Buffer"===e.type&&Array.isArray(e.data)?f(e.data):void 0:"number"!=typeof e.length||H(e.length)?d(0):f(e)}function p(e){if(e>=J)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+J.toString(16)+" bytes");return 0|e}function m(e,t){if(o.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||Y(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError("The \"string\" argument must be one of type string, Buffer, or ArrayBuffer. Received type "+typeof e);var n=e.length,i=2<arguments.length&&!0===arguments[2];if(!i&&0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return q(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return j(e).length;default:if(r)return i?-1:q(e).length;t=(""+t).toLowerCase(),r=!0;}}function h(e,o,t){var n=!1;if((void 0===o||0>o)&&(o=0),o>this.length)return"";if((void 0===t||t>this.length)&&(t=this.length),0>=t)return"";if(t>>>=0,o>>>=0,t<=o)return"";for(e||(e="utf8");;)switch(e){case"hex":return A(this,o,t);case"utf8":case"utf-8":return w(this,o,t);case"ascii":return E(this,o,t);case"latin1":case"binary":return O(this,o,t);case"base64":return F(this,o,t);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return x(this,o,t);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0;}}function y(e,o,t){var n=e[o];e[o]=e[t],e[t]=n}function b(e,t,n,i,r){if(0===e.length)return-1;if("string"==typeof n?(i=n,n=0):2147483647<n?n=2147483647:-2147483648>n&&(n=-2147483648),n=+n,H(n)&&(n=r?0:e.length-1),0>n&&(n=e.length+n),n>=e.length){if(r)return-1;n=e.length-1}else if(0>n)if(r)n=0;else return-1;if("string"==typeof t&&(t=o.from(t,i)),o.isBuffer(t))return 0===t.length?-1:_(e,t,n,i,r);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):_(e,[t],n,i,r);throw new TypeError("val must be string, number or Buffer")}function _(e,o,t,n,r){function d(e,o){return 1==a?e[o]:e.readUInt16BE(o*a)}var a=1,s=e.length,c=o.length;if(void 0!==n&&(n=(n+"").toLowerCase(),"ucs2"===n||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(2>e.length||2>o.length)return-1;a=2,s/=2,c/=2,t/=2}var g;if(r){var i=-1;for(g=t;g<s;g++)if(d(e,g)!==d(o,-1==i?0:g-i))-1!=i&&(g-=g-i),i=-1;else if(-1==i&&(i=g),g-i+1===c)return i*a}else for(t+c>s&&(t=s-c),g=t;0<=g;g--){for(var f=!0,u=0;u<c;u++)if(d(e,g+u)!==d(o,u)){f=!1;break}if(f)return g}return-1}function T(e,o,t,n){t=+t||0;var r=e.length-t;n?(n=+n,n>r&&(n=r)):n=r;var d=o.length;n>d/2&&(n=d/2);for(var a,s=0;s<n;++s){if(a=parseInt(o.substr(2*s,2),16),H(a))return s;e[t+s]=a}return s}function L(e,o,t,n){return V(q(o,e.length-t),e,t,n)}function S(e,o,t,n){return V(M(o),e,t,n)}function v(e,o,t,n){return S(e,o,t,n)}function C(e,o,t,n){return V(j(o),e,t,n)}function N(e,o,t,n){return V(G(o,e.length-t),e,t,n)}function F(e,o,t){return 0===o&&t===e.length?K.fromByteArray(e):K.fromByteArray(e.slice(o,t))}function w(e,o,t){t=Q(e.length,t);for(var n=[],r=o;r<t;){var i=e[r],d=null,a=239<i?4:223<i?3:191<i?2:1;if(r+a<=t){var s,c,g,f;1==a?128>i&&(d=i):2==a?(s=e[r+1],128==(192&s)&&(f=(31&i)<<6|63&s,127<f&&(d=f))):3==a?(s=e[r+1],c=e[r+2],128==(192&s)&&128==(192&c)&&(f=(15&i)<<12|(63&s)<<6|63&c,2047<f&&(55296>f||57343<f)&&(d=f))):4==a?(s=e[r+1],c=e[r+2],g=e[r+3],128==(192&s)&&128==(192&c)&&128==(192&g)&&(f=(15&i)<<18|(63&s)<<12|(63&c)<<6|63&g,65535<f&&1114112>f&&(d=f))):void 0}null===d?(d=65533,a=1):65535<d&&(d-=65536,n.push(55296|1023&d>>>10),d=56320|1023&d),n.push(d),r+=a}return I(n)}function I(e){var o=e.length;if(o<=Z)return r.apply(String,e);for(var t="",n=0;n<o;)t+=r.apply(String,e.slice(n,n+=Z));return t}function E(e,o,t){var n="";t=Q(e.length,t);for(var d=o;d<t;++d)n+=r(127&e[d]);return n}function O(e,o,t){var n="";t=Q(e.length,t);for(var d=o;d<t;++d)n+=r(e[d]);return n}function A(e,o,t){var n=e.length;(!o||0>o)&&(o=0),(!t||0>t||t>n)&&(t=n);for(var r="",d=o;d<t;++d)r+=P(e[d]);return r}function x(e,o,t){for(var n=e.slice(o,t),d="",a=0;a<n.length;a+=2)d+=r(n[a]+256*n[a+1]);return d}function D(e,o,t){if(0!=e%1||0>e)throw new RangeError("offset is not uint");if(e+o>t)throw new RangeError("Trying to access beyond buffer length")}function R(e,t,n,i,r,d){if(!o.isBuffer(e))throw new TypeError("\"buffer\" argument must be a Buffer instance");if(t>r||t<d)throw new RangeError("\"value\" argument is out of bounds");if(n+i>e.length)throw new RangeError("Index out of range")}function W(e,o,t,n){if(t+n>e.length)throw new RangeError("Index out of range");if(0>t)throw new RangeError("Index out of range")}function z(e,o,t,n,i){return o=+o,t>>>=0,i||W(e,o,t,4,3.4028234663852886e38,-3.4028234663852886e38),X.write(e,o,t,n,23,4),t+4}function U(e,o,t,n,i){return o=+o,t>>>=0,i||W(e,o,t,8,1.7976931348623157e308,-1.7976931348623157e308),X.write(e,o,t,n,52,8),t+8}function B(e){if(e=e.split("=")[0],e=e.trim().replace(ee,""),2>e.length)return"";for(;0!=e.length%4;)e+="=";return e}function P(e){return 16>e?"0"+e.toString(16):e.toString(16)}function q(e,o){o=o||Infinity;for(var t,n=e.length,r=null,d=[],a=0;a<n;++a){if(t=e.charCodeAt(a),55295<t&&57344>t){if(!r){if(56319<t){-1<(o-=3)&&d.push(239,191,189);continue}else if(a+1===n){-1<(o-=3)&&d.push(239,191,189);continue}r=t;continue}if(56320>t){-1<(o-=3)&&d.push(239,191,189),r=t;continue}t=(r-55296<<10|t-56320)+65536}else r&&-1<(o-=3)&&d.push(239,191,189);if(r=null,128>t){if(0>(o-=1))break;d.push(t)}else if(2048>t){if(0>(o-=2))break;d.push(192|t>>6,128|63&t)}else if(65536>t){if(0>(o-=3))break;d.push(224|t>>12,128|63&t>>6,128|63&t)}else if(1114112>t){if(0>(o-=4))break;d.push(240|t>>18,128|63&t>>12,128|63&t>>6,128|63&t)}else throw new Error("Invalid code point")}return d}function M(e){for(var o=[],t=0;t<e.length;++t)o.push(255&e.charCodeAt(t));return o}function G(e,o){for(var t,n,r,d=[],a=0;a<e.length&&!(0>(o-=2));++a)t=e.charCodeAt(a),n=t>>8,r=t%256,d.push(r),d.push(n);return d}function j(e){return K.toByteArray(B(e))}function V(e,o,t,n){for(var r=0;r<n&&!(r+t>=o.length||r>=e.length);++r)o[r+t]=e[r];return r}function Y(e,o){return e instanceof o||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===o.name}function H(e){return e!==e}var Q=Math.min,K=e("base64-js"),X=e("ieee754");t.Buffer=o,t.SlowBuffer=function(e){return+e!=e&&(e=0),o.alloc(+e)},t.INSPECT_MAX_BYTES=50;var J=2147483647;t.kMaxLength=J,o.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()}catch(o){return!1}}(),o.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(o.prototype,"parent",{enumerable:!0,get:function(){return o.isBuffer(this)?this.buffer:void 0}}),Object.defineProperty(o.prototype,"offset",{enumerable:!0,get:function(){return o.isBuffer(this)?this.byteOffset:void 0}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&o[Symbol.species]===o&&Object.defineProperty(o,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),o.poolSize=8192,o.from=function(e,o,t){return i(e,o,t)},o.prototype.__proto__=Uint8Array.prototype,o.__proto__=Uint8Array,o.alloc=function(e,o,t){return s(e,o,t)},o.allocUnsafe=function(e){return c(e)},o.allocUnsafeSlow=function(e){return c(e)},o.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==o.prototype},o.compare=function(e,t){if(Y(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),Y(t,Uint8Array)&&(t=o.from(t,t.offset,t.byteLength)),!o.isBuffer(e)||!o.isBuffer(t))throw new TypeError("The \"buf1\", \"buf2\" arguments must be one of type Buffer or Uint8Array");if(e===t)return 0;for(var n=e.length,r=t.length,d=0,i=Q(n,r);d<i;++d)if(e[d]!==t[d]){n=e[d],r=t[d];break}return n<r?-1:r<n?1:0},o.isEncoding=function(e){switch((e+"").toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1;}},o.concat=function(e,t){if(!Array.isArray(e))throw new TypeError("\"list\" argument must be an Array of Buffers");if(0===e.length)return o.alloc(0);var n;if(t===void 0)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var i=o.allocUnsafe(t),r=0;for(n=0;n<e.length;++n){var d=e[n];if(Y(d,Uint8Array)&&(d=o.from(d)),!o.isBuffer(d))throw new TypeError("\"list\" argument must be an Array of Buffers");d.copy(i,r),r+=d.length}return i},o.byteLength=m,o.prototype._isBuffer=!0,o.prototype.swap16=function(){var e=this.length;if(0!=e%2)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var o=0;o<e;o+=2)y(this,o,o+1);return this},o.prototype.swap32=function(){var e=this.length;if(0!=e%4)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var o=0;o<e;o+=4)y(this,o,o+3),y(this,o+1,o+2);return this},o.prototype.swap64=function(){var e=this.length;if(0!=e%8)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var o=0;o<e;o+=8)y(this,o,o+7),y(this,o+1,o+6),y(this,o+2,o+5),y(this,o+3,o+4);return this},o.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?w(this,0,e):h.apply(this,arguments)},o.prototype.toLocaleString=o.prototype.toString,o.prototype.equals=function(e){if(!o.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===o.compare(this,e)},o.prototype.inspect=function(){var e="",o=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,o).replace(/(.{2})/g,"$1 ").trim(),this.length>o&&(e+=" ... "),"<Buffer "+e+">"},o.prototype.compare=function(e,t,n,r,d){if(Y(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),!o.isBuffer(e))throw new TypeError("The \"target\" argument must be one of type Buffer or Uint8Array. Received type "+typeof e);if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===d&&(d=this.length),0>t||n>e.length||0>r||d>this.length)throw new RangeError("out of range index");if(r>=d&&t>=n)return 0;if(r>=d)return-1;if(t>=n)return 1;if(t>>>=0,n>>>=0,r>>>=0,d>>>=0,this===e)return 0;for(var a=d-r,s=n-t,c=Q(a,s),g=this.slice(r,d),f=e.slice(t,n),u=0;u<c;++u)if(g[u]!==f[u]){a=g[u],s=f[u];break}return a<s?-1:s<a?1:0},o.prototype.includes=function(e,o,t){return-1!==this.indexOf(e,o,t)},o.prototype.indexOf=function(e,o,t){return b(this,e,o,t,!0)},o.prototype.lastIndexOf=function(e,o,t){return b(this,e,o,t,!1)},o.prototype.write=function(e,o,t,n){if(void 0===o)n="utf8",t=this.length,o=0;else if(void 0===t&&"string"==typeof o)n=o,t=this.length,o=0;else if(isFinite(o))o>>>=0,isFinite(t)?(t>>>=0,void 0===n&&(n="utf8")):(n=t,t=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var i=this.length-o;if((void 0===t||t>i)&&(t=i),0<e.length&&(0>t||0>o)||o>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var r=!1;;)switch(n){case"hex":return T(this,e,o,t);case"utf8":case"utf-8":return L(this,e,o,t);case"ascii":return S(this,e,o,t);case"latin1":case"binary":return v(this,e,o,t);case"base64":return C(this,e,o,t);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return N(this,e,o,t);default:if(r)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),r=!0;}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var Z=4096;o.prototype.slice=function(e,t){var n=this.length;e=~~e,t=void 0===t?n:~~t,0>e?(e+=n,0>e&&(e=0)):e>n&&(e=n),0>t?(t+=n,0>t&&(t=0)):t>n&&(t=n),t<e&&(t=e);var i=this.subarray(e,t);return i.__proto__=o.prototype,i},o.prototype.readUIntLE=function(e,o,t){e>>>=0,o>>>=0,t||D(e,o,this.length);for(var n=this[e],r=1,d=0;++d<o&&(r*=256);)n+=this[e+d]*r;return n},o.prototype.readUIntBE=function(e,o,t){e>>>=0,o>>>=0,t||D(e,o,this.length);for(var n=this[e+--o],i=1;0<o&&(i*=256);)n+=this[e+--o]*i;return n},o.prototype.readUInt8=function(e,o){return e>>>=0,o||D(e,1,this.length),this[e]},o.prototype.readUInt16LE=function(e,o){return e>>>=0,o||D(e,2,this.length),this[e]|this[e+1]<<8},o.prototype.readUInt16BE=function(e,o){return e>>>=0,o||D(e,2,this.length),this[e]<<8|this[e+1]},o.prototype.readUInt32LE=function(e,o){return e>>>=0,o||D(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},o.prototype.readUInt32BE=function(e,o){return e>>>=0,o||D(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},o.prototype.readIntLE=function(e,o,t){e>>>=0,o>>>=0,t||D(e,o,this.length);for(var r=this[e],d=1,a=0;++a<o&&(d*=256);)r+=this[e+a]*d;return d*=128,r>=d&&(r-=n(2,8*o)),r},o.prototype.readIntBE=function(e,o,t){e>>>=0,o>>>=0,t||D(e,o,this.length);for(var r=o,i=1,d=this[e+--r];0<r&&(i*=256);)d+=this[e+--r]*i;return i*=128,d>=i&&(d-=n(2,8*o)),d},o.prototype.readInt8=function(e,o){return e>>>=0,o||D(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},o.prototype.readInt16LE=function(e,o){e>>>=0,o||D(e,2,this.length);var t=this[e]|this[e+1]<<8;return 32768&t?4294901760|t:t},o.prototype.readInt16BE=function(e,o){e>>>=0,o||D(e,2,this.length);var t=this[e+1]|this[e]<<8;return 32768&t?4294901760|t:t},o.prototype.readInt32LE=function(e,o){return e>>>=0,o||D(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},o.prototype.readInt32BE=function(e,o){return e>>>=0,o||D(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},o.prototype.readFloatLE=function(e,o){return e>>>=0,o||D(e,4,this.length),X.read(this,e,!0,23,4)},o.prototype.readFloatBE=function(e,o){return e>>>=0,o||D(e,4,this.length),X.read(this,e,!1,23,4)},o.prototype.readDoubleLE=function(e,o){return e>>>=0,o||D(e,8,this.length),X.read(this,e,!0,52,8)},o.prototype.readDoubleBE=function(e,o){return e>>>=0,o||D(e,8,this.length),X.read(this,e,!1,52,8)},o.prototype.writeUIntLE=function(e,o,t,r){if(e=+e,o>>>=0,t>>>=0,!r){var d=n(2,8*t)-1;R(this,e,o,t,d,0)}var a=1,s=0;for(this[o]=255&e;++s<t&&(a*=256);)this[o+s]=255&e/a;return o+t},o.prototype.writeUIntBE=function(e,o,t,r){if(e=+e,o>>>=0,t>>>=0,!r){var d=n(2,8*t)-1;R(this,e,o,t,d,0)}var a=t-1,i=1;for(this[o+a]=255&e;0<=--a&&(i*=256);)this[o+a]=255&e/i;return o+t},o.prototype.writeUInt8=function(e,o,t){return e=+e,o>>>=0,t||R(this,e,o,1,255,0),this[o]=255&e,o+1},o.prototype.writeUInt16LE=function(e,o,t){return e=+e,o>>>=0,t||R(this,e,o,2,65535,0),this[o]=255&e,this[o+1]=e>>>8,o+2},o.prototype.writeUInt16BE=function(e,o,t){return e=+e,o>>>=0,t||R(this,e,o,2,65535,0),this[o]=e>>>8,this[o+1]=255&e,o+2},o.prototype.writeUInt32LE=function(e,o,t){return e=+e,o>>>=0,t||R(this,e,o,4,4294967295,0),this[o+3]=e>>>24,this[o+2]=e>>>16,this[o+1]=e>>>8,this[o]=255&e,o+4},o.prototype.writeUInt32BE=function(e,o,t){return e=+e,o>>>=0,t||R(this,e,o,4,4294967295,0),this[o]=e>>>24,this[o+1]=e>>>16,this[o+2]=e>>>8,this[o+3]=255&e,o+4},o.prototype.writeIntLE=function(e,o,t,r){if(e=+e,o>>>=0,!r){var d=n(2,8*t-1);R(this,e,o,t,d-1,-d)}var a=0,i=1,s=0;for(this[o]=255&e;++a<t&&(i*=256);)0>e&&0==s&&0!==this[o+a-1]&&(s=1),this[o+a]=255&(e/i>>0)-s;return o+t},o.prototype.writeIntBE=function(e,o,t,r){if(e=+e,o>>>=0,!r){var d=n(2,8*t-1);R(this,e,o,t,d-1,-d)}var a=t-1,i=1,s=0;for(this[o+a]=255&e;0<=--a&&(i*=256);)0>e&&0==s&&0!==this[o+a+1]&&(s=1),this[o+a]=255&(e/i>>0)-s;return o+t},o.prototype.writeInt8=function(e,o,t){return e=+e,o>>>=0,t||R(this,e,o,1,127,-128),0>e&&(e=255+e+1),this[o]=255&e,o+1},o.prototype.writeInt16LE=function(e,o,t){return e=+e,o>>>=0,t||R(this,e,o,2,32767,-32768),this[o]=255&e,this[o+1]=e>>>8,o+2},o.prototype.writeInt16BE=function(e,o,t){return e=+e,o>>>=0,t||R(this,e,o,2,32767,-32768),this[o]=e>>>8,this[o+1]=255&e,o+2},o.prototype.writeInt32LE=function(e,o,t){return e=+e,o>>>=0,t||R(this,e,o,4,2147483647,-2147483648),this[o]=255&e,this[o+1]=e>>>8,this[o+2]=e>>>16,this[o+3]=e>>>24,o+4},o.prototype.writeInt32BE=function(e,o,t){return e=+e,o>>>=0,t||R(this,e,o,4,2147483647,-2147483648),0>e&&(e=4294967295+e+1),this[o]=e>>>24,this[o+1]=e>>>16,this[o+2]=e>>>8,this[o+3]=255&e,o+4},o.prototype.writeFloatLE=function(e,o,t){return z(this,e,o,!0,t)},o.prototype.writeFloatBE=function(e,o,t){return z(this,e,o,!1,t)},o.prototype.writeDoubleLE=function(e,o,t){return U(this,e,o,!0,t)},o.prototype.writeDoubleBE=function(e,o,t){return U(this,e,o,!1,t)},o.prototype.copy=function(e,t,n,r){if(!o.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),0<r&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(0>t)throw new RangeError("targetStart out of bounds");if(0>n||n>=this.length)throw new RangeError("Index out of range");if(0>r)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var d=r-n;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,n,r);else if(this===e&&n<t&&t<r)for(var a=d-1;0<=a;--a)e[a+t]=this[a+n];else Uint8Array.prototype.set.call(e,this.subarray(n,r),t);return d},o.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!o.isEncoding(r))throw new TypeError("Unknown encoding: "+r);if(1===e.length){var d=e.charCodeAt(0);("utf8"===r&&128>d||"latin1"===r)&&(e=d)}}else"number"==typeof e&&(e&=255);if(0>t||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;t>>>=0,n=n===void 0?this.length:n>>>0,e||(e=0);var a;if("number"==typeof e)for(a=t;a<n;++a)this[a]=e;else{var i=o.isBuffer(e)?e:o.from(e,r),s=i.length;if(0===s)throw new TypeError("The value \""+e+"\" is invalid for argument \"value\"");for(a=0;a<n-t;++a)this[a+t]=i[a%s]}return this};var ee=/[^+/0-9A-Za-z-_]/g}).call(this,e("buffer").Buffer)},{"base64-js":1,buffer:2,ieee754:4}],3:[function(e,t){function n(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=b(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}function i(e){return void 0===e._maxListeners?n.defaultMaxListeners:e._maxListeners}function r(e,o,t){if(o)e.call(t);else for(var n=e.length,r=h(e,n),d=0;d<n;++d)r[d].call(t)}function d(e,o,t,n){if(o)e.call(t,n);else for(var r=e.length,d=h(e,r),a=0;a<r;++a)d[a].call(t,n)}function a(e,o,t,n,r){if(o)e.call(t,n,r);else for(var d=e.length,a=h(e,d),s=0;s<d;++s)a[s].call(t,n,r)}function s(e,o,t,n,r,d){if(o)e.call(t,n,r,d);else for(var a=e.length,s=h(e,a),c=0;c<a;++c)s[c].call(t,n,r,d)}function c(e,o,t,n){if(o)e.apply(t,n);else for(var r=e.length,d=h(e,r),a=0;a<r;++a)d[a].apply(t,n)}function g(e,o,t,n){var r,d,a;if("function"!=typeof t)throw new TypeError("\"listener\" argument must be a function");if(d=e._events,d?(d.newListener&&(e.emit("newListener",o,t.listener?t.listener:t),d=e._events),a=d[o]):(d=e._events=b(null),e._eventsCount=0),!a)a=d[o]=t,++e._eventsCount;else if("function"==typeof a?a=d[o]=n?[t,a]:[a,t]:n?a.unshift(t):a.push(t),!a.warned&&(r=i(e),r&&0<r&&a.length>r)){a.warned=!0;var s=new Error("Possible EventEmitter memory leak detected. "+a.length+" \""+(o+"\" listeners added. Use emitter.setMaxListeners() to increase limit."));s.name="MaxListenersExceededWarning",s.emitter=e,s.type=o,s.count=a.length,"object"==typeof console&&console.warn&&console.warn("%s: %s",s.name,s.message)}return e}function f(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var e=Array(arguments.length),o=0;o<e.length;++o)e[o]=arguments[o];this.listener.apply(this.target,e);}}function u(e,o,t){var n={fired:!1,wrapFn:void 0,target:e,type:o,listener:t},i=T.call(f,n);return i.listener=t,n.wrapFn=i,i}function l(e,o,t){var n=e._events;if(!n)return[];var i=n[o];return i?"function"==typeof i?t?[i.listener||i]:[i]:t?y(i):h(i,i.length):[]}function p(e){var o=this._events;if(o){var t=o[e];if("function"==typeof t)return 1;if(t)return t.length}return 0}function m(e,o){for(var t=o,i=t+1,r=e.length;i<r;t+=1,i+=1)e[t]=e[i];e.pop()}function h(e,o){for(var t=Array(o),n=0;n<o;++n)t[n]=e[n];return t}function y(e){for(var o=Array(e.length),t=0;t<o.length;++t)o[t]=e[t].listener||e[t];return o}var b=Object.create||function(e){var o=function(){};return o.prototype=e,new o},_=Object.keys||function(e){var o=[];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&o.push(t);return t},T=Function.prototype.bind||function(e){var o=this;return function(){return o.apply(e,arguments)}};t.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0;var L,S=10;try{var v={};Object.defineProperty&&Object.defineProperty(v,"x",{value:0}),L=0===v.x}catch(e){L=!1}L?Object.defineProperty(n,"defaultMaxListeners",{enumerable:!0,get:function(){return S},set:function(e){if("number"!=typeof e||0>e||e!==e)throw new TypeError("\"defaultMaxListeners\" must be a positive number");S=e}}):n.defaultMaxListeners=S,n.prototype.setMaxListeners=function(e){if("number"!=typeof e||0>e||isNaN(e))throw new TypeError("\"n\" argument must be a positive number");return this._maxListeners=e,this},n.prototype.getMaxListeners=function(){return i(this)},n.prototype.emit=function(e){var o,t,n,g,f,i,u="error"===e;if(i=this._events,i)u=u&&null==i.error;else if(!u)return!1;if(u){if(1<arguments.length&&(o=arguments[1]),o instanceof Error)throw o;else{var l=new Error("Unhandled \"error\" event. ("+o+")");throw l.context=o,l}return!1}if(t=i[e],!t)return!1;var p="function"==typeof t;switch(n=arguments.length,n){case 1:r(t,p,this);break;case 2:d(t,p,this,arguments[1]);break;case 3:a(t,p,this,arguments[1],arguments[2]);break;case 4:s(t,p,this,arguments[1],arguments[2],arguments[3]);break;default:for(g=Array(n-1),f=1;f<n;f++)g[f-1]=arguments[f];c(t,p,this,g);}return!0},n.prototype.addListener=function(e,o){return g(this,e,o,!1)},n.prototype.on=n.prototype.addListener,n.prototype.prependListener=function(e,o){return g(this,e,o,!0)},n.prototype.once=function(e,o){if("function"!=typeof o)throw new TypeError("\"listener\" argument must be a function");return this.on(e,u(this,e,o)),this},n.prototype.prependOnceListener=function(e,o){if("function"!=typeof o)throw new TypeError("\"listener\" argument must be a function");return this.prependListener(e,u(this,e,o)),this},n.prototype.removeListener=function(e,o){var t,n,r,d,i;if("function"!=typeof o)throw new TypeError("\"listener\" argument must be a function");if(n=this._events,!n)return this;if(t=n[e],!t)return this;if(t===o||t.listener===o)0==--this._eventsCount?this._events=b(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,t.listener||o));else if("function"!=typeof t){for(r=-1,d=t.length-1;0<=d;d--)if(t[d]===o||t[d].listener===o){i=t[d].listener,r=d;break}if(0>r)return this;0===r?t.shift():m(t,r),1===t.length&&(n[e]=t[0]),n.removeListener&&this.emit("removeListener",e,i||o)}return this},n.prototype.removeAllListeners=function(e){var o,t,n;if(t=this._events,!t)return this;if(!t.removeListener)return 0===arguments.length?(this._events=b(null),this._eventsCount=0):t[e]&&(0==--this._eventsCount?this._events=b(null):delete t[e]),this;if(0===arguments.length){var i,r=_(t);for(n=0;n<r.length;++n)i=r[n],"removeListener"===i||this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=b(null),this._eventsCount=0,this}if(o=t[e],"function"==typeof o)this.removeListener(e,o);else if(o)for(n=o.length-1;0<=n;n--)this.removeListener(e,o[n]);return this},n.prototype.listeners=function(e){return l(this,e,!0)},n.prototype.rawListeners=function(e){return l(this,e,!1)},n.listenerCount=function(e,o){return"function"==typeof e.listenerCount?e.listenerCount(o):p.call(e,o)},n.prototype.listenerCount=p,n.prototype.eventNames=function(){return 0<this._eventsCount?Reflect.ownKeys(this._events):[]}},{}],4:[function(e,o,i){i.read=function(o,t,r,a,c){var g,e,f=8*c-a-1,u=(1<<f)-1,l=u>>1,p=-7,m=r?c-1:0,i=r?-1:1,d=o[t+m];for(m+=i,g=d&(1<<-p)-1,d>>=-p,p+=f;0<p;g=256*g+o[t+m],m+=i,p-=8);for(e=g&(1<<-p)-1,g>>=-p,p+=a;0<p;e=256*e+o[t+m],m+=i,p-=8);if(0===g)g=1-l;else{if(g===u)return e?NaN:(d?-1:1)*Infinity;e+=n(2,a),g-=l}return(d?-1:1)*e*n(2,g-a)},i.write=function(o,r,a,g,f,u){var l,p,m,c=8*u-f-1,h=(1<<c)-1,y=h>>1,b=23===f?5.960464477539063e-8-6.617444900424222e-24:0,_=g?0:u-1,i=g?1:-1,d=0>r||0===r&&0>1/r?1:0;for(r=Math.abs(r),isNaN(r)||r===Infinity?(p=isNaN(r)?1:0,l=h):(l=t(Math.log(r)/Math.LN2),1>r*(m=n(2,-l))&&(l--,m*=2),r+=1<=l+y?b/m:b*n(2,1-y),2<=r*m&&(l++,m/=2),l+y>=h?(p=0,l=h):1<=l+y?(p=(r*m-1)*n(2,f),l+=y):(p=r*n(2,y-1)*n(2,f),l=0));8<=f;o[a+_]=255&p,_+=i,p/=256,f-=8);for(l=l<<f|p,c+=f;0<c;o[a+_]=255&l,_+=i,l/=256,c-=8);o[a+_-i]|=128*d}},{}],5:[function(o,t){(function(o){"use strict";function n(e,o){var t=(65535&e)+(65535&o);return(e>>16)+(o>>16)+(t>>16)<<16|65535&t}function i(e,o){return e<<o|e>>>32-o}function g(e,o,r,d,a,s){return n(i(n(n(o,e),n(d,s)),a),r)}function s(e,o,n,i,r,d,a){return g(o&n|~o&i,e,o,r,d,a)}function f(e,o,n,i,r,a,s){return g(o&i|n&~i,e,o,r,a,s)}function u(e,o,n,i,r,d,a){return g(o^n^i,e,o,r,d,a)}function l(e,o,n,i,r,a,s){return g(n^(o|~i),e,o,r,a,s)}function d(e,o){e[o>>5]|=128<<o%32,e[(o+64>>>9<<4)+14]=o;var t,i,r,g,p,m=1732584193,a=-271733879,h=-1732584194,c=271733878;for(t=0;t<e.length;t+=16)i=m,r=a,g=h,p=c,m=s(m,a,h,c,e[t],7,-680876936),c=s(c,m,a,h,e[t+1],12,-389564586),h=s(h,c,m,a,e[t+2],17,606105819),a=s(a,h,c,m,e[t+3],22,-1044525330),m=s(m,a,h,c,e[t+4],7,-176418897),c=s(c,m,a,h,e[t+5],12,1200080426),h=s(h,c,m,a,e[t+6],17,-1473231341),a=s(a,h,c,m,e[t+7],22,-45705983),m=s(m,a,h,c,e[t+8],7,1770035416),c=s(c,m,a,h,e[t+9],12,-1958414417),h=s(h,c,m,a,e[t+10],17,-42063),a=s(a,h,c,m,e[t+11],22,-1990404162),m=s(m,a,h,c,e[t+12],7,1804603682),c=s(c,m,a,h,e[t+13],12,-40341101),h=s(h,c,m,a,e[t+14],17,-1502002290),a=s(a,h,c,m,e[t+15],22,1236535329),m=f(m,a,h,c,e[t+1],5,-165796510),c=f(c,m,a,h,e[t+6],9,-1069501632),h=f(h,c,m,a,e[t+11],14,643717713),a=f(a,h,c,m,e[t],20,-373897302),m=f(m,a,h,c,e[t+5],5,-701558691),c=f(c,m,a,h,e[t+10],9,38016083),h=f(h,c,m,a,e[t+15],14,-660478335),a=f(a,h,c,m,e[t+4],20,-405537848),m=f(m,a,h,c,e[t+9],5,568446438),c=f(c,m,a,h,e[t+14],9,-1019803690),h=f(h,c,m,a,e[t+3],14,-187363961),a=f(a,h,c,m,e[t+8],20,1163531501),m=f(m,a,h,c,e[t+13],5,-1444681467),c=f(c,m,a,h,e[t+2],9,-51403784),h=f(h,c,m,a,e[t+7],14,1735328473),a=f(a,h,c,m,e[t+12],20,-1926607734),m=u(m,a,h,c,e[t+5],4,-378558),c=u(c,m,a,h,e[t+8],11,-2022574463),h=u(h,c,m,a,e[t+11],16,1839030562),a=u(a,h,c,m,e[t+14],23,-35309556),m=u(m,a,h,c,e[t+1],4,-1530992060),c=u(c,m,a,h,e[t+4],11,1272893353),h=u(h,c,m,a,e[t+7],16,-155497632),a=u(a,h,c,m,e[t+10],23,-1094730640),m=u(m,a,h,c,e[t+13],4,681279174),c=u(c,m,a,h,e[t],11,-358537222),h=u(h,c,m,a,e[t+3],16,-722521979),a=u(a,h,c,m,e[t+6],23,76029189),m=u(m,a,h,c,e[t+9],4,-640364487),c=u(c,m,a,h,e[t+12],11,-421815835),h=u(h,c,m,a,e[t+15],16,530742520),a=u(a,h,c,m,e[t+2],23,-995338651),m=l(m,a,h,c,e[t],6,-198630844),c=l(c,m,a,h,e[t+7],10,1126891415),h=l(h,c,m,a,e[t+14],15,-1416354905),a=l(a,h,c,m,e[t+5],21,-57434055),m=l(m,a,h,c,e[t+12],6,1700485571),c=l(c,m,a,h,e[t+3],10,-1894986606),h=l(h,c,m,a,e[t+10],15,-1051523),a=l(a,h,c,m,e[t+1],21,-2054922799),m=l(m,a,h,c,e[t+8],6,1873313359),c=l(c,m,a,h,e[t+15],10,-30611744),h=l(h,c,m,a,e[t+6],15,-1560198380),a=l(a,h,c,m,e[t+13],21,1309151649),m=l(m,a,h,c,e[t+4],6,-145523070),c=l(c,m,a,h,e[t+11],10,-1120210379),h=l(h,c,m,a,e[t+2],15,718787259),a=l(a,h,c,m,e[t+9],21,-343485551),m=n(m,i),a=n(a,r),h=n(h,g),c=n(c,p);return[m,a,h,c]}function a(e){var o,t="",n=32*e.length;for(o=0;o<n;o+=8)t+=r(255&e[o>>5]>>>o%32);return t}function c(e){var o,t=[];for(t[(e.length>>2)-1]=void 0,o=0;o<t.length;o+=1)t[o]=0;var n=8*e.length;for(o=0;o<n;o+=8)t[o>>5]|=(255&e.charCodeAt(o/8))<<o%32;return t}function p(e){return a(d(c(e),8*e.length))}function m(e,o){var t,n,i=c(e),r=[],s=[];for(r[15]=s[15]=void 0,16<i.length&&(i=d(i,8*e.length)),t=0;16>t;t+=1)r[t]=909522486^i[t],s[t]=1549556828^i[t];return n=d(r.concat(c(o)),512+8*o.length),a(d(s.concat(n),640))}function h(e){var o,t,n="0123456789abcdef",i="";for(t=0;t<e.length;t+=1)o=e.charCodeAt(t),i+=n.charAt(15&o>>>4)+n.charAt(15&o);return i}function y(e){return unescape(encodeURIComponent(e))}function b(e){return p(y(e))}function _(e){return h(b(e))}function T(e,o){return m(y(e),y(o))}function L(e,o){return h(T(e,o))}function S(e,o,t){return o?t?T(o,e):L(o,e):t?b(e):_(e)}"function"==typeof e&&e.amd?e(function(){return S}):"object"==typeof t&&t.exports?t.exports=S:o.md5=S})(this)},{}],6:[function(e,o){o.exports="function"==typeof Object.create?function(e,o){e.super_=o,e.prototype=Object.create(o.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,o){e.super_=o;var t=function(){};t.prototype=o.prototype,e.prototype=new t,e.prototype.constructor=e}},{}],7:[function(e,o){o.exports={name:"yfdashio",version:"1.2.6",description:"h5 p2p plug",main:"./dist/index.yfplayer.js",browser:{"fs-chunk-store":"memory-chunk-store","load-ip-set":!1,net:!1,os:!1,ut_pex:!1},dependencies:{"binary-search":"^1.3.5",bitfield:"^1.1.2","blueimp-md5":"^2.10.0",buffer:"^4.9.1","crypto-js":"^3.1.9-1","fs-chunk-store":"^1.6.2","gulp-uglify":"^3.0.1","immediate-chunk-store":"^1.0.8",inherits:"^2.0.3","js-base64":"^2.5.2","memory-chunk-store":"^1.3.0",sha1:"^1.1.1",uint64be:"^2.0.2"},devDependencies:{babili:"^0.1.4","babel-loader":"^7.1.1","babel-polyfill":"^6.26.0","arraybuffer-equal":"^1.0.4","babel-core":"^6.25.0","babel-preset-es2015":"^6.24.1","babel-register":"^6.24.0",chromedriver:"^2.28.0","cross-env":"^5.0.2","deep-strict-equal":"^0.2.0"},scripts:{"build-io":"browserify ./yfdash-io.js -s YFDashIO > ./dist/yfdashio.js","uglify-io":"browserify -s YFDashIO -e  ./yfdash-io.js | babili > ./dist/yfdashio.min.js","pull-from-github":"git pull","push-to-github":"git add . && git commit -m 'update' && git push","uglifyjs-player":"uglifyjs ./dist/yfdash-io.js-m -o ./dist/yfdashio.min.js","npm-publish":"npm publish"},author:"zhengweibing",license:"ISC"}},{}],8:[function(e,t){(function(n){function i(e,o,t){var n=this;if(s.call(n),o=o||{},!o){throw new Error("IOController init error,opts is null or undefined")}n.app=t,n.src=e,n.selector=o.selector,n.autoplay=!1!==o.autoplay,n.isPlaying=!1,n.dispatcher=null,n.nodes=[],n.nodeList=[],n.appendCount=0,n.oldAppendCount=0,n.sameAppendCount=0,n.config=new p,n.config.mediaType=n.app.mediaType,n.config.version=o.version||n.version,n.config.limitrtc=n.config.limitrtc,n.config.mdebug=o.mdebug;n.timeInterval=void 0,"watch"==n.config.mediaType&&(n.config.bWatch=!0),n.src+=0<n.src.indexOf("?")?"&uatag=yfsdk@"+n.config.sdkversion:"?uatag=yfsdk@"+n.config.sdkversion,n.config.videourl=n.src,n.config.autoplay=o.autoplay||!1,n.config.autoload=o.autoload,n.config.keyurl=r(n.src),n.state="PLATING",n.config.setupTime=new Date().getTime(),n.config.SdkFristTime=n.config.setupTime,n.config.hasLoadeddata=!1,n.config.videoType="video",n.firstsize=131072,n.config.domain=o.domain||"";var i=n.config.videourl.split("/");i[2]&&(n.config.domain=i[2]),n._initStatx("/qa.igame"),n.config.stat=n.stat,n.timerFlag=!1,n.destroyed=!1,n.seekOffset=0,n.bPlayEnd=!1,n.range_start=0,n.range_end=0,n.sillpiece_num=2,n.oFetchNode=new g(n.config),n.bOnplayEvent=!1,n.count=0,n.FetchTimeOutId=0,n.bNoResources=!1,n.hdCdn=void 0,n.appendBufferEnd=0,n.requestTimeId=0,n.requestTimeOutId=0,n.curLoader=void 0,n.bQueryNode=!1,n.cloudCfg=void 0,n.bFetchSupported=!1,n.scdnErrCount=0,n.scdnSwitchCount=0,n.bNotNeedQueryNode=!0,n.nodeCount=1,n.config.bWatch&&(n.config.hasSteupded=!0,clearTimeout(n.requestTimeId),n.nodes=[],n.nodes.push({uri:n.src,type:"server"}),n.hdCdn=new u(n.src,"server",0,{mediaType:n.config.mediaType,timeout:n.config.cdn_req_timeout,config:n.config}),n._startPlaying(n.nodes),n.startTimer(),n.requestTimeId=setTimeout(function(){clearTimeout(n.requestTimeId),n.requestTimeId=0,n._initsingal()},2e3))}function r(e){var o=new Date,t=o.getFullYear(),n="",i="";e=e.split("?")[0];var r=e.split("/"),d=r[3].indexOf(t);i=0<=d?5:3;for(var a=0;a<i;a++)r.shift();return n=r.join("/"),"/"+n}function d(e){var o=document.cookie.split(";")||[];if(!o||!o.length)return"";for(var t=0;t<o.length;t++){var n=$.trim(o[t]).split("=")[0],i=$.trim(o[t]).split("=")[1];if(n===e)return i}return""}t.exports=i;var a=e("inherits"),s=e("events").EventEmitter,c=e("../loader/node-filter"),g=e("../loader/fetchLoader"),f=e("../loader/toGetNodes"),u=e("../loader/xhrLoader"),l=e("./dispatcher-xhr"),p=e("./config"),m=e("../stat/statx"),h=e("../stat/log-report"),y=e("../loader/cloud-cfg"),b=e("../util/dateFtt");a(i,s);var _=0,T=1,L=1,S=2,v=0;String.prototype.format=function(e){var o=this;if(1>arguments.length)return o;var t=arguments;for(var n in 1==arguments.length&&"object"==typeof e&&(t=e),t){var i=t[n];void 0!=i&&(o=o.replace("{"+n+"}",i))}return o},i.prototype._initStatx=function(){var e=this;if(!e.destroyed){e.stat=new m;var o=e.config.keyurl.split("/");if(e.stat.appname=o[o.length-2],e.stat.streamname=o[o.length-1],e.stat.streamname=e.stat.streamname.split(".")[0],e.stat.open_ts=e.config.setupTime,e.stat.init(e.config.domain,e.config),e.withCredentials=!1,e.config.logReport=new h(e.config),e.readCfgFromLocal(),e.config.playSessid=e.stat.device_vid,window&&window.player&&window.player.getSession&&(e.config.playSessid=window.player.getSession()),document&&document.cookie&&(e.config.playDevId=d("buvid3")),0<e.config.iSaveWaitLog||e.config.mdebug){let o="[{0}][{1}]IOController._initStatx >>uuid[{2}] vid[{3}] Sessid[{4}] DevId[{5}]".format(b("hh:mm:ss:S",new Date),e.config.mediaType,e.stat.vid,e.stat.device_vid,e.config.playSessid,e.config.playDevId);e.config.mdebug&&console.log(o),e.config.debugger(o)}}},i.prototype._start=function(e,o){var t=this;t.destroyed||((0<t.config.iSaveWaitLog||t.config.mdebug)&&t.config.debugger("["+b("hh:mm:ss:S",new Date)+"]IOController._start bufferLen\uFF1A"+t.config.bufferLen+" range:"+JSON.stringify(e)),t.config.bytefrom=0,t.config.byteto=-1,t.nodes=[],t.nodes.push({uri:t.src,type:"server"}),t.hdCdn=new u(t.src,"server",0,{mediaType:t.config.mediaType,timeout:t.config.cdn_req_timeout,config:t.config}),t.config.hasSteupded=!0,t.withCredentials=o,t.withCredentials&&(t.hdCdn&&(t.hdCdn.withCredentials=t.withCredentials),t.oFetchNode&&(t.oFetchNode.withCredentials=t.withCredentials)),t.range_start=e.from,t.range_end=e.to,0<e.from&&(t.bOnplayEvent=!0),t.appendBufferEnd=t.range_start,t._startPlaying(t.nodes),"video"==t.config.mediaType?t.queryNodeFromVideoLocal(t.config.mediaType):t.queryNodeFromAudioLocal(t.config.mediaType),t.oFetchNode&&t.oFetchNode.isSupported()?(t.bFetchSupported=!0,t.oFetchNode.loader=t.hdCdn,t.oFetchNode.cdnType=_,t.ToFetch(t.src,L,e,0)):(t.startReq(!0,e),t.stat.download_type=2))},i.prototype.startReq=function(e,o){var t=this;if(!(t.destroyed||t.config.bWatch)){t.range_start=0,o&&0<o.from&&(t.range_start=o.from);var i=t.firstsize*t.sillpiece_num;0<o.to?(i=o.to-o.from+1,204800<i&&(i=t.firstsize*t.sillpiece_num)):"audio"==t.config.mediaType&&(i=40960),t.dispatcher&&(t.dispatcher.cdnloaded.curUrl=t.hdCdn.uri),t.stat.first_cdn_byte=i;var r=new Date().getTime();t.nodeFilter=new c(t.nodes,t.withCredentials,function(e,o,d,a){if(!t.destroyed){if(0!==d)return t.config.ErrCount++,t.config.AllErrCount++,t.config.stopLoadedFlag=!0,void(t.app&&t.app.onError&&t.app.onError(t.nodeFilter.xhr.status,t.nodeFilter.xhr.statusText));var s=e.length;if(0<t.config.iSaveWaitLog||t.config.mdebug){let e="[{0}][{1}]##IOController.startReq RangeEnd[{2}] fileLength[{3}] errorcode[{4}]".format(b("hh:mm:ss:S",new Date),t.config.mediaType,t.range_end,o,d);t.config.mdebug&&console.log(e),t.config.debugger(e)}if(s){var c=new Date().getTime(),g=n.from(a);if(t.stat.first_cdn_time=c-r,t.config.filesize=o,t.dispatcher&&(t.dispatcher.cdnloaded.curloaded+=i),t.app&&t.app.onDataArrival&&!1==t.config.stopLoadedFlag){if(t.appendBufferEnd=t.range_start+g.length,0<t.config.iSaveWaitLog||t.config.mdebug){let e="[{0}][{1}]#IOController.startReq >>onDataArrival() range_start[{2}] size[{3}] appendBufferEnd[{4}]".format(b("hh:mm:ss:S",new Date),t.config.mediaType,t.range_start,i,t.appendBufferEnd);t.config.mdebug&&console.log(e),t.config.debugger(e)}t.app.onDataArrival(g,t.range_start)}if(t.appendBufferEnd>=t.range_end+1&&0<t.range_end)return t.config.mdebug&&console.log("[%s][%s]IOController.startReq >>callback file onComplete() range_start[%d][%d][%d] stopLoadedFlag[%s]",b("hh:mm:ss:S",new Date),t.config.mediaType,t.range_start,i,g.length,t.config.stopLoadedFlag),t.config.stopLoadedFlag=!0,void(t.app.onComplete&&t.app.onComplete());t.ToLoadCtr(v,!0)}}},{start:0,end:10},i,8e3,t.range_start,t.config.mdebug)}},i.prototype.ToFetch=function(e,t,n,i){var r=this;if(!0==r.destroyed||r.oFetchNode.isWorking()||r.config.bWatch)return;r.scdnSwitchCount=0;var d=new Date().getTime();0<r.requestTimeId&&(clearTimeout(r.requestTimeId),r.requestTimeId=0);let a=e;var s=r.config.fetchCdnSize;0<r.oFetchNode.cdnType&&1024<r.config.fetchScdnSize&&(s=r.config.fetchScdnSize);let c;if(r.dispatcher&&(c=r.dispatcher.getNodeFromType(T)),(t==L||t==S&&r.oFetchNode.cdnType==_&&r.dispatcher&&1<r.dispatcher.downloaders.length&&c)&&(s=r.config.fetchFirstSize,r.oFetchNode&&r.oFetchNode.cdnType==_&&r.dispatcher&&1<r.dispatcher.downloaders.length&&(r.app&&r.app.updateBufferLen(!0),r.config.bufferLen>r.config.bufLenCtr.b+1+r.config.PlusBufferLen&&(s=131072))),"video"!=r.config.mediaType&&s>r.config.AudioFetchBufSize&&(s=r.config.AudioFetchBufSize),0<n.to){let e=n.to-n.from+1;e<s&&0<e&&(s=e)}if(0<r.config.filesize&&n.from+s>r.config.filesize&&(s=r.config.filesize-n.from),1>s){if(0<r.config.iSaveWaitLog||r.config.mdebug){let e="[{0}][{1}]IOController.ToFetch() cdnType[{2}] bufferLen[{3}] filesize[{4}] tmpFetchSize[{5}] erro".format(b("hh:mm:ss:S",new Date),r.config.mediaType,r.oFetchNode.cdnType,parseInt(r.config.bufferLen),r.config.filesize,s);r.config.mdebug&&console.log(e),r.config.debugger(e)}return void(r.config.stopLoadedFlag=!0)}var g=r.config.fetchTimeOut;if((t==L||t==S)&&(g=r.config.fetchCdnFirstTimeOut,r.oFetchNode.cdnType==T&&(g=r.config.fetchScdnFirstTimeOut)),r.oFetchNode._onContentLengthKnown=function(e){0<r.FetchTimeOutId&&(clearTimeout(r.FetchTimeOutId),r.FetchTimeOutId=0),r.destroyed||0==r.config.filesize&&(r.config.filesize=e,0==r.config.bitrate&&r.app&&r.app.video&&0<r.app.video.duration&&(r.config.bitrate=8*o(r.config.filesize/r.app.video.duration/1024),r.config.PlusBufferLen=r.config.getPlusBufferLen(r.config.bitrate)))},r.oFetchNode._onURLRedirect=void 0,r.oFetchNode._onDataArrival=function(e,o,t){if(0<r.FetchTimeOutId&&(clearTimeout(r.FetchTimeOutId),r.FetchTimeOutId=0),!0==r.destroyed||!0==r.config.stopLoadedFlag)return void(r.oFetchNode.isWorking()&&r.oFetchNode.abort());if(1>r.appendCount&&(0<r.config.iSaveWaitLog||r.config.mdebug)){let e="[{0}][{1}]IOController.ToFetch() _onDataArrival cdnType[{2}] bufferLen[{3}] byteStart[{4}] receivedLength[{5}]".format(b("hh:mm:ss:S",new Date),r.config.mediaType,r.oFetchNode.cdnType,parseInt(r.config.bufferLen),o,t);r.config.mdebug&&console.log(e),r.config.debugger(e)}if(r.dispatcher&&r.oFetchNode.loader){let e=0;e=r.oFetchNode.loader.downbytes-r.oFetchNode.loader.syncdownbytes,0<e&&(r.oFetchNode.loader.syncdownbytes=r.oFetchNode.loader.downbytes,r.oFetchNode.loader.type==T?r.dispatcher.cdnloaded.curminerloaded+=e:r.dispatcher.cdnloaded.curloaded+=e)}r.app&&r.app.onDataArrival&&(r.appendBufferEnd=o+e.length,r.appendCount++,r.app.onDataArrival(e,o)),r.app&&0==r.appendCount%40&&r.oFetchNode.cdnType==_&&r.dispatcher&&1<r.dispatcher.length&&6>r.scdnSwitchCount&&262144<s&&(r.app.updateBufferLen(!0),r.config.bufferLen>r.config.b+1&&(r.scdnSwitchCount++,r.ToLoadCtr(v,!0)))},r.oFetchNode._onError=function(e,o,t){if(0<r.FetchTimeOutId&&(clearTimeout(r.FetchTimeOutId),r.FetchTimeOutId=0),r.destroyed||!r.oFetchNode)return;if(r.config.ErrCount++,r.config.AllErrCount++,3<r.config.iSaveWaitLog&&(r.config.iSaveLogCount=0),r.app&&r.app.updateBufferLen(!0)&&(0<r.config.iSaveWaitLog||r.config.mdebug)){let t="[{0}][{1}]##IOController.ToFetch() _onError cdnType[{2}] TimeOut[{3}] bufferLen[{4}] range[{5}] waitNum[{6}] sCanceNum[{7}] size[{8}]  ErrCount[{9}] _status[{10}] errType[{11}] errinfo[{12}]".format(b("hh:mm:ss:S",new Date),r.config.mediaType,r.oFetchNode.cdnType,g,parseInt(r.config.bufferLen),r.oFetchNode.strRange,r.config.waitNum,r.config.sCanceNum,r.oFetchNode._size,r.config.ErrCount,r.oFetchNode._status,e,JSON.stringify(o));r.config.mdebug&&console.log(t),r.config.debugger(t)}0==r.config.filesize&&o.code&&416==o.code&&r.config.RangeErrCount++,o&&o.msg&&0<o.msg.indexOf("buffer allocation")&&(r.config.iSaveWaitLog=0,r.config.cleanLogReport());let n=0;if(r.oFetchNode.loader&&(r.oFetchNode.loader.weight-=0.3,r.oFetchNode.loader.code=r.oFetchNode._status,n=r.oFetchNode.loader.useTime,r.oFetchNode.loader.downfails++,r.oFetchNode.loader.AddErrMsgArry({err_code:o.code,err_msg:o.msg,err_pos:t,node_type:r.oFetchNode.loader.nodetype,sCanceNum:r.config.sCanceNum,send_length:r.config.send_length,waitNum:r.config.waitNum,bufferLen:parseInt(r.config.bufferLen),pull_type:"fetch",range:r.oFetchNode.strRange,rangeSize:r.oFetchNode._size,timeout:g,useTime:r.oFetchNode.loader.Onedowntimes,usetimes:r.oFetchNode.loader.usetimes,url:r.oFetchNode.loader.uri}),r.oFetchNode.loader.type==T&&(r.oFetchNode.loader.updateErrTime(),r.scdnErrCount++),0.11>r.oFetchNode.loader.weight&&r.oFetchNode.loader.type==T)){r.scdnErrCount=0;let e=r.oFetchNode.loader.uri;if(r.dispatcher){var i=r.oFetchNode.loader.downbytes-r.oFetchNode.loader.reportdownbytes;0<i&&r.dispatcher.FlowReport(0),r.dispatcher.removeObj(r.oFetchNode.loader,r.dispatcher.downloaders),r.oFetchNode.loader=void 0,r.nodeCount=r.dispatcher.downloaders.length}if(0<r.config.iSaveWaitLog||r.config.mdebug){let o="[{0}][{1}]##Dispatcher.removeDownLoader new loader.length[{2}] HTTP_SDN_TYPE>> removeObj url[{3}] ".format(b("hh:mm:ss:S",new Date),r.config.mediaType,r.nodeCount,e);r.config.mdebug&&console.log(o),r.config.debugger(o)}r.queryNode()}if(0==r.config.filesize&&o.code&&416==o.code&&(r.config.RangeErrCount++,1<r.config.RangeErrCount&&-1==r.oFetchNode._size)){if(r.oFetchNode.loader&&(r.oFetchNode.loader.errMsgArry=[]),0<r.config.iSaveWaitLog||r.config.mdebug){let e="[{0}][{1}]##IOController.ToFetch() >>filesize==0 RangeErrCount[{2}] _size[{3}] onComplete".format(b("hh:mm:ss:S",new Date),r.config.mediaType,r.config.RangeErrCount,r.oFetchNode._size);r.config.mdebug&&console.log(e),r.config.debugger(e)}return r.config.stopLoadedFlag=!0,void(r.app.onComplete&&r.app.onComplete())}if(900>n&&1<r.config.iFetchErrToXhr&&r.oFetchNode.cdnType==_&&0==r.config.send_length&&(-1<o.msg.indexOf("\u6CD5 fetch")||-1<o.msg.indexOf("ailed to fetch")))return r.bFetchSupported=!1,r.oFetchNode.loader=void 0,r.switchFetch(),void r.ToLoadCtr(S,!0);if(900>n&&3<r.config.iFetchErrToXhr&&-1==o.code&&r.oFetchNode.cdnType==_&&0==r.config.send_length)return r.bFetchSupported=!1,r.oFetchNode.loader=void 0,r.switchFetch(),void r.ToLoadCtr(S,!0);if(r.app&&null!=r.app.onError&&r.oFetchNode.cdnType==_){if(0==r.config.filesize&&o.code&&416==o.code&&2>r.config.RangeErrCoun)return r.oFetchNode.loader=void 0,void r.ToLoadCtr(v,!0);if(0<r.config.iSaveWaitLog||r.config.mdebug){let e="[{0}][{1}]##IOController.ToFetch() >>CDN _onError() ".format(b("hh:mm:ss:S",new Date),r.config.mediaType);r.config.mdebug&&console.log(e),r.config.debugger(e)}return r.config.stopLoadedFlag=!0,void r.app.onError(o.code,o.msg)}r.oFetchNode.loader=void 0,r.ToLoadCtr(v,!0)},r.oFetchNode._onComplete=function(e,o){if(0<r.FetchTimeOutId&&(clearTimeout(r.FetchTimeOutId),r.FetchTimeOutId=0),!0==r.destroyed||!r.app)return;if(r.app.updateBufferLen(!0),r.dispatcher&&0<r.config.filesize&&(r.dispatcher.progressed=(r.appendBufferEnd/r.config.filesize).toFixed(2)),r.oFetchNode&&r.oFetchNode.cdnType==T&&r.UpdateTimeToSessionInfo(r.config.mediaType),r.oFetchNode.loader&&10<r.config.bufferLen){let e=r.oFetchNode.loader.downbytes-r.oFetchNode.loader.reportdownbytes;e>r.config.ReportMinSize&&r.dispatcher&&r.dispatcher.UploadFlowReport(0)}let t=0;if(r.oFetchNode.loader&&(t=r.oFetchNode.loader.Onedowntimes),0<r.config.iSaveWaitLog||r.config.mdebug){let n=r.app.loadInfo(),i="[{0}][{1}]#IOController.ToFetch() onComplete cdnType[{2}] useTime[{3}]ms appendCount[{4}] byteStart[{5}] byteEnd[{6}] size[{7}] bufferLen[{8}] loadinfo.cdn[{9}] loadinfo.scdn[{10}]".format(b("hh:mm:ss:S",new Date),r.config.mediaType,r.oFetchNode.cdnType,t,r.appendCount,e,o,r.oFetchNode._size,parseInt(r.config.bufferLen),n.cdn,n.p2p);r.config.mdebug&&console.log(i),r.config.debugger(i)}if(0==r.stat.first_cdn_time&&(r.stat.first_cdn_time=new Date().getTime()-d),0<r.config.filesize&&o>=r.config.filesize-1){if(0<r.config.iSaveWaitLog||r.config.mdebug){let e="[{0}][{1}]#IOController.ToFetch() >>callback file onComplete()".format(b("hh:mm:ss:S",new Date),r.config.mediaType);r.config.mdebug&&console.log(e),r.config.debugger(e)}return r.bPlayEnd=!0,r.dispatcher&&r.dispatcher.FlowReport(0),r.config.stopLoadedFlag=!0,void(r.app.onComplete&&r.app.onComplete())}if(r.oFetchNode.loader&&r.oFetchNode.loader.nodetype==T&&r.oFetchNode.loader.responseURL&&0<r.oFetchNode.loader.responseURL.length&&(r.config.mdebug&&console.log("[%s][%s]IOController.ToFetch() scdn return 302 remove node",b("hh:mm:ss:S",new Date),r.config.mediaType),r.dispatcher&&r.dispatcher.removeObj(r.oFetchNode.loader,r.dispatcher.downloaders),r.oFetchNode.loader=void 0,r.queryNode()),r.appendBufferEnd>=r.range_end&&0<r.range_end){if(0<r.config.iSaveWaitLog||r.config.mdebug){let e="[{0}][{1}]#IOController.ToFetch() >>one Range End onComplete()".format(b("hh:mm:ss:S",new Date),r.config.mediaType,r.oFetchNode.cdnType);r.config.mdebug&&console.log(e),r.config.debugger(e)}return r.config.stopLoadedFlag=!0,void(r.app.onComplete&&r.app.onComplete())}if(0==r.config.filesize&&r.oFetchNode._receivedLength<r.oFetchNode._size){if(0<r.config.iSaveWaitLog||r.config.mdebug){let e="[{0}][{1}]##IOController.ToFetch() >>filesize==0 _receivedLength[{2}][{3}] onComplete()".format(b("hh:mm:ss:S",new Date),r.config.mediaType,r.oFetchNode._receivedLength,r.oFetchNode._size);r.config.mdebug&&console.log(e),r.config.debugger(e)}return r.dispatcher&&r.dispatcher.FlowReport(0),r.config.stopLoadedFlag=!0,void(r.app.onComplete&&r.app.onComplete())}if(0==r.config.filesize&&-1==r.oFetchNode._size&&0<r.config.RangeErrCount){if(0<r.config.iSaveWaitLog||r.config.mdebug){let e="[{0}][{1}]##IOController.ToFetch() >>filesize==0 _size[{2}] onComplete()".format(b("hh:mm:ss:S",new Date),r.config.mediaType,r.oFetchNode._size);r.config.mdebug&&console.log(e),r.config.debugger(e)}return r.dispatcher&&r.dispatcher.FlowReport(0),r.config.stopLoadedFlag=!0,void(r.app.onComplete&&r.app.onComplete())}r.appendCount=0,r.requestTimeId=setTimeout(function(){clearTimeout(r.requestTimeId),r.requestTimeId=0,r.ToLoadCtr(v,!0)},100)},r.oFetchNode._onCance=function(){if(0<r.FetchTimeOutId&&(clearTimeout(r.FetchTimeOutId),r.FetchTimeOutId=0),!r.destroyed&&r.oFetchNode){if(r.dispatcher&&r.oFetchNode.loader){let e=0;e=r.oFetchNode.loader.downbytes-r.oFetchNode.loader.syncdownbytes,0<e&&(r.oFetchNode.loader.syncdownbytes=r.oFetchNode.loader.downbytes,r.oFetchNode.loader.type==T?r.dispatcher.cdnloaded.curminerloaded+=e:r.dispatcher.cdnloaded.curloaded+=e)}if(r.app&&r.app.updateBufferLen(!0),r.dispatcher&&0<r.config.filesize&&(r.dispatcher.progressed=(r.appendBufferEnd/r.config.filesize).toFixed(2)),0<r.config.iSaveWaitLog||r.config.mdebug){let e="[{0}][{1}]#IOController.ToFetch() _onCance() cdnType[{2}] ifirst[{3}] from[{4}] size[{5}] byteEnd[{6}] bufferLen[{7}] stopLoadedFlag[{8}]".format(b("hh:mm:ss:S",new Date),r.config.mediaType,r.oFetchNode.cdnType,t,r.oFetchNode._range.from,r.oFetchNode._size,r.oFetchNode._range.from+r.oFetchNode._receivedLength-1,parseInt(r.config.bufferLen),r.config.stopLoadedFlag);r.config.mdebug&&console.log(e),r.config.debugger(e)}r.oFetchNode.cdnType==T&&1<r.appendCount&&r.UpdateTimeToSessionInfo(r.config.mediaType),!0==r.config.stopLoadedFlag||r.ToLoadCtr(v,!0)}},r.appendCount=0,0<r.config.filesize&&(r.oFetchNode._onContentLengthKnown=void 0),0==r.config.filesize&&0<r.config.RangeErrCount&&0<n.from&&(s=0),0<r.config.iSaveWaitLog||r.config.mdebug){let e="[{0}][{1}]IOController.ToFetch() cdnType[{2}] nTimeOut[{3}] loaders.length[{4}] bufferLen[{5}] PlusBufferLen[{6}] range_end[{7}] from[{8}] end[{9}] tmpFetchSize[{10}] fileSize[{11}] bitrate[{12}]kb pos[{13}]".format(b("hh:mm:ss:S",new Date),r.config.mediaType,r.oFetchNode.cdnType,g,r.nodeCount,parseInt(r.config.bufferLen),r.config.PlusBufferLen,r.range_end,n.from,n.from+s-1,s,r.config.filesize,r.config.bitrate,i);r.config.mdebug&&console.log(e),r.config.debugger(e)}r.dispatcher&&(r.dispatcher.updateSendLen(),r.dispatcher.cdnloaded.curUrl=a),0<r.FetchTimeOutId&&(clearTimeout(r.FetchTimeOutId),r.FetchTimeOutId=0),r.oFetchNode.open(a,s-1,n.from,5e3),0==r.stat.first_cdn_byte&&(r.stat.first_cdn_byte=s),r.FetchTimeOutId=setTimeout(function(){if(0!=r.FetchTimeOutId){3<r.config.iSaveWaitLog&&(r.config.iSaveLogCount=0),5<r.config.iSaveWaitLog&&r.config.ErrCount++,r.config.AllErrCount++,clearTimeout(r.FetchTimeOutId),r.oFetchNode.abort();let o=r.oFetchNode.cdnType;if(r.FetchTimeOutId=0,r.app&&r.app.updateBufferLen(!0),0<r.config.iSaveWaitLog||r.config.mdebug){let o="[{0}][{1}]##IOController.ToFetch()>>self.NodeTimeOut()  cdnType[{2}] TimeOut[{3}] bufferLen[{4}] range[{5}] waitNum[{6}] sCanceNum[{7}] size[{8}] ErrCount[{9}] url[{10}]".format(b("hh:mm:ss:S",new Date),r.config.mediaType,r.oFetchNode.cdnType,g,parseInt(r.config.bufferLen),r.oFetchNode.strRange,r.config.waitNum,r.config.sCanceNum,r.oFetchNode._size,r.config.ErrCount,e);r.config.mdebug&&console.log(o),r.config.debugger(o)}(t==L||t==S)&&r.oFetchNode.loader&&(r.oFetchNode.loader.sdkTimeout++,r.oFetchNode.loader.downbytes++),r.NodeTimeOut(g),o==T&&7<r.config.bufferLen&&r.app&&r.app.onDataArrival&&r.app.onDataArrival("",r.appendBufferEnd,r.appendBufferEnd),r.ToLoadCtr(v,!1)}},g)},i.prototype.NodeTimeOut=function(e){var o=this;if(o.oFetchNode&&void 0!=o.oFetchNode){if(o.oFetchNode.loader&&o.oFetchNode.loader.downfails++,o.oFetchNode.loader){if(o.oFetchNode.loader.weight-=100<o.oFetchNode.loader.downbytes?0.2:0.3,o.oFetchNode.loader.code=o.oFetchNode._status,o.oFetchNode.loader.AddErrMsgArry({err_code:10,err_msg:"fetch advance TimeOut",err_pos:24,node_type:o.oFetchNode.loader.nodetype,sCanceNum:o.config.sCanceNum,send_length:o.config.send_length,waitNum:o.config.waitNum,bufferLen:parseInt(o.config.bufferLen),pull_type:"fetch",range:o.oFetchNode.strRange,rangeSize:o.oFetchNode._size,timeout:e,useTime:o.oFetchNode.loader.Onedowntimes,usetimes:o.oFetchNode.loader.usetimes,url:o.oFetchNode.loader.uri}),o.oFetchNode.loader.type==T&&(o.oFetchNode.loader.updateErrTime(),o.scdnErrCount++),0.11>o.oFetchNode.loader.weight&&o.oFetchNode.loader.type==T){o.dispatcher&&3<o.config.bufferLen&&o.dispatcher.ErrLogReport();let e=o.oFetchNode.loader.uri;if(o.dispatcher){var t=o.oFetchNode.loader.downbytes-o.oFetchNode.loader.reportdownbytes;0<t&&o.dispatcher.FlowReport(0),o.dispatcher.removeObj(o.oFetchNode.loader,o.dispatcher.downloaders),o.oFetchNode.loader=void 0,o.nodeCount=o.dispatcher.downloaders.length}if(0<o.config.iSaveWaitLog||o.config.mdebug){let t="[{0}][{1}]##IOController.NodeTimeOut() new loader.length[{2}]  remove scdnNode url[{3}]".format(b("hh:mm:ss:S",new Date),o.config.mediaType,o.nodeCount,e);o.config.mdebug&&console.log(t),o.config.debugger(t)}o.scdnErrCount=0}else if((0.7>o.oFetchNode.loader.weight||4>o.config.bufferLen)&&o.oFetchNode.cdnType==_){if(0<o.config.iSaveWaitLog||o.config.mdebug){let e="[{0}][{1}]##IOController.NodeTimeOut() >>CDN timeOut()".format(b("hh:mm:ss:S",new Date),o.config.mediaType);o.config.mdebug&&console.log(e),o.config.debugger(e)}return o.switchFetch(),o.config.stopLoadedFlag=!0,void(o.app&&o.app.onError&&o.app.onError(408,"cdn time out"))}o.queryNode()}o.switchFetch()}},i.prototype.switchFetch=function(){var e=this;e.oFetchNode&&e.oFetchNode.FetchClean(),0<e.FetchTimeOutId&&(clearTimeout(e.FetchTimeOutId),e.FetchTimeOutId=0),e.oFetchNode=void 0,e.oFetchNode=new g(e.config),e.withCredentials&&e.oFetchNode&&(e.oFetchNode.withCredentials=e.withCredentials)},i.prototype.queryNode=function(){var e=this;if(!(e.destroyed||e.bPlayEnd||null==e.dispatcher||!0==e.bQueryNode||e.config.bWatch||!e.config.bUseScdn)&&!(e.stat.req_dispatch_num>e.config.MaxGetNodesNum-1||1<e.dispatcher.downloaders.length)){if(1==e.dispatcher.downloaders.length&&0<e.config.NodesTime){var o=(new Date().getTime()-e.config.NodesTime)/1e3;o>e.config.noScdnSesTimeOut&&(e.bNotNeedQueryNode=!0)}if(e.bNotNeedQueryNode){e.bQueryNode=!0,e.stat.req_dispatch_num++;var t=new Date().getTime();e.UpdateGetNodeTimeToSessionInfo(e.config.mediaType),f(e.config,function(o){e.bQueryNode=!1,0==e.stat.first_dispatch_msecs&&(e.stat.first_dispatch_msecs=new Date().getTime()-t,e.stat.first_dispatch_nodes=o.length),o?(e.parseNodes(o),e.WriteNodeToSessionInfo(e.config.mediaType,o)):null!=e.dispatcher&&void 0!=e.dispatcher&&(e.dispatcher.noMoreNodes=!0),e.destroyed||e.bPlayEnd||e.toNoResources()})}}},i.prototype.parseNodes=function(e){var o=this;if(o.config.bUseScdn){if(0<o.config.iSaveWaitLog||o.config.mdebug){let t="[{0}][{1}]IOController.parseNodes nodes[{2}] ".format(b("hh:mm:ss:S",new Date),o.config.mediaType,JSON.stringify(e));o.config.mdebug&&console.log(t),o.config.debugger(t)}for(var t=0;t<e.length;++t){var n=e[t],i=n.uri.split("?")[0];if(-1===o.nodeList.indexOf(i)&&n.uri){o.scdnErrCount=0,o.nodeList.push(i);var r=new u(n.uri,n.type,n.nodetype,{mediaType:o.config.mediaType,config:o.config});null!=o.dispatcher&&void 0!=o.dispatcher&&(o.dispatcher.addNode(r),o.nodeCount=o.dispatcher.downloaders.length)}}}},i.prototype.toNoResources=function(){var e=this;1==e.dispatcher.downloaders.length?(e.config.mdebug&&console.log("[%s][%s]IOController.toNoResources()",b("hh:mm:ss:S",new Date),e.config.mediaType),e.bNoResources=!0):e.bNoResources=!1},i.prototype.readCfgFromLocal=function(){var e=this;if(window.localStorage&&window.localStorage.objcfg&&10<window.localStorage.objcfg.length){let o=JSON.parse(window.localStorage.objcfg),t=new Date().getTime();o&&o.local_ts&&(t-o.local_ts)/1e3<600&&o.data&&o.data.conf&&(o&&0<o.server_ts&&(e.config.server_ts=o.server_ts+(t-o.local_ts)),e.parseConfig(o))}},i.prototype.reqcloudcfg=function(){var e=this;e.config.bInitConfig||e.readCfgFromLocal(),e.config.bInitConfig&&e.queryNode();e.destroyed||e.bPlayEnd||void 0!=e.cloudCfg||e.config.bInitConfig||(this.cloudCfg=new y(function(o,t){if((e.config.server_ts=e.cloudCfg.server_ts,!e.destroyed)&&(e.queryNode(),0===o)&&t&&1<t.length){var n=JSON.parse(t);n.ok&&(n.server_ts=e.config.server_ts,n.local_ts=new Date().getTime(),e.parseConfig(n),window.localStorage&&window.localStorage.setItem("objcfg",JSON.stringify(n)))}},3e3))},i.prototype.parseConfig=function(e){var o=this;let t=e.data.conf;if(t){if(o.config.bInitConfig=!0,0<o.config.iSaveWaitLog||o.config.mdebug){let t="[{0}][{1}]IOController.parseConfig  setupTime[{2}] objConf[{3}] ".format(b("hh:mm:ss:S",new Date),o.config.mediaType,o.config.setupTime,JSON.stringify(e));o.config.mdebug&&console.log(t),o.config.debugger(t)}t.lmrtc&&0<t.lmrtc&&(o.config.limitrtc=t.lmrtc),t.cpn&&7<t.cpn&&(17>t.cpn?o.config.cdn_block_num=t.cpn:o.config.cdn_block_num=16),t.crto&&0<t.crto&&(o.config.cdn_req_timeout=e.data.crto),0<o.config.cdn_piece_num&&(o.config.cdn_block_num=16*o.config.cdn_piece_num),t.MaxWaitLogNum&&100<t.MaxWaitLogNum&&(o.config.MaxWaitLogNum=t.MaxWaitLogNum),t.MinCacheTime&&0<t.MinCacheTime&&(o.config.MinCacheTime=t.MinCacheTime),t.MidCacheTime&&0<t.MidCacheTime&&(o.config.MidCacheTime=t.MidCacheTime),t.GoodCacheTime&&0<t.GoodCacheTime&&(o.config.GoodCacheTime=t.GoodCacheTime),(!0==t.UploadLog||!1==t.UploadLog)&&"video"==o.config.mediaType&&(o.config.UploadLog=t.UploadLog),t.UploadLogInterval&&0<t.UploadLogInterval&&(o.config.UploadLogInterval=t.UploadLogInterval),t.UploadQualityInterval&&0<t.UploadQualityInterval&&(o.config.UploadQualityInterval=t.UploadQualityInterval),t.UploadFlowInterval&&0<t.UploadFlowInterval&&(o.config.UploadFlowInterval=t.UploadFlowInterval),(!0==t.bFromScdn||!1==t.bFromScdn)&&(o.config.bFromScdn=t.bFromScdn),t.MaxGetNodesNum&&3<t.MaxGetNodesNum&&(o.config.MaxGetNodesNum=t.MaxGetNodesNum),(!0==t.bUseScdn||!1==t.bUseScdn)&&(o.config.bUseScdn=t.bUseScdn),t.scdnSizeCtr&&(t.scdnSizeCtr.b&&(o.config.scdnSizeCtr.b=16*t.scdnSizeCtr.b),t.scdnSizeCtr.c&&(o.config.scdnSizeCtr.c=16*t.scdnSizeCtr.c)),t.scdnTimeOutCtr&&(t.scdnTimeOutCtr.b&&(o.config.scdnTimeOutCtr.b=t.scdnTimeOutCtr.b),t.scdnTimeOutCtr.c&&(o.config.scdnTimeOutCtr.c=t.scdnTimeOutCtr.c)),t.bufLenCtr&&(t.bufLenCtr.a&&(o.config.bufLenCtr.a=t.bufLenCtr.a),t.bufLenCtr.b&&5<t.bufLenCtr.b&&(o.config.bufLenCtr.b=t.bufLenCtr.b),t.bufLenCtr.c&&(o.config.bufLenCtr.c=t.bufLenCtr.c)),t.fetchCdnSize&&1048576<t.fetchCdnSize&&(o.config.fetchCdnSize=t.fetchCdnSize),t.fetchScdnSize&&1048576<t.fetchScdnSize&&(o.config.fetchScdnSize=t.fetchScdnSize),t.AudioFetchBufSize&&261120<t.AudioFetchBufSize&&(o.config.AudioFetchBufSize=t.AudioFetchBufSize),t.QueryNodeInterval&&29<t.QueryNodeInterval&&(o.config.QueryNodeInterval=t.QueryNodeInterval),t.fetchTimeOut&&2<t.fetchTimeOut&&8>t.fetchTimeOut&&(o.config.fetchTimeOut=1e3*t.fetchTimeOut),(!0==t.bScdnFetch||!1==t.bScdnFetch)&&(o.config.bScdnFetch=t.bScdnFetch),(!0==t.bAudioScdnFetch||!1==t.bAudioScdnFetch)&&(o.config.bAudioScdnFetch=t.bAudioScdnFetch),t.iFetchErrToXhr&&0<t.iFetchErrToXhr&&(o.config.iFetchErrToXhr=t.iFetchErrToXhr),t.CorrectionFactor&&1<t.CorrectionFactor&&1.4>t.CorrectionFactor&&(o.config.CorrectionFactor=t.CorrectionFactor),!1==o.config.bAudioScdnFetch&&"audio"==o.config.mediaType&&(o.config.bScdnFetch=!1),t.ReportMinSize&&2097152<t.ReportMinSize&&104857600>t.ReportMinSize&&(o.config.ReportMinSize=t.ReportMinSize),t.fetchCdnFirstTimeOut&&999<t.fetchCdnFirstTimeOut&&8e3>t.fetchCdnFirstTimeOut&&(o.config.fetchCdnFirstTimeOut=t.fetchCdnFirstTimeOut),t.fetchScdnFirstTimeOut&&999<t.fetchScdnFirstTimeOut&&8e3>t.fetchScdnFirstTimeOut&&(o.config.fetchScdnFirstTimeOut=t.fetchScdnFirstTimeOut),t.scdnSesTimeOut&&0<t.scdnSesTimeOut&&(o.config.scdnSesTimeOut=t.scdnSesTimeOut),t.noScdnSesTimeOut&&0<t.noScdnSesTimeOut&&(o.config.noScdnSesTimeOut=t.noScdnSesTimeOut),t.iSaveWaitLog&&0<t.iSaveWaitLog&&(o.config.iSaveWaitLog=t.iSaveWaitLog),t.UploadWaitLogInterval&&9<t.UploadWaitLogInterval&&(o.config.UploadWaitLogInterval=t.UploadWaitLogInterval),(!0==t.UploadWaitLog||!1==t.UploadWaitLog)&&("video"==o.config.mediaType||"watch"==o.config.mediaType)&&(o.config.UploadWaitLog=t.UploadWaitLog),t.fetchFirstSize&&262144<t.fetchFirstSize&&(o.config.fetchFirstSize=t.fetchFirstSize),t.xhrFirstSize&&64512<t.xhrFirstSize&&(o.config.xhrFirstSize=t.xhrFirstSize),t.xhrPartitionSize&&262144<t.xhrPartitionSize&&(o.config.xhrPartitionSize=t.xhrPartitionSize)}},i.prototype.startTimer=function(){var e=this;e.timerFlag||(e.timerFlag=!0,e.timeInterval=setInterval(function(){if(!(e.destroyed||e.bPlayEnd||!1==e.config.hasSteupded||!e.dispatcher)&&(e.config.timercount++,(!0==e.config.UploadLog&&3>e.dispatcher.FlowReportCount||e.config.bWatch)&&(e.config.bufferLen<e.config.MinCacheTime?e.stat.mincache_times++:e.config.bufferLen<e.config.MidCacheTime?e.stat.midcache_times++:e.stat.goodcache_times++),0==e.config.timercount%e.config.UploadWaitLogInterval&&e.config.UploadWaitData(),!e.config.bWatch)){if(e.config.bUseScdn&&1==e.dispatcher.downloaders.length&&0==e.config.timercount%e.config.QueryNodeInterval&&6<e.config.timercount&&(e.config.mdebug&&console.log("[%s][%s]IOController.startTimer()>>queryNode() setupTime[%d]",b("hh:mm:ss:S",new Date),e.config.mediaType,e.config.setupTime),e.queryNode()),0==e.config.timercount%e.config.UploadFlowInterval){let o=5;if(e.dispatcher&&0.85<e.dispatcher.progressed&&(o=1),0==e.config.timercount%(e.config.UploadFlowInterval*o))e.dispatcher.FlowReport(0);else{let o=e.dispatcher.cdnloaded.curloaded+e.dispatcher.cdnloaded.curloaded.preminerloaded-e.dispatcher.cdnloaded.reportdownbytes;o>e.config.ReportMinSize&&e.dispatcher.FlowReport(0)}e.dispatcher.ErrLogReport()}0==e.config.timercount%15&&0<e.config.waitNum&&0<e.config.iSaveWaitLog&&1>e.config.iSaveLogCount&&3>e.config.iAllSaveLogCount&&(e.config.timercount-e.config.iLastSaveLogTime>e.config.UploadLogInterval||0==e.config.iLastSaveLogTime)&&(e.config.logReport.saveLog(),e.config.iSaveLogCount++,e.config.iAllSaveLogCount++,e.config.iLastSaveLogTime=e.config.timercount),0==e.config.timercount%15&&0<e.config.ErrCount&&3<e.config.iSaveWaitLog&&1>e.config.iSaveLogCount&&3>e.config.iAllSaveLogCount&&(e.config.timercount-e.config.iLastSaveLogTime>e.config.UploadLogInterval||0==e.config.iLastSaveLogTime)&&(e.config.logReport.saveLog(),e.config.iSaveLogCount++,e.config.iAllSaveLogCount++,e.config.iLastSaveLogTime=e.config.timercount),!0==e.config.UploadLog&&3>e.dispatcher.FlowReportCount&&(e.dispatcher&&e.dispatcher.updateSendLen(),0==e.config.timercount%e.config.UploadQualityInterval&&e.config.bufferLen>e.config.MinCacheTime&&512000<e.config.send_length&&e.stat.send(e.stat.SCDN_DASHSDK_QUALITY,{upload_type:1})),!0==e.config.stopLoadedFlag||e.ToLoadCtr(v,!0)}},1e3))},i.prototype._initsingal=function(){var e=this;if(!(e.destroyed||e.bPlayEnd)){if(e.reqcloudcfg(),0<e.config.iSaveWaitLog||e.config.mdebug){let o="[{0}][{1}]IOController._initsingal() end loader.length[{2}] setupTime[{3}]".format(b("hh:mm:ss:S",new Date),e.config.mediaType,e.nodeCount,e.config.setupTime);e.config.mdebug&&console.log(o),e.config.debugger(o)}e.config.UploadWaitData(),0<e.stat.first_screen&&e.config.UploadLog&&!e.config.bWatch&&(e.dispatcher&&e.dispatcher.updateSendLen(),!e.config.bWatch&&e.config.UploadLog&&!e.stat.bSendQuality&&e.stat.send(e.stat.SCDN_DASHSDK_QUALITY,{upload_type:0}))}},i.prototype._startPlaying=function(){var e=this,o=20;let t=[e.hdCdn];var n=new l(t,e.config);e.dispatcher=n,e.dispatcher.app=e.app,e.config.bufferLen=e.app.buffering(),n.on("error",function(o,t){e.app&&e.app.onError&&e.app.onError(o,t)}),n.on("needmorenodes",function(){e.queryNode()}),n.on("needsource",function(){}),n.on("hdError",function(o,t){if(!(!0==e.config.stopLoadedFlag||e.destroyed)){if(3<e.config.iSaveWaitLog&&(e.config.iSaveLogCount=0),e.config.ErrCount++,e.config.AllErrCount++,0==e.config.filesize&&416==t&&(e.config.RangeErrCount++,e.config.xhrioPreEnd)){if(e.bPlayEnd=!0,o.errMsgArry=[],0<e.config.iSaveWaitLog||e.config.mdebug){let o="[{0}][{1}]IOController._startPlaying()>>'hdError' app.onComplete()".format(b("hh:mm:ss:S",new Date),e.config.mediaType);e.config.mdebug&&console.log(o),e.config.debugger(o)}return e.config.stopLoadedFlag=!0,void(e.app.onComplete&&e.app.onComplete())}if(o.type==_&&e.app&&e.app.onError){if(0<e.config.iSaveWaitLog||e.config.mdebug){let o="[{0}][{1}]##IOController._startPlaying() on('hdError'>>app.onError()".format(b("hh:mm:ss:S",new Date),e.config.mediaType);e.config.mdebug&&console.log(o),e.config.debugger(o)}return e.config.stopLoadedFlag=!0,void e.app.onError(o._xhr.status,o._xhr.statusText)}o.type==T&&e.scdnErrCount++,e.ToLoadCtr(v,!0)}}),n.on("timeout",function(t){if(!(!0==e.config.stopLoadedFlag||e.destroyed)){if(3<e.config.iSaveWaitLog&&(e.config.iSaveLogCount=0),5<e.config.iSaveWaitLog&&e.config.ErrCount++,e.config.AllErrCount++,0<e.requestTimeOutId&&(clearTimeout(e.requestTimeOutId),e.requestTimeOutId=0),t.type==_&&e.app&&e.app.onError&&0.7>t.weight){if(0<e.config.iSaveWaitLog||e.config.mdebug){let o="[{0}][{1}]##IOController._startPlaying() on('timeout'>>app.onError()".format(b("hh:mm:ss:S",new Date),e.config.mediaType);e.config.mdebug&&console.log(o),e.config.debugger(o)}e.config.stopLoadedFlag=!0,t._xhr&&0<t._xhr.status?e.app.onError(t._xhr.status,t._xhr.statusText):e.app.onError(408,"cdn time out")}else t.type==T&&e.scdnErrCount++;e.requestTimeOutId=setTimeout(function(){clearTimeout(e.requestTimeOutId),e.requestTimeOutId=0,e.ToLoadCtr(v,!0)},o)}}),n.on("onprogress",function(o,t,n){if(!(!0==e.config.stopLoadedFlag||e.destroyed)&&(0.1<n&&0==o.iProgressArrival||0.3<n&&1==o.iProgressArrival||0.5<n&&2==o.iProgressArrival||0.6<n&&3==o.iProgressArrival||0.7<n&&4==o.iProgressArrival||0.8<n&&5==o.iProgressArrival||0.9<n&&6==o.iProgressArrival)){if(o.iProgressArrival++,1==o.iProgressArrival&&(0<e.config.iSaveWaitLog||e.config.mdebug)){let t="[{0}][{1}]##Dispatcher.dispatcher>> hd.on('onprogress' cdnType[{2}] bufferLen[{3}] ".format(b("hh:mm:ss:S",new Date),e.config.mediaType,o.nodetype,parseInt(e.config.bufferLen));e.config.mdebug&&console.log(t),e.config.debugger(t)}e.app&&e.app.onDataArrival&&e.app.onDataArrival("",t,t)}}),n.on("data",function(t,n,i){if(0<e.requestTimeOutId&&(clearTimeout(e.requestTimeOutId),e.requestTimeOutId=0),!0!=e.config.stopLoadedFlag&&!e.destroyed&&e.app){e.app.onDataArrival&&(e.appendBufferEnd=n+t.length,e.app.onDataArrival(t,n),e.dispatcher&&e.dispatcher.updateSendLen(),e.app&&e.app.updateBufferLen(!0));if(0==e.config.filesize&&i-n+1>t.length&&0<n&&(e.config.xhrioPreEnd=!0),e.curLoader.type==T&&e.UpdateTimeToSessionInfo(e.config.mediaType),e.appendBufferEnd>=e.range_end+1&&0<e.range_end){if(0<e.config.iSaveWaitLog||e.config.mdebug){let o="[{0}][{1}]IOController._startPlaying()>>one Range end onComplete()".format(b("hh:mm:ss:S",new Date),e.config.mediaType);e.config.mdebug&&console.log(o),e.config.debugger(o)}return e.config.stopLoadedFlag=!0,void(e.app.onComplete&&e.app.onComplete())}if(0<e.config.filesize&&e.appendBufferEnd>=e.config.filesize-1){if(e.bPlayEnd=!0,0<e.config.iSaveWaitLog||e.config.mdebug){let o="[{0}][{1}]IOController._startPlaying()>>IOController._startPlaying()>>app.onComplete()".format(b("hh:mm:ss:S",new Date),e.config.mediaType);e.config.mdebug&&console.log(o),e.config.debugger(o)}return e.dispatcher&&e.dispatcher.FlowReport(0),e.config.stopLoadedFlag=!0,void(e.app.onComplete&&e.app.onComplete())}e.requestTimeOutId=setTimeout(function(){clearTimeout(e.requestTimeOutId),e.requestTimeOutId=0,e.ToLoadCtr(v,!0)},o)}}),e.bOnplayEvent&&e.app&&e.app.onplayEvent()},i.prototype.seek=function(){var e=this;if(!(e.destroyed||e.config.bWatch)){if(e.bPlayEnd=!1,e.config.iLastLoadTime=new Date().getTime(),0==e.config.bitrate&&0<e.config.filesize&&0<e.config.duration&&(e.config.bitrate=8*o(e.config.filesize/e.config.duration/1024),e.config.PlusBufferLen=e.config.getPlusBufferLen(e.config.bitrate)),e.oFetchNode&&e.oFetchNode.isWorking()){if(0<e.config.iSaveWaitLog||e.config.mdebug){let o="[{0}][{1}]IOController.seek() bufferLen[{2}] cdnType[{3}]  fetchCreateTime[{4}] FetchNode.isWorking() FetchNode.abort()".format(b("hh:mm:ss:S",new Date),e.config.mediaType,parseInt(e.config.bufferLen),e.oFetchNode.cdnType,e.oFetchNode.fetchCreateTime);e.config.mdebug&&console.log(o),e.config.debugger(o)}e.switchFetch()}e.withCredentials!=e.oFetchNode.withCredentials&&(e.oFetchNode.withCredentials=e.withCredentials),e.withCredentials!=e.hdCdn.withCredentials&&(e.hdCdn.withCredentials=e.withCredentials),e.curLoader&&e.curLoader.bUse&&!e.curLoader.httpIdel()&&e.curLoader.abort(),e.appendBufferEnd=e.config.bytefrom,e.range_start=e.config.bytefrom,e.range_end=e.config.byteto,e.sameAppendCount=0,e.app&&e.app.updateBufferLen(!0),e.ToLoadCtr(S,!1)}},i.prototype.abort=function(){var e=this;if(!(e.destroyed||e.config.bWatch)){let o=new Date().getTime();if(1e3<o-e.config.SdkFristTime&&1900>o-e.config.iLastLoadTime&&e.config.abortCount++,e.app){e.app.updateBufferLen(!0);let o=e.app.loadInfo();if(0<e.config.iSaveWaitLog||e.config.mdebug){let t="[{0}][{1}]IOController.abort() bufferLen[{2}] abortCount[{3}] appendBufferEnd[{4}] loadinfo.cdn[{5}] loadinfo.scdn[{6}]".format(b("hh:mm:ss:S",new Date),e.config.mediaType,parseInt(e.config.bufferLen),e.config.abortCount,e.appendBufferEnd,o.cdn,o.p2p);e.config.mdebug&&console.log(t),e.config.debugger(t)}}if(e.config.stopLoadedFlag=!0,clearTimeout(e.FetchTimeOutId),clearTimeout(e.requestTimeId),e.oFetchNode&&e.oFetchNode.isWorking()){if(0<e.config.iSaveWaitLog||e.config.mdebug){let o="[{0}][{1}]IOController.abort() bufferLen[{2}] cdnType[{3}] fetchCreateTime[{4}] FetchNode.isWorking() FetchNode.abort()".format(b("hh:mm:ss:S",new Date),e.config.mediaType,parseInt(e.config.bufferLen),e.oFetchNode.cdnType,e.oFetchNode.fetchCreateTime);e.config.mdebug&&console.log(o),e.config.debugger(o)}e.switchFetch()}e.nodeFilter&&e.nodeFilter.abort(),e.dispatcher&&0<e.config.filesize&&(e.dispatcher.progressed=(e.appendBufferEnd/e.config.filesize).toFixed(2),e.dispatcher.abort())}},i.prototype.ToLoadCtr=function(e,o){var t=this;if(!(t.destroyed||!t.dispatcher||!0==t.config.stopLoadedFlag||t.bPlayEnd||t.config.bWatch)){t.dispatcher&&t.nodeCount!=t.dispatcher.downloaders.length&&(t.nodeCount=t.dispatcher.downloaders.length),!0==o&&t.app.updateBufferLen(!0);if(t.oFetchNode&&t.bFetchSupported&&(!0==t.config.bScdnFetch||1==t.dispatcher.downloaders.length)){!1==t.config.bScdnFetch&&t.curLoader&&!t.curLoader.httpIdel()&&(t.curLoader.bUse=!1,t.curLoader.abort(),t.config.mdebug&&console.log("[%s][%s]IOController.ToLoadCtr()  from xhr to fetch",b("hh:mm:ss:S",new Date),t.config.mediaType)),1!=t.stat.download_type&&(t.stat.download_type=1);let o={from:t.appendBufferEnd,to:-1};if(0<t.range_end&&(o.to=t.range_end),!t.oFetchNode.isWorking()){t.oFetchNode.cdnType=_,t.oFetchNode.loader=t.hdCdn;let n=t.dispatcher.getNodeFromType(T);2>t.dispatcher.downloaders.length||t.config.bufferLen<t.config.bufLenCtr.b-1+t.config.PlusBufferLen||!n?t.ToFetch(t.hdCdn.uri,e,o,1):(t.oFetchNode.cdnType=T,t.oFetchNode.loader=t.dispatcher.getNodeFromType(t.oFetchNode.cdnType),t.oFetchNode.loader&&t.ToFetch(t.oFetchNode.loader.uri,e,o,2))}else if(t.oFetchNode.cdnType==_&&1<t.dispatcher.downloaders.length&&t.config.bufferLen>t.config.bufLenCtr.b+1+t.config.PlusBufferLen&&36<t.appendCount){let e=t.dispatcher.getNodeFromType(T);if(!e){if(0<t.config.iSaveWaitLog||t.config.mdebug){let e="[{0}][{1}]IOController.ToLoadCtr() Switch scdn fail bufferLen[{2}] appendCount[{3}] cdnType[{4}] ".format(b("hh:mm:ss:S",new Date),t.config.mediaType,parseInt(t.config.bufferLen),t.appendCount,t.oFetchNode.cdnType);t.config.mdebug&&console.log(e),t.config.debugger(e)}return}if(t.oFetchNode.isWorking()&&t.oFetchNode.abort(),0<t.config.iSaveWaitLog||t.config.mdebug){let e="[{0}][{1}]IOController.ToLoadCtr() Switch scdn >>oFetchNode.abort()  bufferLen[{2}] url[{3}]".format(b("hh:mm:ss:S",new Date),t.config.mediaType,parseInt(t.config.bufferLen),t.oFetchNode.loader.uri);t.config.mdebug&&console.log(e),t.config.debugger(e)}}else if(t.oFetchNode.cdnType==T&&t.config.bufferLen<t.config.bufLenCtr.a+t.config.PlusBufferLen){if(0<t.config.iSaveWaitLog||t.config.mdebug){let e="[{0}][{1}]IOController.ToLoadCtr() Switch cdn >>oFetchNode.abort() sCanceNum[{2}] bufferLen[{3}] url[{4}]".format(b("hh:mm:ss:S",new Date),t.config.mediaType,t.config.sCanceNum,parseInt(t.config.bufferLen),t.oFetchNode.loader.uri);t.config.mdebug&&console.log(e),t.config.debugger(e)}t.config.sCanceNum++,t.switchFetch(),t.oFetchNode.cdnType=_,t.oFetchNode.loader=t.hdCdn,t.ToFetch(t.hdCdn.uri,!1,o,3)}else{if(t.oldAppendCount==t.appendCount&&0<t.appendCount?t.sameAppendCount++:(t.sameAppendCount=0,t.oldAppendCount=t.appendCount),2<t.sameAppendCount)return t.oFetchNode.cdnType==T&&t.oFetchNode.loader&&t.oFetchNode.loader.updateErrTime(),t.sameAppendCount=0,t.switchFetch(),void t.ToLoadCtr(S,!0);if(0<t.config.iSaveWaitLog||t.config.mdebug){let e="[{0}][{1}]IOController.ToLoadCtr() bufferLen[{2}] appendCount[{3}] cdnType[{4}] loaders.length[{5}] send_length[{6}] appendBufferEnd[{7}]".format(b("hh:mm:ss:S",new Date),t.config.mediaType,parseInt(t.config.bufferLen),t.appendCount,t.oFetchNode.cdnType,t.nodeCount,t.config.send_length,t.appendBufferEnd);t.config.mdebug&&console.log(e),t.config.debugger(e)}}}else{if(!1==t.config.bScdnFetch&&t.oFetchNode&&t.oFetchNode.isWorking()&&(t.switchFetch(),t.config.mdebug&&console.log("[%s][%s]IOController.ToLoadCtr()  from fetch to xhr",b("hh:mm:ss:S",new Date),t.config.mediaType)),2!=t.stat.download_type&&(t.stat.download_type=2),!t.curLoader)t.curLoader=t.dispatcher.GetLoader();else if(t.curLoader.httpIdel())t.curLoader.bUse=!1,t.curLoader=t.dispatcher.GetLoader();else if(!t.curLoader.httpIdel()&&t.config.bufferLen<t.config.bufLenCtr.a+t.config.PlusBufferLen&&t.curLoader.type==T)t.config.sCanceNum++,t.curLoader.bUse=!1,t.curLoader.abort(),t.curLoader.advanceTimeOut(),t.curLoader=t.dispatcher.GetLoader();else if(!t.curLoader.httpIdel())return;if(!t.curLoader){if(!t.hdCdn.httpIdel())return;if(t.curLoader=t.hdCdn,0<t.config.iSaveWaitLog||t.config.mdebug){let e="[{0}][{1}]IOController.ToLoadCtr() switch scdn fail cdnType[{2}] loaders.length[{3}] bufferLen[{4}] PlusBufferLen[{5}] appendBufferEnd[{6}]".format(b("hh:mm:ss:S",new Date),t.config.mediaType,t.curLoader.nodetype,t.nodeCount,parseInt(t.config.bufferLen),t.config.PlusBufferLen,t.appendBufferEnd);t.config.mdebug&&console.log(e),t.config.debugger(e)}}var n=0;let o=0;e==S&&(n=t.config.xhrFirstSize,0<t.range_end?(o=t.range_end-t.appendBufferEnd+1,o<t.config.xhrPartitionSize&&(n=o)):0==t.config.bufferLen&&(n=0)),0==n&&(n=t.dispatcher.GetLoadBufSize(t.curLoader.type,t.config.bufferLen));var i=t.dispatcher.GetTimeOut(n);let r=t.appendBufferEnd,d=t.appendBufferEnd+n-1;if(d>t.range_end&&0<t.range_end&&(d=t.range_end),d>t.config.filesize&&0<t.config.filesize&&(d=t.config.filesize-1),t.curLoader.bUse=!0,0==t.config.filesize&&2<t.curLoader.sameRangeCount)return;if(0<t.config.iSaveWaitLog||t.config.mdebug){let e="[{0}][{1}]IOController.ToLoadCtr() cdnType[{2}] nTimeOut[{3}] loaders.length[{4}] bufferLen[{5}] PlusBufferLen[{6}] range_end[{7}] from[{8}] end[{9}] send_length[{10}] fileSize[{11}] bitrate[{12}]kb ".format(b("hh:mm:ss:S",new Date),t.config.mediaType,t.curLoader.nodetype,i,t.nodeCount,parseInt(t.config.bufferLen),t.config.PlusBufferLen,t.range_end,t.appendBufferEnd,d,t.config.send_length,t.config.filesize,t.config.bitrate);t.config.mdebug&&console.log(e),t.config.debugger(e)}d>r&&(0<t.requestTimeOutId&&(clearTimeout(t.requestTimeOutId),t.requestTimeOutId=0),t.dispatcher&&(t.dispatcher.updateSendLen(),t.dispatcher.cdnloaded.curUrl=t.curLoader.uri),t.curLoader.open(r,d,i))}}},i.prototype.destroy=function(){var e=this;if(!e.destroyed){var o="";if(e.app&&(o=e.app.loadInfo()),0<e.config.iSaveWaitLog||e.config.mdebug){let t="[{0}][{1}]IOController.destroy() setupTime[{2}] fileName[{3}] loadinfo.cdn[{4}] loadinfo.scdn[{5}]".format(b("hh:mm:ss:S",new Date),e.config.mediaType,e.config.setupTime,e.stat.streamname,o.cdn,o.p2p);e.config.mdebug&&console.log(t),e.config.debugger(t)}e.config.stopLoadedFlag=!0,e.destroyed=!0,e.hdCdn=void 0,clearInterval(e.timeInterval),clearTimeout(e.FetchTimeOutId),clearTimeout(e.requestTimeId),e.oFetchNode&&(e.oFetchNode.FetchClean(),e.oFetchNode=void 0),e.timeInterval=void 0,e.dispatcher&&(e.dispatcher.destroy(),e.app=null,e.dispatcher=null,e.nodeFilter&&e.nodeFilter.abort(),e.cloudCfg&&e.cloudCfg.abort(),e.nodeFilter=null,e.cloudCfg=void 0)}},i.prototype.queryNodeFromAudioLocal=function(){var e=this;window.localStorage&&window.localStorage.scdnSesTimeOut&&window.localStorage.noScdnSesTimeOut&&(e.config.scdnSesTimeOut=parseInt(window.localStorage.scdnSesTimeOut),e.config.noScdnSesTimeOut=parseInt(window.localStorage.noScdnSesTimeOut));var o=e.config.videourl.split("?")[0];if(window.localStorage&&window.localStorage.AudioGetNodesTime&&window.localStorage.AudioUrl&&o==window.localStorage.AudioUrl&&(e.config.NodesTime=window.localStorage.AudioGetNodesTime),window.sessionStorage&&window.localStorage&&window.sessionStorage.AudioScdnNodes&&window.localStorage.AudioUrl&&window.sessionStorage.AudioNodesTime&&window.localStorage.AudioGetNodesTime){var t=(new Date().getTime()-window.sessionStorage.AudioNodesTime)/1e3,n=(new Date().getTime()-window.localStorage.AudioGetNodesTime)/1e3,i="";if(20<window.sessionStorage.AudioScdnNodes.length&&(i=JSON.parse(window.sessionStorage.AudioScdnNodes)),e.config.mdebug&&console.log("[%s][%s]IOController.queryNodeFromAudioLocal  TimeInterval[%d] scdnSesTimeOut[%s] noScdnSesTimeOut[%s] tmpScdnNodes.length[%d] localStorage.AudioUrl[%s] uri[%s] sessionStorage.scdnNodes[%s]",b("yyyy-MM-dd hh:mm:ss:S",new Date),e.config.mediaType,t,e.config.scdnSesTimeOut,e.config.noScdnSesTimeOut,i.length,window.localStorage.AudioUrl,o,window.sessionStorage.AudioScdnNodes),t<e.config.scdnSesTimeOut&&window.localStorage.AudioUrl==o&&0<i.length&&(e.parseNodes(i),e.dispatcher&&1<e.dispatcher.downloaders.length))return 0==e.config.stat.first_dispatch_msecs&&(e.config.stat.first_dispatch_nodes=e.dispatcher.downloaders.length-1),void(e.bNotNeedQueryNode=!1);if(n<e.config.noScdnSesTimeOut&&window.localStorage.AudioUrl==o)return e.bNotNeedQueryNode=!1,void(e.config.NodesTime=window.localStorage.AudioGetNodesTime)}},i.prototype.queryNodeFromVideoLocal=function(){var e=this;window.localStorage&&window.localStorage.scdnSesTimeOut&&window.localStorage.noScdnSesTimeOut&&(e.config.scdnSesTimeOut=parseInt(window.localStorage.scdnSesTimeOut),e.config.noScdnSesTimeOut=parseInt(window.localStorage.noScdnSesTimeOut));var o=e.config.videourl.split("?")[0];if(window.localStorage&&window.localStorage.VideoGetNodesTime&&window.localStorage.VideoUrl&&o==window.localStorage.VideoUrl&&(e.config.NodesTime=window.localStorage.VideoGetNodesTime),window.sessionStorage&&window.localStorage&&window.sessionStorage.VideoScdnNodes&&window.localStorage.VideoUrl&&window.sessionStorage.VideoNodesTime&&window.localStorage.VideoGetNodesTime){var t=(new Date().getTime()-window.sessionStorage.VideoNodesTime)/1e3,n=(new Date().getTime()-window.localStorage.VideoGetNodesTime)/1e3,i="";if(20<window.sessionStorage.VideoScdnNodes.length&&(i=JSON.parse(window.sessionStorage.VideoScdnNodes)),e.config.mdebug&&console.log("[%s][%s]IOController.queryNodeFromVideoLocal TimeInterval[%d] scdnSesTimeOut[%s] noScdnSesTimeOut[%s] tmpScdnNodes.length[%d] localStorage.VideoUrl[%s] uri[%s] sessionStorage.VideoScdnNodes[%s]",b("yyyy-MM-dd hh:mm:ss:S",new Date),e.config.mediaType,t,e.config.scdnSesTimeOut,e.config.noScdnSesTimeOut,i.length,window.localStorage.VideoUrl,o,window.sessionStorage.VideoScdnNodes),t<e.config.scdnSesTimeOut&&window.localStorage.VideoUrl==o&&0<i.length&&(e.parseNodes(i),e.dispatcher&&1<e.dispatcher.downloaders.length))return 0==e.config.stat.first_dispatch_msecs&&(e.config.stat.first_dispatch_nodes=e.dispatcher.downloaders.length),void(e.bNotNeedQueryNode=!1);if(n<e.config.noScdnSesTimeOut&&window.localStorage.VideoUrl==o)return e.bNotNeedQueryNode=!1,e.config.NodesTime=window.localStorage.VideoGetNodesTime,void(e.config.mdebug&&console.log("[%s][%s]IOController.queryNodeFromVideoLocal bNotNeedQueryNode[%s] videourl[%s]",b("yyyy-MM-dd hh:mm:ss:S",new Date),e.config.mediaType,e.bNotNeedQueryNode,o))}},i.prototype.WriteNodeToSessionInfo=function(e,o){var t=this;if(window.sessionStorage){var n=t.config.videourl.split("?")[0];t.config.mdebug&&console.log("[%s][%s]IOController.WriteNodeToSessionInfo  nodes[%s] videourl[%s]",b("yyyy-MM-dd hh:mm:ss:S",new Date),e,JSON.stringify(o),n);let i=new Date().getTime();"video"==e?(window.sessionStorage.setItem("VideoScdnNodes",JSON.stringify(o)),window.sessionStorage.setItem("VideoNodesTime",i)):(window.sessionStorage.setItem("AudioScdnNodes",JSON.stringify(o)),window.sessionStorage.setItem("AudioNodesTime",i))}},i.prototype.UpdateTimeToSessionInfo=function(e){this;window.sessionStorage&&("video"==e?window.sessionStorage.setItem("VideoNodesTime",new Date().getTime()):window.sessionStorage.setItem("AudioNodesTime",new Date().getTime()))},i.prototype.UpdateGetNodeTimeToSessionInfo=function(e){var o=this;if(window.localStorage){var t=o.config.videourl.split("?")[0];let n=new Date().getTime();"video"==e?(window.localStorage.setItem("VideoUrl",t),window.localStorage.setItem("VideoGetNodesTime",n)):(window.localStorage.setItem("AudioUrl",t),window.localStorage.setItem("AudioGetNodesTime",n))}}}).call(this,e("buffer").Buffer)},{"../loader/cloud-cfg":11,"../loader/fetchLoader":12,"../loader/node-filter":13,"../loader/toGetNodes":14,"../loader/xhrLoader":15,"../stat/log-report":16,"../stat/statx":17,"../util/dateFtt":19,"./config":9,"./dispatcher-xhr":10,buffer:2,events:3,inherits:6}],9:[function(e,o){function t(){var e=this;e.limitrtc=200,e.cdn_block_time_out=2e3,e.rtc_block_time_out=2e3,e.max_block_num=128,e.STAT_POST_URL="https://sdk-log-scdn.yfdts.net/s.gif",e.GET_EDGE_NODES_ADDR="https://api.yfscdn.net/v1/node/get_nodes",e.GET_EDGE_NODES_URI="/v1/node/get_nodes",e.EdgeSecretKey="bilibili33JKH324Bhjbjhdsu32hU",e.useNode=!0,e.RangeErrCount=0,e.xhrioPreEnd=!1,e.ErrCount=0,e.AllErrCount=0,e.sendFailTime=16000,e.close_ts=0,e.nodedomain="bilibili",e.domain="vod.h5.bilibili.com",e.queryNodeDomain="upos-dash-mirrorks3u.bilivideo.com",e.sdkversion="1.2.6",e.sdk_channel="billiblili",e.scdnNodeParam="yfpm=1",e.iFetchErrToXhr=0,e.bWatch=!1,e.videourl="",e.keyurl="",e.bufferLen=0,e.filesize=0,e.duration=0,e.bitrate=0,e.stat=null,e.autoplay=!0,e.autoload=!0,e.stopLoadedFlag=!1,e.setupTime=0,e.mdebug=!1,e.hasLoadeddata=!1,e.hasSteupded=!1,e.scdnRespFlag=!0,e.global_cache_time=0,e.cdn_block_num=128,e.cdn_req_timeout=8e3,e.cdn_piece_num=6,e.bytefrom=0,e.byteto=-1,e.MinCacheTime=2,e.MidCacheTime=5,e.GoodCacheTime=10,e.UploadLog=!1,e.UploadLogInterval=60,e.UploadQualityInterval=60,e.UploadFlowInterval=60,e.scdnSizeCtr={b:144,c:288},e.scdnTimeOutCtr={b:1e4,c:2e4},e.bufLenCtr={a:10,b:20,c:30,d:80},e.scdnSesTimeOut=300,e.noScdnSesTimeOut=59,e.vid="",e.server_ts=0,e.timercount=0,e.fetchScdnSize=2097152,e.fetchCdnSize=2097152,e.mediaType="video",e.QueryNodeInterval=60,e.bFromScdn=!1,e.MaxGetNodesNum=5,e.fetchTimeOut=3e3,e.bScdnFetch=!0,e.bAudioScdnFetch=!0,e.NodesTime=0,e.AudioFetchBufSize=262144,e.ReportMinSize=8388608,e.CorrectionFactor=1,e.fetchCdnFirstTimeOut=3e3,e.fetchScdnFirstTimeOut=1900,e.logReport=void 0,e.iSaveWaitLog=0,e.MaxWaitLogNum=600,e.iSaveLogCount=0,e.iAllSaveLogCount=0,e.iLastSaveLogTime=0,e.waitNum=0,e.sCanceNum=0,e.bInitConfig=!1,e.send_length=0,e.iWaitReportCount=0,e.UploadWaitLogInterval=30,e.UploadWaitLog=!1,e.fetchFirstSize=819200,e.xhrFirstSize=921600,e.SdkFristTime=0,e.xhrPartitionSize=1048576,e.playSessid="",e.playDevId="",e.PlusBufferLen=0,e.bUseScdn=!0,e.abortCount=0,e.iLastLoadTime=0}o.exports=t,t.prototype.debugger=function(){var e=this;e.logReport&&0<e.iSaveWaitLog&&e.logReport.debugger(arguments)},t.prototype.cleanLogReport=function(){var e=this;e.logReport&&e.logReport.clean()},t.prototype.UploadWaitData=function(){var e=this;if(e.UploadWaitLog){if(0==e.iWaitReportCount){let o=[];o.push({upload_type:0,mincache_times:e.stat.mincache_times,midcache_times:e.stat.midcache_times,goodcache_times:e.stat.goodcache_times,bufferLen:parseInt(e.bufferLen),waitNum:e.waitNum,errorNum:e.AllErrCount,abortCount:e.abortCount}),0<o.length&&(e.iWaitReportCount++,e.stat.send(e.stat.SCDN_DASHSDK_WAIT,o))}0<e.stat.WaitMsgArry.length&&(0<e.stat.WaitMsgArry.length&&(e.iWaitReportCount++,e.stat.send(e.stat.SCDN_DASHSDK_WAIT,e.stat.WaitMsgArry)),e.stat.WaitMsgArry=[])}},t.prototype.getPlusBufferLen=function(e){this;return 1500>e?0:2500>e?1:3500>e?2:4500>e?3:5500>e?4:6500>e?5:7500>e?6:8500>e?7:8}},{}],10:[function(e,o){function t(e,o){i.call(this);var t=this;t.destroyed=!1,t.noMoreNodes=!1,t.startTime=new Date().getTime(),t.downloaders=[],t.config=o,t.timercount=0,t.cdnloaded={reportdownbytes:0,curloaded:0,curminerloaded:0,curUrl:""},t.progressed=0,t.urierrors=[],t.requestTimeId=0,t.destoryTimeId=0,t.FlowReportCount=0,t.AllFlowReportCount=0,t.abortReportTimeOutId=0,t.app=void 0,t.downloaders=e.map(function(e){return t._setupHttp(e),e})}o.exports=t;var n=e("../util/dateFtt"),i=e("events").EventEmitter,r=e("inherits"),d=e("buffer").Buffer;r(t,i);var a=8192,s=0,c=1;t.prototype.getNodeFromType=function(e){for(var o=this,t=void 0,n=0;n<o.downloaders.length;++n)if((t=o.downloaders[n],!(0<t.errTime&&1<o.downloaders.length&&t.type==c&&parseInt(new Date().getTime())<t.errTime))&&t.type==e)return t},t.prototype.GetLoader=function(){var e=this,o=void 0;if(!(!0==e.config.stopLoadedFlag||e.destroyed)){if(1==e.downloaders.length)return e.downloaders[0];for(var t=0;t<e.downloaders.length;t++)if((o=e.downloaders[t],!!o.httpIdel())&&!(0<o.errTime&&1<e.downloaders.length&&o.type==c&&parseInt(new Date().getTime())<o.errTime)&&!e._limitDownload(o.type,e.config.bufferLen))return o}},t.prototype.GetTimeOut=function(e){var o=this,t=o.config.cdn_req_timeout;return t=e==o.config.scdnSizeCtr.b*a?o.config.scdnTimeOutCtr.b:e==o.config.scdnSizeCtr.c*a?o.config.scdnTimeOutCtr.c:2097152<e?2e4:1572864<e?15000:o.config.cdn_req_timeout,t},t.prototype.sortNodes=function(){var e=this;e.downloaders.sort(function(e,o){return e.weight-o.weight})},t.prototype.GetLoadBufSize=function(e,o){var t=this,n=0;return"audio"==t.config.mediaType?0==o&&1<t.downloaders.length&&t.config.global_cache_time>t.config.bufLenCtr.b?blockNum=16:o<t.config.bufLenCtr.b?blockNum=32:blockNum=64:(e==s||e==c)&&(blockNum=t.config.max_block_num,o<t.config.bufLenCtr.b?e==s&&(0==o&&1<t.downloaders.length&&t.config.global_cache_time>t.config.bufLenCtr.b?(blockNum=32,n=0):4>o?(blockNum=32,n=1):8>o?(blockNum=64,n=2):128>t.config.cdn_block_num?(blockNum=128,n=3):(n=4,blockNum=t.config.cdn_block_num)):o<t.config.bufLenCtr.c?e==c?(n=4,blockNum=t.config.scdnSizeCtr.b):e==s&&(n=5,128>t.config.cdn_block_num?(blockNum=128,n=6):(n=7,blockNum=t.config.cdn_block_num)):e==c?(n=8,blockNum=t.config.scdnSizeCtr.c):e==s&&(n=9,blockNum=t.config.cdn_block_num,128>t.config.cdn_block_num&&(blockNum=128))),blockNum*a},t.prototype._limitDownload=function(e,o){var t=this,i=0,r=!1;if(t.config.stopLoadedFlag?(i=1,r=!0):o<t.config.bufLenCtr.b?e==c&&1<t.downloaders.length&&(i=2,r=!0):o<t.config.limitrtc?e==s&&1<t.downloaders.length&&(i=3,r=!0):(i=4,r=!0),0<t.config.iSaveWaitLog||t.config.mdebug){let o="[{0}][{1}]Dispatcher._limitDownload() limit is true cdnType[{2}] ilimitFlag[{3}] bufferLen[{4}] limitrtc[{5}] stopLoadedFlag[{6}]".format(n("hh:mm:ss:S",new Date),t.config.mediaType,e,i,parseInt(t.config.bufferLen),t.config.limitrtc,t.config.stopLoadedFlag);t.config.mdebug&&console.log(o),t.config.debugger(o)}return r},t.prototype._setupHttp=function(e){var o=this;return e.on("error",function(t,i){if(0<o.config.iSaveWaitLog||o.config.mdebug){let r="[{0}][{1}]##Dispatcher._setupHttp>> hd.on('error' cdnType[{2}] TimeOut[{3}] bufferLen[{4}] range[{5}] waitNum[{6}] sCanceNum[{7}] size[{8}] error[{9}] errMsg[{10}] weight[{11}] useTime[{12}] hd.uri[{13}]".format(n("hh:mm:ss:S",new Date),o.config.mediaType,e.nodetype,e.timeout,parseInt(o.config.bufferLen),e.range,o.config.waitNum,o.config.sCanceNum,e.rangeSize,t,i,e.weight,e.Onedowntimes,e.uri);o.config.mdebug&&console.log(r),o.config.debugger(r)}o.urierrors[e.uri]?o.urierrors[e.uri]+=1:o.urierrors[e.uri]=1,e.abort(),o.sortNodes(),o.emit("hdError",e,t,i),o.removeDownLoader(e,t,i)}),e.on("timeout",function(t){if(0<o.config.iSaveWaitLog||o.config.mdebug){let t="[{0}][{1}]##Dispatcher._setupHttp>> hd.on('timeout'>>cdnType[{2}] TimeOut[{3}] bufferLen[{4}] range[{5}] waitNum[{6}] sCanceNum[{7}] size[{8}]  useTime[{9}]ms fDownLoad[{10}] weight[{11}] uri[{12}] ".format(n("hh:mm:ss:S",new Date),o.config.mediaType,e.nodetype,e.timeout,parseInt(o.config.bufferLen),e.range,o.config.waitNum,o.config.sCanceNum,e.rangeSize,e.Onedowntimes,e.fDownLoad,e.weight,e.uri);o.config.mdebug&&console.log(t),o.config.debugger(t)}o.urierrors[e.uri]?o.urierrors[e.uri]+=1:o.urierrors[e.uri]=1,e.abort(),o.sortNodes(),o.emit("timeout",e,t),o._timeoutLoader(e)}),e.on("onprogress",function(t,n){o.emit("onprogress",e,t,n)}),e.on("data",function(t,i,r){if(!o.destroyed){o.urierrors[e.uri]=0;if(e.type==c?o.cdnloaded.curminerloaded+=t.length:o.cdnloaded.curloaded+=t.length,0<o.config.iSaveWaitLog||o.config.mdebug){let d="[{0}][{1}]##Dispatcher._setupHttp>> hd.on('data' cdnType[{2}] bufferLen[{3}] size[{4}] start[{5}] end[{6}] useTime[{7}]ms".format(n("hh:mm:ss:S",new Date),o.config.mediaType,e.nodetype,parseInt(o.config.bufferLen),t.length,i,r,e.Onedowntimes);o.config.mdebug&&console.log(d),o.config.debugger(d)}if(o.emit("data",t,i,r),10<o.config.bufferLen){let t=e.downbytes-e.reportdownbytes;t>o.config.ReportMinSize&&o.UploadFlowReport(0)}if(e.nodetype==c&&e.responseURL&&0<e.responseURL.length){if(0<o.config.iSaveWaitLog||o.config.mdebug){let e="[{0}][{1}]Dispatcher._setupHttp scdn return 302 remove node".format(n("hh:mm:ss:S",new Date),o.config.mediaType);o.config.mdebug&&console.log(e),o.config.debugger(e)}o.removeObj(e,o.downloaders)}}}),e},t.prototype.FlowReport=function(e){var o=this,t=[];let n=e;(0.82<o.progressed||0==o.AllFlowReportCount%10)&&(n=0);for(var i=0;i<o.downloaders.length;i++){var r=this.downloaders[i],d=r.downbytes-r.reportdownbytes;r.nodetype==c&&o.config&&(d=parseInt(d*o.config.CorrectionFactor));var a=0;0<r.downtimes&&(a=r.downtimes-r.reportdowntimes),d>n&&(t.push({nodeip:r.uri,nodeport:80,nodetype:r.nodetype,downbytes:d,all_downbytes:r.downbytes*o.config.CorrectionFactor,downtimes:a,usetimes:r.usetimes,downfails:r.downfails,timeout:r.timeoutCnt,code:r.code,err_code:r.err_code,sdkTimeout:r.sdkTimeout,dataType:r.dataType}),r.reportdownbytes=r.downbytes,r.reportdowntimes=r.downtimes)}0<t.length?(o.cdnloaded.reportdownbytes=o.cdnloaded.curloaded+o.cdnloaded.curloaded.preminerloaded,o.config.stat.send(o.config.stat.SCDN_DASHSDK_NODE,t),o.FlowReportCount=0,o.AllFlowReportCount++):o.FlowReportCount++},t.prototype.ErrLogReport=function(){for(var e,o=this,t=[],i=0;i<o.downloaders.length;i++)if(e=o.downloaders[i],0<e.errMsgArry.length){for(var r=0;r<e.errMsgArry.length;r++)t.push(e.errMsgArry[r]);e.errMsgArry=[]}if(0<t.length){if(0<o.config.iSaveWaitLog||o.config.mdebug){let e="[{0}][{1}]Dispatcher.ErrLogReport nodesErrMsg.length[{2}] ".format(n("hh:mm:ss:S",new Date),o.config.mediaType,t.length);o.config.mdebug&&console.log(e),o.config.debugger(e)}o.config.stat.send(o.config.stat.SCDN_DASHSDK_ERROR,t)}},t.prototype.removeDownLoader=function(e,o,t){var i=this;if(e.type==c){if(2<=i.urierrors[e.uri]||0.11>e.weight){var r=e.downbytes-e.reportdownbytes;if(e.nodetype==c&&i.config&&(r=parseInt(r*i.config.CorrectionFactor)),0<r&&i.FlowReport(0),i.ErrLogReport(),0<i.config.iSaveWaitLog||i.config.mdebug){let e="[{0}][{1}]Dispatcher.removeDownLoader HTTP_SDN_TYPE>> this.removeObj(loader, this.downloaders)".format(n("hh:mm:ss:S",new Date),i.config.mediaType);i.config.mdebug&&console.log(e),i.config.debugger(e)}i.removeObj(e,i.downloaders)}i.requestMoreNodes()}else e.type===s&&3<=i.urierrors[e.uri]&&(i.config.stopLoadedFlag=!0,i.emit("error",o,t))},t.prototype._timeoutLoader=function(e){var o=this;if(e.type==c){if((2<=o.urierrors[e.uri]||0.11>e.weight)&&(o.ErrLogReport(),0<e.downbytes-e.reportdownbytes&&o.FlowReport(0),o.removeObj(e,o.downloaders),0<o.config.iSaveWaitLog||o.config.mdebug)){let e="[{0}][{1}]Dispatcher._timeoutLoader HTTP_SDN_TYPE>> this.removeObj(loader, this.downloaders)".format(n("hh:mm:ss:S",new Date),o.config.mediaType);o.config.mdebug&&console.log(e),o.config.debugger(e)}o.requestMoreNodes()}},t.prototype.addNode=function(e){if(e.type==c)for(var o,t=0;t<this.downloaders.length;t++)if(o=this.downloaders[t],o.uri===e.uri&&o.type===e.type)return;this._setupHttp(e),this.downloaders.push(e)},t.prototype.requestMoreNodes=function(){0<this.downloaders.length&&1>=this.downloaders.length&&!this.noMoreNodes&&this.emit("needmorenodes")},t.prototype.abort=function(){var e=this;if(!e.destroyed){for(var o,t=0;t<e.downloaders.length;++t)o=e.downloaders[t],(o.type===c||o.type==s)&&o.downloading&&o.abort();e.UploadFlowReport(e.config.ReportMinSize)}},t.prototype.UploadFlowReport=function(e){var o=this;if(o.destroyed)return;let t=19;0.8<o.progressed&&(t=10),o.config.bufferLen>t&&(0<o.abortReportTimeOutId&&clearTimeout(o.abortReportTimeOutId),o.abortReportTimeOutId=setTimeout(function(){clearTimeout(o.abortReportTimeOutId),o.abortReportTimeOutId=0,o.FlowReport(e)},10))},t.prototype.destroy=function(){var e=this;if(!e.destroyed){if(0<e.config.iSaveWaitLog||e.config.mdebug){let o="[{0}][{1}]Dispatcher.destroy() downloaders.length[{2}]".format(n("hh:mm:ss:S",new Date),e.config.mediaType,e.downloaders.length);e.config.mdebug&&console.log(o),e.config.debugger(o)}for(e.destroyed=!0,e.app=void 0,k=0;k<e.downloaders.length;++k)e.downloaders[k].destroy();e.destoryTimeId=setTimeout(function(){clearTimeout(e.destoryTimeId),e.config.UploadWaitData(),e.config.bWatch||(e.updateSendLen(),!0==e.config.UploadLog&&0==e.config.close_ts&&(e.config.close_ts=new Date().getTime(),e.config.stat.send(e.config.stat.SCDN_DASHSDK_QUALITY,{upload_type:100})),e.FlowReport(0),e.ErrLogReport(),e.downloaders.length=0,0<e.config.waitNum&&1<e.config.iSaveWaitLog&&1>e.config.iSaveLogCount&&3>e.config.iAllSaveLogCount&&(e.config.logReport.saveLog(),e.config.iSaveLogCount++,e.config.iAllSaveLogCount++),0<e.config.ErrCount&&4<e.config.iSaveWaitLog&&1>e.config.iSaveLogCount&&3>e.config.iAllSaveLogCount&&(e.config.logReport.saveLog(),e.config.iSaveLogCount++,e.config.iAllSaveLogCount++),e.config.cleanLogReport())},3e3)}},t.prototype.updateSendLen=function(){var e=this;e.config.send_length=e.cdnloaded.curloaded+e.cdnloaded.curminerloaded},t.prototype.removeObj=function(e,o){for(var t=o.length,n=0;n<t;n++)if(o[n]==e){o.splice(n,1);break}}},{"../util/dateFtt":19,buffer:2,events:3,inherits:6}],11:[function(e,o){function t(e,o){var t=this;t.cb=e,t.xhr=void 0,t.abortFlag=!1,t.timerId=-1,t.server_ts=0,t.start(o)}o.exports=t;var n=e("../util/dateFtt");t.prototype.start=function(e){function o(){c=new Date().getTime();var e=n.xhr=new XMLHttpRequest;e.open("GET","https://cloudcfg.yfp2p.net/sdk/config"+"?app=h5_dash_bilibili&ver=1.1.1.10",!0),e.onreadystatechange=function(){if(2===e.readyState||3===e.readyState)n.abortFlag&&n.abort();else if(4==e.readyState&&!n.abortFlag){if(r++,200<=e.status&&300>e.status){try{d=0,g=e.response}catch(o){d=1}var o=e.getResponseHeader("date");n.server_ts=new Date(o).getTime()}else d=404==e.status?2:403==e.status?3:5;e.onerror=null,t()}},e.ontimeout=function(){r++,d=4,t()},e.onerror=function(){d=5,r++,t()},e.send()}function t(){s||(clearTimeout(n.timerId),0!=d&&r<a?o():(s=!0,i&&i(d,g)))}var n=this,i=n.cb,r=0,d=0,a=0,s=!1,c=new Date().getTime(),g=void 0;o(),n.timerId=setTimeout(function(){d=4,t()},e)},t.prototype.abort=function(){var e=this;e.xhr&&(2==e.xhr.readyState||3==e.xhr.readyState)&&e.xhr.abort(),clearTimeout(e.timerId),e.xhr.onreadystatechange=null,e.xhr.ontimeout=null,e.xhr.onerror=null,e.cb=null,e.abortFlag=!0}},{"../util/dateFtt":19}],12:[function(e,o){function t(e){this.timeout=8e3,this.timeoutId=0,this._receivedLength=0,this._range={from:0,to:0,contentLength:0,fileLength:0},this.doneCount=0,this.errorcode=0,this.retryTime=0,this.hasReturn=!1,this.startTime=0,this.endTime=0,this.response=void 0,this._status=a.kIdle,this.cdnType=0,this._size=0,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null,this._onContentLengthKnown=null,this._onCance=null,this._contentLength=null,this.withCredentials=!1,this._requestAbort=!1,this.loader=void 0,this.strRange="",this.fetchCreateTime=new Date().getTime(),this.config=e;var o=this;if(0<o.config.iSaveWaitLog||o.config.mdebug){let e="[{0}][{1}]fetchLoader create fetchCreateTime[{2}]".format(d("hh:mm:ss:S",new Date),o.config.mediaType,o.fetchCreateTime);o.config.mdebug&&console.log(e),o.config.debugger(e)}}o.exports=t;var n=e("events").EventEmitter,i=e("inherits"),r=e("../util/browser.js"),d=e("../util/dateFtt"),a={kIdle:0,kConnecting:1,kBuffering:2,kError:3,kComplete:4},s={OK:"OK",EXCEPTION:"Exception",HTTP_STATUS_CODE_INVALID:"HttpStatusCodeInvalid",CONNECTING_TIMEOUT:"ConnectingTimeout",EARLY_EOF:"EarlyEof",UNRECOVERABLE_EARLY_EOF:"UnrecoverableEarlyEof"};i(t,n),t.prototype.open=function(e,o,t,n){var i=this;if(i.isWorking()||-1>o)return void(i.config.mdebug&&console.log("[%s][%s]fetchLoader.open() cdnType[%d]  fetch is busy! or size[%d] error",d("hh:mm:ss:S",new Date),i.config.mediaType,i.cdnType,o));i.startTime=new Date().getTime(),i.loader&&(i.loader.startTime=i.startTime,++i.loader.usetimes),i.endTime=i.startTime,i.timeout=n,i._receivedLength=0,i._size=o,i.strRange="bytes=0-"+o,0<t&&0<o?i.strRange="bytes="+t+"-"+(t+o):0<t&&-1==o&&(i.strRange="bytes="+t+"-"),i._range={from:t,to:t+o};var r=new Headers;r.append("Range",i.strRange);var c="";if(c={method:"GET",headers:r,mode:"cors",cache:"no-store",redirect:"follow",referrerPolicy:"no-referrer-when-downgrade"},i.withCredentials&&0==i.cdnType&&(c.credentials="include"),0<i.config.iSaveWaitLog||i.config.mdebug){let e="[{0}][{1}]fetchLoader.open() >>fetch() fetchCreateTime[{2}] cdnType[{3}] range[{4}]".format(d("hh:mm:ss:S",new Date),i.config.mediaType,i.fetchCreateTime,i.cdnType,JSON.stringify(i.strRange));i.config.mdebug&&console.log(e),i.config.debugger(e)}return i._status=a.kConnecting,void fetch(e,c).then(function(o){if(o.ok&&200<=o.status&&299>=o.status){if(o.url&&o.url!==e&&(i._onURLRedirect&&i._onURLRedirect(o.url),0<o.url.length&&i.loader&&1==i.loader.nodetype&&(i.loader.responseURL=o.url)),i._requestAbort){i._requestAbort=!1,i._status=a.kIdle;var t=o.body.getReader().cancel();if(i._onCance)i._onCance();else if(0<i.config.iSaveWaitLog||i.config.mdebug){let e="[{0}][{1}]fetchLoader.open() >>fetch cancel() fetchCreateTime[{2}] cdnType[{3}] range[{4}]".format(d("hh:mm:ss:S",new Date),i.config.mediaType,i.fetchCreateTime,i.cdnType,JSON.stringify(i.strRange));i.config.mdebug&&console.log(e),i.config.debugger(e)}return t}var n=o.headers.get("Content-Length");if(null!=n&&(i._contentLength=parseInt(n)),i._onContentLengthKnown){let e=o.headers.get("Content-Range");if(e&&null!=e){var r=+e.split(" ",2)[1].split("/",2)[1];i._onContentLengthKnown(r)}}return i._pump.call(i,o.body.getReader())}if(i.updateLoaderTime(),i._status=a.kError,i._requestAbort=!1,0<i.config.iSaveWaitLog||i.config.mdebug){let e="[{0}][{1}]fetchLoader.fetch() cdnType[[{2}] status[{3}] statusText[{4}]".format(d("hh:mm:ss:S",new Date),i.config.mediaType,i.cdnType,o.status,o.statusText);i.config.mdebug&&console.log(e),i.config.debugger(e)}let c={code:o.status,msg:o.statusText};i._onError&&!i._requestAbort?i._onError(s.HTTP_STATUS_CODE_INVALID,c,20):i.config.mdebug&&console.log("[%s][%s]fetchLoader.open() cdnType[%d]  erro info1[%s]",d("hh:mm:ss:S",new Date),i.config.mediaType,i.cdnType,JSON.stringify(c))}).catch(function(o){i.updateLoaderTime(),i._status=a.kError,i._requestAbort=!1;let e={code:-1,msg:o.message};i.withCredentials&&0==i.cdnType&&e.msg&&(e.msg+="_withCredentials is true"),i._onError&&!i._requestAbort?i._onError(s.EXCEPTION,e,21):i.config.mdebug&&console.log("[%s][%s]fetchLoader.open() cdnType[%d]  erro info2[%s]",d("hh:mm:ss:S",new Date),i.config.mediaType,i.cdnType,JSON.stringify(e))})},t.prototype._pump=function(e){var o=this;return e.read().then(function(t){if(!t.done){o._onDataArrival&&void 0!=o._onDataArrival||(o._requestAbort=!0);var n=t.value,i=o._range.from+o._receivedLength;if(o._receivedLength+=n.byteLength,o.loader&&(o.loader.downbytes+=n.byteLength),o._status=a.kBuffering,o._onDataArrival?o._onDataArrival(n,i,o._receivedLength):o.config.mdebug&&o._requestAbort&&console.log("[%s][%s]fetchLoader._pump() cdnType[%d] can not _onDataArrival size[%d]",d("hh:mm:ss:S",new Date),o.config.mediaType,o.cdnType,n.byteLength),!0===o._requestAbort){o._requestAbort=!1,o._status=a.kIdle,o.loader&&(o.loader.downbytes+=n.byteLength);var r=e.cancel();if(o._onCance)o._onCance();else if(0<o.config.iSaveWaitLog||o.config.mdebug){let e="[{0}][{1}]fetchLoader._pump() >>fetch cancel() fetchCreateTime[{2}] cdnType[{3}] range[{4}] receivedLength[{5}] byteStart[{6}] chunk.byteLength[{7}]".format(d("hh:mm:ss:S",new Date),o.config.mediaType,o.fetchCreateTime,o.cdnType,JSON.stringify(o.strRange),o._receivedLength,i,n.byteLength);o.config.mdebug&&console.log(e),o.config.debugger(e)}return r}return o._pump.call(o,e)}if(o.updateLoaderTime(),null!==o._contentLength&&o._receivedLength<o._contentLength){o._status=a.kError;var c=s.EARLY_EOF,g={code:-2,msg:"Fetch stream meet Early-EOF"};o._onError&&!o._requestAbort?o._onError(c,g,22):o.config.mdebug&&console.log("[%s][%s]fetchLoader._pump() cdnType[%d]  erro info1[%s]",d("hh:mm:ss:S",new Date),o.config.mediaType,o.cdnType,JSON.stringify(g))}else o._status=a.kComplete,o._onComplete&&!o._requestAbort?o._onComplete(o._range.from,o._range.from+o._receivedLength-1):o.config.mdebug&&console.log("[%s][%s]fetchLoader._pump() cdnType[%d]  is  Download complete from[%s]",d("hh:mm:ss:S",new Date),o.config.mediaType,o.cdnType,o._range.from)}).catch(function(t){11===t.code&&r.msedge,o.updateLoaderTime(),o._status=a.kError;var e=0,n=null;(19===t.code||"network error"===t.message)&&(null===o._contentLength||null!==o._contentLength&&o._receivedLength<o._contentLength)?(e=s.EARLY_EOF,n={code:t.code,msg:"Fetch stream meet Early-EOF"}):(e=s.EXCEPTION,n={code:t.code,msg:t.message}),n&&(0==n.code||!t.code)&&(n.code=-2),o._onError&&!o._requestAbort?o._onError(e,n,23):o.config.mdebug&&console.log("[%s][%s]fetchLoader._pump() cdnType[%d] catch  erro info2[%s]",d("hh:mm:ss:S",new Date),o.config.mediaType,o.cdnType,JSON.stringify(n))})},t.prototype.abort=function(){var e=this;if(e.isWorking()&&(e._requestAbort=!0,e.updateLoaderTime()),0<e.config.iSaveWaitLog||e.config.mdebug){let o="[{0}][{1}]fetchLoader.abort() fetchCreateTime[{2}] cdnType[{3}] range[{4}] size[{5}]".format(d("hh:mm:ss:S",new Date),e.config.mediaType,e.fetchCreateTime,e.cdnType,JSON.stringify(e.strRange),e._size);e.config.mdebug&&console.log(o),e.config.debugger(o)}},t.prototype.FetchClean=function(){var e=this;if(0<e.config.iSaveWaitLog||e.config.mdebug){let o="[{0}][{1}]fetchLoader.FetchClean() fetchCreateTime[{2}] cdnType[{3}] range[{4}] size[{5}]".format(d("hh:mm:ss:S",new Date),e.config.mediaType,e.fetchCreateTime,e.cdnType,JSON.stringify(e.strRange),e._size);e.config.mdebug&&console.log(o),e.config.debugger(o)}e._requestAbort=!0,e.isWorking()&&(e.updateLoaderTime(),e._requestAbort=!0),e._onContentLengthKnown=void 0,e._onDataArrival=void 0,e._onError=void 0,e._onComplete=void 0,e._onCance=void 0},t.prototype.updateLoaderTime=function(){var e=this;e.endTime=new Date().getTime(),e.loader&&0<e.loader.startTime&&(e.loader.Onedowntimes=e.endTime-e.loader.startTime,e.loader.downtimes+=e.loader.Onedowntimes,e.loader.startTime=0)},t.prototype.destroy=function(){var e=this;e.FetchClean()},t.prototype.isSupported=function(){try{let e=r.msedge&&15048<=r.version.minor,o=!r.msedge||e;return self.fetch&&self.ReadableStream&&o}catch(o){return!1}},t.prototype.isWorking=function(){var e=this;return e._status===a.kConnecting||e._status===a.kBuffering}},{"../util/browser.js":18,"../util/dateFtt":19,events:3,inherits:6}],13:[function(e,o){function t(e,o,t,n,i,r,d,a){var s=this;s.nodesArray=e,s.withCredentials=o,s.cb=t,s.range=n,s.range_start=d,s.xhr=void 0,s.abortFlag=!1,s.timerId=-1,s.mdebug=a,s.start(i,r)}o.exports=t;var n=e("../util/dateFtt");t.prototype.start=function(e,o){function t(e){h=new Date().getTime();var o=r.xhr=new XMLHttpRequest;o.open("GET",e.uri,!0);var t="bytes=0-"+m;0<r.range_start&&(t="bytes="+r.range_start+"-"+(r.range_start+m)),!0==r.withCredentials&&(o.withCredentials=r.withCredentials),o.setRequestHeader("Range",t),o.responseType="arraybuffer",o.onreadystatechange=function(){if(2===o.readyState||3===o.readyState)r.abortFlag&&r.abort();else if(4==o.readyState&&!r.abortFlag){if(c++,200<=o.status&&300>o.status)try{u=0,y=o.response,g.push(e);let t=o.getResponseHeader("Content-Range");null!=t&&(f=+t.split(" ",2)[1].split("/",2)[1])}catch(o){u=1}else u=404==o.status?2:403==o.status?3:5;o.onerror=null,i()}},o.ontimeout=function(){c++,u=4,i()},o.onerror=function(){u=5,c++,i()},o.send(),r.mdebug&&console.log("[%s]NodeFilter.start End>> xhr.send() doneCount[%d] withCredentials[%s] range[%s] url[%s]",n("hh:mm:ss:S",new Date),c,r.withCredentials,JSON.stringify(t),e.uri)}function i(){p||(clearTimeout(r.timerId),0!=u&&c<l?t(d[0]):(p=!0,a&&a(g,f,u,y)))}var r=this,d=r.nodesArray,a=r.cb,s=r.range,c=0,g=[],f=0,u=0,l=1,p=!1,m=e-1,h=new Date().getTime(),y=void 0;s?s.end>d.length&&(s.end=d.length):s={start:0,end:d.length},t(d[s.end-1]),r.timerId=setTimeout(function(){u=4,i()},o)},t.prototype.abort=function(){var e=this;e.xhr&&(2==e.xhr.readyState||3==e.xhr.readyState)&&e.xhr.abort(),clearTimeout(e.timerId),e.xhr.onreadystatechange=null,e.xhr.ontimeout=null,e.xhr.onerror=null,e.cb=null,e.abortFlag=!0}},{"../util/dateFtt":19}],14:[function(e,o){o.exports=function(e,o){function i(){y++;var o=new XMLHttpRequest;o.open("GET",l,!0),o.timeout=2e3,o.onload=function(){if(200<=this.status&&300>this.status||304==this.status){a=0;var o=JSON.parse(this.response);if(e.mdebug&&console.log("[%s][%s]toGetNodes response[%s]",n("hh:mm:ss:S",new Date),e.mediaType,this.response),s=o.code,o.data&&o.data.urls){s=0;let n="";for(var t=0;t<o.data.urls.snodes.length;t++)n=o.data.urls.snodes[t],n&&(0<e.scdnNodeParam.length&&0>n.indexOf(e.scdnNodeParam)&&(0<n.indexOf("?")?n+="&"+e.scdnNodeParam:n+="?"+e.scdnNodeParam),d.push({uri:n,type:"node",nodetype:1}));for(var t=0;t<o.data.urls.cnodes.length;t++)n=o.data.urls.cnodes[t],n&&(0<e.scdnNodeParam.length&&0>n.indexOf(e.scdnNodeParam)&&(0<n.indexOf("?")?n+="&"+e.scdnNodeParam:n+="?"+e.scdnNodeParam),d.push({uri:n,type:"node",nodetype:2}))}}else a=1;r()},o.ontimeout=function(){e.mdebug&&console.log("[%s][%s]toGetNodes xhr.ontimeout()",n("hh:mm:ss",new Date),e.mediaType),a=2,r()},o.onerror=function(){e.mdebug&&console.log("[%s][%s]toGetNodes xhr.onerror()",n("hh:mm:ss",new Date),e.mediaType),a=3,r()},e.mdebug&&console.log("[%s][%s]toGetNodes send() url[%s]",n("hh:mm:ss",new Date),e.mediaType,l),o.send()}function r(){0!=a&&3>y&&!e.stopLoadedFlag?setTimeout(function(){i()},1e3*y):o(d,a,s)}var d=[],a=0,s=-1;if(!e.useNode)return void r();var c=e.GET_EDGE_NODES_ADDR,g=e.videourl;(0<e.domain.indexOf(".acgvideo.com")||0<e.domain.indexOf(".bilivideo.com"))&&(g=e.videourl.replace(e.domain,e.queryNodeDomain));var f=g,u=0;u=0<e.server_ts?parseInt(e.server_ts/1e3)+e.timercount+3600:parseInt(new Date().getTime()/1e3)+3600,f=encodeURIComponent(f);var l=c+"?url="+f+"&upt=",p=e.EdgeSecretKey,m=e.GET_EDGE_NODES_URI,h=p+"&"+u+"&"+m;h=t(h),h=h.slice(12,20)+u,l=l+h+"&ak=bilibili11hjgHGJH3ghy78gG";var y=0;i()};var t=e("blueimp-md5"),n=e("../util/dateFtt")},{"../util/dateFtt":19,"blueimp-md5":5}],15:[function(e,o){function n(e,o,t,n){r.call(this),n=n||{},this.uri=e,this.type="server"===o?0:1,this.nodetype=t,this.downbytes=0,this.reportdownbytes=0,this.syncdownbytes=0,this.downtimes=0,this.reportdowntimes=0,this.Onedowntimes=0,this.usetimes=0,this.downfails=0,this.timeoutCnt=0,this.code=0,this.err_code=0,this.lastRange=0,this.sameRangeCount=0,this.downloading=!1,this.bGetContentRange=!1,this.queue=[],this.startTime=0,this.endTime=0,this.weight=1,this.isAsync=n.isAsync||!1,this.start=0,this.end=0,this.timeout=n.timeout||1e4,this.timeoutId=0,this.blockNum=8,this.keepRecevieNum=0,this.waitAbortRange="",this.errTime=0,this._xhr=null,this.speed=0,this.fDownLoad=0,this.curDownbytes=0,this.withCredentials=!1,this.bUse=!1,this.sdkTimeout=0,this.dataType=1,this.errMsgArry=[],this.config=n.config,this.range="",this.rangeSize=0,this.iProgressArrival=0,this.responseURL=""}o.exports=n;var i=e("buffer").Buffer,r=e("events").EventEmitter,d=e("inherits"),a=e("../util/dateFtt");d(n,r);n.prototype.open=function(e,o,n){var i=this;if(void 0!==e&&null!==e){i.lastRange==e?i.sameRangeCount++:(i.lastRange=e,i.sameRangeCount=0),i.startTime=new Date().getTime(),i.endTime=i.startTime,i.rangeSize=o-e;t(e/1048576);i.usetimes+=1,0<n&&(i.timeout=n),i.isAsync?i._getChunk(e,o):i.downloading?i.queue.push([e,o]):i._getChunk(e,o),0<i.timeoutId&&(clearTimeout(i.timeoutId),i.timeoutId=0),i.timeoutId=setTimeout(function(){clearTimeout(i.timeoutId),i.timeoutId=0,0.13>i.fDownLoad&&1==i.type&&(i.updateLoadTime(),i.config.mdebug&&console.log("[%s][%s]xhrLoader.setTimeout() cdnType[%d] fDownLoad[%s] speed[%d]kb",a("hh:mm:ss:S",new Date),i.config.mediaType,i.nodetype,i.fDownLoad,i.speed),i.weight-=0.2,i.AddErrMsgArry({err_code:11,err_msg:"xhr setTimeout to TimeOut",err_pos:10,node_type:i.nodetype,sCanceNum:i.config.sCanceNum,bufferLen:parseInt(i.config.bufferLen),pull_type:"xhr",waitNum:i.config.waitNum,range:i.range,rangeSize:i.rangeSize,timeout:i.timeout,useTime:i.Onedowntimes,usetimes:i.usetimes,send_length:i.config.send_length,url:i.uri}),i.emit("timeout"))},i.timeout/2)}},n.prototype.abort=function(){var e=this;e._xhr&&(e._xhr.abort(),e._xhr.onreadystatechange=null,e._xhr.onprogress=null,e._xhr.onload=null,e._xhr.onerror=null),e.downloading=!1,0<e.timeoutId&&(clearTimeout(e.timeoutId),e.timeoutId=0)},n.prototype.clearQueue=function(){var e=this;0<e.queue.length&&(e.queue=[])},n.prototype.AddErrMsgArry=function(e){var o=this;if(o.errMsgArry.push(e),0<o.config.iSaveWaitLog||o.config.mdebug){let t="[{0}][{1}]##xhrLoader.AddErrMsgArry() length[{2}]  curErrJson[{3}]".format(a("hh:mm:ss:S",new Date),o.config.mediaType,o.errMsgArry.length,JSON.stringify(e));o.config.mdebug&&console.log(t),o.config.debugger(t)}},n.prototype.advanceTimeOut=function(){var e=this;0<e.timeoutId&&(clearTimeout(e.timeoutId),e.timeoutId=0),e.updateLoadTime(),e.weight-=0.2,e.config.mdebug&&console.log("[%s][%s]xhrLoader.advanceTimeOut() cdnType[%d] fDownLoad[%s] ",a("hh:mm:ss:S",new Date),e.config.mediaType,e.nodetype,e.fDownLoad),e.AddErrMsgArry({err_code:10,err_msg:"xhr advance TimeOut",err_pos:11,node_type:e.nodetype,sCanceNum:e.config.sCanceNum,bufferLen:parseInt(e.config.bufferLen),pull_type:"xhr",waitNum:e.config.waitNum,range:e.range,rangeSize:e.rangeSize,timeout:e.timeout,useTime:e.Onedowntimes,usetimes:e.usetimes,send_length:e.config.send_length,url:e.uri}),e.updateErrTime(),e.emit("timeout")},n.prototype._getChunk=function(e,o){var n=this;n.start=e,n.end=o,n.curDownbytes=o-e,n.downloading=!0,n.fDownLoad=0,n._xhr=null;let i=n.uri;var r=new XMLHttpRequest;n._xhr=r,r.open("GET",i),r.responseType="arraybuffer",r.timeout=n.timeout,!0==n.withCredentials&&0==n.type&&(r.withCredentials=n.withCredentials),n.range="bytes="+e+"-"+o,n.errTime=0;if(r.setRequestHeader("Range",n.range),r.onload=function(i){if(200<=r.status&&300>r.status||304==r.status)try{if(n.downloading=!1,0<n.timeoutId&&(clearTimeout(n.timeoutId),n.timeoutId=0),n.endTime=new Date().getTime(),n.Onedowntimes=n.endTime-n.startTime,n.speed=t(i.total/n.Onedowntimes),n.downtimes+=n.Onedowntimes,0==n.config.filesize&&!1==n.bGetContentRange){n.bGetContentRange=!0;let e=r.getResponseHeader("Content-Range");e&&null!=e&&(n.config.filesize=+e.split(" ",2)[1].split("/",2)[1])}if(1==n.nodetype&&n.uri!=r.responseURL&&r.responseURL&&0<r.responseURL.length&&(n.responseURL=r.responseURL),n.err_code=0,n._handleChunk(e+"-"+o,this.response),!n.isAsync&&0<n.queue.length){var d=n.queue.shift();n._getChunk(d[0],d[1])}}catch(e){n.downfails++,n.config.mdebug&&console.log("[%s][%s]xhrLoader.catch error err[%s]",a("hh:mm:ss:S",new Date),n.config.mediaType,e.message),n.AddErrMsgArry({err_code:-1,err_msg:"xhr Parsing catch Error",err_pos:15,node_type:n.nodetype,sCanceNum:n.config.sCanceNum,bufferLen:parseInt(n.config.bufferLen),pull_type:"xhr",waitNum:n.config.waitNum,range:n.range,rangeSize:n.rangeSize,timeout:n.timeout,useTime:n.Onedowntimes,usetimes:n.usetimes,send_length:n.config.send_length,url:n.uri}),n.downloading=!1,n.emit("error",-1,"xhr analysis  catch Error")}else n.updateLoadTime(),n.downfails++,n.updateErrTime(),n.AddErrMsgArry({err_code:r.status,err_msg:r.statusText,err_pos:12,node_type:n.nodetype,sCanceNum:n.config.sCanceNum,bufferLen:parseInt(n.config.bufferLen),pull_type:"xhr",waitNum:n.config.waitNum,range:n.range,rangeSize:n.rangeSize,timeout:n.timeout,useTime:n.Onedowntimes,usetimes:n.usetimes,send_length:n.config.send_length,url:n.uri}),n.code=r.status,n.err_code=5,n.downloading=!1,n.emit("error",r.status,r.statusText)},r.onreadystatechange=function(){(2===r.readyState||3===r.readyState)&&n.waitAbortRange===n.range&&(n.waitAbortRange="",r.abort(),n.downloading=!1)},r.onprogress=function(e){e.loaded&&e.total&&0<e.total&&(n.fDownLoad=(e.loaded/e.total).toFixed(2)),n.emit("onprogress",n.lastRange,n.fDownLoad)},r.onerror=function(){0<n.timeoutId&&(clearTimeout(n.timeoutId),n.timeoutId=0),n.updateLoadTime(),n.updateErrTime(),n.downfails++,n.err_code=4,n.downloading=!1,n.weight-=0.3;let e=-2,o="xhr network error";r.status&&0<r.status&&r.statusText&&(e=r.status,o=r.statusText),n.AddErrMsgArry({err_code:e,err_msg:o,err_pos:13,node_type:n.nodetype,sCanceNum:n.config.sCanceNum,bufferLen:parseInt(n.config.bufferLen),pull_type:"xhr",waitNum:n.config.waitNum,range:n.range,rangeSize:n.rangeSize,timeout:n.timeout,useTime:n.Onedowntimes,usetimes:n.usetimes,send_length:n.config.send_length,url:n.uri}),n.emit("error",e,o)},r.ontimeout=function(){0<n.timeoutId&&(clearTimeout(n.timeoutId),n.timeoutId=0),n.updateLoadTime(),n.downfails++,n.timeoutCnt++,n.weight-=0.2,n.updateErrTime();let e=408,o="xhr requist time out";r.status&&0<r.status&&r.statusText&&(e=r.status,o=r.statusText),n.AddErrMsgArry({err_code:e,err_msg:o,err_pos:14,node_type:n.nodetype,sCanceNum:n.config.sCanceNum,bufferLen:parseInt(n.config.bufferLen),pull_type:"xhr",waitNum:n.config.waitNum,range:n.range,rangeSize:n.rangeSize,timeout:n.timeout,useTime:n.Onedowntimes,usetimes:n.usetimes,send_length:n.config.send_length,url:n.uri}),n.err_code=1,n.downloading=!1,n.emit("timeout")},n.waitAbortRange="",n.iProgressArrival=0,r.send(),0<n.config.iSaveWaitLog||n.config.mdebug){let e="[{0}][{1}]xhrLoader._getChunk() >>xhr.send() cdnType[{2}] range[{3}] curDownbytes[{4}]KB speed[{5}]KB timeout[{6}] downbytes[{7}] downtimes[{8}] usetimes[{9}] downfails[{10}]".format(a("hh:mm:ss:S",new Date),n.config.mediaType,n.nodetype,n.range,parseInt(n.curDownbytes/1024),n.speed,n.timeout,n.downbytes,n.downtimes,n.usetimes,n.downfails);n.config.mdebug&&console.log(e),n.config.debugger(e)}},n.prototype._handleChunk=function(e,o){var t=this,n=e.split("-")[0],r=e.split("-")[1],d=i.from(o);t.downbytes+=d.length,t.bUse&&0<d.length&&t.emit("data",d,+n,+r)},n.prototype.updateErrTime=function(){var e=this;0<e.type&&(e.errTime=parseInt(new Date().getTime())+5e3)},n.prototype.updateTimeout=function(e){var o=this;0<e&&(o.timeout=e)},n.prototype.updateLoadTime=function(){var e=this;e.endTime=new Date().getTime(),0<e.startTime&&(e.Onedowntimes=e.endTime-e.startTime,e.downtimes+=e.Onedowntimes,e.startTime=0)},n.prototype.httpIdel=function(){var e=this;return!e.downloading&&0>=e.queue.length},n.prototype.close=function(){var e=this;e.abort()},n.prototype.destroy=function(){var e=this;e.close()}},{"../util/dateFtt":19,buffer:2,events:3,inherits:6}],16:[function(e,o){function t(e){var o=this;o.config=e,o.log="",o._logDic=[],o.startTime=new Date().getTime(),o.saved=!1}o.exports=t;var n=e("../util/dateFtt");t.prototype.clean=function(){var e=this;e._logDic=[]},t.prototype.saveLog=function(){var e=this;e.saved=!0;new Date;var o="&key=h5_dash_"+n("MMddhh",new Date)+"_"+e.config.playSessid+"_"+e.config.mediaType+"_"+e.config.vid+"_"+new Date().getTime();o+="";let t="";navigator&&navigator.userAgent&&(t+=navigator.userAgent+"\n");for(var r=0;r<this._logDic.length;r++)t+=this._logDic[r].value+"\n";e.config.mdebug&&console.log("[%s][%s]##LogReport.saveLog >>key[%s] _logDic.length[%d] logStr[%d]",n("hh:mm:ss:S",new Date),e.config.mediaType,o,e._logDic.length,t.length);var i=new XMLHttpRequest;i.open("POST","https://err-log.yfp2p.net/file?token=b306712340ef1c5569afa4bbf5c164d0&hash=yunfan&user=yunfansdk"+o),i.timeout=1e4,i.onload=function(){200<=this.status||300>this.status},i.onerror=function(){},i.ontimeout=function(){},i.setRequestHeader("Content-Type","text/plain"),i.send(t)},t.prototype.write=function(){var e=this,o=new Date().getTime(),t="";if(1==arguments.length)t=arguments[0];else for(var n=0;n<arguments.length;n++)t+=arguments[n]+",";e._logDic.length>e.config.MaxWaitLogNum&&e._logDic.shift(),e._logDic.push({time:o,value:t}),o-e._logDic[0].time>600000&&e._logDic.shift()},t.prototype.debugger=function(){var e=this,o=arguments.length,t=arguments[0],o=t.length;switch(o){case 0:break;case 1:e.write(t[0]);break;case 2:e.write(t[0],t[1]);break;case 3:e.write(t[0],t[1],t[2]);break;case 4:e.write(t[0],t[1],t[2],t[3]);break;case 5:e.write(t[0],t[1],t[2],t[3],t[4]);break;case 6:e.write(t[0],t[1],t[2],t[3],t[4],t[5]);break;case 7:e.write(t[0],t[1],t[2],t[3],t[4],t[5],t[6]);break;case 8:e.write(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]);break;case 9:e.write(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]);break;default:e.write(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9]);}}},{"../util/dateFtt":19}],17:[function(e,o){function n(){var e=this;e.fail={},e.fail.Warn_CDN_Timeout={code:1001,desc:"Warn.CDN.Timeout"},e.fail.Warn_Video_NotEnoughData={code:1002,desc:"Warn.Video.NotEnoughData"},e.fail.Err_CDN_SecurityError={code:2001,desc:"Err.CDN.SecurityError"},e.fail.Err_CDN_IOError={code:2002,desc:"Err.CDN.IOError"},e.fail.Err_CDN_RangeUnsupport={code:2003,desc:"Err.CDN.RangeInvalid"},e.fail.Err_CDN_VideoNotFound={code:2004,desc:"Err.CDN.VideoNotFound"},e.fail.Err_Video_FormatUnsupport={code:2005,desc:"Err.CDN.FormatInvalid"},e.fail.Err_CDN_QueryUnsupport={code:2006,desc:"Err.CDN.QueryInvalid"},e.fail.Err_VDIEO_TypeUnsupport={code:2007,desc:"Err.CDN.TypeUnsupport"},e.CONN_FAIL="connfail",e.NGX_LOG_CRYPT_KEY=1120700265,e.domain="",e.config=null,e.vid="",e.uid="",e.appname="",e.streamname="",e.base64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789*-[",e.SCDN_DASHSDK_QUALITY="scdn_dashsdk_quality",e.SCDN_DASHSDK_NODE="scdn_dashsdk_node",e.SCDN_DASHSDK_ERROR="scdn_dashsdk_error",e.SCDN_DASHSDK_WAIT="scdn_dashsdk_wait",e.sdk_p=3,e.sdk_v="",e.conf_v="1.1.1.10",e.uuid="",e.net=0,e.url="",e.media_time=0,e.length=0,e.server_ts=0,e.open_ts=0,e.first_cdn_byte=0,e.first_cdn_time=0,e.first_screen=0,e.mincache_times=0,e.midcache_times=0,e.goodcache_times=0,e.minsdkcache_times=0,e.midsdkcache_times=0,e.goodsdkcache_times=0,e.upload_type=0,e.bpos=0,e.req_dispatch_num=0,e.es_type="",e.sdk_cache_time=0,e.first_dispatch_nodes=0,e.first_dispatch_msecs=0,e.bSendQuality=!1,e.download_type=1,e.timeoutCnt=0,e.device_vid="",e.dtype=0,e.WaitMsgArry=[]}o.exports=n;var i=e("buffer").Buffer,r=e("../util/dateFtt");n.prototype.init=function(e,o){var t=this;t.domain=e,t.config=o,t.vid=t._getVID(),t.config.vid=t.vid,t.device_vid=t._getDeviceVID(),t.uid=t._getUID(),t.config.uid=t.uid,t.config.bWatch&&(t.dtype=1)},n.prototype.send=function(e,o){var t=this;if(""!=t.domain){var n=[],r=1,d=[],a=t.config.STAT_POST_URL+"?dm="+t.domain+"&act="+e;switch(a=encodeURI(a),e){case t.SCDN_DASHSDK_QUALITY:n.push(["sdk_p",3]),n.push(["sdk_v",t.config.sdkversion]),n.push(["sdk_channel",t.config.sdk_channel]),n.push(["conf_v",t.conf_v]),n.push(["uuid",t.vid]),n.push(["net",0]),n.push(["url",t.config.videourl]),n.push(["bitrate",t.config.bitrate]),n.push(["media_time",t.config.duration]),n.push(["length",t.config.filesize]),0<t.config.server_ts?n.push(["server_ts",t.config.server_ts+1e3*t.config.timercount]):n.push(["server_ts",0]),n.push(["open_ts",t.open_ts]),n.push(["close_ts",t.config.close_ts]),n.push(["first_cdn_byte",t.first_cdn_byte]),n.push(["first_cdn_time",t.first_cdn_time]),n.push(["first_screen",t.first_screen]),n.push(["mincache_times",t.mincache_times]),n.push(["midcache_times",t.midcache_times]),n.push(["goodcache_times",t.goodcache_times]),n.push(["minsdkcache_times",0]),n.push(["midsdkcache_times",0]),n.push(["goodsdkcache_times",0]),t.bSendQuality||(t.bSendQuality=!0),n.push(["upload_type",o.upload_type]),n.push(["bpos",t.bpos]),n.push(["req_dispatch_num",t.req_dispatch_num]),n.push(["es_type","scdn_dashsdk_quality"]),n.push(["sdk_cache_size",0]),n.push(["send_length",t.config.send_length]),n.push(["global_cache_time",t.config.global_cache_time]),n.push(["sdk_cache_time",0]),n.push(["first_dispatch_nodes",t.first_dispatch_nodes]),n.push(["first_dispatch_msecs",t.first_dispatch_msecs]),n.push(["download_type",t.download_type]),n.push(["vid",t.device_vid]),n.push(["waitNum",t.config.waitNum]),n.push(["sCanceNum",t.config.sCanceNum]);let i=t.config.playSessid+"#"+t.config.playDevId;n.push(["session_devId",i]);var s=t.generateJSON(n);d.push(s);break;case t.SCDN_DASHSDK_NODE:r=o.length;for(var c,g=0;g<o.length;++g){c=o[g],n=[],n.push(["uuid",t.vid]),n.push(["url",t.config.videourl]),n.push(["nodeip",c.nodeip]),n.push(["nodeport",c.nodeport]),n.push(["nodetype",c.nodetype]),n.push(["downprotocol",0]),n.push(["downbytes",c.downbytes]),n.push(["downtimes",c.downtimes]),n.push(["usetimes",c.usetimes]),n.push(["downfails",c.downfails]),n.push(["timeout",c.timeout]),n.push(["code",c.code]),n.push(["err_code",c.err_code]),n.push(["es_type","scdn_dashsdk_node"]),n.push(["sdk_time_out",c.sdkTimeout]),n.push(["data_type",c.dataType]),n.push(["vid",t.device_vid]),n.push(["sdk_channel",t.config.sdk_channel]),n.push(["all_downbytes",c.all_downbytes]);let e=t.config.playSessid+"#"+t.config.playDevId;n.push(["session_devId",e]);var s=t.generateJSON(n);d.push(s)}break;case t.SCDN_DASHSDK_ERROR:r=o.length;for(var c,g=0;g<o.length;++g){c=o[g],n=[],n.push(["sdk_p",3]),n.push(["sdk_v",t.config.sdkversion]),n.push(["sdk_channel",t.config.sdk_channel]),n.push(["conf_v",t.conf_v]),n.push(["uuid",t.vid]),n.push(["url",t.config.videourl]),n.push(["req_url",c.url]),n.push(["download_type",t.download_type]),n.push(["err_code",c.err_code]),n.push(["err_msg",c.err_msg]),n.push(["node_type",c.node_type]),n.push(["vid",t.device_vid]),n.push(["bufferLen",parseInt(c.bufferLen)]),n.push(["length",t.config.filesize]),n.push(["media_time",t.config.duration]),n.push(["pull_type",c.pull_type]),n.push(["err_pos",c.err_pos]),n.push(["range",c.range]),n.push(["send_length",c.send_length]),n.push(["rangeSize",c.rangeSize]),n.push(["timeout",c.timeout]),n.push(["useTime",c.useTime]),n.push(["usetimes",c.usetimes]),n.push(["waitNum",c.waitNum]),n.push(["sCanceNum",c.sCanceNum]);let e=t.config.playSessid+"#"+t.config.playDevId;n.push(["session_devId",e]);var s=t.generateJSON(n);d.push(s)}break;case t.SCDN_DASHSDK_WAIT:r=o.length;for(var c,g=0;g<o.length;++g){c=o[g],t.config.iWaitReportCount++,n=[],n.push(["sdk_p",3]),n.push(["sdk_v",t.config.sdkversion]),n.push(["sdk_channel",t.config.sdk_channel]),n.push(["conf_v",t.conf_v]),n.push(["vid",t.device_vid]),n.push(["uuid",t.vid]),n.push(["url",t.config.videourl]),n.push(["dtype",t.dtype]),n.push(["upload_type",c.upload_type]),n.push(["global_cache_time",parseInt(c.bufferLen)]),n.push(["mincache_times",c.mincache_times]),n.push(["midcache_times",c.midcache_times]),n.push(["goodcache_times",c.goodcache_times]),n.push(["waitNum",c.waitNum]),n.push(["errorNum",c.errorNum]);let e=t.config.playSessid+"#"+t.config.playDevId;n.push(["session_devId",e]),n.push(["abortCount",c.abortCount]);var s=t.generateJSON(n);d.push(s)}break;default:return;}0<d.length&&t._sendReq(a,d,e,r)}},n.prototype.AddWaitMsgArry=function(e){var o=this;if(o.WaitMsgArry=[],o.WaitMsgArry.push(e),0<o.config.iSaveWaitLog||o.config.mdebug){let t="[{0}][{1}]##Statx.AddWaitMsgArry() length[{2}]  curoJson[{3}]".format(r("hh:mm:ss:S",new Date),o.config.mediaType,o.WaitMsgArry.length,JSON.stringify(e));o.config.mdebug&&console.log(t),o.config.debugger(t)}},n.prototype._sendReq=function(e,o,t,n){function i(e,o,t){var n=new XMLHttpRequest;n.open("POST",e),n.timeout=8e3,n.onload=function(){(200<=this.status||300>this.status)&&(d.timeoutCnt=0)},n.onerror=function(){},n.ontimeout=function(){3>d.timeoutCnt&&d.SCDN_DASHSDK_NODE==o&&(d.timeoutCnt++,d.config.mdebug&&console.log("[%s][%s]Statx._sendReq ontimeout[%d] msg[%s]",r("hh:mm:ss:S",new Date),d.config.mediaType,d.timeoutCnt,s),i(e,o,t))},n.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),n.send(t),d.config.mdebug&&console.log("[%s][%s]Statx._sendReq msg[%s]",r("hh:mm:ss:S",new Date),d.config.mediaType,s)}var d=this,a=d._ngxLogEnc(JSON.stringify({key:"",count:n,dm:d.domain,act:t,data:o}),d.NGX_LOG_CRYPT_KEY),s=JSON.stringify({dm:d.domain,act:t,count:n,data:o});i(e,t,a)},n.prototype.generateJSON=function(e){var o="";if(1>e.length)return o;for(var t,n=0;n<e.length;n++)if(t=e[n][1],t instanceof Array)for(var i=0;i<t.length;i++)o+=t[i]+"|";else("string"==typeof t||"number"==typeof t)&&(o+=t+"|");return o.slice(0,-1)},n.prototype._setUID=function(){var e=this.randomString(10);return e+=new Date().getTime().toString().slice(8,13),window.localStorage&&(window.localStorage.domainUid=JSON.stringify({uid:e,sdk_ver:this.config.sdkversion})),e},n.prototype._getUID=function(){var e,o;if(window.localStorage)try{e=JSON.parse(window.localStorage.domainUid)}catch(o){}return o=e&&e.uid&&0<e.uid.length?e.sdk_ver==this.config.sdkversion?e.uid:this._setUID():this._setUID(),o},n.prototype._getVID=function(){var e=this.randomString(15);return e+=new Date().getTime().toString().slice(8,13),e},n.prototype._getDeviceVID=function(){var e="";return window.localStorage&&window.localStorage.vid&&(e=window.localStorage.vid),5>e.length&&(e=this.randomString(15),e+=new Date().getTime().toString().slice(8,13),window.localStorage&&window.localStorage.setItem("vid",e)),e},n.prototype.randomString=function(e){e=e||32;for(var o="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",n=o.length,r="",d=0;d<e;d++)r+=o.charAt(t(Math.random()*n));return r},n.prototype._ngxLogEnc=function(e,o){var t=this;o=o||t.NGX_LOG_CRYPT_KEY;for(var n=o,i=o+84836237,r=o+278417278,a=o+1995388704,d=0,s=t.str2ary(e),c=s.length;c>=8;){for(var g=0,f=parseInt(t.pick(s,d)),u=parseInt(t.pick(s,d+4)),l=16;l--;)g+=2654435769,f+=(u<<4)+n^u+g^(u>>>5)+i,u+=(f<<4)+r^f+g^(f>>>5)+a,f=parseInt(f),u=parseInt(u);t.memcpy(s,f,d),t.memcpy(s,u,d+4),d+=8,c-=8}for(;c;)s[d]^=255,++d,--c;return t.ary2Base64str(s)},n.prototype.ary2Base64str=function(e){var o=i.from(e).toString("base64");return o=o.replace(/[+]/g,"*"),o=o.replace(/[\/]/g,"-"),o=o.replace(/[=]/g,"["),o},n.prototype.str2ary=function(e){var o=i.from(e);return o},n.prototype.memcpy=function(e,o,t){var n=new ArrayBuffer(4),i=new DataView(n);i.setInt32(0,o,!1);var r=new Uint8Array(n);e[t+3]=r[0],e[t+2]=r[1],e[t+1]=r[2],e[t]=r[3]},n.prototype.pick=function(e,o){var t=i.from([e[o+3],e[o+2],e[o+1],e[o]]);return t.readUInt32BE(0)}},{"../util/dateFtt":19,buffer:2}],18:[function(e,o){var t={};(function(){var e=self.navigator.userAgent.toLowerCase(),o=/(edge)\/([\w.]+)/.exec(e)||/(opr)[\/]([\w.]+)/.exec(e)||/(chrome)[ \/]([\w.]+)/.exec(e)||/(iemobile)[\/]([\w.]+)/.exec(e)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||0<=e.indexOf("trident")&&/(rv)(?::| )([\w.]+)/.exec(e)||0>e.indexOf("compatible")&&/(firefox)[ \/]([\w.]+)/.exec(e)||[],n=/(ipad)/.exec(e)||/(ipod)/.exec(e)||/(windows phone)/.exec(e)||/(iphone)/.exec(e)||/(kindle)/.exec(e)||/(android)/.exec(e)||/(windows)/.exec(e)||/(mac)/.exec(e)||/(linux)/.exec(e)||/(cros)/.exec(e)||[],i={browser:o[5]||o[3]||o[1]||"",version:o[2]||o[4]||"0",majorVersion:o[4]||o[2]||"0",platform:n[0]||""},r={};if(i.browser){r[i.browser]=!0;var d=i.majorVersion.split(".");r.version={major:parseInt(i.majorVersion,10),string:i.version},1<d.length&&(r.version.minor=parseInt(d[1],10)),2<d.length&&(r.version.build=parseInt(d[2],10))}if(i.platform&&(r[i.platform]=!0),(r.chrome||r.opr||r.safari)&&(r.webkit=!0),r.rv||r.iemobile){r.rv&&delete r.rv;var a="msie";i.browser=a,r[a]=!0}if(r.edge){delete r.edge;var s="msedge";i.browser=s,r[s]=!0}if(r.opr){var c="opera";i.browser=c,r[c]=!0}if(r.safari&&r.android){var g="android";i.browser=g,r[g]=!0}for(var f in r.name=i.browser,r.platform=i.platform,t)t.hasOwnProperty(f)&&delete t[f];for(var f in r)t[f]=r[f]})(),o.exports=t},{}],19:[function(e,o){o.exports=function(e,n){var i={"M+":n.getMonth()+1,"d+":n.getDate(),"h+":n.getHours(),"m+":n.getMinutes(),"s+":n.getSeconds(),"q+":t((n.getMonth()+3)/3),S:n.getMilliseconds()};for(var o in /(y+)/.test(e)&&(e=e.replace(RegExp.$1,(n.getFullYear()+"").substr(4-RegExp.$1.length))),i)new RegExp("("+o+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?i[o]:("00"+i[o]).substr((""+i[o]).length)));return e}},{}],20:[function(e,t){function n(e,o,t){var n=this;n.version=d;var i=this.observer=new a;i.trigger=function(e,o){i.emit(e,e,o)},i.off=function(e,o){i.removeListener(e,o)},this.on=i.on.bind(i),this.off=i.off.bind(i),this.trigger=i.trigger.bind(i),this.emit=i.emit.bind(i),this.removeAllListeners=i.removeAllListeners.bind(i),this.iocontroller=void 0,this.mediaType=t,this.PlayEventTimeOutId=0,this.InitIO(o,e)}t.exports=n;try{var i=e("inherits"),r=e("./src/controller/IOcontroller.js"),d=e("./package.json").version,a=e("events"),s=e("./src/util/dateFtt")}catch(o){}n.prototype.InitIO=function(e,o){var t=this;if(void 0!=t.iocontroller)return void(t.iocontroller.config.mdebug&&console.log("[%s]YFDashIO.InitIO() can not repeat Init",s("hh:mm:ss:S",new Date)));if(!e||"VIDEO"!==e.tagName&&"AUDIO"!==e.tagName)throw new Error("must be video or audio!");t.video=e,t.h5vars={mdebug:!1},t.h5vars.src=o,t.h5vars.version=t.version,t.h5vars.autoplay=e.autoplay,t.h5vars.autoload=e.autoplay,t.h5vars.mdebug=t.mediaType&&"audio"==t.mediaType?window.localStorage.AudioDebug&&"true"===window.localStorage.AudioDebug:window.localStorage.mdebug&&"true"===window.localStorage.mdebug,t.iocontroller=new r(t.h5vars.src,t.h5vars,this),t.setupListeners(),t.firstScreenTime=0;var n=t.iocontroller;if(0<n.config.iSaveWaitLog||n.config.mdebug){let e="[{0}][{1}]#YFDashIO.InitIO() setupTime[{2}] fileName[{3}]".format(s("hh:mm:ss:S",new Date),n.config.mediaType,n.config.setupTime,n.stat.streamname);n.config.mdebug&&console.log(e),n.config.debugger(e)}},n.prototype.load=function(e,o){var t=this,n=this.iocontroller;if(!n)return;if(n.destroyed||!e||n.config.bWatch)return void(n.config.mdebug&&console.log("[%s][%s]YFDashIO.load() range[%s] sdk is destroyed or range error or sdk type is watch",s("hh:mm:ss:S",new Date),t.mediaType,JSON.stringify(e)));let i=0;var r={from:0,to:-1};if(e&&(0<e.from&&(r.from=e.from),0<e.to&&(r.to=e.to,i=e.to-r.from+1)),o!=n.withCredentials&&(n.withCredentials=o),0<n.config.iSaveWaitLog||n.config.mdebug){let t="[{0}][{1}]#YFDashIO.load() withCredentials[{2}] range[{3}] size[{4}] setupTime[{5}]".format(s("hh:mm:ss:S",new Date),n.config.mediaType,o,JSON.stringify(e),i,n.config.setupTime);n.config.mdebug&&console.log(t),n.config.debugger(t)}n.config.hasSteupded?t.seek(r):n._start(r,o),t.firstScreenTime=new Date().getTime()},n.prototype.pause=function(){var e=this.iocontroller;!e||e.config.bWatch||(e.config.stopLoadedFlag=!0,e.abort(),e.config.mdebug&&console.log("[%s][%s]YFDashIO.pause()",s("hh:mm:ss:S",new Date),e.config.mediaType))},n.prototype.resume=function(){var e=this.iocontroller;!e||e.config.bWatch||(e.config.stopLoadedFlag=!1)},n.prototype.seek=function(e){var o=this,t=o.iocontroller;return t?t.config.bWatch?void 0:t.destroyed||!e?void(t.config.mdebug&&console.log("[%s][%s]YFDashIO.load() range[%s] sdk is destroyed or range error",s("hh:mm:ss:S",new Date),t.config.mediaType,JSON.stringify(e))):void(t.config.bytefrom=e.from,t.config.byteto=e.to,t.bPlayEnd=!1,o.resume(),t.seek()):void 0},n.prototype.abort=function(){var e=this,o=e.iocontroller;!o||o.config.bWatch||(o.config.stopLoadedFlag=!0,o.abort())},n.prototype.onDataArrival=null,n.prototype.onError=null,n.prototype.onComplete=null,n.prototype.setupListeners=function(){var e=this,t=e.iocontroller;t&&(e.onloadedmetadata=function(){!t||t.config.bWatch||t.destroyed||t.config.stopLoadedFlag||(e.video&&0<e.video.duration&&(t.config.duration=e.video.duration),0<t.config.filesize&&0<e.video.duration&&(t.config.bitrate=8*o(t.config.filesize/t.config.duration/1024),t.config.PlusBufferLen=t.config.getPlusBufferLen(t.config.bitrate),t.config.mdebug&&console.log("[%s][%s]onloadedmetadata() filesize[%d] bitrate[%d]KB PlusBufferLen[%d]",s("hh:mm:ss:S",new Date),t.config.mediaType,t.config.filesize,t.config.bitrate/8,t.config.PlusBufferLen)),t.config.hasLoadedMetadata=!0,t.startTimer(),e.buffering())},e.video.addEventListener("loadedmetadata",e.onloadedmetadata,!0),e.onloadeddata=function(){if(t&&!t.destroyed){t.config.hasLoadeddata=!0;var o=new Date().getTime();t.config.stat.first_screen=o-e.firstScreenTime,t.config.mdebug&&console.log("[%s][%s]onloadeddata() fs[%f]\u79D2 setupTime[%s] count[%d]",s("hh:mm:ss:S",new Date),t.config.mediaType,t.config.stat.first_screen/1e3,t.config.setupTime,t.count),t.config.bWatch||(e.PlayEventTimeOutId=setTimeout(function(){clearTimeout(e.PlayEventTimeOutId),e.PlayEventTimeOutId=0,t._initsingal()},1500))}},e.video.addEventListener("loadeddata",e.onloadeddata,!0),e.onplay=function(){t&&(t.config.autoload=!0)},e.video.addEventListener("play",e.onplay,!0),e.onwaiting=function(){if(t){if(e.updateBufferLen(!0),0<t.config.iSaveWaitLog||t.config.mdebug){let e="[{0}][{1}]##YFDashIO.onwaiting() >> bufferLen[{2}]  ".format(s("hh:mm:ss:S",new Date),t.config.mediaType,parseInt(t.config.bufferLen));t.config.mdebug&&console.log(e),t.config.debugger(e)}if(!(1e3>new Date().getTime()-t.config.SdkFristTime||0<t.config.bufferLen||t.bPlayEnd)){if(t.config.waitNum++,t.config.iSaveLogCount=0,0<t.config.iSaveWaitLog||t.config.mdebug){let e="[{0}][{1}]##YFDashIO.onwaiting() >> bufferLen[{2}] waitNum[{3}]  ".format(s("hh:mm:ss:S",new Date),t.config.mediaType,parseInt(t.config.bufferLen),t.config.waitNum);t.config.mdebug&&console.log(e),t.config.debugger(e)}t.config.UploadWaitLog&&t.config.stat.AddWaitMsgArry({upload_type:1,mincache_times:t.stat.mincache_times,midcache_times:t.stat.midcache_times,goodcache_times:t.stat.goodcache_times,bufferLen:parseInt(t.config.bufferLen),waitNum:t.config.waitNum,errorNum:t.config.AllErrCount,abortCount:t.config.abortCount})}}},e.video.addEventListener("waiting",e.onwaiting,!0),e.onplaying=function(){t&&e.updateBufferLen(!0)},e.video.addEventListener("playing",e.onplaying,!0),e.onseeking=function(){if(t&&(t.config.SdkFristTime=new Date().getTime(),e.updateBufferLen(!0),0<t.config.iSaveWaitLog||t.config.mdebug)){let e="[{0}][{1}]##YFDashIO.setupListeners()>>onseeking() bufferLen[{2}] playSessid[{3}]".format(s("hh:mm:ss:S",new Date),t.config.mediaType,parseInt(t.config.bufferLen),t.config.playSessid);t.config.mdebug&&console.log(e),t.config.debugger(e)}},e.video.addEventListener("seeking",e.onseeking,!0),e.onSeeked=function(){if(t&&(e.updateBufferLen(!0),0<t.config.iSaveWaitLog||t.config.mdebug)){let e="[{0}][{1}]##YFDashIO.setupListeners()>>onSeeked() bufferLen[{2}] playSessid[{3}]".format(s("hh:mm:ss:S",new Date),t.config.mediaType,parseInt(t.config.bufferLen),t.config.playSessid);t.config.mdebug&&console.log(e),t.config.debugger(e)}},e.video.addEventListener("seeked",e.onSeeked,!0),e.oncanplay=function(){if(t&&(e.updateBufferLen(!0),0<t.config.iSaveWaitLog||t.config.mdebug)){let e="[{0}][{1}]##YFDashIO.setupListeners()>>oncanplay() bufferLen[{2}] playSessid[{3}]".format(s("hh:mm:ss:S",new Date),t.config.mediaType,parseInt(t.config.bufferLen),t.config.playSessid);t.config.mdebug&&console.log(e),t.config.debugger(e)}},e.video.addEventListener("canplay",e.oncanplay,!0),e.onpause=function(){if(t&&!t.config.bWatch&&(e.updateBufferLen(!0),0<t.config.iSaveWaitLog||t.config.mdebug)){let e="[{0}][{1}]#YFDashIO.setupListeners>>onpause() playSessid[{2}]".format(s("hh:mm:ss:S",new Date),t.config.mediaType,t.config.playSessid);t.config.mdebug&&console.log(e),t.config.debugger(e)}},e.video.addEventListener("pause",e.onpause,!0),e.onended=function(){if(t&&!(t.destroyed||t.config.stopLoadedFlag)){if(t.config.UploadWaitData(),0==t.config.close_ts){if(t.config.close_ts=new Date().getTime(),t.config.bWatch)return;t.config.UploadLog&&t.config.stat.send(t.config.stat.SCDN_DASHSDK_QUALITY,{upload_type:100})}t.config.bWatch||t.dispatcher.FlowReport(0)}},e.video.addEventListener("ended",e.onended,!0),e.onabort=function(){if(t&&!t.config.bWatch&&(e.updateBufferLen(!0),0<t.config.iSaveWaitLog||t.config.mdebug)){let e="[{0}][{1}]#YFDashIO.setupListeners>>onabort() playSessid[{2}]".format(s("hh:mm:ss:S",new Date),t.config.mediaType,t.config.playSessid);t.config.mdebug&&console.log(e),t.config.debugger(e)}},e.video.addEventListener("abort",e.onabort,!0),e.onerror=function(){if(t&&!t.config.bWatch&&(e.updateBufferLen(!0),0<t.config.iSaveWaitLog||t.config.mdebug)){let e="[{0}][{1}]#YFDashIO.setupListeners>>onerror() playSessid[{2}]".format(s("hh:mm:ss:S",new Date),t.config.mediaType,t.config.playSessid);t.config.mdebug&&console.log(e),t.config.debugger(e)}},e.video.addEventListener("error",e.onerror,!0),e.onloadstart=function(){if(t&&!t.config.bWatch&&(e.updateBufferLen(!0),0<t.config.iSaveWaitLog||t.config.mdebug)){let e="[{0}][{1}]#YFDashIO.setupListeners>>onloadstart() playSessid[{2}]".format(s("hh:mm:ss:S",new Date),t.config.mediaType,t.config.playSessid);t.config.mdebug&&console.log(e),t.config.debugger(e)}},e.video.addEventListener("loadstart",e.onloadstart,!0))},n.prototype.onplayEvent=function(){var e=this,t=e.iocontroller;if(t&&!t.config.bWatch){e.video&&0<e.video.duration&&(t.config.duration=e.video.duration),0<t.config.filesize&&0<t.config.duration&&(t.config.bitrate=8*o(t.config.filesize/t.config.duration/1024),t.config.PlusBufferLen=t.config.getPlusBufferLen(t.config.bitrate)),t.config.hasLoadeddata=!0;var n=1500;"video"==t.config.mediaType&&(n=2500),e.PlayEventTimeOutId=setTimeout(function(){clearTimeout(e.PlayEventTimeOutId),e.PlayEventTimeOutId=0,e.updateBufferLen(!0),t.startTimer(),e.buffering(),t._initsingal(),t.config.autoload=!0},n),e.updateBufferLen(!0)}},n.prototype.buffering=function(){var e=this;e.updateBufferLen(!0)},n.prototype.updateBufferLen=function(e){var o=this,t=o.iocontroller;!t||o.video&&(o.video.paused||e)&&(0==t.config.duration&&0<o.video.duration&&(t.config.duration=o.video.duration),t.config.bufferLen=o._bufferLen(),t.config.global_cache_time=t.config.bufferLen)},n.prototype._bufferLen=function(){for(var e=this,o=e.video.buffered.length,t=0,n=0;n<o;n++)if(e.video.currentTime>=e.video.buffered.start(n)&&e.video.currentTime<e.video.buffered.end(n)){t=e.video.buffered.end(n)-e.video.currentTime;break}return t},n.prototype.loadInfo=function(){var e=this,o=e.iocontroller;if(!(o&&o.config.bWatch)){if(o&&o.dispatcher){var t=parseInt(o.dispatcher.cdnloaded.curminerloaded*o.config.CorrectionFactor),n={cdn:o.dispatcher.cdnloaded.curloaded,p2p:t,url:o.dispatcher.cdnloaded.curUrl};return n}return{cdn:0,p2p:0,url:""}}},n.prototype.destroy=function(){var e=this;e.iocontroller&&(e.iocontroller.config.stopLoadedFlag=!0),0<e.PlayEventTimeOutId&&(clearTimeout(e.PlayEventTimeOutId),e.PlayEventTimeOutId=0),e.onDataArrival=null,e.onLoadError=null,e.onComplete=null,e.video&&(e.video.removeEventListener("loadedmetadata",e.onloadedmetadata,!0),e.video.removeEventListener("loadeddata",e.onloadeddata,!0),e.video.removeEventListener("play",e.onplay,!0),e.video.removeEventListener("waiting",e.onwaiting,!0),e.video.removeEventListener("playing",e.onplaying,!0),e.video.removeEventListener("ended",e.onended,!0),e.video.removeEventListener("seeking",e.onseeking,!0),e.video.removeEventListener("seeked",e.onSeeked,!0),e.video.removeEventListener("canplay",e.oncanplay,!0),e.video.removeEventListener("pause",e.onpause,!0),e.video.removeEventListener("abort",e.onabort,!0),e.video.removeEventListener("error",e.onerror,!0),e.video.removeEventListener("loadstart",e.onloadstart,!0),e.video=null),e.iocontroller&&e.iocontroller.destroy()}},{"./package.json":7,"./src/controller/IOcontroller.js":8,"./src/util/dateFtt":19,events:3,inherits:6}]},{},[20])(20)});

